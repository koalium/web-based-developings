<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>شبیه‌ساز پهپاد اطفای حریق</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        :root {
            --primary-color: #1a73e8;
            --secondary-color: #34a853;
            --danger-color: #ea4335;
            --warning-color: #fbbc05;
            --dark-color: #202124;
            --light-color: #f8f9fa;
            --gray-color: #dadce0;
            --shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

        body {
            background: linear-gradient(135deg, #1a237e 0%, #283593 100%);
            color: var(--light-color);
            min-height: 100vh;
            padding: 10px;
            overflow-x: hidden;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        header {
            text-align: center;
            padding: 20px;
            margin-bottom: 20px;
            border-bottom: 2px solid rgba(255, 255, 255, 0.1);
        }

        h1 {
            font-size: 2.2rem;
            margin-bottom: 8px;
            color: white;
        }

        .subtitle {
            font-size: 1.1rem;
            opacity: 0.9;
            margin-bottom: 20px;
        }

        .main-content {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        @media (min-width: 1024px) {
            .main-content {
                flex-direction: row;
            }
        }

        /* بخش کانواس و شبیه‌سازی */
        .simulation-section {
            flex: 3;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 16px;
            padding: 15px;
            box-shadow: var(--shadow);
            backdrop-filter: blur(10px);
        }

        .simulation-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            flex-wrap: wrap;
            gap: 10px;
        }

        .status-indicators {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
        }

        .status-item {
            display: flex;
            align-items: center;
            gap: 8px;
            background: rgba(255, 255, 255, 0.1);
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 0.9rem;
        }

        .status-icon {
            font-size: 1.2rem;
        }

        .status-battery {
            color: var(--secondary-color);
        }

        .status-water {
            color: var(--primary-color);
        }

        .status-foam {
            color: var(--warning-color);
        }

        .status-fuel {
            color: var(--danger-color);
        }

        .canvas-container {
            position: relative;
            width: 100%;
            height: 500px;
            background: #0d1525;
            border-radius: 12px;
            overflow: hidden;
            margin-bottom: 20px;
            border: 2px solid rgba(255, 255, 255, 0.1);
        }

        #simulationCanvas {
            width: 100%;
            height: 100%;
            display: block;
        }

        .fire-indicator {
            position: absolute;
            top: 20px;
            left: 20px;
            background: rgba(234, 67, 53, 0.8);
            padding: 10px 15px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            gap: 10px;
            font-weight: bold;
        }

        .fire-icon {
            animation: pulse 1.5s infinite;
        }

        @keyframes pulse {
            0% { opacity: 0.7; }
            50% { opacity: 1; }
            100% { opacity: 0.7; }
        }

        /* پنل کنترل‌ها */
        .controls-section {
            flex: 2;
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .control-panel {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 16px;
            padding: 20px;
            box-shadow: var(--shadow);
            backdrop-filter: blur(10px);
        }

        .panel-title {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.2);
        }

        .panel-title i {
            font-size: 1.5rem;
        }

        /* استایل کنترل‌های لمسی و موس */
        .controls-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 15px;
        }

        .control-group {
            background: rgba(0, 0, 0, 0.2);
            border-radius: 12px;
            padding: 15px;
            transition: all 0.3s;
        }

        .control-group:hover {
            background: rgba(0, 0, 0, 0.3);
        }

        .control-label {
            display: block;
            margin-bottom: 10px;
            font-weight: 500;
            font-size: 0.95rem;
        }

        .slider-container {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .slider-value {
            min-width: 40px;
            text-align: center;
            background: rgba(255, 255, 255, 0.1);
            padding: 4px 8px;
            border-radius: 6px;
            font-size: 0.9rem;
        }

        input[type="range"] {
            width: 100%;
            height: 8px;
            -webkit-appearance: none;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 4px;
            outline: none;
        }

        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: var(--primary-color);
            cursor: pointer;
            transition: all 0.2s;
        }

        input[type="range"]::-webkit-slider-thumb:hover {
            background: #0d5bb5;
            transform: scale(1.1);
        }

        .button-group {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 10px;
        }

        .control-btn {
            flex: 1;
            min-width: 120px;
            padding: 12px 15px;
            border: none;
            border-radius: 8px;
            background: var(--primary-color);
            color: white;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .control-btn:hover {
            background: #0d5bb5;
            transform: translateY(-2px);
        }

        .control-btn:active {
            transform: translateY(0);
        }

        .control-btn.danger {
            background: var(--danger-color);
        }

        .control-btn.danger:hover {
            background: #c23321;
        }

        .control-btn.warning {
            background: var(--warning-color);
            color: #333;
        }

        .control-btn.warning:hover {
            background: #d9a404;
        }

        .control-btn.success {
            background: var(--secondary-color);
        }

        .control-btn.success:hover {
            background: #2d924a;
        }

        /* استایل مخصوص صفحات کوچک */
        @media (max-width: 768px) {
            .controls-grid {
                grid-template-columns: repeat(auto-fill, minmax(130px, 1fr));
            }
            
            .button-group {
                flex-direction: column;
            }
            
            .control-btn {
                min-width: 100%;
            }
            
            .simulation-header {
                flex-direction: column;
                align-items: flex-start;
            }
            
            .canvas-container {
                height: 400px;
            }
        }

        @media (max-width: 480px) {
            h1 {
                font-size: 1.8rem;
            }
            
            .controls-grid {
                grid-template-columns: 1fr;
            }
            
            .canvas-container {
                height: 350px;
            }
            
            .control-panel {
                padding: 15px;
            }
        }

        /* استایل برای حالت لمسی */
        .touch-controls {
            display: none;
        }

        @media (hover: none) and (pointer: coarse) {
            .touch-controls {
                display: grid;
                grid-template-columns: repeat(3, 1fr);
                gap: 10px;
                margin-top: 20px;
            }
            
            .touch-btn {
                aspect-ratio: 1;
                border-radius: 50%;
                background: rgba(255, 255, 255, 0.2);
                display: flex;
                align-items: center;
                justify-content: center;
                font-size: 1.5rem;
                border: 2px solid rgba(255, 255, 255, 0.3);
                touch-action: manipulation;
            }
            
            .touch-btn:active {
                background: rgba(255, 255, 255, 0.3);
                transform: scale(0.95);
            }
            
            .touch-btn.double {
                grid-column: span 2;
                aspect-ratio: auto;
                border-radius: 12px;
            }
        }

        /* پانل پایین صفحه */
        .action-panel {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 16px;
            padding: 20px;
            margin-top: 20px;
            box-shadow: var(--shadow);
            backdrop-filter: blur(10px);
        }

        .log-container {
            height: 120px;
            overflow-y: auto;
            background: rgba(0, 0, 0, 0.5);
            border-radius: 8px;
            padding: 15px;
            margin-top: 15px;
            font-family: monospace;
            font-size: 0.9rem;
            line-height: 1.5;
        }

        .log-entry {
            margin-bottom: 8px;
            padding-bottom: 8px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .log-time {
            color: var(--gray-color);
            font-size: 0.8rem;
        }

        .log-message {
            color: white;
        }

        footer {
            text-align: center;
            padding: 20px;
            margin-top: 30px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            font-size: 0.9rem;
            opacity: 0.8;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1><i class="fas fa-helicopter"></i> شبیه‌ساز پهپاد اطفای حریق</h1>
            <p class="subtitle">کنترل کامل پهپاد اطفای حریق با قابلیت‌های پیشرفته - بهینه‌شده برای صفحات لمسی و موس</p>
        </header>

        <div class="main-content">
            <!-- بخش شبیه‌سازی -->
            <section class="simulation-section">
                <div class="simulation-header">
                    <h2><i class="fas fa-satellite-dish"></i> نمای شبیه‌سازی</h2>
                    <div class="status-indicators">
                        <div class="status-item">
                            <i class="fas fa-battery-full status-icon status-battery"></i>
                            <span>باتری: <span id="batteryLevel">98%</span></span>
                        </div>
                        <div class="status-item">
                            <i class="fas fa-tint status-icon status-water"></i>
                            <span>آب: <span id="waterLevel">400</span> لیتر</span>
                        </div>
                        <div class="status-item">
                            <i class="fas fa-wind status-icon status-foam"></i>
                            <span>کف: <span id="foamLevel">100%</span></span>
                        </div>
                        <div class="status-item">
                            <i class="fas fa-gas-pump status-icon status-fuel"></i>
                            <span>سوخت: <span id="fuelLevel">85%</span></span>
                        </div>
                    </div>
                </div>

                <div class="canvas-container">
                    <canvas id="simulationCanvas"></canvas>
                    <div class="fire-indicator">
                        <i class="fas fa-fire fire-icon"></i>
                        <span>شدت آتش: <span id="fireIntensity">75%</span></span>
                    </div>
                </div>

                <!-- کنترل‌های لمسی (فقط در دستگاه‌های لمسی نمایش داده می‌شود) -->
                <div class="touch-controls">
                    <div class="touch-btn" id="touchUp">
                        <i class="fas fa-arrow-up"></i>
                    </div>
                    <div class="touch-btn" id="touchTakeoff">
                        <i class="fas fa-rocket"></i>
                    </div>
                    <div class="touch-btn" id="touchLeft">
                        <i class="fas fa-arrow-left"></i>
                    </div>
                    <div class="touch-btn" id="touchDown">
                        <i class="fas fa-arrow-down"></i>
                    </div>
                    <div class="touch-btn" id="touchRight">
                        <i class="fas fa-arrow-right"></i>
                    </div>
                    <div class="touch-btn double" id="touchWater">
                        <i class="fas fa-tint"></i>
                        <span>پاشش آب</span>
                    </div>
                </div>
            </section>

            <!-- بخش کنترل‌ها -->
            <section class="controls-section">
                <!-- کنترل پرواز -->
                <div class="control-panel">
                    <div class="panel-title">
                        <i class="fas fa-plane"></i>
                        <h3>کنترل پرواز</h3>
                    </div>
                    <div class="button-group">
                        <button class="control-btn success" id="takeoffBtn">
                            <i class="fas fa-rocket"></i>
                            پرواز
                        </button>
                        <button class="control-btn danger" id="landBtn">
                            <i class="fas fa-landmark"></i>
                            فرود
                        </button>
                        <button class="control-btn" id="hoverBtn">
                            <i class="fas fa-pause-circle"></i>
                            شناور
                        </button>
                    </div>
                    
                    <div class="controls-grid">
                        <div class="control-group">
                            <label class="control-label">ارتفاع</label>
                            <div class="slider-container">
                                <input type="range" id="altitudeSlider" min="0" max="100" value="0">
                                <span class="slider-value" id="altitudeValue">0 متر</span>
                            </div>
                        </div>
                        
                        <div class="control-group">
                            <label class="control-label">سرعت</label>
                            <div class="slider-container">
                                <input type="range" id="speedSlider" min="0" max="100" value="30">
                                <span class="slider-value" id="speedValue">30 km/h</span>
                            </div>
                        </div>
                        
                        <div class="control-group">
                            <label class="control-label">زاویه بال</label>
                            <div class="slider-container">
                                <input type="range" id="wingAngleSlider" min="-15" max="30" value="5">
                                <span class="slider-value" id="wingAngleValue">5°</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- کنترل بازوها و نازل‌ها -->
                <div class="control-panel">
                    <div class="panel-title">
                        <i class="fas fa-robot"></i>
                        <h3>کنترل بازوها و نازل‌ها</h3>
                    </div>
                    
                    <div class="controls-grid">
                        <div class="control-group">
                            <label class="control-label">بازوها</label>
                            <div class="button-group">
                                <button class="control-btn" id="extendArmsBtn">
                                    <i class="fas fa-expand-alt"></i>
                                    بازکردن
                                </button>
                                <button class="control-btn" id="retractArmsBtn">
                                    <i class="fas fa-compress-alt"></i>
                                    جمع کردن
                                </button>
                            </div>
                        </div>
                        
                        <div class="control-group">
                            <label class="control-label">شدت جت بازوها</label>
                            <div class="slider-container">
                                <input type="range" id="armJetSlider" min="0" max="100" value="50">
                                <span class="slider-value" id="armJetValue">50%</span>
                            </div>
                        </div>
                        
                        <div class="control-group">
                            <label class="control-label">زاویه نازل بدنه</label>
                            <div class="slider-container">
                                <input type="range" id="nozzleAngleSlider" min="-90" max="45" value="0">
                                <span class="slider-value" id="nozzleAngleValue">0°</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- کنترل اطفای حریق -->
                <div class="control-panel">
                    <div class="panel-title">
                        <i class="fas fa-fire-extinguisher"></i>
                        <h3>کنترل اطفای حریق</h3>
                    </div>
                    
                    <div class="controls-grid">
                        <div class="control-group">
                            <label class="control-label">شدت پاشش آب</label>
                            <div class="slider-container">
                                <input type="range" id="waterFlowSlider" min="0" max="100" value="0">
                                <span class="slider-value" id="waterFlowValue">0%</span>
                            </div>
                        </div>
                        
                        <div class="control-group">
                            <label class="control-label">درصد کف در مخلوط</label>
                            <div class="slider-container">
                                <input type="range" id="foamMixSlider" min="0" max="100" value="30">
                                <span class="slider-value" id="foamMixValue">30%</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="button-group">
                        <button class="control-btn warning" id="attachTankBtn">
                            <i class="fas fa-link"></i>
                            اتصال مخزن
                        </button>
                        <button class="control-btn danger" id="detachTankBtn">
                            <i class="fas fa-unlink"></i>
                            جداسازی مخزن
                        </button>
                        <button class="control-btn success" id="sprayBtn">
                            <i class="fas fa-tint"></i>
                            پاشش آب/کف
                        </button>
                    </div>
                </div>
            </section>
        </div>

        <!-- پانل عملیات و لاگ -->
        <div class="action-panel">
            <div class="panel-title">
                <i class="fas fa-clipboard-list"></i>
                <h3>لاگ عملیات و وضعیت</h3>
            </div>
            <div class="log-container" id="logContainer">
                <!-- لاگ‌ها به صورت پویا اضافه می‌شوند -->
            </div>
        </div>

        <footer>
            <p>شبیه‌ساز پهپاد اطفای حریق | طراحی شده برای صفحات لمسی و موس | کلیه حقوق محفوظ است © ۲۰۲۳</p>
        </footer>
    </div>

    <script>
        // حالت اولیه شبیه‌سازی
        const droneState = {
            isFlying: false,
            altitude: 0,
            speed: 0,
            armsExtended: false,
            armJetIntensity: 50,
            nozzleAngle: 0,
            wingAngle: 5,
            waterFlow: 0,
            foamMix: 30,
            waterTankAttached: true,
            battery: 98,
            waterLevel: 400,
            foamLevel: 100,
            fuelLevel: 85,
            fireIntensity: 75
        };

        // لاگ عملیات
        const operationLog = [
            {time: "۱۰:۰۵", message: "پهپاد روشن و آماده به کار است"},
            {time: "۱۰:۰۶", message: "مخزن ۴۰۰ لیتری آب متصل شد"},
            {time: "۱۰:۰۷", message: "بازوها در حالت جمع قرار دارند"},
            {time: "۱۰:۰۸", message: "سیستم‌های ناوبری فعال شدند"}
        ];

        // المان‌های DOM
        const canvas = document.getElementById('simulationCanvas');
        const ctx = canvas.getContext('2d');
        const logContainer = document.getElementById('logContainer');
        
        // المان‌های نمایش وضعیت
        const batteryLevelEl = document.getElementById('batteryLevel');
        const waterLevelEl = document.getElementById('waterLevel');
        const foamLevelEl = document.getElementById('foamLevel');
        const fuelLevelEl = document.getElementById('fuelLevel');
        const fireIntensityEl = document.getElementById('fireIntensity');
        
        // المان‌های کنترل اسلایدر
        const altitudeSlider = document.getElementById('altitudeSlider');
        const altitudeValue = document.getElementById('altitudeValue');
        const speedSlider = document.getElementById('speedSlider');
        const speedValue = document.getElementById('speedValue');
        const wingAngleSlider = document.getElementById('wingAngleSlider');
        const wingAngleValue = document.getElementById('wingAngleValue');
        const armJetSlider = document.getElementById('armJetSlider');
        const armJetValue = document.getElementById('armJetValue');
        const nozzleAngleSlider = document.getElementById('nozzleAngleSlider');
        const nozzleAngleValue = document.getElementById('nozzleAngleValue');
        const waterFlowSlider = document.getElementById('waterFlowSlider');
        const waterFlowValue = document.getElementById('waterFlowValue');
        const foamMixSlider = document.getElementById('foamMixSlider');
        const foamMixValue = document.getElementById('foamMixValue');
        
        // دکمه‌های کنترل
        const takeoffBtn = document.getElementById('takeoffBtn');
        const landBtn = document.getElementById('landBtn');
        const hoverBtn = document.getElementById('hoverBtn');
        const extendArmsBtn = document.getElementById('extendArmsBtn');
        const retractArmsBtn = document.getElementById('retractArmsBtn');
        const attachTankBtn = document.getElementById('attachTankBtn');
        const detachTankBtn = document.getElementById('detachTankBtn');
        const sprayBtn = document.getElementById('sprayBtn');
        
        // کنترل‌های لمسی
        const touchUp = document.getElementById('touchUp');
        const touchDown = document.getElementById('touchDown');
        const touchLeft = document.getElementById('touchLeft');
        const touchRight = document.getElementById('touchRight');
        const touchTakeoff = document.getElementById('touchTakeoff');
        const touchWater = document.getElementById('touchWater');

        // تنظیم ابعاد کانواس
        function resizeCanvas() {
            canvas.width = canvas.parentElement.clientWidth;
            canvas.height = canvas.parentElement.clientHeight;
            drawDrone();
        }

        // تابع برای افزودن لاگ جدید
        function addLog(message) {
            const now = new Date();
            const time = `${now.getHours().toString().padStart(2, '0')}:${now.getMinutes().toString().padStart(2, '0')}`;
            operationLog.unshift({time, message});
            
            // فقط ۵ لاگ آخر را نگه دار
            if (operationLog.length > 5) {
                operationLog.pop();
            }
            
            updateLogDisplay();
        }

        // به‌روزرسانی نمایش لاگ
        function updateLogDisplay() {
            logContainer.innerHTML = '';
            operationLog.forEach(log => {
                const logEntry = document.createElement('div');
                logEntry.className = 'log-entry';
                logEntry.innerHTML = `
                    <div class="log-time">${log.time}</div>
                    <div class="log-message">${log.message}</div>
                `;
                logContainer.appendChild(logEntry);
            });
        }

        // تابع برای کشیدن پهپاد و محیط
        function drawDrone() {
            // پاک کردن کانواس
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            // پس‌زمینه آسمان
            const gradient = ctx.createLinearGradient(0, 0, 0, canvas.height);
            gradient.addColorStop(0, '#0a1931');
            gradient.addColorStop(1, '#1a1a2e');
            ctx.fillStyle = gradient;
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            // زمین
            ctx.fillStyle = '#1b4332';
            ctx.fillRect(0, canvas.height * 0.7, canvas.width, canvas.height * 0.3);
            
            // آتش (اگر وجود دارد)
            if (droneState.fireIntensity > 0) {
                drawFire();
            }
            
            // پهپاد
            drawDroneBody();
            
            // بازوها و نازل‌ها
            drawArmsAndNozzles();
            
            // مخزن آب
            if (droneState.waterTankAttached) {
                drawWaterTank();
            }
            
            // جت‌های هوا
            drawAirJets();
            
            // پاشش آب (اگر فعال باشد)
            if (droneState.waterFlow > 0) {
                drawWaterSpray();
            }
        }

        // تابع برای کشیدن بدنه پهپاد
        function drawDroneBody() {
            const centerX = canvas.width / 2;
            const centerY = canvas.height * 0.4 - droneState.altitude * 2;
            
            // بدنه اصلی (بیضی شکل)
            ctx.fillStyle = '#2d3436';
            ctx.beginPath();
            ctx.ellipse(centerX, centerY, 60, 40, 0, 0, Math.PI * 2);
            ctx.fill();
            ctx.strokeStyle = '#636e72';
            ctx.lineWidth = 2;
            ctx.stroke();
            
            // بال ثابت
            ctx.fillStyle = '#34495e';
            ctx.save();
            ctx.translate(centerX, centerY - 20);
            ctx.rotate(droneState.wingAngle * Math.PI / 180);
            ctx.fillRect(-80, -10, 160, 20);
            ctx.restore();
            
            // چراغ‌ها
            ctx.fillStyle = droneState.isFlying ? '#f1c40f' : '#7f8c8d';
            ctx.beginPath();
            ctx.arc(centerX - 30, centerY - 15, 5, 0, Math.PI * 2);
            ctx.fill();
            
            ctx.fillStyle = droneState.isFlying ? '#2ecc71' : '#7f8c8d';
            ctx.beginPath();
            ctx.arc(centerX + 30, centerY - 15, 5, 0, Math.PI * 2);
            ctx.fill();
            
            // پنجره کابین
            ctx.fillStyle = '#3498db';
            ctx.beginPath();
            ctx.ellipse(centerX, centerY - 10, 25, 15, 0, 0, Math.PI * 2);
            ctx.fill();
        }

        // تابع برای کشیدن بازوها و نازل‌ها
        function drawArmsAndNozzles() {
            const centerX = canvas.width / 2;
            const centerY = canvas.height * 0.4 - droneState.altitude * 2;
            
            // طول بازوها بر اساس حالت
            const armLength = droneState.armsExtended ? 100 : 60;
            
            // چهار بازو
            const armAngles = [45, 135, 225, 315];
            
            armAngles.forEach(angle => {
                const rad = angle * Math.PI / 180;
                const endX = centerX + Math.cos(rad) * armLength;
                const endY = centerY + Math.sin(rad) * armLength;
                
                // کشیدن بازو
                ctx.strokeStyle = '#636e72';
                ctx.lineWidth = 8;
                ctx.beginPath();
                ctx.moveTo(centerX, centerY);
                ctx.lineTo(endX, endY);
                ctx.stroke();
                
                // کشیدن نازل انتهای بازو
                ctx.fillStyle = '#95a5a6';
                ctx.beginPath();
                ctx.arc(endX, endY, 12, 0, Math.PI * 2);
                ctx.fill();
                
                // کشیدن جت هوا از نازل
                if (droneState.armJetIntensity > 0 && droneState.isFlying) {
                    const jetLength = droneState.armJetIntensity * 0.5;
                    const jetEndX = endX + Math.cos(rad) * jetLength;
                    const jetEndY = endY + Math.sin(rad) * jetLength;
                    
                    const jetGradient = ctx.createLinearGradient(endX, endY, jetEndX, jetEndY);
                    jetGradient.addColorStop(0, 'rgba(52, 152, 219, 0.8)');
                    jetGradient.addColorStop(1, 'rgba(52, 152, 219, 0)');
                    
                    ctx.strokeStyle = jetGradient;
                    ctx.lineWidth = 6;
                    ctx.beginPath();
                    ctx.moveTo(endX, endY);
                    ctx.lineTo(jetEndX, jetEndY);
                    ctx.stroke();
                }
            });
            
            // کشیدن نازل‌های زیر بدنه
            drawUnderbodyNozzles(centerX, centerY);
        }

        // تابع برای کشیدن نازل‌های زیر بدنه
        function drawUnderbodyNozzles(centerX, centerY) {
            // چهار نازل زیر بدنه
            const nozzlePositions = [
                {x: centerX - 40, y: centerY + 40},
                {x: centerX - 15, y: centerY + 40},
                {x: centerX + 15, y: centerY + 40},
                {x: centerX + 40, y: centerY + 40}
            ];
            
            nozzlePositions.forEach(pos => {
                // نازل
                ctx.fillStyle = '#7f8c8d';
                ctx.beginPath();
                ctx.arc(pos.x, pos.y, 8, 0, Math.PI * 2);
                ctx.fill();
                
                // جهت نازل (با زاویه قابل تنظیم)
                const nozzleRad = (droneState.nozzleAngle + 90) * Math.PI / 180;
                const nozzleEndX = pos.x + Math.cos(nozzleRad) * 25;
                const nozzleEndY = pos.y + Math.sin(nozzleRad) * 25;
                
                ctx.strokeStyle = '#bdc3c7';
                ctx.lineWidth = 3;
                ctx.beginPath();
                ctx.moveTo(pos.x, pos.y);
                ctx.lineTo(nozzleEndX, nozzleEndY);
                ctx.stroke();
                
                // جت هوا از نازل‌های زیر بدنه (اگر پهپاد در حال پرواز باشد)
                if (droneState.isFlying) {
                    const jetLength = 40;
                    const jetEndX = pos.x + Math.cos(nozzleRad) * jetLength;
                    const jetEndY = pos.y + Math.sin(nozzleRad) * jetLength;
                    
                    const jetGradient = ctx.createLinearGradient(pos.x, pos.y, jetEndX, jetEndY);
                    jetGradient.addColorStop(0, 'rgba(236, 240, 241, 0.9)');
                    jetGradient.addColorStop(1, 'rgba(236, 240, 241, 0)');
                    
                    ctx.strokeStyle = jetGradient;
                    ctx.lineWidth = 6;
                    ctx.beginPath();
                    ctx.moveTo(pos.x, pos.y);
                    ctx.lineTo(jetEndX, jetEndY);
                    ctx.stroke();
                }
            });
        }

        // تابع برای کشیدن مخزن آب
        function drawWaterTank() {
            const centerX = canvas.width / 2;
            const centerY = canvas.height * 0.4 - droneState.altitude * 2;
            
            // مخزن آب زیر بدنه
            ctx.fillStyle = '#3498db';
            ctx.fillRect(centerX - 50, centerY + 50, 100, 60);
            
            ctx.strokeStyle = '#2980b9';
            ctx.lineWidth = 2;
            ctx.strokeRect(centerX - 50, centerY + 50, 100, 60);
            
            // سطح آب در مخزن
            const waterHeight = (droneState.waterLevel / 400) * 60;
            ctx.fillStyle = '#1e6ea7';
            ctx.fillRect(centerX - 50, centerY + 50 + (60 - waterHeight), 100, waterHeight);
            
            // برچسب مخزن
            ctx.fillStyle = 'white';
            ctx.font = '12px Arial';
            ctx.textAlign = 'center';
            ctx.fillText(`مخزن آب: ${droneState.waterLevel}L`, centerX, centerY + 85);
        }

        // تابع برای کشیدن جت‌های هوا
        function drawAirJets() {
            if (!droneState.isFlying) return;
            
            const centerX = canvas.width / 2;
            const centerY = canvas.height * 0.4 - droneState.altitude * 2;
            
            // جت‌های هوا از فن‌های سانتریفیوژ
            for (let i = 0; i < 4; i++) {
                const angle = (i * 90) * Math.PI / 180;
                const jetX = centerX + Math.cos(angle) * 40;
                const jetY = centerY + Math.sin(angle) * 30;
                
                const jetLength = 60 + droneState.speed;
                const jetEndX = jetX + Math.cos(angle) * jetLength;
                const jetEndY = jetY + Math.sin(angle) * jetLength;
                
                const jetGradient = ctx.createLinearGradient(jetX, jetY, jetEndX, jetEndY);
                jetGradient.addColorStop(0, 'rgba(52, 152, 219, 0.8)');
                jetGradient.addColorStop(1, 'rgba(52, 152, 219, 0)');
                
                ctx.strokeStyle = jetGradient;
                ctx.lineWidth = 15;
                ctx.beginPath();
                ctx.moveTo(jetX, jetY);
                ctx.lineTo(jetEndX, jetEndY);
                ctx.stroke();
            }
        }

        // تابع برای کشیدن پاشش آب
        function drawWaterSpray() {
            const centerX = canvas.width / 2;
            const centerY = canvas.height * 0.4 - droneState.altitude * 2;
            
            // نازل پاشش آب در مرکز زیر بدنه
            const nozzleX = centerX;
            const nozzleY = centerY + 80;
            
            // زاویه پاشش (از -90 تا +45 درجه)
            const sprayAngle = (-45 + droneState.nozzleAngle) * Math.PI / 180;
            const sprayLength = 150 + droneState.waterFlow * 2;
            const sprayEndX = nozzleX + Math.cos(sprayAngle) * sprayLength;
            const sprayEndY = nozzleY + Math.sin(sprayAngle) * sprayLength;
            
            // گرادیانت آب/کف
            const foamRatio = droneState.foamMix / 100;
            const waterColor = `rgba(52, 152, 219, ${0.7 - foamRatio * 0.3})`;
            const foamColor = `rgba(236, 240, 241, ${0.3 + foamRatio * 0.4})`;
            
            const sprayGradient = ctx.createLinearGradient(nozzleX, nozzleY, sprayEndX, sprayEndY);
            sprayGradient.addColorStop(0, waterColor);
            sprayGradient.addColorStop(0.5, foamColor);
            sprayGradient.addColorStop(1, 'rgba(236, 240, 241, 0)');
            
            // کشیدن پاشش
            ctx.strokeStyle = sprayGradient;
            ctx.lineWidth = 10 + droneState.waterFlow / 10;
            ctx.beginPath();
            ctx.moveTo(nozzleX, nozzleY);
            ctx.lineTo(sprayEndX, sprayEndY);
            ctx.stroke();
            
            // اثر پاشش روی آتش
            if (droneState.fireIntensity > 0 && Math.abs(sprayEndX - canvas.width/2) < 100) {
                // کاهش آتش
                droneState.fireIntensity = Math.max(0, droneState.fireIntensity - 0.5);
                fireIntensityEl.textContent = Math.round(droneState.fireIntensity) + '%';
            }
        }

        // تابع برای کشیدن آتش
        function drawFire() {
            const fireCenterX = canvas.width / 2 + 200;
            const fireCenterY = canvas.height * 0.7;
            const fireSize = droneState.fireIntensity * 2;
            
            // شعله‌های آتش
            for (let i = 0; i < 5; i++) {
                const flameHeight = 50 + Math.random() * fireSize;
                const flameWidth = 20 + Math.random() * 30;
                const flameX = fireCenterX - 50 + Math.random() * 100;
                const flameY = fireCenterY - flameHeight;
                
                const flameGradient = ctx.createRadialGradient(
                    flameX, flameY + flameHeight/2, 5,
                    flameX, flameY + flameHeight/2, flameWidth
                );
                flameGradient.addColorStop(0, 'rgba(255, 100, 0, 0.9)');
                flameGradient.addColorStop(0.5, 'rgba(255, 50, 0, 0.6)');
                flameGradient.addColorStop(1, 'rgba(255, 0, 0, 0)');
                
                ctx.fillStyle = flameGradient;
                ctx.beginPath();
                ctx.ellipse(flameX, flameY + flameHeight/2, flameWidth/2, flameHeight/2, 0, 0, Math.PI * 2);
                ctx.fill();
            }
            
            // دود
            for (let i = 0; i < 3; i++) {
                const smokeSize = 30 + Math.random() * 40;
                const smokeX = fireCenterX - 30 + Math.random() * 60;
                const smokeY = fireCenterY - 80 - Math.random() * 50;
                
                ctx.fillStyle = `rgba(50, 50, 50, ${0.2 + Math.random() * 0.3})`;
                ctx.beginPath();
                ctx.arc(smokeX, smokeY, smokeSize, 0, Math.PI * 2);
                ctx.fill();
            }
        }

        // به‌روزرسانی وضعیت از اسلایدرها
        function updateFromSliders() {
            droneState.altitude = parseInt(altitudeSlider.value);
            altitudeValue.textContent = droneState.altitude + ' متر';
            
            droneState.speed = parseInt(speedSlider.value);
            speedValue.textContent = droneState.speed + ' km/h';
            
            droneState.wingAngle = parseInt(wingAngleSlider.value);
            wingAngleValue.textContent = droneState.wingAngle + '°';
            
            droneState.armJetIntensity = parseInt(armJetSlider.value);
            armJetValue.textContent = droneState.armJetIntensity + '%';
            
            droneState.nozzleAngle = parseInt(nozzleAngleSlider.value);
            nozzleAngleValue.textContent = droneState.nozzleAngle + '°';
            
            droneState.waterFlow = parseInt(waterFlowSlider.value);
            waterFlowValue.textContent = droneState.waterFlow + '%';
            
            droneState.foamMix = parseInt(foamMixSlider.value);
            foamMixValue.textContent = droneState.foamMix + '%';
            
            // کاهش سطح آب اگر پاشش فعال است
            if (droneState.waterFlow > 0 && droneState.isFlying) {
                droneState.waterLevel = Math.max(0, droneState.waterLevel - 0.1);
                waterLevelEl.textContent = Math.round(droneState.waterLevel);
                
                // کاهش کف
                droneState.foamLevel = Math.max(0, droneState.foamLevel - 0.05);
                foamLevelEl.textContent = Math.round(droneState.foamLevel) + '%';
            }
            
            // کاهش باتری و سوخت در حین پرواز
            if (droneState.isFlying) {
                droneState.battery = Math.max(0, droneState.battery - 0.01);
                batteryLevelEl.textContent = Math.round(droneState.battery) + '%';
                
                droneState.fuelLevel = Math.max(0, droneState.fuelLevel - 0.02);
                fuelLevelEl.textContent = Math.round(droneState.fuelLevel) + '%';
            }
            
            drawDrone();
        }

        // تنظیم event listeners برای اسلایدرها
        altitudeSlider.addEventListener('input', updateFromSliders);
        speedSlider.addEventListener('input', updateFromSliders);
        wingAngleSlider.addEventListener('input', updateFromSliders);
        armJetSlider.addEventListener('input', updateFromSliders);
        nozzleAngleSlider.addEventListener('input', updateFromSliders);
        waterFlowSlider.addEventListener('input', updateFromSliders);
        foamMixSlider.addEventListener('input', updateFromSliders);

        // event listeners برای دکمه‌ها
        takeoffBtn.addEventListener('click', () => {
            droneState.isFlying = true;
            altitudeSlider.value = 30;
            speedSlider.value = 40;
            updateFromSliders();
            addLog("پهپاد پرواز را آغاز کرد");
        });

        landBtn.addEventListener('click', () => {
            droneState.isFlying = false;
            altitudeSlider.value = 0;
            speedSlider.value = 0;
            waterFlowSlider.value = 0;
            updateFromSliders();
            addLog("پهپاد با موفقیت فرود آمد");
        });

        hoverBtn.addEventListener('click', () => {
            speedSlider.value = 0;
            updateFromSliders();
            addLog("پهپاد در حالت شناور قرار گرفت");
        });

        extendArmsBtn.addEventListener('click', () => {
            droneState.armsExtended = true;
            addLog("بازوهای پهپاد باز شدند");
            drawDrone();
        });

        retractArmsBtn.addEventListener('click', () => {
            droneState.armsExtended = false;
            addLog("بازوهای پهپاد جمع شدند");
            drawDrone();
        });

        attachTankBtn.addEventListener('click', () => {
            droneState.waterTankAttached = true;
            droneState.waterLevel = 400;
            waterLevelEl.textContent = droneState.waterLevel;
            addLog("مخزن ۴۰۰ لیتری آب متصل شد");
            drawDrone();
        });

        detachTankBtn.addEventListener('click', () => {
            droneState.waterTankAttached = false;
            addLog("مخزن آب جدا شد");
            drawDrone();
        });

        sprayBtn.addEventListener('click', () => {
            if (droneState.waterFlow === 0) {
                waterFlowSlider.value = 50;
                addLog("پاشش آب/کف آغاز شد");
            } else {
                waterFlowSlider.value = 0;
                addLog("پاشش آب/کف متوقف شد");
            }
            updateFromSliders();
        });

        // کنترل‌های لمسی
        if (touchUp) {
            touchUp.addEventListener('touchstart', () => {
                altitudeSlider.value = Math.min(100, parseInt(altitudeSlider.value) + 10);
                updateFromSliders();
            });
            
            touchDown.addEventListener('touchstart', () => {
                altitudeSlider.value = Math.max(0, parseInt(altitudeSlider.value) - 10);
                updateFromSliders();
            });
            
            touchLeft.addEventListener('touchstart', () => {
                speedSlider.value = Math.max(0, parseInt(speedSlider.value) - 10);
                updateFromSliders();
            });
            
            touchRight.addEventListener('touchstart', () => {
                speedSlider.value = Math.min(100, parseInt(speedSlider.value) + 10);
                updateFromSliders();
            });
            
            touchTakeoff.addEventListener('touchstart', () => {
                droneState.isFlying = !droneState.isFlying;
                if (droneState.isFlying) {
                    altitudeSlider.value = 30;
                    speedSlider.value = 40;
                    addLog("پهپاد پرواز را آغاز کرد");
                } else {
                    altitudeSlider.value = 0;
                    speedSlider.value = 0;
                    addLog("پهپاد فرود آمد");
                }
                updateFromSliders();
            });
            
            touchWater.addEventListener('touchstart', () => {
                if (droneState.waterFlow === 0) {
                    waterFlowSlider.value = 70;
                    addLog("پاشش آب/کف آغاز شد");
                } else {
                    waterFlowSlider.value = 0;
                    addLog("پاشش آب/کف متوقف شد");
                }
                updateFromSliders();
            });
        }

        // پشتیبانی از صفحه‌کلید برای صفحات بزرگ
        document.addEventListener('keydown', (e) => {
            switch(e.key) {
                case 'ArrowUp':
                    altitudeSlider.value = Math.min(100, parseInt(altitudeSlider.value) + 5);
                    updateFromSliders();
                    break;
                case 'ArrowDown':
                    altitudeSlider.value = Math.max(0, parseInt(altitudeSlider.value) - 5);
                    updateFromSliders();
                    break;
                case 'ArrowLeft':
                    speedSlider.value = Math.max(0, parseInt(speedSlider.value) - 5);
                    updateFromSliders();
                    break;
                case 'ArrowRight':
                    speedSlider.value = Math.min(100, parseInt(speedSlider.value) + 5);
                    updateFromSliders();
                    break;
                case ' ':
                    droneState.isFlying = !droneState.isFlying;
                    if (droneState.isFlying) {
                        altitudeSlider.value = 30;
                        speedSlider.value = 40;
                        addLog("پهپاد پرواز را آغاز کرد");
                    } else {
                        altitudeSlider.value = 0;
                        speedSlider.value = 0;
                        addLog("پهپاد فرود آمد");
                    }
                    updateFromSliders();
                    break;
                case 'w':
                case 'W':
                    if (droneState.waterFlow === 0) {
                        waterFlowSlider.value = 60;
                        addLog("پاشش آب/کف آغاز شد");
                    } else {
                        waterFlowSlider.value = 0;
                        addLog("پاشش آب/کف متوقف شد");
                    }
                    updateFromSliders();
                    break;
            }
        });

        // راه�اندازی اولیه
        window.addEventListener('load', () => {
            resizeCanvas();
            updateLogDisplay();
            updateFromSliders();
            
            // شبیه‌سازی کاهش منابع با زمان
            setInterval(() => {
                if (droneState.isFlying) {
                    updateFromSliders();
                }
            }, 100);
            
            // افزایش آتش با زمان (اگر پاشش آب فعال نباشد)
            setInterval(() => {
                if (droneState.fireIntensity < 100 && droneState.waterFlow === 0) {
                    droneState.fireIntensity = Math.min(100, droneState.fireIntensity + 0.2);
                    fireIntensityEl.textContent = Math.round(droneState.fireIntensity) + '%';
                    drawDrone();
                }
            }, 500);
        });

        window.addEventListener('resize', resizeCanvas);
    </script>
</body>
</html>