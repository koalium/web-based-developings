<!DOCTYPE html>
<html lang="fa">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Professional Investor Gantt & Market Dashboard</title>
<style>
/* === Industrial Branding Layer === */
:root{
 --brand-primary:#ffb703;
 --brand-secondary:#219ebc;
 --brand-dark:#0b1320;
 --brand-accent:#fb8500;
}
header{background:linear-gradient(120deg,var(--brand-secondary),var(--brand-primary))}
.card h2::after{content:"";display:block;width:60px;height:4px;border-radius:4px;background:linear-gradient(90deg,var(--brand-accent),var(--brand-primary));margin-top:8px}
.chartBox h3{color:var(--brand-primary)}
.badge{box-shadow:0 4px 12px rgba(0,0,0,.35)}

:root{
  --c1:#0d1b2a;--c2:#1b263b;--c3:#415a77;--c4:#778da9;--c5:#e0e1dd;
  --g1:#2ec4b6;--g2:#ff9f1c;--g3:#e71d36;--g4:#3a86ff;--g5:#8338ec;
}
body{margin:0;font-family:Tahoma,Arial;background:linear-gradient(135deg,var(--c1),var(--c2));color:var(--c5)}
header{padding:24px;text-align:center;background:linear-gradient(90deg,var(--g4),var(--g5))}
header h1{margin:0;font-size:26px}
header p{opacity:.9}
section{padding:24px}
.card{background:rgba(255,255,255,.06);border-radius:16px;padding:20px;margin-bottom:24px;box-shadow:0 10px 30px rgba(0,0,0,.35)}
.card h2{margin-top:0;font-size:20px;color:#fff}
.gantt{display:grid;grid-template-columns:220px repeat(12,1fr);gap:6px;align-items:center}
.gantt .head{font-size:12px;opacity:.8;text-align:center}
.task{padding:8px 10px;border-radius:12px;color:#fff;font-size:13px;cursor:pointer;transition:transform .35s ease,box-shadow .35s ease,opacity .35s ease;background:linear-gradient(135deg,#06beb6,#48b1bf);box-shadow:0 6px 18px rgba(0,0,0,.35)}
.task:hover{transform:scale(1.03);filter:brightness(1.15)}
.t1{background:linear-gradient(90deg,var(--g1),#1dd3b0)}
.t2{background:linear-gradient(90deg,var(--g2),#ffd166)}
.t3{background:linear-gradient(90deg,var(--g3),#ff758f)}
.t4{background:linear-gradient(90deg,var(--g4),#4cc9f0)}
.t5{background:linear-gradient(90deg,var(--g5),#c77dff)}
.label{font-size:13px}
.parallel{opacity:.9;font-style:italic}
.flex{display:flex;flex-wrap:wrap;gap:20px}
.chartBox{flex:1 1 300px;background:rgba(0,0,0,.25);border-radius:14px;padding:16px}
canvas{max-width:100%}
.footer{padding:16px;text-align:center;font-size:12px;opacity:.7}
/* === Mode Control === */
.mode-epc .investorOnly{display:none}
.mode-investor .epcOnly{display:none}
/* === Rupture Intro Styles === */
.rupture-intro{
 position:fixed;inset:0;z-index:9999;
 background:radial-gradient(circle at top,#0b132b,#000814);
 display:flex;align-items:center;justify-content:center;
 animation:introFadeIn 1.2s ease forwards;
}
.rupture-content{max-width:820px;padding:40px;text-align:center;color:#fff}
.intro-title{font-size:3.2rem;letter-spacing:6px;margin-bottom:30px}
.intro-title .accent{background:linear-gradient(45deg,#ffd166,#ef476f);
 -webkit-background-clip:text;color:transparent}
.type-line{opacity:0;font-size:1.2rem;margin:10px 0;
 animation:typeIn .9s ease forwards}
.type-line.spacer{margin-top:28px;font-weight:600}
.type-line.finale{margin-top:32px;font-size:1.1rem;opacity:.85}
.kw{color:#ffd166;font-weight:600;position:relative}
.kw::after{
 content:"";position:absolute;left:0;bottom:-2px;width:100%;height:2px;
 background:linear-gradient(90deg,#ffd166,#ef476f);
 transform:scaleX(0);transform-origin:left;
 animation:kwGlow .8s ease forwards;animation-delay:.4s}

@keyframes typeIn{from{opacity:0;transform:translateY(12px)}to{opacity:1;transform:none}}
@keyframes kwGlow{to{transform:scaleX(1)}}
@keyframes introFadeIn{from{opacity:0}to{opacity:1}}
</style>
<style>
@keyframes flowGrad{0%{background-position:0% 50%}50%{background-position:100% 50%}100%{background-position:0% 50%}}
.gradientItem{background-size:200% 200%;animation:flowGrad 12s ease infinite}
.kpiBar{display:flex;justify-content:space-around;gap:16px;margin:24px}
.kpi{background:linear-gradient(135deg,#1f4037,#99f2c8);padding:14px 18px;border-radius:18px;color:#fff;min-width:140px;text-align:center;box-shadow:0 10px 28px rgba(0,0,0,.4)}
.kpi span{font-size:22px;font-weight:bold;display:block}
.presentation{position:fixed;bottom:20px;left:20px;z-index:2000}
.presentation button{padding:10px 18px;border-radius:22px;border:none;font-weight:bold;cursor:pointer;background:linear-gradient(135deg,#ff8008,#ffc837)}
.section{margin:40px 20px}
</style>
<style>
.gradientItem:nth-child(1){background:linear-gradient(135deg,#ff512f,#dd2476)}
.gradientItem:nth-child(2){background:linear-gradient(135deg,#24c6dc,#514a9d)}
.gradientItem:nth-child(3){background:linear-gradient(135deg,#11998e,#38ef7d)}
.gradientItem:nth-child(4){background:linear-gradient(135deg,#fc4a1a,#f7b733)}
.gradientItem:nth-child(5){background:linear-gradient(135deg,#8360c3,#2ebf91)}
.gradientItem:hover{transform:translateY(-6px) scale(1.04);box-shadow:0 14px 34px rgba(0,0,0,.55)}
.gradientItem:active{transform:scale(.97)}
</style>
<style>
/* === Gradient System === */
:root{
 --g-conservative:linear-gradient(135deg,#2b5876,#4e4376);
 --g-base:linear-gradient(135deg,#11998e,#38ef7d);
 --g-aggressive:linear-gradient(135deg,#ff512f,#dd2476);
}
.task{
 transition:all .45s cubic-bezier(.4,0,.2,1);
 position:relative;
 overflow:hidden;
}
.task::after{
 content:"";
 position:absolute;inset:0;
 background:inherit;
 opacity:.18;
 transition:.4s;
}
.task:hover{transform:scale(1.05);box-shadow:0 12px 30px rgba(0,0,0,.45)}
.task:hover::after{opacity:.35}
/* === Scenario Button === */
.scenarioBar{display:flex;gap:14px;justify-content:center;margin-top:18px}
.scenarioBar button{padding:10px 18px;border-radius:30px;border:none;font-weight:700;cursor:pointer;transition:.35s}
.scenarioBar button:hover{transform:translateY(-3px)}
.conservative{background:var(--g-conservative);color:#fff}
.base{background:var(--g-base);color:#002b22}
.aggressive{background:var(--g-aggressive);color:#fff}
/* === Animated Counters === */
.counter{font-size:22px;font-weight:800;transition:.5s}
</style>
<style>
.sidePanel{position:fixed;top:0;right:-420px;width:420px;height:100%;background:#0b1320;color:#fff;padding:20px;transition:.4s;z-index:1000;box-shadow:-10px 0 30px rgba(0,0,0,.6)}
.sidePanel.active{right:0}
.sidePanel h3{margin-top:0;color:#ffd166}
.badge{display:inline-block;padding:4px 10px;border-radius:20px;font-size:12px;margin:4px 4px 4px 0}
.b-cost{background:#e71d36}.b-margin{background:#2ec4b6}.b-risk{background:#ff9f1c}
.toolbar{display:flex;gap:12px;justify-content:center;margin-top:12px}
.toolbar button{padding:8px 14px;border-radius:20px;border:none;cursor:pointer;font-weight:bold}
.darkBtn{background:#111;color:#fff}.lightBtn{background:#eee;color:#000}
.sliderTime{width:100%;margin:12px 0}
</style>
</head>
<body class="mode-investor">
<!-- === Rupture Disk Intro (First Visit Only) === -->
<div id="ruptureIntro" class="rupture-intro">
  <div class="rupture-content">
    <h1 class="intro-title">RUPTURE <span class="accent">DISK</span></h1>

    <p class="type-line">A <span class="kw">Rupture Disk</span> is a <span class="kw">non-reclosing pressure relief device</span></p>
    <p class="type-line">designed to <span class="kw">burst at a precise pressure</span></p>
    <p class="type-line">to <span class="kw">protect critical equipment</span> from overpressure.</p>

    <p class="type-line spacer">Main Types:</p>
    <p class="type-line">• <span class="kw">Forward Acting</span> – Tensile stress rupture</p>
    <p class="type-line">• <span class="kw">Reverse Buckling</span> – Compressive precision</p>
    <p class="type-line">• <span class="kw">Composite</span> – Seal + structural disk</p>
    <p class="type-line">• <span class="kw">Graphite & High-Alloy</span> – Extreme corrosion & temperature</p>

    <p class="type-line finale">Engineered Safety · Predictable Failure · Zero Compromise</p>
  </div>
</div>
<header>
<h1>Investor Command Center</h1>
<p>Rupture Disk & Burst Sensor | Live Gantt, Finance & Market Intelligence</p>
<div class="kpiBar">
<div class="kpi"><span id="roi">4.8x</span>ROI</div>
<div class="kpi"><span id="payback">6 ماه</span>Payback</div>
<div class="kpi"><span id="margin">65%</span>Gross Margin</div>
<div class="kpi"><span id="market">2.3%</span>Market Share</div>
</div>
<div class="toolbar">
<button onclick="setMode('investor')">Investor Mode</button>
<button onclick="setMode('epc')">EPC / Client Mode</button>
<button class="darkBtn" onclick="setTheme('dark')">Dark</button>
<button class="lightBtn" onclick="setTheme('light')">Light</button>
</div>
<input type="range" min="1" max="18" value="1" class="sliderTime" oninput="moveTime(this.value);updateKPI(this.value)">
</header>

<section class="investorOnly">
<div class="card">
<h2>KPI Strip سرمایه‌گذار</h2>
<div style="display:flex;gap:16px;flex-wrap:wrap">
<div class="badge b-margin">ROI: <span id="kpiROI">220%</span></div>
<div class="badge b-cost">Payback: <span id="kpiPay">3 ماه</span></div>
<div class="badge b-risk">IRR: <span id="kpiIRR">85%</span></div>
<div class="badge" style="background:#3a86ff">Cash Multiple: <span id="kpiCM">3.2x</span></div>
</div>
</div>
<div class="card">
<h2>گانت جامع حرفه‌ای – چندسطری، چندستونی، موازی و سرمایه‌گذاری‌محور</h2>
<div class="gantt" style="grid-template-columns:260px repeat(18,1fr)">
<div></div>
<div class="head">W1</div><div class="head">W2</div><div class="head">W3</div><div class="head">W4</div><div class="head">W5</div><div class="head">W6</div>
<div class="head">W7</div><div class="head">W8</div><div class="head">W9</div><div class="head">W10</div><div class="head">W11</div><div class="head">W12</div>
<div class="head">W13</div><div class="head">W14</div><div class="head">W15</div><div class="head">W16</div><div class="head">W17</div><div class="head">W18</div>

<div class="label">تحلیل بازار و مناقصات</div>
<div class="task gradientItem"" onclick="openPanel(this)" data-cost="4500" data-margin="68" data-risk="Low" t1" style="grid-column:2/6">تحلیل تقاضا، قیمت و رقبا</div>

<div class="label">طراحی مهندسی پایه</div>
<div class="task gradientItem"" onclick="openPanel(this)" data-cost="4500" data-margin="68" data-risk="Low" t2" style="grid-column:3/7">Spec + BOM + استانداردها</div>

<div class="label">طراحی مهندسی تفصیلی</div>
<div class="task gradientItem"" onclick="openPanel(this)" data-cost="4500" data-margin="68" data-risk="Low" t3" style="grid-column:5/9">Tolerance، کنترل ترک، ایمنی</div>

<div class="label">تامین Inconel / Monel</div>
<div class="task gradientItem"" onclick="openPanel(this)" data-cost="4500" data-margin="68" data-risk="Low" t4" style="grid-column:6/11">سورس‌یابی + خرید</div>

<div class="label">ساخت سیستم فورمینگ</div>
<div class="task gradientItem"" onclick="openPanel(this)" data-cost="4500" data-margin="68" data-risk="Low" t5" style="grid-column:7/12">کنترل الکترونیکی دقیق</div>

<div class="label">ساخت قالب‌ها (Multi Size)</div>
<div class="task gradientItem"" onclick="openPanel(this)" data-cost="4500" data-margin="68" data-risk="Low" t1" style="grid-column:9/14">قالب سایزهای مختلف</div>

<div class="label">توسعه سنسور Burst</div>
<div class="task gradientItem"" onclick="openPanel(this)" data-cost="4500" data-margin="68" data-risk="Low" t2 parallel" style="grid-column:8/14">الکترونیک + کالیبراسیون</div>

<div class="label">تست‌های مکانیکی</div>
<div class="task gradientItem"" onclick="openPanel(this)" data-cost="4500" data-margin="68" data-risk="Low" t3" style="grid-column:12/16">Burst / Fatigue</div>

<div class="label">کنترل کیفیت و مستندات</div>
<div class="task gradientItem"" onclick="openPanel(this)" data-cost="4500" data-margin="68" data-risk="Low" t4" style="grid-column:14/18">Report + Traceability</div>

<div class="label">Vendor List و قرارداد</div>
<div class="task gradientItem"" onclick="openPanel(this)" data-cost="4500" data-margin="68" data-risk="Low" t5" style="grid-column:15/19">Approval + First PO</div>
</div>
<p style="margin-top:14px;opacity:.85">این گانت نشان می‌دهد چندین مسیر ارزش به‌صورت همزمان فعال‌اند؛ زمان کوتاه، ریسک کنترل‌شده و بازده سرمایه بالا.</p>
</div>
</section>

<section class="epcOnly">
<div class="card">
<h2>گانت اجرای قرارداد – ۳ هفته (گردش سریع نقدینگی)</h2>
<div class="gantt">
<div></div>
<div class="head">D1</div><div class="head">D4</div><div class="head">D7</div><div class="head">D10</div>
<div class="head">D13</div><div class="head">D16</div><div class="head">D19</div><div class="head">D21</div>

<div class="label">پیش‌پرداخت</div>
<div class="task gradientItem"" onclick="openPanel(this)" data-cost="4500" data-margin="68" data-risk="Low" t1" style="grid-column:2/3">Cash In</div>

<div class="label">تولید سریع</div>
<div class="task gradientItem"" onclick="openPanel(this)" data-cost="4500" data-margin="68" data-risk="Low" t2" style="grid-column:3/6">Forming & Machining</div>

<div class="label">Burst Test</div>
<div class="task gradientItem"" onclick="openPanel(this)" data-cost="4500" data-margin="68" data-risk="Low" t3" style="grid-column:6/7">Validation</div>

<div class="label">تحویل و تسویه</div>
<div class="task gradientItem"" onclick="openPanel(this)" data-cost="4500" data-margin="68" data-risk="Low" t4" style="grid-column:7/10">Invoice & Close</div>
</div>
</div>
</section>

<section class="investorOnly">
<div class="card">
<h2>قیف مناقصات (Tender Funnel) – از RFQ تا Win – از RFQ تا Win</h2>
<div class="flex">
<div class="chartBox"><h3>RFQ → Quote → Win</h3><canvas id="funnelChart"></canvas></div>
<div class="chartBox"><h3>نرخ تبدیل و قطعیت بازار</h3><canvas id="barTender"></canvas></div>
</div>
<p style="opacity:.85;margin-top:12px">این قیف نشان می‌دهد بازار مناقصات صنعتی «تصادفی» نیست؛ با تجربه و Vendor List، نرخ برد کاملاً قابل پیش‌بینی است.</p>
</div>
</section>
<section>
<div class="card">
<h2>داشبورد مالی و بازار (تحلیل گرافیکی پیشرفته)</h2>
<div class="flex">
<div class="chartBox">
<h3>ترکیب هزینه و سود</h3>
<canvas id="pie1"></canvas>
</div>
<div class="chartBox">
<h3>سهم بازار هدف</h3>
<canvas id="pie2"></canvas>
</div>
<div class="chartBox">
<h3>جریان نقدی پروژه</h3>
<canvas id="line1"></canvas>
</div>
</div>
</div>
</section>

<section>
<div class="card">
<h2>بازار، مالی و استراتژی – ارائه‌شده با منطق گانت و رنگ‌های زنده</h2>

<h3>گانت بازار و توسعه فروش (ایران → خلیج فارس)</h3>
<div class="gantt" style="grid-template-columns:260px repeat(16,1fr)">
<div></div>
<div class="head">M1</div><div class="head">M2</div><div class="head">M3</div><div class="head">M4</div><div class="head">M5</div><div class="head">M6</div><div class="head">M7</div><div class="head">M8</div>
<div class="head">M9</div><div class="head">M10</div><div class="head">M11</div><div class="head">M12</div><div class="head">M13</div><div class="head">M14</div><div class="head">M15</div><div class="head">M16</div>

<div class="label">Vendor List داخلی</div>
<div class="task gradientItem"" onclick="openPanel(this)" data-cost="4500" data-margin="68" data-risk="Low" t1" style="grid-column:2/6">پالایشگاه و پتروشیمی</div>

<div class="label">قراردادهای ایران</div>
<div class="task gradientItem"" onclick="openPanel(this)" data-cost="4500" data-margin="68" data-risk="Low" t2" style="grid-column:5/10">سهم بازار 1–2%</div>

<div class="label">EPC و پروژه‌های توسعه</div>
<div class="task gradientItem"" onclick="openPanel(this)" data-cost="4500" data-margin="68" data-risk="Low" t3" style="grid-column:7/13">قراردادهای تکرارشونده</div>

<div class="label">ورود به GCC</div>
<div class="task gradientItem"" onclick="openPanel(this)" data-cost="4500" data-margin="68" data-risk="Low" t4" style="grid-column:11/17">نماینده + صادرات</div>
</div>

<h3 style="margin-top:24px">گانت جریان مالی و بازگشت سرمایه</h3>
<div class="gantt" style="grid-template-columns:260px repeat(12,1fr)">
<div></div>
<div class="head">W1</div><div class="head">W2</div><div class="head">W3</div><div class="head">W4</div><div class="head">W5</div><div class="head">W6</div>
<div class="head">W7</div><div class="head">W8</div><div class="head">W9</div><div class="head">W10</div><div class="head">W11</div><div class="head">W12</div>

<div class="label">سرمایه اولیه (10k$)</div>
<div class="task gradientItem"" onclick="openPanel(this)" data-cost="4500" data-margin="68" data-risk="Low" t3" style="grid-column:2/4">Cash Out</div>

<div class="label">ساخت و نمونه اولیه</div>
<div class="task gradientItem"" onclick="openPanel(this)" data-cost="4500" data-margin="68" data-risk="Low" t5" style="grid-column:3/6">Value Creation</div>

<div class="label">پیش‌پرداخت قرارداد</div>
<div class="task gradientItem"" onclick="openPanel(this)" data-cost="4500" data-margin="68" data-risk="Low" t1" style="grid-column:6/7">Cash In</div>

<div class="label">سود عملیاتی</div>
<div class="task gradientItem"" onclick="openPanel(this)" data-cost="4500" data-margin="68" data-risk="Low" t4" style="grid-column:7/13">High Margin Loop</div>
</div>

<p style="margin-top:16px;opacity:.9">تمام اطلاعات بازار، مالی و استراتژیک به‌جای متن‌های خسته‌کننده، به‌صورت گانت‌های رنگی، مرحله‌محور و اقناع‌کننده نمایش داده شده‌اند؛ دقیقاً در فرم قابل ارائه به سرمایه‌گذار.</p>
</div>
</section>

<div class="footer">Investor-Grade Interactive Dashboard | Rupture Disk Manufacturing</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js">function exportPDF(){
 alert('Presentation-ready PDF export (Investor Mode)');
}
</script>
<script>
// === Mode Switch ===
function setMode(m){
 document.body.classList.remove('mode-investor','mode-epc');
 if(m==='investor')document.body.classList.add('mode-investor');
 if(m==='epc')document.body.classList.add('mode-epc');
}

// === Rupture Intro First-Visit Logic ===
(function(){
 const KEY='rupture_intro_seen_v1';
 const intro=document.getElementById('ruptureIntro');
 if(!intro)return;

 if(localStorage.getItem(KEY)==='true'){
   intro.remove();
   return;
 }

 document.body.style.overflow='hidden';
 const lines=intro.querySelectorAll('.type-line');
 let d=0;
 lines.forEach(l=>{l.style.animationDelay=`${d}s`;d+=0.7});

 const TOTAL=d*1000+2500;
 setTimeout(()=>{
   intro.style.transition='all 1.4s ease';
   intro.style.opacity='0';
   intro.style.transform='scale(0.96)';
 },TOTAL-1400);

 setTimeout(()=>{
   intro.remove();
   document.body.style.overflow='';
   localStorage.setItem(KEY,'true');
 },TOTAL);
})();

function setMode(m){
 document.body.classList.remove('mode-investor','mode-epc');
 if(m==='investor')document.body.classList.add('mode-investor');
 if(m==='epc')document.body.classList.add('mode-epc');
}

let scenario='base';
const scenarioData={
 conservative:{costMul:0.85,margin:55,gradient:'var(--g-conservative)'},
 base:{costMul:1,margin:68,gradient:'var(--g-base)'},
 aggressive:{costMul:1.25,margin:82,gradient:'var(--g-aggressive)'}
};
function animateValue(el,start,end,dur){
 let s=null;function step(t){if(!s)s=t;let p=Math.min((t-s)/dur,1);
 el.innerText=Math.floor(start+p*(end-start));if(p<1)requestAnimationFrame(step)}
 requestAnimationFrame(step)}
function setScenario(sc){
 scenario=sc;
 document.querySelectorAll('.task').forEach(t=>{
  t.style.background=scenarioData[sc].gradient;
  let baseCost=parseInt(t.dataset.cost);
  let newCost=Math.round(baseCost*scenarioData[sc].costMul);
  t.dataset.cost=newCost;
 })
 document.querySelectorAll('.counter').forEach(c=>{
  animateValue(c,0,scenarioData[sc].margin,600)
 })
}

new Chart(document.getElementById('pie1'),{
 type:'pie',
 data:{labels:['هزینه تولید','سود خالص'],datasets:[{data:[10,90],backgroundColor:['#e71d36','#2ec4b6']}]},
 options:{plugins:{legend:{labels:{color:'#fff'}}}}
});
new Chart(document.getElementById('pie2'),{
 type:'pie',
 data:{labels:['سهم هدف','سایر بازار'],datasets:[{data:[5,95],backgroundColor:['#3a86ff','#778da9']}]},
 options:{plugins:{legend:{labels:{color:'#fff'}}}}
});
new Chart(document.getElementById('funnelChart'),{
 type:'bar',
 data:{labels:['RFQ','Quoted','Technically Approved','Won'],datasets:[{label:'Count',data:[120,42,18,6],backgroundColor:['#778da9','#3a86ff','#ffb703','#2ec4b6']}]},
 options:{indexAxis:'y',plugins:{legend:{display:false}},scales:{x:{ticks:{color:'#fff'}},y:{ticks:{color:'#fff'}}}}
});
new Chart(document.getElementById('barTender'),{
 type:'bar',
 data:{labels:['RFQ→Quote','Quote→Tech','Tech→Win'],datasets:[{label:'Conversion %',data:[35,45,33],backgroundColor:['#219ebc','#ffb703','#fb8500']}]},
 options:{plugins:{legend:{labels:{color:'#fff'}}},scales:{x:{ticks:{color:'#fff'}},y:{ticks:{color:'#fff',callback:v=>v+'%'}}}}
});

new Chart(document.getElementById('line1'),{
 type:'line',
 data:{labels:['W1','W2','W3','W4','W5','W6','W7','W8','W9','W10','W11','W12'],datasets:[{label:'Cash Flow',data:[-2,-1,-1,0,2,3,4,6,8,10,12,15],borderColor:'#ffd166',tension:.4}]},
 options:{scales:{x:{ticks:{color:'#fff'}},y:{ticks:{color:'#fff'}}},plugins:{legend:{labels:{color:'#fff'}}}}
});
</script>
<div class="sidePanel" id="panel">
<h3>جزئیات مالی و مهندسی تسک</h3>
<p id="taskTitle"></p>
<span class="badge b-cost">Cost: <span id="pCost"></span>$</span>
<span class="badge b-margin">Margin: <span id="pMargin"></span>%</span>
<span class="badge b-risk">Risk: <span id="pRisk"></span></span>
<p style="margin-top:12px;opacity:.85">این تسک بخشی از مسیر ارزش پروژه است و مستقیماً روی جریان نقدی و زمان بازگشت سرمایه اثر دارد.</p>
<button onclick="closePanel()" style="margin-top:20px;padding:8px 14px;border-radius:20px;border:none;cursor:pointer">بستن</button>
</div>
<script>
function openPanel(el){
 el.style.boxShadow='0 0 28px rgba(255,209,102,.9)';(el){
 document.getElementById('panel').classList.add('active');
 document.getElementById('taskTitle').innerText=el.innerText;
 document.getElementById('pCost').innerText=el.dataset.cost;
 document.getElementById('pMargin').innerText=el.dataset.margin;
 document.getElementById('pRisk').innerText=el.dataset.risk;
}
function closePanel(){document.getElementById('panel').classList.remove('active')}
function setTheme(t){
 if(t==='light')document.body.style.background='#f2f2f2';
 else document.body.style.background='linear-gradient(135deg,#0d1b2a,#1b263b)';
}
function setScenario(s){
 if(s==='cons'){
  document.getElementById('kpiROI').innerText='150%';
  document.getElementById('kpiPay').innerText='5 ماه';
  document.getElementById('kpiIRR').innerText='45%';
  document.getElementById('kpiCM').innerText='2.1x';
 }
 if(s==='base'){
  document.getElementById('kpiROI').innerText='220%';
  document.getElementById('kpiPay').innerText='3 ماه';
  document.getElementById('kpiIRR').innerText='85%';
  document.getElementById('kpiCM').innerText='3.2x';
 }
 if(s==='agg'){
  document.getElementById('kpiROI').innerText='380%';
  document.getElementById('kpiPay').innerText='2 ماه';
  document.getElementById('kpiIRR').innerText='140%';
  document.getElementById('kpiCM').innerText='5.1x';
 }
}
function moveTime(v){
 document.querySelectorAll('.task').forEach(t=>{
  t.style.opacity = (parseInt(t.style.gridColumn?.split('/')[1])<=v+1)?1:0.15;
 })
}
function updateKPI(v){
 document.getElementById('roi').innerText=(1+v*0.22).toFixed(1)+'x';
 document.getElementById('payback').innerText=(12-v/2).toFixed(1)+' ماه';
 document.getElementById('margin').innerText=(45+v).toFixed(0)+'%';
 document.getElementById('market').innerText=(v*0.18).toFixed(1)+'%';
}(v){
 document.querySelectorAll('.task').forEach(t=>{
  t.style.opacity = (parseInt(t.style.gridColumn?.split('/')[1])<=v+1)?1:0.2;
 })
}
</script>
<div class="presentation"><button onclick="document.documentElement.requestFullscreen()">Presentation Mode</button></div>
<!-- === Advanced Interactive Extensions === -->
<style>
/* Heatmap Overlay */
.heat-low{box-shadow:inset 0 0 0 2px rgba(46,196,182,.8)}
.heat-mid{box-shadow:inset 0 0 0 2px rgba(255,159,28,.9)}
.heat-high{box-shadow:inset 0 0 0 2px rgba(231,29,54,.95)}
.expandable{cursor:pointer}
.subtask{display:none;font-size:12px;opacity:.9;padding-left:18px}
.subtask.active{display:block;animation:fadeIn .4s ease}
@keyframes fadeIn{from{opacity:0;transform:translateY(6px)}to{opacity:1;transform:none}}
/* Scenario Visual Feedback */
body.cons .task{filter:saturate(.9)}
body.base .task{filter:saturate(1.05)}
body.agg .task{filter:saturate(1.25) brightness(1.05)}
</style>

<section>
<div class="card">
<h2>Risk Heatmap Overlay (تحلیل ریسک مهندسی–مالی)</h2>
<p style="opacity:.85">هر تسک با توجه به حساسیت فنی، مالی و تامین، رنگ ریسک متفاوت دارد. این لایه تصمیم‌گیری را بصری و فوری می‌کند.</p>
<div class="scenarioBar">
<button onclick="applyHeat('low')" class="base">Low Risk</button>
<button onclick="applyHeat('mid')" class="conservative">Medium Risk</button>
<button onclick="applyHeat('high')" class="aggressive">High Risk</button>
</div>
</div>
</section>

<section>
<div class="card">
<h2>Expandable Engineering Breakdown (WBS تعاملی)</h2>
<div class="gantt" style="grid-template-columns:260px repeat(10,1fr)">
<div></div>
<div class="head">P1</div><div class="head">P2</div><div class="head">P3</div><div class="head">P4</div><div class="head">P5</div><div class="head">P6</div><div class="head">P7</div><div class="head">P8</div><div class="head">P9</div><div class="head">P10</div>

<div class="label expandable" onclick="toggleSub(this)">طراحی دیسک انفجاری ▼
  <div class="subtask">• Material Selection (Inconel / SS)</div>
  <div class="subtask">• Thickness Optimization</div>
  <div class="subtask">• Rupture Calibration</div>
</div>
<div class="task t1" style="grid-column:2/7">Engineering Core</div>

<div class="label expandable" onclick="toggleSub(this)">سیستم تست و کالیبراسیون ▼
  <div class="subtask">• Pressure Ramp Logic</div>
  <div class="subtask">• Sensor Accuracy</div>
  <div class="subtask">• Validation Protocol</div>
</div>
<div class="task t3" style="grid-column:5/10">Validation Chain</div>
</div>
</div>
</section>

<section>
<div class="card">
<h2>Scenario Simulator (تصمیم سرمایه‌گذار)</h2>
<p style="opacity:.9">انتخاب سناریو فقط عدد را تغییر نمی‌دهد؛ شدت رنگ، انرژی پروژه و سرعت بازگشت سرمایه را هم حس می‌کنید.</p>
<div class="scenarioBar">
<button onclick="setScenarioMode('cons')" class="conservative">Conservative</button>
<button onclick="setScenarioMode('base')" class="base">Base</button>
<button onclick="setScenarioMode('agg')" class="aggressive">Aggressive</button>
</div>
</div>
</section>

<script>
function applyHeat(level){
 document.querySelectorAll('.task').forEach(t=>{
  t.classList.remove('heat-low','heat-mid','heat-high');
  if(level==='low')t.classList.add('heat-low');
  if(level==='mid')t.classList.add('heat-mid');
  if(level==='high')t.classList.add('heat-high');
 })
}
function toggleSub(el){
 el.querySelectorAll('.subtask').forEach(s=>s.classList.toggle('active'));
}
function setScenarioMode(m){
 document.body.classList.remove('cons','base','agg');
 document.body.classList.add(m);
 setScenario(m);
}
</script>

</body>
</html>
