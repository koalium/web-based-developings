<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>404 - Dalton's Color Vision Challenge</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;600;700;800;900&family=Rubik:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --color-normal: #ff4757;
            --color-protanopia: #00d2d3;
            --color-deuteranopia: #ff9f43;
            --color-tritanopia: #5f27cd;
            --color-monochrome: #576574;
            --dark-bg: #0c2461;
            --darker-bg: #1e272e;
            --light-text: #f7f7f7;
            --card-bg: rgba(255, 255, 255, 0.08);
            --gradient-primary: linear-gradient(135deg, #ff6b6b, #ee5a52, #ff4757);
            --gradient-secondary: linear-gradient(135deg, #00d2d3, #1dd1a1);
            --gradient-tertiary: linear-gradient(135deg, #ff9f43, #ffaf40);
            --gradient-quaternary: linear-gradient(135deg, #5f27cd, #341f97);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            user-select: none;
        }

        body {
            font-family: 'Rubik', sans-serif;
            background: linear-gradient(135deg, var(--darker-bg), var(--dark-bg), #0a3d62);
            color: var(--light-text);
            min-height: 100vh;
            overflow-x: hidden;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 20px;
            position: relative;
        }

        .color-vision-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
            opacity: 0.05;
            background: radial-gradient(circle at 20% 50%, var(--color-normal) 0%, transparent 50%),
                        radial-gradient(circle at 80% 20%, var(--color-protanopia) 0%, transparent 50%),
                        radial-gradient(circle at 40% 80%, var(--color-deuteranopia) 0%, transparent 50%),
                        radial-gradient(circle at 60% 60%, var(--color-tritanopia) 0%, transparent 50%);
            animation: colorShift 20s infinite alternate;
        }

        @keyframes colorShift {
            0% { filter: hue-rotate(0deg); }
            100% { filter: hue-rotate(90deg); }
        }

        .color-dots {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
            pointer-events: none;
        }

        .color-dot {
            position: absolute;
            border-radius: 50%;
            opacity: 0.4;
            animation: floatDot 15s infinite ease-in-out;
            filter: blur(1px);
        }

        @keyframes floatDot {
            0%, 100% { transform: translate(0, 0) scale(1); }
            25% { transform: translate(30px, 40px) scale(1.1); }
            50% { transform: translate(0, 80px) scale(1); }
            75% { transform: translate(-30px, 40px) scale(0.9); }
        }

        .container {
            max-width: 1400px;
            width: 100%;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 30px;
            z-index: 1;
        }

        .header {
            text-align: center;
            margin-bottom: 40px;
            animation: colorPulse 3s infinite alternate;
        }

        @keyframes colorPulse {
            0% { filter: drop-shadow(0 0 10px rgba(255, 71, 87, 0.3)); }
            33% { filter: drop-shadow(0 0 10px rgba(0, 210, 211, 0.3)); }
            66% { filter: drop-shadow(0 0 10px rgba(255, 159, 67, 0.3)); }
            100% { filter: drop-shadow(0 0 10px rgba(95, 39, 205, 0.3)); }
        }

        .logo {
            font-family: 'Montserrat', sans-serif;
            font-weight: 900;
            font-size: 4.5rem;
            background: linear-gradient(90deg, var(--color-normal), var(--color-protanopia), var(--color-deuteranopia), var(--color-tritanopia));
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            margin-bottom: 15px;
            text-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
            letter-spacing: 1px;
        }

        .logo-subtitle {
            font-size: 1.4rem;
            opacity: 0.9;
            max-width: 800px;
            margin: 0 auto 30px;
            line-height: 1.6;
        }

        .error-section {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin-bottom: 50px;
            width: 100%;
        }

        .error-code {
            font-family: 'Montserrat', sans-serif;
            font-size: 15rem;
            font-weight: 900;
            line-height: 1;
            position: relative;
            margin-bottom: 20px;
        }

        .error-digit {
            display: inline-block;
            position: relative;
            transition: all 0.5s ease;
        }

        .error-digit:nth-child(1) { color: var(--color-normal); }
        .error-digit:nth-child(2) { color: var(--color-protanopia); }
        .error-digit:nth-child(3) { color: var(--color-deuteranopia); }

        .error-digit:hover {
            transform: translateY(-20px) scale(1.1);
            text-shadow: 0 10px 20px rgba(0, 0, 0, 0.3);
        }

        .error-message {
            font-size: 2.2rem;
            text-align: center;
            max-width: 900px;
            line-height: 1.5;
            margin-bottom: 40px;
            font-weight: 600;
            background: linear-gradient(90deg, #ff9ff3, #f368e0, #ff6b6b);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
        }

        .challenge-container {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 40px;
            width: 100%;
            margin-bottom: 50px;
        }

        .color-vision-test {
            flex: 1;
            min-width: 350px;
            max-width: 800px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 25px;
            padding: 35px;
            backdrop-filter: blur(15px);
            border: 2px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.3);
            transition: transform 0.4s;
        }

        .color-vision-test:hover {
            transform: translateY(-10px);
        }

        .test-title {
            font-family: 'Montserrat', sans-serif;
            font-size: 2.2rem;
            margin-bottom: 30px;
            text-align: center;
            background: var(--gradient-primary);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
        }

        .color-grid {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 20px;
            margin-bottom: 30px;
        }

        .color-cell {
            aspect-ratio: 1;
            border-radius: 15px;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.8rem;
            color: white;
            text-shadow: 0 2px 5px rgba(0, 0, 0, 0.3);
            position: relative;
            overflow: hidden;
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.2);
        }

        .color-cell:hover {
            transform: scale(1.08);
            box-shadow: 0 12px 20px rgba(0, 0, 0, 0.3);
        }

        .color-cell.selected {
            transform: scale(1.05);
            box-shadow: 0 0 0 4px white, 0 0 25px rgba(255, 255, 255, 0.5);
            animation: selectedPulse 1.5s infinite;
        }

        @keyframes selectedPulse {
            0%, 100% { box-shadow: 0 0 0 4px white, 0 0 25px rgba(255, 255, 255, 0.5); }
            50% { box-shadow: 0 0 0 6px white, 0 0 35px rgba(255, 255, 255, 0.7); }
        }

        .color-cell.correct {
            animation: correctFlash 1s forwards;
        }

        @keyframes correctFlash {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); box-shadow: 0 0 30px rgba(46, 204, 113, 0.8); }
            100% { transform: scale(1); box-shadow: 0 8px 16px rgba(0, 0, 0, 0.2); }
        }

        .color-cell.incorrect {
            animation: incorrectShake 0.5s;
        }

        @keyframes incorrectShake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-10px); }
            75% { transform: translateX(10px); }
        }

        .test-instructions {
            background: rgba(0, 0, 0, 0.2);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 25px;
            border-left: 5px solid var(--color-protanopia);
        }

        .instructions-title {
            font-size: 1.3rem;
            margin-bottom: 10px;
            color: var(--color-protanopia);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .instruction-text {
            font-size: 1.1rem;
            line-height: 1.6;
        }

        .vision-type-selector {
            flex: 1;
            min-width: 350px;
            max-width: 500px;
            display: flex;
            flex-direction: column;
            gap: 25px;
        }

        .vision-card {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 20px;
            padding: 30px;
            backdrop-filter: blur(10px);
            border: 2px solid transparent;
            transition: all 0.4s;
            cursor: pointer;
            position: relative;
            overflow: hidden;
        }

        .vision-card:hover {
            background: rgba(255, 255, 255, 0.08);
            transform: translateY(-8px);
        }

        .vision-card.active {
            border-color: rgba(255, 255, 255, 0.3);
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.4);
        }

        .vision-card.active::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 8px;
            height: 100%;
            background: linear-gradient(to bottom, var(--color-normal), var(--color-tritanopia));
        }

        .vision-title {
            font-family: 'Montserrat', sans-serif;
            font-size: 1.8rem;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .vision-icon {
            font-size: 2rem;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
        }

        .normal .vision-icon { background: var(--gradient-primary); }
        .protanopia .vision-icon { background: var(--gradient-secondary); }
        .deuteranopia .vision-icon { background: var(--gradient-tertiary); }
        .tritanopia .vision-icon { background: var(--gradient-quaternary); }

        .vision-description {
            font-size: 1rem;
            line-height: 1.6;
            opacity: 0.9;
            margin-bottom: 20px;
        }

        .color-palette {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }

        .palette-color {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            border: 2px solid rgba(255, 255, 255, 0.3);
        }

        .progress-section {
            width: 100%;
            max-width: 1000px;
            margin-bottom: 40px;
        }

        .progress-container {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 20px;
            padding: 30px;
            backdrop-filter: blur(10px);
            border: 2px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.2);
        }

        .progress-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
        }

        .progress-title {
            font-family: 'Montserrat', sans-serif;
            font-size: 1.8rem;
            background: linear-gradient(90deg, var(--color-normal), var(--color-protanopia));
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
        }

        .progress-stats {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--color-deuteranopia);
        }

        .progress-bar-container {
            height: 25px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 50px;
            overflow: hidden;
            margin-bottom: 15px;
            position: relative;
        }

        .progress-bar {
            height: 100%;
            background: linear-gradient(90deg, var(--color-normal), var(--color-protanopia), var(--color-deuteranopia));
            border-radius: 50px;
            width: 0%;
            transition: width 1s ease;
            position: relative;
            overflow: hidden;
        }

        .progress-bar::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
            animation: shimmer 2s infinite;
        }

        .progress-message {
            font-size: 1.2rem;
            text-align: center;
            margin-top: 15px;
            font-weight: 600;
            min-height: 30px;
        }

        .actions-container {
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
            gap: 30px;
            width: 100%;
            max-width: 1000px;
            margin-bottom: 50px;
        }

        .action-btn {
            padding: 22px 45px;
            border-radius: 50px;
            border: none;
            font-family: 'Montserrat', sans-serif;
            font-weight: 800;
            font-size: 1.3rem;
            cursor: pointer;
            transition: all 0.4s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
            min-width: 280px;
            text-transform: uppercase;
            letter-spacing: 1px;
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.3);
            position: relative;
            overflow: hidden;
        }

        .action-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: left 0.7s;
        }

        .action-btn:hover::before {
            left: 100%;
        }

        .home-btn {
            background: linear-gradient(135deg, var(--color-normal), #c23616);
            color: white;
        }

        .home-btn:hover {
            transform: translateY(-10px) scale(1.05);
            box-shadow: 0 25px 40px rgba(255, 71, 87, 0.4);
        }

        .explore-btn {
            background: linear-gradient(135deg, var(--color-protanopia), #0a3d62);
            color: white;
        }

        .explore-btn:hover {
            transform: translateY(-10px) scale(1.05);
            box-shadow: 0 25px 40px rgba(0, 210, 211, 0.4);
        }

        .learn-btn {
            background: linear-gradient(135deg, var(--color-deuteranopia), #e67e22);
            color: white;
        }

        .learn-btn:hover {
            transform: translateY(-10px) scale(1.05);
            box-shadow: 0 25px 40px rgba(255, 159, 67, 0.4);
        }

        .footer {
            margin-top: 30px;
            text-align: center;
            font-size: 0.9rem;
            opacity: 0.7;
            max-width: 800px;
            line-height: 1.6;
        }

        .dalton-fact {
            position: fixed;
            bottom: 25px;
            right: 25px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            padding: 20px;
            max-width: 300px;
            backdrop-filter: blur(10px);
            border: 2px solid rgba(255, 255, 255, 0.2);
            transform: translateY(100px);
            opacity: 0;
            transition: all 0.5s;
            z-index: 10;
        }

        .dalton-fact.active {
            transform: translateY(0);
            opacity: 1;
        }

        .fact-title {
            font-weight: 700;
            color: var(--color-tritanopia);
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .fact-content {
            font-size: 0.95rem;
            line-height: 1.5;
        }

        .close-fact {
            position: absolute;
            top: 10px;
            right: 10px;
            background: none;
            border: none;
            color: white;
            cursor: pointer;
            font-size: 1.2rem;
            opacity: 0.7;
            transition: opacity 0.3s;
        }

        .close-fact:hover {
            opacity: 1;
        }

        .color-blindness-sim {
            position: fixed;
            top: 25px;
            right: 25px;
            background: rgba(0, 0, 0, 0.7);
            border-radius: 15px;
            padding: 15px;
            backdrop-filter: blur(10px);
            border: 2px solid rgba(255, 255, 255, 0.2);
            z-index: 10;
            display: flex;
            gap: 10px;
        }

        .sim-btn {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            border: none;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
            color: white;
            transition: all 0.3s;
        }

        .sim-btn.active {
            transform: scale(1.1);
            box-shadow: 0 0 15px rgba(255, 255, 255, 0.5);
        }

        .sim-normal { background: var(--color-normal); }
        .sim-protanopia { background: var(--color-protanopia); }
        .sim-deuteranopia { background: var(--color-deuteranopia); }
        .sim-tritanopia { background: var(--color-tritanopia); }

        .confetti {
            position: fixed;
            width: 15px;
            height: 15px;
            opacity: 0;
            z-index: 1000;
            pointer-events: none;
        }

        /* Responsive adjustments */
        @media (max-width: 1200px) {
            .challenge-container {
                flex-direction: column;
                align-items: center;
            }
            
            .color-vision-test, .vision-type-selector {
                width: 100%;
                max-width: 800px;
            }
        }

        @media (max-width: 768px) {
            .logo {
                font-size: 3.5rem;
            }
            
            .error-code {
                font-size: 11rem;
            }
            
            .error-message {
                font-size: 1.8rem;
            }
            
            .color-grid {
                grid-template-columns: repeat(4, 1fr);
                gap: 15px;
            }
            
            .action-btn {
                min-width: 100%;
                padding: 20px 30px;
                font-size: 1.2rem;
            }
            
            .dalton-fact {
                position: relative;
                bottom: auto;
                right: auto;
                margin-top: 30px;
                max-width: 100%;
            }
        }

        @media (max-width: 480px) {
            .logo {
                font-size: 2.8rem;
            }
            
            .error-code {
                font-size: 8rem;
            }
            
            .color-grid {
                grid-template-columns: repeat(3, 1fr);
            }
            
            .vision-card {
                padding: 25px 20px;
            }
            
            .color-blindness-sim {
                top: 15px;
                right: 15px;
                padding: 10px;
            }
            
            .sim-btn {
                width: 35px;
                height: 35px;
                font-size: 1rem;
            }
        }
    </style>
</head>
<body>
    <div class="color-vision-overlay"></div>
    <div class="color-dots" id="colorDots"></div>
    
    <div class="color-blindness-sim" id="colorSim">
        <button class="sim-btn sim-normal active" id="simNormal" title="Normal Vision"><i class="fas fa-eye"></i></button>
        <button class="sim-btn sim-protanopia" id="simProtanopia" title="Protanopia Simulation"><i class="fas fa-eye-slash"></i></button>
        <button class="sim-btn sim-deuteranopia" id="simDeuteranopia" title="Deuteranopia Simulation"><i class="fas fa-low-vision"></i></button>
        <button class="sim-btn sim-tritanopia" id="simTritanopia" title="Tritanopia Simulation"><i class="fas fa-adjust"></i></button>
    </div>
    
    <div class="dalton-fact" id="daltonFact">
        <button class="close-fact" id="closeFact"><i class="fas fa-times"></i></button>
        <div class="fact-title"><i class="fas fa-lightbulb"></i> DID YOU KNOW?</div>
        <div class="fact-content" id="factContent">Color blindness is named after John Dalton, who published the first scientific paper on the subject in 1798.</div>
    </div>
    
    <div class="container">
        <div class="header">
            <div class="logo">DALTON'S 404</div>
            <div class="logo-subtitle">An interactive exploration of color perception and vision diversity</div>
        </div>
        
        <div class="error-section">
            <div class="error-code">
                <span class="error-digit">4</span>
                <span class="error-digit">0</span>
                <span class="error-digit">4</span>
            </div>
            <div class="error-message">The page you're looking for appears differently to everyone. Can you solve the color vision challenge to find your way?</div>
        </div>
        
        <div class="challenge-container">
            <div class="color-vision-test">
                <h2 class="test-title"><i class="fas fa-palette"></i> COLOR IDENTIFICATION CHALLENGE</h2>
                
                <div class="test-instructions">
                    <h3 class="instructions-title"><i class="fas fa-info-circle"></i> INSTRUCTIONS</h3>
                    <p class="instruction-text">Select the color that <strong>DOESN'T MATCH</strong> the others in each row. Test your color perception skills! Each correct answer brings you closer to finding the missing page.</p>
                </div>
                
                <div class="color-grid" id="colorGrid">
                    <!-- Color cells will be generated by JavaScript -->
                </div>
                
                <div class="progress-message" id="progressMessage">Select the odd color in each row to begin the challenge!</div>
            </div>
            
            <div class="vision-type-selector">
                <div class="vision-card normal active" id="visionNormal">
                    <div class="vision-title">
                        <div class="vision-icon"><i class="fas fa-eye"></i></div>
                        <span>Normal Color Vision</span>
                    </div>
                    <p class="vision-description">Trichromatic vision with full sensitivity to red, green, and blue light wavelengths. Approximately 92% of the population has normal color vision.</p>
                    <div class="color-palette">
                        <div class="palette-color" style="background: #ff4757;"></div>
                        <div class="palette-color" style="background: #2ed573;"></div>
                        <div class="palette-color" style="background: #1e90ff;"></div>
                        <div class="palette-color" style="background: #ffa502;"></div>
                        <div class="palette-color" style="background: #9b59b6;"></div>
                    </div>
                </div>
                
                <div class="vision-card protanopia" id="visionProtanopia">
                    <div class="vision-title">
                        <div class="vision-icon"><i class="fas fa-eye-slash"></i></div>
                        <span>Protanopia (Red-Blind)</span>
                    </div>
                    <p class="vision-description">Missing or defective red cones. Reds appear as black or dark gray, and purples appear as blue. Affects about 1% of males and 0.01% of females.</p>
                    <div class="color-palette">
                        <div class="palette-color" style="background: #8b7d7d;"></div>
                        <div class="palette-color" style="background: #2ed573;"></div>
                        <div class="palette-color" style="background: #1e90ff;"></div>
                        <div class="palette-color" style="background: #ffa502;"></div>
                        <div class="palette-color" style="background: #4169e1;"></div>
                    </div>
                </div>
                
                <div class="vision-card deuteranopia" id="visionDeuteranopia">
                    <div class="vision-title">
                        <div class="vision-icon"><i class="fas fa-low-vision"></i></div>
                        <span>Deuteranopia (Green-Blind)</span>
                    </div>
                    <p class="vision-description">Missing or defective green cones. Difficulty distinguishing between red and green hues. The most common form of color blindness, affecting about 6% of males.</p>
                    <div class="color-palette">
                        <div class="palette-color" style="background: #ff4757;"></div>
                        <div class="palette-color" style="background: #8b7d7d;"></div>
                        <div class="palette-color" style="background: #1e90ff;"></div>
                        <div class="palette-color" style="background: #ffa502;"></div>
                        <div class="palette-color" style="background: #9b59b6;"></div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="progress-section">
            <div class="progress-container">
                <div class="progress-header">
                    <div class="progress-title">COLOR VISION PROGRESS</div>
                    <div class="progress-stats" id="progressStats">0/5 Challenges</div>
                </div>
                <div class="progress-bar-container">
                    <div class="progress-bar" id="progressBar"></div>
                </div>
                <div class="progress-message" id="challengeMessage">Complete the color identification challenges to unlock navigation options.</div>
            </div>
        </div>
        
        <div class="actions-container">
            <button class="action-btn home-btn" id="homeButton" disabled>
                <i class="fas fa-home"></i> GO HOME
            </button>
            <button class="action-btn explore-btn" id="exploreButton">
                <i class="fas fa-compass"></i> EXPLORE SITE
            </button>
            <button class="action-btn learn-btn" id="learnButton">
                <i class="fas fa-book"></i> LEARN MORE
            </button>
        </div>
        
        <div class="footer">
            <p>Â© 2023 Dalton's 404 Challenge | This interactive experience explores color vision diversity and raises awareness about color blindness.</p>
            <p>Inspired by John Dalton's pioneering work on color vision. All simulations are approximate representations.</p>
        </div>
    </div>

    <script>
        // Game state
        const gameState = {
            currentChallenge: 0,
            totalChallenges: 5,
            correctAnswers: 0,
            visionType: 'normal',
            challenges: [
                {
                    colors: ['#FF6B6B', '#FF6B6B', '#4ECDC4', '#FF6B6B', '#FF6B6B'],
                    oddIndex: 2,
                    hint: "Look for the color that stands out from the reds"
                },
                {
                    colors: ['#1DD1A1', '#1DD1A1', '#1DD1A1', '#FF9F43', '#1DD1A1'],
                    oddIndex: 3,
                    hint: "Find the warm color among the cool greens"
                },
                {
                    colors: ['#54A0FF', '#FF9FF3', '#54A0FF', '#54A0FF', '#54A0FF'],
                    oddIndex: 1,
                    hint: "Spot the pink among the blues"
                },
                {
                    colors: ['#F368E0', '#F368E0', '#FF9F43', '#F368E0', '#F368E0'],
                    oddIndex: 2,
                    hint: "Identify the orange among the purples"
                },
                {
                    colors: ['#FF9F43', '#2ED573', '#2ED573', '#2ED573', '#2ED573'],
                    oddIndex: 0,
                    hint: "Find the odd one out among the greens"
                }
            ],
            daltonFacts: [
                "John Dalton, the father of color blindness research, was himself red-green color blind.",
                "Color blindness affects approximately 1 in 12 men (8%) and 1 in 200 women (0.5%) worldwide.",
                "The term 'color blind' is somewhat misleading, as most people with color vision deficiency can see colors, just differently.",
                "Dogs are dichromats, seeing blues and yellows but not reds and greens like humans.",
                "The most common form of color blindness is deuteranomaly, affecting about 5% of males.",
                "Some countries restrict color-blind individuals from certain professions like pilots or electricians.",
                "Color blindness is usually inherited through the X chromosome, which is why it's more common in males.",
                "Special glasses and contact lenses can help some people with color blindness distinguish colors better.",
                "Digital interfaces can be made more accessible by using patterns along with colors.",
                "Famous color-blind people include Mark Zuckerberg, Bill Clinton, and Christopher Nolan."
            ]
        };

        // DOM Elements
        const colorGridEl = document.getElementById('colorGrid');
        const progressBarEl = document.getElementById('progressBar');
        const progressStatsEl = document.getElementById('progressStats');
        const progressMessageEl = document.getElementById('progressMessage');
        const challengeMessageEl = document.getElementById('challengeMessage');
        const homeButtonEl = document.getElementById('homeButton');
        const exploreButtonEl = document.getElementById('exploreButton');
        const learnButtonEl = document.getElementById('learnButton');
        const visionCards = document.querySelectorAll('.vision-card');
        const simButtons = document.querySelectorAll('.sim-btn');
        const daltonFactEl = document.getElementById('daltonFact');
        const factContentEl = document.getElementById('factContent');
        const closeFactEl = document.getElementById('closeFact');

        // Initialize color dots background
        function initColorDots() {
            const colorDotsEl = document.getElementById('colorDots');
            const colors = ['#FF6B6B', '#1DD1A1', '#54A0FF', '#FF9FF3', '#FF9F43', '#F368E0'];
            
            for (let i = 0; i < 40; i++) {
                const dot = document.createElement('div');
                dot.classList.add('color-dot');
                dot.style.width = `${Math.random() * 100 + 30}px`;
                dot.style.height = dot.style.width;
                dot.style.left = `${Math.random() * 100}%`;
                dot.style.top = `${Math.random() * 100}%`;
                dot.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
                dot.style.animationDelay = `${Math.random() * 15}s`;
                dot.style.animationDuration = `${Math.random() * 20 + 10}s`;
                colorDotsEl.appendChild(dot);
            }
        }

        // Generate color grid for current challenge
        function generateColorGrid() {
            colorGridEl.innerHTML = '';
            
            const challenge = gameState.challenges[gameState.currentChallenge];
            
            challenge.colors.forEach((color, index) => {
                const colorCell = document.createElement('div');
                colorCell.className = 'color-cell';
                colorCell.style.backgroundColor = color;
                colorCell.dataset.index = index;
                colorCell.dataset.isOdd = index === challenge.oddIndex;
                
                // Add icon based on position (simulating Ishihara test)
                if (index === challenge.oddIndex) {
                    colorCell.innerHTML = '<i class="fas fa-question-circle"></i>';
                } else {
                    colorCell.innerHTML = '<i class="fas fa-circle"></i>';
                }
                
                // Add click event
                colorCell.addEventListener('click', () => checkColorSelection(index));
                
                colorGridEl.appendChild(colorCell);
            });
            
            // Update progress message
            progressMessageEl.textContent = `Challenge ${gameState.currentChallenge + 1}/${gameState.totalChallenges}: ${challenge.hint}`;
        }

        // Check selected color
        function checkColorSelection(selectedIndex) {
            const challenge = gameState.challenges[gameState.currentChallenge];
            const isCorrect = selectedIndex === challenge.oddIndex;
            const colorCells = document.querySelectorAll('.color-cell');
            
            // Visual feedback
            colorCells.forEach((cell, index) => {
                if (index === selectedIndex) {
                    cell.classList.add(isCorrect ? 'correct' : 'incorrect');
                    cell.classList.add('selected');
                }
                
                // Show which one was the correct odd color
                if (index === challenge.oddIndex && !isCorrect) {
                    setTimeout(() => {
                        cell.classList.add('selected');
                        setTimeout(() => {
                            cell.classList.remove('selected');
                        }, 2000);
                    }, 500);
                }
            });
            
            // Update game state
            if (isCorrect) {
                gameState.correctAnswers++;
                playSound('correct');
                
                // Move to next challenge after delay
                setTimeout(() => {
                    gameState.currentChallenge++;
                    
                    if (gameState.currentChallenge < gameState.totalChallenges) {
                        generateColorGrid();
                    } else {
                        completeGame();
                    }
                    
                    updateProgress();
                }, 1500);
            } else {
                playSound('incorrect');
                
                // Remove incorrect class after animation
                setTimeout(() => {
                    colorCells[selectedIndex].classList.remove('incorrect');
                    colorCells[selectedIndex].classList.remove('selected');
                }, 1000);
            }
        }

        // Update progress display
        function updateProgress() {
            const percentage = (gameState.correctAnswers / gameState.totalChallenges) * 100;
            progressBarEl.style.width = `${percentage}%`;
            progressStatsEl.textContent = `${gameState.correctAnswers}/${gameState.totalChallenges} Challenges`;
            
            // Update challenge message
            if (gameState.currentChallenge < gameState.totalChallenges) {
                challengeMessageEl.textContent = `Great! ${gameState.totalChallenges - gameState.currentChallenge} more challenges to complete.`;
            }
        }

        // Complete the game
        function completeGame() {
            // Enable home button
            homeButtonEl.disabled = false;
            homeButtonEl.style.background = 'linear-gradient(135deg, #2ED573, #1DD1A1)';
            homeButtonEl.innerHTML = '<i class="fas fa-home"></i> GO HOME - UNLOCKED!';
            
            // Update messages
            progressMessageEl.textContent = 'ðŸŽ‰ Congratulations! You completed all color vision challenges!';
            challengeMessageEl.textContent = 'Your understanding of color perception has unlocked the navigation options.';
            
            // Show celebration
            showCelebration();
            
            // Show random Dalton fact
            showRandomFact();
        }

        // Show celebration effect
        function showCelebration() {
            // Create confetti
            for (let i = 0; i < 200; i++) {
                setTimeout(() => {
                    const confetti = document.createElement('div');
                    confetti.classList.add('confetti');
                    
                    const colors = ['#FF6B6B', '#1DD1A1', '#54A0FF', '#FF9FF3', '#FF9F43', '#F368E0'];
                    confetti.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
                    confetti.style.borderRadius = Math.random() > 0.5 ? '50%' : '0';
                    confetti.style.width = `${Math.random() * 20 + 5}px`;
                    confetti.style.height = confetti.style.width;
                    
                    confetti.style.left = `${Math.random() * 100}%`;
                    confetti.style.top = `${-50}px`;
                    confetti.style.opacity = '1';
                    
                    document.body.appendChild(confetti);
                    
                    // Animate confetti falling
                    const animation = confetti.animate([
                        { transform: `translate(0, 0) rotate(0deg)`, opacity: 1 },
                        { transform: `translate(${(Math.random() - 0.5) * 200}px, ${window.innerHeight + 100}px) rotate(${Math.random() * 720}deg)`, opacity: 0 }
                    ], {
                        duration: 2000 + Math.random() * 2000,
                        easing: 'cubic-bezier(0.215, 0.610, 0.355, 1)'
                    });
                    
                    // Remove confetti after animation
                    animation.onfinish = () => confetti.remove();
                }, i * 20);
            }
        }

        // Show random Dalton fact
        function showRandomFact() {
            const randomFact = gameState.daltonFacts[Math.floor(Math.random() * gameState.daltonFacts.length)];
            factContentEl.textContent = randomFact;
            
            // Show the fact panel
            daltonFactEl.classList.add('active');
            
            // Auto-hide after 10 seconds
            setTimeout(() => {
                if (daltonFactEl.classList.contains('active')) {
                    daltonFactEl.classList.remove('active');
                }
            }, 10000);
        }

        // Play sound effect
        function playSound(type) {
            // In a real implementation, you would play actual sound files
            // For this demo, we'll just log
            console.log(`Playing ${type} sound effect`);
        }

        // Apply color blindness simulation filter
        function applyColorFilter(filterType) {
            const body = document.body;
            
            // Remove all existing filters
            body.style.filter = '';
            
            // Apply selected filter
            switch(filterType) {
                case 'normal':
                    body.style.filter = 'none';
                    break;
                case 'protanopia':
                    body.style.filter = 'url(#protanopia)';
                    createSVGFilter('protanopia');
                    break;
                case 'deuteranopia':
                    body.style.filter = 'url(#deuteranopia)';
                    createSVGFilter('deuteranopia');
                    break;
                case 'tritanopia':
                    body.style.filter = 'url(#tritanopia)';
                    createSVGFilter('tritanopia');
                    break;
            }
        }

        // Create SVG filter for color blindness simulation
        function createSVGFilter(type) {
            // Remove existing filter if any
            const existingFilter = document.getElementById('colorFilter');
            if (existingFilter) existingFilter.remove();
            
            // Create new filter
            const svgNS = "http://www.w3.org/2000/svg";
            const filter = document.createElementNS(svgNS, "svg");
            filter.id = "colorFilter";
            filter.style.position = "absolute";
            filter.style.width = "0";
            filter.style.height = "0";
            
            const defs = document.createElementNS(svgNS, "defs");
            const colorMatrix = document.createElementNS(svgNS, "filter");
            colorMatrix.id = type;
            
            // Different matrices for different types of color blindness
            let matrixValues;
            switch(type) {
                case 'protanopia':
                    matrixValues = "0.567, 0.433, 0, 0, 0 0.558, 0.442, 0, 0, 0 0, 0.242, 0.758, 0, 0 0, 0, 0, 1, 0";
                    break;
                case 'deuteranopia':
                    matrixValues = "0.625, 0.375, 0, 0, 0 0.7, 0.3, 0, 0, 0 0, 0.3, 0.7, 0, 0 0, 0, 0, 1, 0";
                    break;
                case 'tritanopia':
                    matrixValues = "0.95, 0.05, 0, 0, 0 0, 0.433, 0.567, 0, 0 0, 0.475, 0.525, 0, 0 0, 0, 0, 1, 0";
                    break;
            }
            
            const feColorMatrix = document.createElementNS(svgNS, "feColorMatrix");
            feColorMatrix.setAttribute("type", "matrix");
            feColorMatrix.setAttribute("values", matrixValues);
            
            colorMatrix.appendChild(feColorMatrix);
            defs.appendChild(colorMatrix);
            filter.appendChild(defs);
            document.body.appendChild(filter);
        }

        // Event Listeners
        visionCards.forEach(card => {
            card.addEventListener('click', function() {
                // Remove active class from all cards
                visionCards.forEach(c => c.classList.remove('active'));
                // Add active class to clicked card
                this.classList.add('active');
                
                // Update vision type
                gameState.visionType = this.id.replace('vision', '').toLowerCase();
                
                // Apply color filter
                applyColorFilter(gameState.visionType);
                
                // Update simulation buttons
                simButtons.forEach(btn => btn.classList.remove('active'));
                document.getElementById(`sim${this.id.replace('vision', '')}`).classList.add('active');
            });
        });

        simButtons.forEach(button => {
            button.addEventListener('click', function() {
                const simType = this.id.replace('sim', '').toLowerCase();
                
                // Update active button
                simButtons.forEach(btn => btn.classList.remove('active'));
                this.classList.add('active');
                
                // Apply filter
                applyColorFilter(simType);
                
                // Update vision cards
                visionCards.forEach(card => card.classList.remove('active'));
                document.getElementById(`vision${this.id.replace('sim', '')}`).classList.add('active');
            });
        });

        closeFactEl.addEventListener('click', () => {
            daltonFactEl.classList.remove('active');
        });

        homeButtonEl.addEventListener('click', () => {
            if (!homeButtonEl.disabled) {
                // In a real implementation, this would redirect to homepage
                // window.location.href = "/";
                alert("ðŸŽ¨ Congratulations on completing the color vision challenge! You're being redirected to the homepage...");
            }
        });

        exploreButtonEl.addEventListener('click', () => {
            alert("Exploring the website with enhanced color accessibility settings...");
        });

        learnButtonEl.addEventListener('click', () => {
            // Show a random fact
            showRandomFact();
        });

        // Initialize the game
        function initGame() {
            initColorDots();
            generateColorGrid();
            updateProgress();
            
            // Show initial fact after a delay
            setTimeout(() => {
                showRandomFact();
            }, 3000);
        }

        // Start the game when page loads
        window.addEventListener('DOMContentLoaded', initGame);
    </script>
</body>
</html>