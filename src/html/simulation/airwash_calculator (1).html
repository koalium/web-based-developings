<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Air Wash System Calculator</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        .container {
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }
        h1 {
            color: #333;
            text-align: center;
            margin-bottom: 30px;
            font-size: 2.5em;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.1);
        }
        .input-section, .results-section {
            margin: 25px 0;
            padding: 20px;
            border-radius: 10px;
            background: #f8f9fa;
            border-left: 5px solid #007bff;
        }
        .input-group {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
            color: #333;
        }
        input, select {
            width: 100%;
            padding: 10px;
            border: 2px solid #ddd;
            border-radius: 5px;
            font-size: 16px;
            transition: border-color 0.3s;
        }
        input:focus, select:focus {
            outline: none;
            border-color: #007bff;
            box-shadow: 0 0 5px rgba(0,123,255,0.3);
        }
        button {
            background: linear-gradient(45deg, #007bff, #0056b3);
            color: white;
            padding: 12px 25px;
            border: none;
            border-radius: 25px;
            cursor: pointer;
            font-size: 16px;
            margin: 10px 5px;
            transition: all 0.3s;
            box-shadow: 0 4px 15px rgba(0,123,255,0.3);
        }
        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0,123,255,0.4);
        }
        .results {
            background: #e8f5e8;
            border-left-color: #28a745;
        }
        .warning {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            border-radius: 5px;
            padding: 10px;
            margin: 10px 0;
            color: #856404;
        }
        .error {
            background: #f8d7da;
            border: 1px solid #f5c6cb;
            border-radius: 5px;
            padding: 10px;
            margin: 10px 0;
            color: #721c24;
        }
        .good {
            background: #d4edda;
            border: 1px solid #c3e6cb;
            border-radius: 5px;
            padding: 10px;
            margin: 10px 0;
            color: #155724;
        }
        .file-ops {
            text-align: center;
            margin: 20px 0;
            padding: 20px;
            background: #f1f3f4;
            border-radius: 10px;
        }
        .result-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
        .result-item {
            background: white;
            padding: 15px;
            border-radius: 8px;
            border: 1px solid #ddd;
        }
        .result-item h4 {
            margin: 0 0 10px 0;
            color: #007bff;
        }
        .advice-section {
            background: #e3f2fd;
            border-left-color: #2196f3;
            margin-top: 20px;
        }
        .advice-section h3 {
            color: #1976d2;
            margin-top: 0;
        }
        .advice-list {
            list-style-type: none;
            padding: 0;
        }
        .advice-list li {
            background: white;
            margin: 10px 0;
            padding: 10px;
            border-radius: 5px;
            border-left: 3px solid #2196f3;
        }
        #fileInput {
            display: none;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üåä Air Wash System Calculator</h1>
        
        <div class="file-ops">
            <h3>üìÅ File Operations</h3>
            <button onclick="loadFromFile()">üìÇ Load Configuration</button>
            <button onclick="saveToFile()">üíæ Save Configuration</button>
            <input type="file" id="fileInput" accept=".json" onchange="handleFileLoad(event)">
        </div>

        <div class="input-section">
            <h3>üìê System Dimensions</h3>
            <div class="input-group">
                <div>
                    <label for="height">Height (m):</label>
                    <input type="number" id="height" step="0.1" value="3.0">
                </div>
                <div>
                    <label for="width">Width (m):</label>
                    <input type="number" id="width" step="0.1" value="2.0">
                </div>
                <div>
                    <label for="airflow">Airflow (m¬≥/s):</label>
                    <input type="number" id="airflow" step="0.1" value="10.0">
                </div>
                <div>
                    <label for="zoneNumber">Number of Zones:</label>
                    <input type="number" id="zoneNumber" value="2" min="1">
                </div>
            </div>
        </div>

        <div class="input-section">
            <h3>‚öôÔ∏è System Parameters</h3>
            <div class="input-group">
                <div>
                    <label for="collectorDiameter">Collector Diameter (inches):</label>
                    <input type="number" id="collectorDiameter" value="4" step="0.1">
                </div>
                <div>
                    <label for="nozzleSpace">Nozzle Spacing (mm):</label>
                    <input type="number" id="nozzleSpace" value="76">
                </div>
                <div>
                    <label for="riserSpace">Riser Spacing (mm):</label>
                    <input type="number" id="riserSpace" value="304">
                </div>
                <div>
                    <label for="nozzleWaterFlow">Nozzle Water Flow (L/min):</label>
                    <input type="number" id="nozzleWaterFlow" value="2.5" step="0.1">
                </div>
            </div>
        </div>

        <button onclick="calculate()">üîÑ Calculate System</button>

        <div id="results" class="results-section" style="display: none;">
            <h3>üìä Calculation Results</h3>
            <div id="resultsContent"></div>
        </div>

        <div id="advice" class="advice-section" style="display: none;">
            <h3>üí° Optimization Advice</h3>
            <div id="adviceContent"></div>
        </div>
    </div>

    <script>
        class AirWashCalculator {
            constructor() {
                this.results = {};
                this.inputs = {};
            }

            calculate() {
                // Get inputs
                this.inputs = {
                    height: parseFloat(document.getElementById('height').value),
                    width: parseFloat(document.getElementById('width').value),
                    airflow: parseFloat(document.getElementById('airflow').value),
                    zoneNumber: parseInt(document.getElementById('zoneNumber').value),
                    collectorDiameter: parseFloat(document.getElementById('collectorDiameter').value),
                    nozzleSpace: parseFloat(document.getElementById('nozzleSpace').value),
                    riserSpace: parseFloat(document.getElementById('riserSpace').value),
                    nozzleWaterFlow: parseFloat(document.getElementById('nozzleWaterFlow').value)
                };

                // Validate inputs
                if (!this.validateInputs()) return;

                // Perform calculations
                this.performCalculations();
                this.displayResults();
                this.generateAdvice();
            }

            validateInputs() {
                const required = ['height', 'width', 'airflow', 'zoneNumber'];
                for (let field of required) {
                    if (!this.inputs[field] || this.inputs[field] <= 0) {
                        alert(`Please enter a valid ${field}`);
                        return false;
                    }
                }
                return true;
            }

            performCalculations() {
                const i = this.inputs;
                const r = this.results = {};

                // Basic calculations
                r.area = i.height * i.width;
                r.airVelocity = i.airflow / r.area;
                r.collectorDiameterM = i.collectorDiameter * 0.0254; // inches to meters
                r.riserLength = i.height - r.collectorDiameterM;
                r.nozzleSpaceM = i.nozzleSpace / 1000; // mm to m
                r.riserSpaceM = i.riserSpace / 1000; // mm to m
                
                // Nozzle and riser calculations
                r.nozzlePerRiser = Math.floor(r.riserLength / r.nozzleSpaceM);
                r.riserPerZone = Math.floor(i.width / r.riserSpaceM) - 1;
                r.totalNozzles = i.zoneNumber * r.riserPerZone * r.nozzlePerRiser;
                r.totalWaterFlow = r.totalNozzles * i.nozzleWaterFlow; // L/min
                r.totalWaterFlowM3h = r.totalWaterFlow * 0.06; // m¬≥/h

                // Pump calculations
                r.pumpHead = 35; // meters (given)
                r.pumpPowerKW = this.calculatePumpPower(r.totalWaterFlowM3h, r.pumpHead);
                r.pumpMotorPower = this.selectMotorPower(r.pumpPowerKW);
                
                // Pipe and component sizing
                r.pipeSizing = this.calculatePipeSizing(r.totalWaterFlowM3h);
                r.filterSpecs = this.calculateFilterSpecs(r.totalWaterFlowM3h);
                
                // Performance indicators
                r.velocityStatus = this.evaluateVelocity(r.airVelocity);
                r.systemEfficiency = this.calculateEfficiency();
            }

            calculatePumpPower(flowM3h, headM) {
                // Pump power calculation: P = (Q √ó H √ó œÅ √ó g) / (3600 √ó Œ∑)
                // Where: Q = flow (m¬≥/h), H = head (m), œÅ = density (1000 kg/m¬≥), g = 9.81 m/s¬≤, Œ∑ = efficiency (0.75)
                const efficiency = 0.75;
                const power = (flowM3h * headM * 1000 * 9.81) / (3600 * efficiency * 1000); // kW
                return power;
            }

            selectMotorPower(calculatedPower) {
                // Standard motor sizes in kW
                const standardSizes = [0.37, 0.55, 0.75, 1.1, 1.5, 2.2, 3.0, 4.0, 5.5, 7.5, 11, 15, 18.5, 22, 30, 37, 45, 55, 75, 90, 110];
                
                // Add 20% safety factor
                const requiredPower = calculatedPower * 1.2;
                
                for (let size of standardSizes) {
                    if (size >= requiredPower) {
                        return size;
                    }
                }
                return standardSizes[standardSizes.length - 1];
            }

            calculatePipeSizing(flowM3h) {
                // Pipe sizing based on recommended velocities
                // Suction: 1.5-2.0 m/s, Discharge: 2.0-3.0 m/s, Return: 1.0-1.5 m/s
                const flowM3s = flowM3h / 3600;
                
                const suctionVelocity = 1.8; // m/s
                const dischargeVelocity = 2.5; // m/s
                const returnVelocity = 1.2; // m/s
                
                const suctionDiameter = Math.sqrt(4 * flowM3s / (Math.PI * suctionVelocity)) * 1000; // mm
                const dischargeDiameter = Math.sqrt(4 * flowM3s / (Math.PI * dischargeVelocity)) * 1000; // mm
                const returnDiameter = Math.sqrt(4 * flowM3s / (Math.PI * returnVelocity)) * 1000; // mm
                
                return {
                    suction: this.standardPipeSize(suctionDiameter),
                    discharge: this.standardPipeSize(dischargeDiameter),
                    return: this.standardPipeSize(returnDiameter)
                };
            }

            standardPipeSize(calculatedDiameter) {
                const standardSizes = [20, 25, 32, 40, 50, 65, 80, 100, 125, 150, 200, 250, 300, 350, 400, 450, 500];
                for (let size of standardSizes) {
                    if (size >= calculatedDiameter) {
                        return size;
                    }
                }
                return standardSizes[standardSizes.length - 1];
            }

            calculateFilterSpecs(flowM3h) {
                // Filter sizing - typically 1.5-2 times the pump flow rate
                const filterFlow = flowM3h * 1.8;
                
                let filterType, micronRating;
                
                if (flowM3h < 5) {
                    filterType = "Cartridge Filter";
                    micronRating = "25-50 micron";
                } else if (flowM3h < 20) {
                    filterType = "Sand Filter";
                    micronRating = "20-40 micron";
                } else {
                    filterType = "Multi-media Filter";
                    micronRating = "15-30 micron";
                }
                
                return {
                    type: filterType,
                    flowCapacity: Math.ceil(filterFlow),
                    micronRating: micronRating,
                    backwashFrequency: "Every 24-48 hours"
                };
            }

            evaluateVelocity(velocity) {
                if (velocity > 3.8) {
                    return { status: "HIGH", message: "Air velocity too high - reduce airflow or increase area", class: "error" };
                } else if (velocity < 3.0) {
                    return { status: "LOW", message: "Air velocity low - consider increasing airflow", class: "warning" };
                } else if (velocity >= 3.4 && velocity <= 3.5) {
                    return { status: "OPTIMAL", message: "Air velocity in optimal range", class: "good" };
                } else {
                    return { status: "ACCEPTABLE", message: "Air velocity acceptable", class: "good" };
                }
            }

            calculateEfficiency() {
                const r = this.results;
                let score = 100;
                
                // Penalize for non-optimal velocity
                if (r.airVelocity > 3.8) score -= 20;
                else if (r.airVelocity < 3.0) score -= 10;
                
                // Consider nozzle coverage
                const nozzleDensity = r.totalNozzles / r.area;
                if (nozzleDensity < 10) score -= 15;
                
                return Math.max(score, 0);
            }

            displayResults() {
                const r = this.results;
                const content = document.getElementById('resultsContent');
                
                content.innerHTML = `
                    <div class="${r.velocityStatus.class}">
                        <strong>Air Velocity Status:</strong> ${r.velocityStatus.message}
                    </div>
                    
                    <div class="result-grid">
                        <div class="result-item">
                            <h4>üí® Air Flow Analysis</h4>
                            <p><strong>Area:</strong> ${r.area.toFixed(2)} m¬≤</p>
                            <p><strong>Air Velocity:</strong> ${r.airVelocity.toFixed(2)} m/s</p>
                            <p><strong>Status:</strong> ${r.velocityStatus.status}</p>
                        </div>
                        
                        <div class="result-item">
                            <h4>üîß System Configuration</h4>
                            <p><strong>Riser Length:</strong> ${r.riserLength.toFixed(2)} m</p>
                            <p><strong>Nozzles per Riser:</strong> ${r.nozzlePerRiser}</p>
                            <p><strong>Risers per Zone:</strong> ${r.riserPerZone}</p>
                            <p><strong>Total Nozzles:</strong> ${r.totalNozzles}</p>
                        </div>
                        
                        <div class="result-item">
                            <h4>üíß Water System</h4>
                            <p><strong>Total Water Flow:</strong> ${r.totalWaterFlow.toFixed(1)} L/min</p>
                            <p><strong>Flow Rate:</strong> ${r.totalWaterFlowM3h.toFixed(2)} m¬≥/h</p>
                            <p><strong>Pump Head:</strong> ${r.pumpHead} m</p>
                        </div>
                        
                        <div class="result-item">
                            <h4>‚ö° Pump & Motor</h4>
                            <p><strong>Calculated Power:</strong> ${r.pumpPowerKW.toFixed(2)} kW</p>
                            <p><strong>Selected Motor:</strong> ${r.pumpMotorPower} kW</p>
                            <p><strong>Safety Factor:</strong> 20%</p>
                        </div>
                        
                        <div class="result-item">
                            <h4>üö∞ Pipe Sizing (mm)</h4>
                            <p><strong>Suction Pipe:</strong> ${r.pipeSizing.suction} mm</p>
                            <p><strong>Discharge Pipe:</strong> ${r.pipeSizing.discharge} mm</p>
                            <p><strong>Return Pipe:</strong> ${r.pipeSizing.return} mm</p>
                        </div>
                        
                        <div class="result-item">
                            <h4>üîΩ Filter Specifications</h4>
                            <p><strong>Type:</strong> ${r.filterSpecs.type}</p>
                            <p><strong>Capacity:</strong> ${r.filterSpecs.flowCapacity} m¬≥/h</p>
                            <p><strong>Filtration:</strong> ${r.filterSpecs.micronRating}</p>
                            <p><strong>Backwash:</strong> ${r.filterSpecs.backwashFrequency}</p>
                        </div>
                    </div>
                `;
                
                document.getElementById('results').style.display = 'block';
            }

            generateAdvice() {
                const r = this.results;
                const i = this.inputs;
                const advice = [];
                
                // Velocity optimization
                if (r.airVelocity > 3.8) {
                    advice.push("üî¥ CRITICAL: Reduce airflow to " + (3.5 * r.area).toFixed(1) + " m¬≥/s or increase wash area to " + (i.airflow / 3.5).toFixed(2) + " m¬≤ for optimal velocity");
                } else if (r.airVelocity < 3.0) {
                    advice.push("üü° Consider increasing airflow to " + (3.4 * r.area).toFixed(1) + " m¬≥/s for better performance");
                } else if (r.airVelocity >= 3.4 && r.airVelocity <= 3.5) {
                    advice.push("üü¢ Excellent! Air velocity is in the optimal range for maximum efficiency");
                }
                
                // Pump selection advice
                if (r.pumpPowerKW < 2) {
                    advice.push("üí° Consider a variable frequency drive (VFD) for energy savings on smaller pumps");
                } else {
                    advice.push("üí° Use a VFD for energy efficiency and soft starting with larger motors");
                }
                
                // System optimization
                advice.push("üîß Install pressure gauges before and after filters to monitor pressure drop");
                advice.push("üîß Use stainless steel or corrosion-resistant materials for nozzles and risers");
                advice.push("üîß Install flow meters on main lines for system monitoring");
                
                // Water quality
                advice.push("üíß Implement water quality monitoring (pH, conductivity, suspended solids)");
                advice.push("üíß Consider UV sterilization for biological control in recirculating systems");
                
                // Maintenance
                advice.push("üõ†Ô∏è Schedule weekly nozzle cleaning and monthly riser inspection");
                advice.push("üõ†Ô∏è Replace filter media every 6-12 months depending on water quality");
                
                // Energy efficiency
                if (r.systemEfficiency < 80) {
                    advice.push("‚ö° System efficiency is " + r.systemEfficiency.toFixed(1) + "% - consider design optimization");
                } else {
                    advice.push("‚ö° Good system efficiency at " + r.systemEfficiency.toFixed(1) + "%");
                }
                
                // Economic considerations
                const dailyWaterUsage = r.totalWaterFlowM3h * 8; // 8 hours operation
                advice.push("üí∞ Daily water usage: ~" + dailyWaterUsage.toFixed(1) + " m¬≥ (8h operation)");
                advice.push("üí∞ Annual power consumption: ~" + (r.pumpMotorPower * 8 * 250 * 0.75).toFixed(0) + " kWh (250 working days)");
                
                const content = document.getElementById('adviceContent');
                content.innerHTML = `
                    <ul class="advice-list">
                        ${advice.map(item => `<li>${item}</li>`).join('')}
                    </ul>
                `;
                
                document.getElementById('advice').style.display = 'block';
            }

            saveToFile() {
                const data = {
                    timestamp: new Date().toISOString(),
                    inputs: this.inputs,
                    results: this.results,
                    version: "1.0"
                };
                
                const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `airwash_config_${new Date().toISOString().slice(0, 10)}.json`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
            }

            loadFromFile() {
                document.getElementById('fileInput').click();
            }

            handleFileLoad(file) {
                const reader = new FileReader();
                reader.onload = (e) => {
                    try {
                        const data = JSON.parse(e.target.result);
                        this.loadConfiguration(data);
                    } catch (error) {
                        alert('Error loading file: ' + error.message);
                    }
                };
                reader.readAsText(file);
            }

            loadConfiguration(data) {
                if (data.inputs) {
                    // Load inputs into form
                    Object.keys(data.inputs).forEach(key => {
                        const element = document.getElementById(key);
                        if (element) {
                            element.value = data.inputs[key];
                        }
                    });
                    
                    // If results exist, load them too
                    if (data.results) {
                        this.inputs = data.inputs;
                        this.results = data.results;
                        this.displayResults();
                        this.generateAdvice();
                    }
                    
                    alert('Configuration loaded successfully!');
                } else {
                    alert('Invalid configuration file format');
                }
            }
        }

        // Initialize calculator
        const calculator = new AirWashCalculator();

        // Global functions for HTML events
        function calculate() {
            calculator.calculate();
        }

        function saveToFile() {
            if (Object.keys(calculator.results).length === 0) {
                alert('Please calculate the system first before saving');
                return;
            }
            calculator.saveToFile();
        }

        function loadFromFile() {
            calculator.loadFromFile();
        }

        function handleFileLoad(event) {
            const file = event.target.files[0];
            if (file) {
                calculator.handleFileLoad(file);
            }
        }
    </script>
</body>
</html>