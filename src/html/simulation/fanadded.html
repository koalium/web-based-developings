<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HVAC System Design Calculator</title>
    <script src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js" defer></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root {
            --primary: #2c3e50;
            --secondary: #3498db;
            --accent: #e74c3c;
            --light: #ecf0f1;
            --dark: #2c3e50;
            --success: #27ae60;
            --warning: #f39c12;
            --danger: #e74c3c;
            --sidebar-width: 280px;
            --sidebar-collapsed: 60px;
            --transition: all 0.3s ease;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background-color: #f5f7fa;
            color: #333;
            line-height: 1.6;
            overflow-x: hidden;
        }

        .app-container {
            display: flex;
            min-height: 100vh;
        }

        /* Sidebar Styles */
        .sidebar {
            width: var(--sidebar-width);
            background: linear-gradient(135deg, var(--primary), #1a2530);
            color: white;
            transition: var(--transition);
            height: 100vh;
            position: fixed;
            overflow-y: auto;
            z-index: 1000;
            box-shadow: 2px 0 10px rgba(0, 0, 0, 0.1);
        }

        .sidebar.collapsed {
            width: var(--sidebar-collapsed);
        }

        .sidebar-header {
            padding: 20px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .sidebar-header h2 {
            font-size: 1.4rem;
            font-weight: 600;
            white-space: nowrap;
            overflow: hidden;
        }

        .sidebar.collapsed .sidebar-header h2 {
            display: none;
        }

        .toggle-btn {
            background: none;
            border: none;
            color: white;
            font-size: 1.2rem;
            cursor: pointer;
            transition: var(--transition);
        }

        .toggle-btn:hover {
            color: var(--secondary);
        }

        .sidebar.collapsed .toggle-btn {
            transform: rotate(180deg);
        }

        .menu-items {
            list-style: none;
            padding: 10px 0;
        }

        .menu-item {
            padding: 12px 20px;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            border-left: 4px solid transparent;
        }

        .menu-item:hover {
            background-color: rgba(255, 255, 255, 0.1);
        }

        .menu-item.active {
            background-color: rgba(52, 152, 219, 0.2);
            border-left-color: var(--secondary);
            font-weight: bold;
            transform: translateX(5px);
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        .menu-item i {
            margin-right: 10px;
            font-size: 1.1rem;
            width: 24px;
            text-align: center;
        }

        .sidebar.collapsed .menu-item span {
            display: none;
        }

        /* Main Content Styles */
        .main-content {
            flex: 1;
            margin-left: var(--sidebar-width);
            transition: var(--transition);
            padding: 20px;
        }

        .sidebar.collapsed ~ .main-content {
            margin-left: var(--sidebar-collapsed);
        }

        .section {
            display: none;
            background: white;
            border-radius: 10px;
            padding: 25px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.05);
            margin-bottom: 20px;
            animation: fadeIn 0.5s ease;
        }

        .section.active {
            display: block;
        }

        .section-header {
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid var(--light);
        }

        .section-header h2 {
            color: var(--primary);
            font-size: 1.8rem;
            margin-bottom: 5px;
        }

        .section-header p {
            color: #7f8c8d;
            font-size: 1rem;
        }

        /* Block Styles */
        .block {
            background: white;
            border-radius: 8px;
            margin-bottom: 20px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
            overflow: hidden;
            border-left: 4px solid var(--secondary);
        }

        .block-header {
            padding: 15px 20px;
            background-color: #f8f9fa;
            display: flex;
            justify-content: space-between;
            align-items: center;
            cursor: pointer;
            transition: var(--transition);
        }

        .block-header:hover {
            background-color: #e9ecef;
        }

        .block-header h3 {
            color: var(--primary);
            font-size: 1.3rem;
            margin: 0;
        }

        .block-content {
            padding: 20px;
            border-top: 1px solid #eee;
        }

        .block.collapsed .block-content {
            display: none;
        }

        /* Form Styles */
        .form-group {
            margin-bottom: 15px;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
            color: #555;
        }

        .form-control {
            width: 100%;
            padding: 10px 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 1rem;
            transition: var(--transition);
        }

        .form-control:focus {
            border-color: var(--secondary);
            box-shadow: 0 0 0 2px rgba(52, 152, 219, 0.2);
            outline: none;
        }

        .btn {
            padding: 10px 15px;
            border: none;
            border-radius: 5px;
            font-size: 1rem;
            cursor: pointer;
            transition: var(--transition);
            font-weight: 500;
        }

        .btn-primary {
            background-color: var(--secondary);
            color: white;
        }

        .btn-primary:hover {
            background-color: #2980b9;
        }

        .btn-success {
            background-color: var(--success);
            color: white;
        }

        .btn-success:hover {
            background-color: #219653;
        }

        .btn-danger {
            background-color: var(--danger);
            color: white;
        }

        .btn-danger:hover {
            background-color: #c0392b;
        }

        .btn-warning {
            background-color: var(--warning);
            color: white;
        }

        .btn-warning:hover {
            background-color: #e67e22;
        }

        /* Result Styles */
        .result-item {
            background: #f8f9fa;
            padding: 12px 15px;
            border-radius: 5px;
            margin-bottom: 10px;
            border-left: 4px solid var(--success);
        }

        .result-item h4 {
            color: var(--primary);
            margin-bottom: 5px;
            font-size: 1.1rem;
        }

        .result-value {
            font-size: 1.2rem;
            font-weight: bold;
            color: var(--success);
        }

        .advisory {
            background: #fff9e6;
            border-left: 4px solid var(--warning);
            padding: 12px 15px;
            border-radius: 5px;
            margin-top: 15px;
        }

        .advisory h4 {
            color: var(--warning);
            margin-bottom: 5px;
        }

        /* Space and AC Block Styles */
        .space-block {
            background: linear-gradient(135deg, #f5f7fa, #e4e8f0);
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 15px;
            border: 1px solid #ddd;
            transition: var(--transition);
        }

        .space-block:hover {
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }

        .space-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .space-title {
            font-weight: bold;
            color: var(--primary);
        }

        .space-actions {
            display: flex;
            gap: 10px;
        }

        .space-result {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 10px;
            margin-top: 15px;
        }

        .result-card {
            background: white;
            padding: 10px;
            border-radius: 5px;
            text-align: center;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
        }

        .result-card .label {
            font-size: 0.9rem;
            color: #7f8c8d;
        }

        .result-card .value {
            font-size: 1.2rem;
            font-weight: bold;
            color: var(--secondary);
            margin-top: 5px;
        }

        /* Animation */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Responsive */
        @media (max-width: 768px) {
            .sidebar {
                width: 100%;
                transform: translateX(-100%);
            }

            .sidebar.open {
                transform: translateX(0);
            }

            .sidebar.collapsed {
                width: 100%;
                transform: translateX(-100%);
            }

            .main-content {
                margin-left: 0;
                width: 100%;
            }

            .menu-toggle {
                display: block;
                position: fixed;
                top: 15px;
                left: 15px;
                z-index: 1100;
                background: var(--primary);
                color: white;
                border: none;
                border-radius: 5px;
                padding: 10px;
                font-size: 1.2rem;
                cursor: pointer;
            }
        }

        /* Table Styles */
        .data-table {
            width: 100%;
            border-collapse: collapse;
            margin: 15px 0;
        }

        .data-table th, .data-table td {
            padding: 12px 15px;
            text-align: center;
            border: 1px solid #ddd;
        }

        .data-table th {
            background-color: #f8f9fa;
            color: var(--primary);
            font-weight: 600;
        }

        .data-table tr:nth-child(even) {
            background-color: #f8f9fa;
        }

        .data-table tr:hover {
            background-color: #e9ecef;
        }

        .selected-cell {
            background-color: rgba(52, 152, 219, 0.2) !important;
            font-weight: bold;
        }

        /* File Actions */
        .file-actions {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }

        /* Fan Selection Styles */
        .fan-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }

        .fan-card {
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 15px;
            transition: var(--transition);
            cursor: pointer;
        }

        .fan-card:hover {
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            transform: translateY(-2px);
        }

        .fan-card.selected {
            border-color: var(--secondary);
            box-shadow: 0 0 0 2px rgba(52, 152, 219, 0.3);
        }

        .fan-card h4 {
            color: var(--primary);
            margin-bottom: 10px;
        }

        .fan-specs {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin: 10px 0;
        }

        .fan-spec-item {
            display: flex;
            justify-content: space-between;
        }

        .fan-spec-label {
            font-weight: 500;
            color: #555;
        }

        .fan-spec-value {
            font-weight: bold;
        }

        /* Chart Container */
        .chart-container {
            position: relative;
            height: 400px;
            margin: 20px 0;
            background: white;
            border-radius: 8px;
            padding: 15px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
        }

        /* Color coding for sections */
        .section-problem-definition { border-top: 4px solid #e74c3c; }
        .section-building-dimension { border-top: 4px solid #3498db; }
        .section-load-estimation { border-top: 4px solid #2ecc71; }
        .section-ac-station { border-top: 4px solid #9b59b6; }
        .section-airflow-calculation { border-top: 4px solid #f1c40f; }
        .section-duct-ventilation { border-top: 4px solid #1abc9c; }
        .section-rotary-filtration { border-top: 4px solid #d35400; }
        .section-air-washer { border-top: 4px solid #34495e; }
        .section-damper-coil { border-top: 4px solid #7f8c8d; }
        .section-fan-motors { border-top: 4px solid #16a085; }
        .section-report { border-top: 4px solid #8e44ad; }
        .section-bom { border-top: 4px solid #c0392b; }
        .section-plan-drawing { border-top: 4px solid #27ae60; }
        .section-heat-exchangers { border-top: 4px solid #2980b9; }
        .section-humidifier { border-top: 4px solid #f39c12; }
        .section-dehumidifier { border-top: 4px solid #2c3e50; }
        .section-file-database { border-top: 4px solid #7d3c98; }
    </style>
</head>
<body>
    <div class="app-container" x-data="app()">
        <!-- Mobile Menu Toggle -->
        <button class="menu-toggle" @click="sidebarOpen = !sidebarOpen" x-show="isMobile()">
            <i x-text="sidebarOpen ? '✕' : '☰'"></i>
        </button>

        <!-- Sidebar -->
        <div class="sidebar" :class="{ 'collapsed': sidebarCollapsed, 'open': sidebarOpen }">
            <div class="sidebar-header">
                <h2>HVAC Design Calculator</h2>
                <button class="toggle-btn" @click="sidebarCollapsed = !sidebarCollapsed">
                    <i x-text="sidebarCollapsed ? '→' : '←'"></i>
                </button>
            </div>
            <ul class="menu-items">
                <template x-for="item in menuItems" :key="item.id">
                    <li class="menu-item" 
                        :class="{ 'active': activeSection === item.id }"
                        @click="setActiveSection(item.id)">
                        <i x-text="item.icon"></i>
                        <span x-text="item.name"></span>
                    </li>
                </template>
            </ul>
        </div>

        <!-- Main Content -->
        <div class="main-content">
            <!-- Problem Definition Section -->
            <div class="section section-problem-definition" :class="{ 'active': activeSection === 'problem-definition' }">
                <div class="section-header">
                    <h2>Problem Definition</h2>
                    <p>Define the HVAC system requirements and constraints</p>
                </div>
                
                <div class="block">
                    <div class="block-header" @click="toggleBlock('problemRequirements')">
                        <h3>System Requirements</h3>
                        <i x-text="blocks.problemRequirements ? '−' : '+'"></i>
                    </div>
                    <div class="block-content" x-show="blocks.problemRequirements">
                        <div class="form-group">
                            <label for="project-name">Project Name</label>
                            <input type="text" id="project-name" class="form-control" x-model="globalData.projectName">
                        </div>
                        <div class="form-group">
                            <label for="project-description">Project Description</label>
                            <textarea id="project-description" class="form-control" rows="4" x-model="globalData.projectDescription"></textarea>
                        </div>
                        <div class="form-group">
                            <label for="building-type">Building Type</label>
                            <select id="building-type" class="form-control" x-model="globalData.buildingType">
                                <option value="residential">Residential</option>
                                <option value="commercial">Commercial</option>
                                <option value="industrial">Industrial</option>
                                <option value="healthcare">Healthcare</option>
                                <option value="educational">Educational</option>
                            </select>
                        </div>
                    </div>
                </div>
                
                <div class="block">
                    <div class="block-header" @click="toggleBlock('problemConstraints')">
                        <h3>Design Constraints</h3>
                        <i x-text="blocks.problemConstraints ? '−' : '+'"></i>
                    </div>
                    <div class="block-content" x-show="blocks.problemConstraints">
                        <div class="form-group">
                            <label for="budget-constraint">Budget Constraint ($)</label>
                            <input type="number" id="budget-constraint" class="form-control" x-model="globalData.budgetConstraint">
                        </div>
                        <div class="form-group">
                            <label for="space-constraint">Space Constraint (m²)</label>
                            <input type="number" id="space-constraint" class="form-control" x-model="globalData.spaceConstraint">
                        </div>
                        <div class="form-group">
                            <label for="energy-constraint">Energy Efficiency Target (%)</label>
                            <input type="number" id="energy-constraint" class="form-control" x-model="globalData.energyEfficiencyTarget" min="0" max="100">
                        </div>
                    </div>
                </div>
            </div>

            <!-- Building Dimension Section -->
            <div class="section section-building-dimension" :class="{ 'active': activeSection === 'building-dimension' }">
                <div class="section-header">
                    <h2>Building Dimension</h2>
                    <p>Define building dimensions and layout</p>
                </div>
                
                <div class="block">
                    <div class="block-header" @click="toggleBlock('buildingOverall')">
                        <h3>Overall Dimensions</h3>
                        <i x-text="blocks.buildingOverall ? '−' : '+'"></i>
                    </div>
                    <div class="block-content" x-show="blocks.buildingOverall">
                        <div class="form-group">
                            <label for="building-length">Building Length (m)</label>
                            <input type="number" id="building-length" class="form-control" x-model="globalData.buildingLength" step="0.1">
                        </div>
                        <div class="form-group">
                            <label for="building-width">Building Width (m)</label>
                            <input type="number" id="building-width" class="form-control" x-model="globalData.buildingWidth" step="0.1">
                        </div>
                        <div class="form-group">
                            <label for="building-height">Building Height (m)</label>
                            <input type="number" id="building-height" class="form-control" x-model="globalData.buildingHeight" step="0.1">
                        </div>
                        <div class="result-item">
                            <h4>Building Area</h4>
                            <p class="result-value" x-text="`${calculateBuildingArea()} m²`"></p>
                        </div>
                        <div class="result-item">
                            <h4>Building Volume</h4>
                            <p class="result-value" x-text="`${calculateBuildingVolume()} m³`"></p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Load Estimation Section -->
            <div class="section section-load-estimation" :class="{ 'active': activeSection === 'load-estimation' }">
                <div class="section-header">
                    <h2>Load Estimation</h2>
                    <p>Calculate heating and cooling loads for the building</p>
                </div>
                
                <div class="block">
                    <div class="block-header" @click="toggleBlock('loadSunlight')">
                        <h3>Sunlight Heat Load</h3>
                        <i x-text="blocks.loadSunlight ? '−' : '+'"></i>
                    </div>
                    <div class="block-content" x-show="blocks.loadSunlight">
                        <div class="form-group">
                            <label for="sunlight-watt">Sunlight Power (W/m²)</label>
                            <input type="number" id="sunlight-watt" class="form-control" x-model="loadEstimationData.sunlightPower" step="0.1">
                        </div>
                        <div class="result-item">
                            <h4>Sunlight Heating</h4>
                            <p class="result-value" x-text="`${calculateSunlightHeating()} kW`"></p>
                        </div>
                    </div>
                </div>
                
                <div class="block">
                    <div class="block-header" @click="toggleBlock('loadMachine')">
                        <h3>Machine Heat Load</h3>
                        <i x-text="blocks.loadMachine ? '−' : '+'"></i>
                    </div>
                    <div class="block-content" x-show="blocks.loadMachine">
                        <div class="form-group">
                            <label for="machine-power">Machine Power Consumption (kW)</label>
                            <input type="number" id="machine-power" class="form-control" x-model="loadEstimationData.machinePower" step="0.1">
                        </div>
                        <div class="result-item">
                            <h4>Total Added Heat</h4>
                            <p class="result-value" x-text="`${calculateTotalAddedHeat()} kW`"></p>
                        </div>
                    </div>
                </div>
                
                <div class="block">
                    <div class="block-header" @click="toggleBlock('loadWall')">
                        <h3>Wall & Roof Heat Conduction</h3>
                        <i x-text="blocks.loadWall ? '−' : '+'"></i>
                    </div>
                    <div class="block-content" x-show="blocks.loadWall">
                        <div class="form-group">
                            <label for="wall-material">Wall Material</label>
                            <select id="wall-material" class="form-control" x-model="loadEstimationData.wallMaterial">
                                <option value="brick">Brick</option>
                                <option value="concrete">Concrete</option>
                                <option value="wood">Wood</option>
                                <option value="insulated">Insulated Panel</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="wall-area">Wall Area (m²)</label>
                            <input type="number" id="wall-area" class="form-control" x-model="loadEstimationData.wallArea" step="0.1">
                        </div>
                        <div class="form-group">
                            <label for="roof-area">Roof Area (m²)</label>
                            <input type="number" id="roof-area" class="form-control" x-model="loadEstimationData.roofArea" step="0.1">
                        </div>
                        <div class="form-group">
                            <label for="outside-temp">Outside Temperature (°C)</label>
                            <input type="number" id="outside-temp" class="form-control" x-model="loadEstimationData.outsideTemp" step="0.1">
                        </div>
                        <div class="form-group">
                            <label for="inside-temp">Inside Temperature (°C)</label>
                            <input type="number" id="inside-temp" class="form-control" x-model="loadEstimationData.insideTemp" step="0.1">
                        </div>
                        <div class="result-item">
                            <h4>Heat Conduction</h4>
                            <p class="result-value" x-text="`${calculateHeatConduction()} W`"></p>
                        </div>
                    </div>
                </div>
                
                <div class="file-actions">
                    <button class="btn btn-primary" @click="saveLoadEstimationData()">Save to JSON</button>
                    <button class="btn btn-success" @click="loadLoadEstimationData()">Load from JSON</button>
                </div>
            </div>

            <!-- Airflow Calculation Section -->
            <div class="section section-airflow-calculation" :class="{ 'active': activeSection === 'airflow-calculation' }">
                <div class="section-header">
                    <h2>Airflow Calculation</h2>
                    <p>Calculate airflow requirements for different spaces</p>
                </div>
                
                <template x-for="(ac, index) in airflowData.acUnits" :key="ac.id">
                    <div class="block">
                        <div class="block-header" @click="toggleBlock(`acUnit${ac.id}`)">
                            <h3 x-text="`AC Unit ${ac.id}`"></h3>
                            <i x-text="blocks[`acUnit${ac.id}`] ? '−' : '+'"></i>
                        </div>
                        <div class="block-content" x-show="blocks[`acUnit${ac.id}`]">
                            <div class="space-actions">
                                <button class="btn btn-primary" @click="addSpace(ac.id)">Add Space</button>
                                <button class="btn btn-danger" @click="removeAcUnit(ac.id)">Remove AC Unit</button>
                                <button class="btn btn-warning" @click="resetAcUnit(ac.id)">Reset AC Unit</button>
                            </div>
                            
                            <template x-for="(space, spaceIndex) in ac.spaces" :key="space.id">
                                <div class="space-block" 
                                     :style="`background: linear-gradient(135deg, ${space.color1}, ${space.color2})`"
                                     @dblclick="copySpaceValues(space)">
                                    <div class="space-header">
                                        <div class="space-title" x-text="space.name || `Space ${spaceIndex + 1}`"></div>
                                        <div class="space-actions">
                                            <button class="btn btn-danger btn-sm" @click="removeSpace(ac.id, space.id)">Remove</button>
                                            <button class="btn btn-warning btn-sm" @click="resetSpace(space)">Reset</button>
                                        </div>
                                    </div>
                                    
                                    <div class="form-group">
                                        <label>Space Name</label>
                                        <input type="text" class="form-control" x-model="space.name" placeholder="Enter space name">
                                    </div>
                                    
                                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 10px;">
                                        <div class="form-group">
                                            <label>Width (m)</label>
                                            <input type="number" class="form-control" x-model="space.width" step="0.1" @change="calculateSpaceValues(space)">
                                        </div>
                                        <div class="form-group">
                                            <label>Length (m)</label>
                                            <input type="number" class="form-control" x-model="space.length" step="0.1" @change="calculateSpaceValues(space)">
                                        </div>
                                        <div class="form-group">
                                            <label>Height (m)</label>
                                            <input type="number" class="form-control" x-model="space.height" step="0.1" @change="calculateSpaceValues(space)">
                                        </div>
                                        <div class="form-group">
                                            <label>ACH</label>
                                            <input type="number" class="form-control" x-model="space.ach" step="0.1" @change="calculateSpaceValues(space)">
                                        </div>
                                    </div>
                                    
                                    <div class="space-result">
                                        <div class="result-card">
                                            <div class="label">Area</div>
                                            <div class="value" x-text="`${space.area.toFixed(2)} m²`"></div>
                                        </div>
                                        <div class="result-card">
                                            <div class="label">Volume</div>
                                            <div class="value" x-text="`${space.volume.toFixed(2)} m³`"></div>
                                        </div>
                                        <div class="result-card">
                                            <div class="label">Airflow (m³/hr)</div>
                                            <div class="value" x-text="`${space.airflowM3Hr.toFixed(2)}`"></div>
                                        </div>
                                        <div class="result-card">
                                            <div class="label">Airflow (m³/s)</div>
                                            <div class="value" x-text="`${space.airflowM3S.toFixed(4)}`"></div>
                                        </div>
                                        <div class="result-card">
                                            <div class="label">Airflow (CFM)</div>
                                            <div class="value" x-text="`${space.airflowCFM.toFixed(2)}`"></div>
                                        </div>
                                    </div>
                                </div>
                            </template>
                        </div>
                    </div>
                </template>
                
                <div class="block">
                    <div class="block-header" @click="toggleBlock('addAcUnit')">
                        <h3>Add New AC Unit</h3>
                        <i x-text="blocks.addAcUnit ? '−' : '+'"></i>
                    </div>
                    <div class="block-content" x-show="blocks.addAcUnit">
                        <button class="btn btn-success" @click="addAcUnit()">Add New AC Unit</button>
                    </div>
                </div>
            </div>

            <!-- Duct & Ventilation Section -->
            <div class="section section-duct-ventilation" :class="{ 'active': activeSection === 'duct-ventilation' }">
                <div class="section-header">
                    <h2>Duct & Ventilation</h2>
                    <p>Design and calculate ductwork and ventilation systems</p>
                </div>
                
                <div class="block">
                    <div class="block-header" @click="toggleBlock('supplyDuct')">
                        <h3>Supply Duct</h3>
                        <i x-text="blocks.supplyDuct ? '−' : '+'"></i>
                    </div>
                    <div class="block-content" x-show="blocks.supplyDuct">
                        <div class="form-group">
                            <label for="supply-duct-shape">Duct Shape</label>
                            <select id="supply-duct-shape" class="form-control" x-model="ductData.supply.shape">
                                <option value="circular">Circular</option>
                                <option value="rectangular">Rectangular</option>
                            </select>
                        </div>
                        
                        <div x-show="ductData.supply.shape === 'rectangular'">
                            <div class="form-group">
                                <label for="supply-duct-height">Duct Height (m)</label>
                                <input type="number" id="supply-duct-height" class="form-control" x-model="ductData.supply.height" step="0.01">
                            </div>
                            <div class="form-group">
                                <label for="supply-duct-width">Duct Width (m)</label>
                                <input type="number" id="supply-duct-width" class="form-control" x-model="ductData.supply.width" step="0.01">
                            </div>
                        </div>
                        
                        <div x-show="ductData.supply.shape === 'circular'">
                            <div class="form-group">
                                <label for="supply-duct-diameter">Duct Diameter (m)</label>
                                <input type="number" id="supply-duct-diameter" class="form-control" x-model="ductData.supply.diameter" step="0.01">
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label for="supply-duct-number">Number of Ducts</label>
                            <input type="number" id="supply-duct-number" class="form-control" x-model="ductData.supply.number" min="1">
                        </div>
                        
                        <div class="result-item">
                            <h4>Duct Cross-Sectional Area</h4>
                            <p class="result-value" x-text="`${calculateSupplyDuctArea()} m²`"></p>
                        </div>
                        
                        <div class="result-item">
                            <h4>Total Duct Area</h4>
                            <p class="result-value" x-text="`${calculateTotalSupplyDuctArea()} m²`"></p>
                        </div>
                        
                        <div class="result-item">
                            <h4>Air Velocity in Duct</h4>
                            <p class="result-value" x-text="`${calculateSupplyAirVelocity()} m/s`"></p>
                        </div>
                        
                        <div class="advisory" x-show="calculateSupplyAirVelocity() > 7.23">
                            <h4>Advisory</h4>
                            <p>Air velocity is too high. Consider increasing duct size to reduce velocity below 7.23 m/s.</p>
                        </div>
                        
                        <div class="advisory" x-show="calculateSupplyAirVelocity() <= 7.23 && calculateSupplyAirVelocity() > 6">
                            <h4>Advisory</h4>
                            <p>Air velocity is acceptable but could be optimized. Ideal range is around 6 m/s.</p>
                        </div>
                        
                        <div class="advisory" x-show="calculateSupplyAirVelocity() <= 6">
                            <h4>Advisory</h4>
                            <p>Air velocity is within optimal range.</p>
                        </div>
                        
                        <h4 style="margin-top: 20px;">Vent Calculation</h4>
                        <div class="form-group">
                            <label for="supply-vent-width">Vent Width (m)</label>
                            <input type="number" id="supply-vent-width" class="form-control" x-model="ductData.supply.ventWidth" step="0.01">
                        </div>
                        <div class="form-group">
                            <label for="supply-vent-length">Vent Length (m)</label>
                            <input type="number" id="supply-vent-length" class="form-control" x-model="ductData.supply.ventLength" step="0.01">
                        </div>
                        <div class="form-group">
                            <label for="supply-vent-number">Number of Vents</label>
                            <input type="number" id="supply-vent-number" class="form-control" x-model="ductData.supply.ventNumber" min="1">
                        </div>
                        
                        <div class="result-item">
                            <h4>Vent Area</h4>
                            <p class="result-value" x-text="`${calculateSupplyVentArea()} m²`"></p>
                        </div>
                        
                        <div class="result-item">
                            <h4>Total Vent Area</h4>
                            <p class="result-value" x-text="`${calculateTotalSupplyVentArea()} m²`"></p>
                        </div>
                        
                        <div class="result-item">
                            <h4>Air Velocity in Vent</h4>
                            <p class="result-value" x-text="`${calculateSupplyVentAirVelocity()} m/s`"></p>
                        </div>
                    </div>
                </div>
                
                <div class="block">
                    <div class="block-header" @click="toggleBlock('returnDuct')">
                        <h3>Return Duct</h3>
                        <i x-text="blocks.returnDuct ? '−' : '+'"></i>
                    </div>
                    <div class="block-content" x-show="blocks.returnDuct">
                        <div class="form-group">
                            <label for="return-duct-width">Duct Width (m)</label>
                            <input type="number" id="return-duct-width" class="form-control" x-model="ductData.return.width" step="0.01">
                        </div>
                        <div class="form-group">
                            <label for="return-duct-height">Duct Height (m)</label>
                            <input type="number" id="return-duct-height" class="form-control" x-model="ductData.return.height" step="0.01">
                        </div>
                        <div class="form-group">
                            <label for="return-duct-number">Number of Ducts</label>
                            <input type="number" id="return-duct-number" class="form-control" x-model="ductData.return.number" min="1">
                        </div>
                        
                        <div class="result-item">
                            <h4>Duct Cross-Sectional Area</h4>
                            <p class="result-value" x-text="`${calculateReturnDuctArea()} m²`"></p>
                        </div>
                        
                        <div class="result-item">
                            <h4>Total Duct Area</h4>
                            <p class="result-value" x-text="`${calculateTotalReturnDuctArea()} m²`"></p>
                        </div>
                        
                        <div class="result-item">
                            <h4>Air Velocity in Duct</h4>
                            <p class="result-value" x-text="`${calculateReturnAirVelocity()} m/s`"></p>
                        </div>
                        
                        <h4 style="margin-top: 20px;">Return Vent Calculation</h4>
                        <div class="form-group">
                            <label for="return-vent-width">Vent Width (mm)</label>
                            <input type="number" id="return-vent-width" class="form-control" x-model="ductData.return.ventWidth" step="1">
                        </div>
                        <div class="form-group">
                            <label for="return-vent-length">Vent Length (m)</label>
                            <input type="number" id="return-vent-length" class="form-control" x-model="ductData.return.ventLength" step="0.01">
                        </div>
                        <div class="form-group">
                            <label for="return-vent-number">Number of Vents</label>
                            <input type="number" id="return-vent-number" class="form-control" x-model="ductData.return.ventNumber" min="1">
                        </div>
                        
                        <div class="result-item">
                            <h4>Vent Area</h4>
                            <p class="result-value" x-text="`${calculateReturnVentArea()} m²`"></p>
                        </div>
                        
                        <div class="result-item">
                            <h4>Total Vent Area</h4>
                            <p class="result-value" x-text="`${calculateTotalReturnVentArea()} m²`"></p>
                        </div>
                        
                        <div class="result-item">
                            <h4>Air Velocity in Vent</h4>
                            <p class="result-value" x-text="`${calculateReturnVentAirVelocity()} m/s`"></p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Rotary Filtration Section -->
            <div class="section section-rotary-filtration" :class="{ 'active': activeSection === 'rotary-filtration' }">
                <div class="section-header">
                    <h2>Rotary Filtration</h2>
                    <p>Design and calculate rotary filtration systems</p>
                </div>
                
                <div class="block">
                    <div class="block-header" @click="toggleBlock('rotaryFilter')">
                        <h3>Filter Selection</h3>
                        <i x-text="blocks.rotaryFilter ? '−' : '+'"></i>
                    </div>
                    <div class="block-content" x-show="blocks.rotaryFilter">
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>Diameter / Length</th>
                                    <th x-text="`${rotaryFilterData.lengths[0]} m`" 
                                        :class="{ 'selected-cell': rotaryFilterData.selectedLength === rotaryFilterData.lengths[0] }"
                                        @click="rotaryFilterData.selectedLength = rotaryFilterData.lengths[0]"></th>
                                    <th x-text="`${rotaryFilterData.lengths[1]} m`" 
                                        :class="{ 'selected-cell': rotaryFilterData.selectedLength === rotaryFilterData.lengths[1] }"
                                        @click="rotaryFilterData.selectedLength = rotaryFilterData.lengths[1]"></th>
                                    <th x-text="`${rotaryFilterData.lengths[2]} m`" 
                                        :class="{ 'selected-cell': rotaryFilterData.selectedLength === rotaryFilterData.lengths[2] }"
                                        @click="rotaryFilterData.selectedLength = rotaryFilterData.lengths[2]"></th>
                                </tr>
                            </thead>
                            <tbody>
                                <template x-for="(diameter, index) in rotaryFilterData.diameters" :key="index">
                                    <tr>
                                        <td x-text="`${diameter} m`" 
                                            :class="{ 'selected-cell': rotaryFilterData.selectedDiameter === diameter }"
                                            @click="rotaryFilterData.selectedDiameter = diameter"></td>
                                        <template x-for="(length, lIndex) in rotaryFilterData.lengths" :key="lIndex">
                                            <td x-text="`${calculateFilterArea(diameter, length).toFixed(2)} m²`"
                                                :class="{ 'selected-cell': rotaryFilterData.selectedDiameter === diameter && rotaryFilterData.selectedLength === length }"
                                                @click="selectFilter(diameter, length)"></td>
                                        </template>
                                    </tr>
                                </template>
                            </tbody>
                        </table>
                        
                        <div class="form-group" style="margin-top: 20px;">
                            <label for="filter-number">Number of Filters</label>
                            <input type="number" id="filter-number" class="form-control" x-model="rotaryFilterData.filterNumber" min="1">
                        </div>
                        
                        <div class="result-item">
                            <h4>Single Filter Area</h4>
                            <p class="result-value" x-text="`${calculateSingleFilterArea()} m²`"></p>
                        </div>
                        
                        <div class="result-item">
                            <h4>Total Filter Area</h4>
                            <p class="result-value" x-text="`${calculateTotalFilterArea()} m²`"></p>
                        </div>
                        
                        <div class="result-item">
                            <h4>Air Velocity Through Filter</h4>
                            <p class="result-value" x-text="`${calculateFilterAirVelocity()} m/s`"></p>
                        </div>
                        
                        <div class="advisory" x-show="calculateFilterAirVelocity() > 1.05">
                            <h4>Advisory</h4>
                            <p>Air velocity is too high. Consider increasing filter area or number of filters to reduce velocity below 1.05 m/s.</p>
                        </div>
                        
                        <div class="advisory" x-show="calculateFilterAirVelocity() <= 1.05 && calculateFilterAirVelocity() > 0.9">
                            <h4>Advisory</h4>
                            <p>Air velocity is acceptable. For minimal pressure drop, aim for around 0.9 m/s.</p>
                        </div>
                        
                        <div class="advisory" x-show="calculateFilterAirVelocity() <= 0.9">
                            <h4>Advisory</h4>
                            <p>Air velocity is within optimal range for minimal pressure drop.</p>
                        </div>
                        
                        <div class="file-actions">
                            <button class="btn btn-primary" @click="saveRotaryFilterData()">Save to File</button>
                            <button class="btn btn-success" @click="loadRotaryFilterData()">Load from File</button>
                            <button class="btn btn-warning" @click="resetRotaryFilterData()">Reset Data</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Fan & Motors Section -->
            <div class="section section-fan-motors" :class="{ 'active': activeSection === 'fan-motors' }">
                <div class="section-header">
                    <h2>Fan & Motors</h2>
                    <p>Select and calculate fan performance with motor requirements</p>
                </div>
                
                <div class="block">
                    <div class="block-header" @click="toggleBlock('fanSelection')">
                        <h3>Fan Selection</h3>
                        <i x-text="blocks.fanSelection ? '−' : '+'"></i>
                    </div>
                    <div class="block-content" x-show="blocks.fanSelection">
                        <div class="form-group">
                            <label for="system-pressure">System Pressure (Pa)</label>
                            <input type="number" id="system-pressure" class="form-control" x-model="fanData.systemPressure" step="10">
                        </div>
                        
                        <div class="form-group">
                            <label for="airflow-required">Required Airflow (m³/s)</label>
                            <input type="number" id="airflow-required" class="form-control" x-model="fanData.airflowRequired" step="0.1">
                        </div>
                        
                        <div class="fan-grid">
                            <template x-for="fan in fanData.fanTypes" :key="fan.id">
                                <div class="fan-card" 
                                     :class="{ 'selected': fanData.selectedFan === fan.id }"
                                     @click="selectFan(fan.id)">
                                    <h4 x-text="fan.name"></h4>
                                    <div class="fan-specs">
                                        <div class="fan-spec-item">
                                            <span class="fan-spec-label">Diameter:</span>
                                            <span class="fan-spec-value" x-text="`${fan.diameter} mm`"></span>
                                        </div>
                                        <div class="fan-spec-item">
                                            <span class="fan-spec-label">RPM:</span>
                                            <span class="fan-spec-value" x-text="fan.rpm"></span>
                                        </div>
                                        <div class="fan-spec-item">
                                            <span class="fan-spec-label">Blade Angle:</span>
                                            <span class="fan-spec-value" x-text="`${fan.bladeAngle}°`"></span>
                                        </div>
                                        <div class="fan-spec-item">
                                            <span class="fan-spec-label">Max Airflow:</span>
                                            <span class="fan-spec-value" x-text="`${fan.maxAirflow} m³/s`"></span>
                                        </div>
                                        <div class="fan-spec-item">
                                            <span class="fan-spec-label">Max Pressure:</span>
                                            <span class="fan-spec-value" x-text="`${fan.maxPressure} Pa`"></span>
                                        </div>
                                        <div class="fan-spec-item">
                                            <span class="fan-spec-label">Efficiency:</span>
                                            <span class="fan-spec-value" x-text="`${fan.efficiency}%`"></span>
                                        </div>
                                    </div>
                                    
                                    <div class="result-item" style="margin-top: 10px;">
                                        <h4>Performance at Selected Conditions</h4>
                                        <div x-show="fanData.selectedFan === fan.id">
                                            <div class="result-item">
                                                <span class="result-label">Required Power:</span>
                                                <span class="result-value" x-text="`${calculateFanPower(fan).toFixed(2)} kW`"></span>
                                            </div>
                                            <div class="result-item">
                                                <span class="result-label">Motor Power:</span>
                                                <span class="result-value" x-text="`${calculateMotorPower(fan).toFixed(2)} kW`"></span>
                                            </div>
                                            <div class="result-item">
                                                <span class="result-label">Operating Point:</span>
                                                <span class="result-value" x-text="calculateOperatingPoint(fan)"></span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </template>
                        </div>
                        
                        <div class="advisory" x-show="fanData.selectedFan">
                            <h4>Fan Selection Advisory</h4>
                            <p x-text="getFanAdvisory()"></p>
                        </div>
                    </div>
                </div>
                
                <div class="block">
                    <div class="block-header" @click="toggleBlock('fanPerformance')">
                        <h3>Fan Performance Curve</h3>
                        <i x-text="blocks.fanPerformance ? '−' : '+'"></i>
                    </div>
                    <div class="block-content" x-show="blocks.fanPerformance">
                        <div class="chart-container">
                            <canvas id="fanPerformanceChart"></canvas>
                        </div>
                    </div>
                </div>
                
                <div class="block">
                    <div class="block-header" @click="toggleBlock('motorSelection')">
                        <h3>Motor Selection</h3>
                        <i x-text="blocks.motorSelection ? '−' : '+'"></i>
                    </div>
                    <div class="block-content" x-show="blocks.motorSelection">
                        <div class="form-group">
                            <label for="motor-efficiency">Motor Efficiency (%)</label>
                            <input type="number" id="motor-efficiency" class="form-control" x-model="fanData.motorEfficiency" min="80" max="98" step="1">
                        </div>
                        
                        <div class="form-group">
                            <label for="safety-factor">Safety Factor</label>
                            <input type="number" id="safety-factor" class="form-control" x-model="fanData.safetyFactor" min="1.1" max="1.5" step="0.05">
                        </div>
                        
                        <div class="result-item">
                            <h4>Motor Requirements</h4>
                            <div class="result-item">
                                <span class="result-label">Required Motor Power:</span>
                                <span class="result-value" x-text="`${calculateRequiredMotorPower().toFixed(2)} kW`"></span>
                            </div>
                            <div class="result-item">
                                <span class="result-label">Recommended Standard Motor:</span>
                                <span class="result-value" x-text="getRecommendedMotor()"></span>
                            </div>
                            <div class="result-item">
                                <span class="result-label">Annual Energy Consumption:</span>
                                <span class="result-value" x-text="`${calculateAnnualEnergy().toFixed(0)} kWh`"></span>
                            </div>
                        </div>
                        
                        <div class="advisory">
                            <h4>Motor Selection Advisory</h4>
                            <p>Select the next available standard motor size above the calculated requirement. Consider variable frequency drives for energy savings in variable load applications.</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- File & Database Section -->
            <div class="section section-file-database" :class="{ 'active': activeSection === 'file-database' }">
                <div class="section-header">
                    <h2>File & Database</h2>
                    <p>Save and load project data</p>
                </div>
                
                <div class="block">
                    <div class="block-header" @click="toggleBlock('fileOperations')">
                        <h3>File Operations</h3>
                        <i x-text="blocks.fileOperations ? '−' : '+'"></i>
                    </div>
                    <div class="block-content" x-show="blocks.fileOperations">
                        <div class="form-group">
                            <label for="project-data">Project Data (JSON)</label>
                            <textarea id="project-data" class="form-control" rows="10" x-model="projectJsonData"></textarea>
                        </div>
                        
                        <div class="file-actions">
                            <button class="btn btn-primary" @click="saveProjectData()">Save Project</button>
                            <button class="btn btn-success" @click="loadProjectData()">Load Project</button>
                            <button class="btn btn-warning" @click="exportProjectData()">Export Project</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        function app() {
            return {
                // App state
                activeSection: 'problem-definition',
                sidebarCollapsed: false,
                sidebarOpen: false,
                blocks: {
                    problemRequirements: true,
                    problemConstraints: true,
                    buildingOverall: true,
                    loadSunlight: true,
                    loadMachine: true,
                    loadWall: true,
                    addAcUnit: true,
                    supplyDuct: true,
                    returnDuct: true,
                    rotaryFilter: true,
                    fanSelection: true,
                    fanPerformance: true,
                    motorSelection: true,
                    fileOperations: true
                },
                
                // Global data shared across all sections
                globalData: {
                    projectName: 'HVAC Project',
                    projectDescription: '',
                    buildingType: 'commercial',
                    budgetConstraint: 100000,
                    spaceConstraint: 1000,
                    energyEfficiencyTarget: 80,
                    buildingLength: 50,
                    buildingWidth: 30,
                    buildingHeight: 10
                },
                
                // Menu items
                menuItems: [
                    { id: 'problem-definition', name: 'Problem Definition', icon: '📋' },
                    { id: 'building-dimension', name: 'Building Dimension', icon: '🏢' },
                    { id: 'load-estimation', name: 'Load Estimation', icon: '⚖️' },
                    { id: 'ac-station', name: 'AC Station', icon: '❄️' },
                    { id: 'airflow-calculation', name: 'AirFlow Calculation', icon: '🌬️' },
                    { id: 'duct-ventilation', name: 'Duct & Ventilation', icon: '📏' },
                    { id: 'rotary-filtration', name: 'Rotary Filtration', icon: '🌀' },
                    { id: 'air-washer', name: 'Air Washer', icon: '💧' },
                    { id: 'damper-coil', name: 'Damper & Coil', icon: '🔧' },
                    { id: 'fan-motors', name: 'Fan & Motors', icon: '🌀' },
                    { id: 'report', name: 'Report', icon: '📊' },
                    { id: 'bom', name: 'BOM', icon: '📦' },
                    { id: 'plan-drawing', name: 'Plan & Drawing', icon: '📐' },
                    { id: 'heat-exchangers', name: 'Heat Exchangers', icon: '🔥' },
                    { id: 'humidifier', name: 'Humidifier', icon: '💦' },
                    { id: 'dehumidifier', name: 'Dehumidifier', icon: '🌵' },
                    { id: 'file-database', name: 'File & Database', icon: '💾' }
                ],
                
                // Load Estimation Data
                loadEstimationData: {
                    sunlightPower: 800,
                    machinePower: 50,
                    wallMaterial: 'brick',
                    wallArea: 800,
                    roofArea: 1500,
                    outsideTemp: 35,
                    insideTemp: 22
                },
                
                // Airflow Calculation Data
                airflowData: {
                    acUnits: [
                        {
                            id: 1,
                            spaces: [
                                {
                                    id: 1,
                                    name: 'Main Hall',
                                    width: 21,
                                    length: 44,
                                    height: 4.4,
                                    ach: 33,
                                    area: 0,
                                    volume: 0,
                                    airflowM3Hr: 0,
                                    airflowM3S: 0,
                                    airflowCFM: 0,
                                    color1: '#e3f2fd',
                                    color2: '#bbdefb'
                                }
                            ]
                        }
                    ],
                    nextAcId: 2,
                    nextSpaceId: 2
                },
                
                // Duct & Ventilation Data
                ductData: {
                    supply: {
                        shape: 'circular',
                        height: 1.2,
                        width: 1.2,
                        diameter: 1.2,
                        number: 1,
                        ventWidth: 0.5,
                        ventLength: 1.2,
                        ventNumber: 1
                    },
                    return: {
                        width: 1.8,
                        height: 1.2,
                        number: 1,
                        ventWidth: 50,
                        ventLength: 1.8,
                        ventNumber: 1
                    }
                },
                
                // Rotary Filtration Data
                rotaryFilterData: {
                    diameters: [2, 2.5, 3],
                    lengths: [1.7, 3.4, 5.1],
                    selectedDiameter: 2,
                    selectedLength: 1.7,
                    filterNumber: 1
                },
                
                // Fan & Motors Data
                fanData: {
                    systemPressure: 500,
                    airflowRequired: 55,
                    selectedFan: null,
                    motorEfficiency: 92,
                    safetyFactor: 1.15,
                    fanTypes: [
                        {
                            id: 1,
                            name: 'Luwa 10-Blade 1120mm',
                            diameter: 1120,
                            rpm: 1000,
                            bladeAngle: 20,
                            maxAirflow: 45,
                            maxPressure: 800,
                            efficiency: 78,
                            a: 0.0002,
                            b: -0.08,
                            c: 1200
                        },
                        {
                            id: 2,
                            name: 'Luwa 10-Blade 1400mm',
                            diameter: 1400,
                            rpm: 1000,
                            bladeAngle: 25,
                            maxAirflow: 70,
                            maxPressure: 950,
                            efficiency: 82,
                            a: 0.00015,
                            b: -0.07,
                            c: 1100
                        },
                        {
                            id: 3,
                            name: 'Luwa 10-Blade 1600mm',
                            diameter: 1600,
                            rpm: 1000,
                            bladeAngle: 30,
                            maxAirflow: 95,
                            maxPressure: 1100,
                            efficiency: 85,
                            a: 0.00012,
                            b: -0.06,
                            c: 1000
                        }
                    ]
                },
                
                // Project JSON data for file operations
                projectJsonData: '',
                
                // Methods
                setActiveSection(section) {
                    this.activeSection = section;
                    if (this.isMobile()) {
                        this.sidebarOpen = false;
                    }
                    
                    // Initialize charts when fan section is selected
                    if (section === 'fan-motors') {
                        this.$nextTick(() => {
                            this.initFanChart();
                        });
                    }
                },
                
                toggleBlock(blockName) {
                    this.blocks[blockName] = !this.blocks[blockName];
                },
                
                isMobile() {
                    return window.innerWidth <= 768;
                },
                
                // Building Dimension Calculations
                calculateBuildingArea() {
                    return this.globalData.buildingLength * this.globalData.buildingWidth;
                },
                
                calculateBuildingVolume() {
                    return this.calculateBuildingArea() * this.globalData.buildingHeight;
                },
                
                // Load Estimation Calculations
                calculateSunlightHeating() {
                    const area = this.calculateBuildingArea();
                    return (area * this.loadEstimationData.sunlightPower) / 1000;
                },
                
                calculateTotalAddedHeat() {
                    return this.calculateSunlightHeating() + this.loadEstimationData.machinePower;
                },
                
                calculateHeatConduction() {
                    // Simplified calculation - in a real app, this would be more complex
                    const tempDifference = this.loadEstimationData.outsideTemp - this.loadEstimationData.insideTemp;
                    const wallUValue = this.getUValue(this.loadEstimationData.wallMaterial);
                    const roofUValue = 0.5; // Assumed value for roof
                    
                    return (this.loadEstimationData.wallArea * wallUValue * tempDifference) + 
                           (this.loadEstimationData.roofArea * roofUValue * tempDifference);
                },
                
                getUValue(material) {
                    const uValues = {
                        'brick': 2.0,
                        'concrete': 3.0,
                        'wood': 1.5,
                        'insulated': 0.5
                    };
                    return uValues[material] || 2.0;
                },
                
                // Airflow Calculation Methods
                calculateSpaceValues(space) {
                    space.area = space.width * space.length;
                    space.volume = space.area * space.height;
                    space.airflowM3Hr = space.volume * space.ach;
                    space.airflowM3S = space.airflowM3Hr / 3600;
                    space.airflowCFM = space.airflowM3Hr / 1.699;
                },
                
                addSpace(acId) {
                    const acUnit = this.airflowData.acUnits.find(ac => ac.id === acId);
                    if (acUnit) {
                        const newSpace = {
                            id: this.airflowData.nextSpaceId++,
                            name: '',
                            width: 21,
                            length: 44,
                            height: 4.4,
                            ach: 33,
                            area: 0,
                            volume: 0,
                            airflowM3Hr: 0,
                            airflowM3S: 0,
                            airflowCFM: 0,
                            color1: this.getRandomLightColor(),
                            color2: this.getRandomLightColor()
                        };
                        this.calculateSpaceValues(newSpace);
                        acUnit.spaces.push(newSpace);
                    }
                },
                
                removeSpace(acId, spaceId) {
                    const acUnit = this.airflowData.acUnits.find(ac => ac.id === acId);
                    if (acUnit) {
                        acUnit.spaces = acUnit.spaces.filter(space => space.id !== spaceId);
                    }
                },
                
                resetSpace(space) {
                    space.width = 21;
                    space.length = 44;
                    space.height = 4.4;
                    space.ach = 33;
                    this.calculateSpaceValues(space);
                },
                
                addAcUnit() {
                    const newAcUnit = {
                        id: this.airflowData.nextAcId++,
                        spaces: []
                    };
                    this.airflowData.acUnits.push(newAcUnit);
                    this.addSpace(newAcUnit.id);
                },
                
                removeAcUnit(acId) {
                    this.airflowData.acUnits = this.airflowData.acUnits.filter(ac => ac.id !== acId);
                },
                
                resetAcUnit(acId) {
                    const acUnit = this.airflowData.acUnits.find(ac => ac.id === acId);
                    if (acUnit) {
                        acUnit.spaces.forEach(space => this.resetSpace(space));
                    }
                },
                
                copySpaceValues(space) {
                    // In a real app, this would copy values to clipboard
                    alert(`Values for ${space.name} copied!`);
                },
                
                getRandomLightColor() {
                    const letters = 'BCDEF';
                    let color = '#';
                    for (let i = 0; i < 6; i++) {
                        color += letters[Math.floor(Math.random() * letters.length)];
                    }
                    return color;
                },
                
                // Duct & Ventilation Calculations
                calculateSupplyDuctArea() {
                    if (this.ductData.supply.shape === 'circular') {
                        return Math.PI * Math.pow(this.ductData.supply.diameter / 2, 2);
                    } else {
                        return this.ductData.supply.width * this.ductData.supply.height;
                    }
                },
                
                calculateTotalSupplyDuctArea() {
                    return this.calculateSupplyDuctArea() * this.ductData.supply.number;
                },
                
                calculateSupplyAirVelocity() {
                    // Using the first space of the first AC unit for airflow calculation
                    if (this.airflowData.acUnits.length > 0 && this.airflowData.acUnits[0].spaces.length > 0) {
                        const airflowM3S = this.airflowData.acUnits[0].spaces[0].airflowM3S;
                        return airflowM3S / this.calculateTotalSupplyDuctArea();
                    }
                    return 0;
                },
                
                calculateSupplyVentArea() {
                    return this.ductData.supply.ventWidth * this.ductData.supply.ventLength;
                },
                
                calculateTotalSupplyVentArea() {
                    return this.calculateSupplyVentArea() * this.ductData.supply.ventNumber;
                },
                
                calculateSupplyVentAirVelocity() {
                    if (this.airflowData.acUnits.length > 0 && this.airflowData.acUnits[0].spaces.length > 0) {
                        const airflowM3S = this.airflowData.acUnits[0].spaces[0].airflowM3S;
                        return airflowM3S / this.calculateTotalSupplyVentArea();
                    }
                    return 0;
                },
                
                calculateReturnDuctArea() {
                    return this.ductData.return.width * this.ductData.return.height;
                },
                
                calculateTotalReturnDuctArea() {
                    return this.calculateReturnDuctArea() * this.ductData.return.number;
                },
                
                calculateReturnAirVelocity() {
                    if (this.airflowData.acUnits.length > 0 && this.airflowData.acUnits[0].spaces.length > 0) {
                        const airflowM3S = this.airflowData.acUnits[0].spaces[0].airflowM3S;
                        return airflowM3S / this.calculateTotalReturnDuctArea();
                    }
                    return 0;
                },
                
                calculateReturnVentArea() {
                    return (this.ductData.return.ventWidth / 1000) * this.ductData.return.ventLength;
                },
                
                calculateTotalReturnVentArea() {
                    return this.calculateReturnVentArea() * this.ductData.return.ventNumber;
                },
                
                calculateReturnVentAirVelocity() {
                    if (this.airflowData.acUnits.length > 0 && this.airflowData.acUnits[0].spaces.length > 0) {
                        const airflowM3S = this.airflowData.acUnits[0].spaces[0].airflowM3S;
                        return airflowM3S / this.calculateTotalReturnVentArea();
                    }
                    return 0;
                },
                
                // Rotary Filtration Calculations
                calculateFilterArea(diameter, length) {
                    return (Math.PI * Math.pow(diameter, 2) / 4) * length;
                },
                
                selectFilter(diameter, length) {
                    this.rotaryFilterData.selectedDiameter = diameter;
                    this.rotaryFilterData.selectedLength = length;
                },
                
                calculateSingleFilterArea() {
                    return this.calculateFilterArea(
                        this.rotaryFilterData.selectedDiameter, 
                        this.rotaryFilterData.selectedLength
                    );
                },
                
                calculateTotalFilterArea() {
                    return this.calculateSingleFilterArea() * this.rotaryFilterData.filterNumber;
                },
                
                calculateFilterAirVelocity() {
                    if (this.airflowData.acUnits.length > 0 && this.airflowData.acUnits[0].spaces.length > 0) {
                        const airflowM3S = this.airflowData.acUnits[0].spaces[0].airflowM3S;
                        return airflowM3S / this.calculateTotalFilterArea();
                    }
                    return 0;
                },
                
                // Fan & Motors Calculations
                selectFan(fanId) {
                    this.fanData.selectedFan = fanId;
                    this.$nextTick(() => {
                        this.updateFanChart();
                    });
                },
                
                calculateFanPower(fan) {
                    if (!fan) return 0;
                    // Fan power = (Airflow * Pressure) / (Fan Efficiency)
                    return (this.fanData.airflowRequired * this.fanData.systemPressure) / (fan.efficiency / 100) / 1000;
                },
                
                calculateMotorPower(fan) {
                    const fanPower = this.calculateFanPower(fan);
                    // Motor power = Fan power / Motor efficiency
                    return fanPower / (this.fanData.motorEfficiency / 100);
                },
                
                calculateOperatingPoint(fan) {
                    if (!fan) return 'N/A';
                    
                    const airflow = this.fanData.airflowRequired;
                    const pressure = this.fanData.systemPressure;
                    
                    // Calculate fan curve pressure at this airflow
                    const fanCurvePressure = fan.a * Math.pow(airflow, 2) + fan.b * airflow + fan.c;
                    
                    if (pressure <= fanCurvePressure * 1.1 && pressure >= fanCurvePressure * 0.9) {
                        return 'Optimal - Operating on fan curve';
                    } else if (pressure > fanCurvePressure * 1.1) {
                        return 'Overloaded - System pressure too high';
                    } else {
                        return 'Underloaded - System pressure too low';
                    }
                },
                
                getFanAdvisory() {
                    if (!this.fanData.selectedFan) return 'Please select a fan type';
                    
                    const fan = this.fanData.fanTypes.find(f => f.id === this.fanData.selectedFan);
                    const airflow = this.fanData.airflowRequired;
                    const pressure = this.fanData.systemPressure;
                    
                    if (airflow > fan.maxAirflow) {
                        return 'Warning: Required airflow exceeds fan maximum capacity. Consider selecting a larger fan or using multiple fans.';
                    } else if (pressure > fan.maxPressure) {
                        return 'Warning: System pressure exceeds fan maximum pressure. Consider selecting a fan with higher pressure capability.';
                    } else if (airflow < fan.maxAirflow * 0.5) {
                        return 'Advisory: Fan is operating at low capacity. Consider using a smaller fan for better efficiency.';
                    } else {
                        return 'Fan selection is appropriate for the specified conditions.';
                    }
                },
                
                calculateRequiredMotorPower() {
                    if (!this.fanData.selectedFan) return 0;
                    
                    const fan = this.fanData.fanTypes.find(f => f.id === this.fanData.selectedFan);
                    const motorPower = this.calculateMotorPower(fan);
                    return motorPower * this.fanData.safetyFactor;
                },
                
                getRecommendedMotor() {
                    const requiredPower = this.calculateRequiredMotorPower();
                    const standardMotors = [15, 18.5, 22, 30, 37, 45, 55, 75];
                    
                    for (let motor of standardMotors) {
                        if (motor >= requiredPower) {
                            return `${motor} kW`;
                        }
                    }
                    
                    return 'Custom motor required (>75 kW)';
                },
                
                calculateAnnualEnergy() {
                    if (!this.fanData.selectedFan) return 0;
                    
                    const motorPower = this.calculateRequiredMotorPower();
                    // Assuming 12 hours/day operation, 300 days/year
                    return motorPower * 12 * 300;
                },
                
                initFanChart() {
                    const ctx = document.getElementById('fanPerformanceChart').getContext('2d');
                    
                    this.fanChart = new Chart(ctx, {
                        type: 'line',
                        data: {
                            labels: [],
                            datasets: []
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            plugins: {
                                title: {
                                    display: true,
                                    text: 'Fan Performance Curves'
                                },
                                tooltip: {
                                    mode: 'index',
                                    intersect: false
                                }
                            },
                            scales: {
                                x: {
                                    title: {
                                        display: true,
                                        text: 'Airflow (m³/s)'
                                    }
                                },
                                y: {
                                    title: {
                                        display: true,
                                        text: 'Pressure (Pa)'
                                    },
                                    beginAtZero: true
                                }
                            }
                        }
                    });
                    
                    this.updateFanChart();
                },
                
                updateFanChart() {
                    if (!this.fanChart) return;
                    
                    const datasets = [];
                    const airflowRange = Array.from({length: 21}, (_, i) => i * 5); // 0 to 100 m³/s
                    
                    // Add fan curves
                    this.fanData.fanTypes.forEach(fan => {
                        const pressures = airflowRange.map(airflow => {
                            return fan.a * Math.pow(airflow, 2) + fan.b * airflow + fan.c;
                        });
                        
                        datasets.push({
                            label: fan.name,
                            data: pressures,
                            borderColor: this.getFanColor(fan.id),
                            backgroundColor: 'transparent',
                            tension: 0.4,
                            pointRadius: 0
                        });
                    });
                    
                    // Add system curve
                    const systemPressures = airflowRange.map(airflow => {
                        // System curve: P = k * Q²
                        const k = this.fanData.systemPressure / Math.pow(this.fanData.airflowRequired, 2);
                        return k * Math.pow(airflow, 2);
                    });
                    
                    datasets.push({
                        label: 'System Curve',
                        data: systemPressures,
                        borderColor: '#333',
                        backgroundColor: 'transparent',
                        borderDash: [5, 5],
                        pointRadius: 0
                    });
                    
                    // Add operating point if fan is selected
                    if (this.fanData.selectedFan) {
                        const fan = this.fanData.fanTypes.find(f => f.id === this.fanData.selectedFan);
                        datasets.push({
                            label: 'Operating Point',
                            data: [{
                                x: this.fanData.airflowRequired,
                                y: this.fanData.systemPressure
                            }],
                            backgroundColor: this.getFanColor(fan.id),
                            borderColor: this.getFanColor(fan.id),
                            pointRadius: 8,
                            pointStyle: 'circle'
                        });
                    }
                    
                    this.fanChart.data.labels = airflowRange;
                    this.fanChart.data.datasets = datasets;
                    this.fanChart.update();
                },
                
                getFanColor(fanId) {
                    const colors = ['#3498db', '#e74c3c', '#2ecc71', '#f39c12', '#9b59b6'];
                    return colors[(fanId - 1) % colors.length];
                },
                
                // File Operations
                saveLoadEstimationData() {
                    const data = JSON.stringify(this.loadEstimationData, null, 2);
                    this.downloadJSON(data, 'load_estimation_data.json');
                },
                
                loadLoadEstimationData() {
                    // In a real app, this would load from a file
                    // For demo purposes, we'll just show an alert
                    alert('Load estimation data loaded from file!');
                },
                
                saveRotaryFilterData() {
                    const data = JSON.stringify(this.rotaryFilterData, null, 2);
                    this.downloadJSON(data, 'rotary_filter_data.json');
                },
                
                loadRotaryFilterData() {
                    // In a real app, this would load from a file
                    // For demo purposes, we'll just show an alert
                    alert('Rotary filter data loaded from file!');
                },
                
                resetRotaryFilterData() {
                    this.rotaryFilterData = {
                        diameters: [2, 2.5, 3],
                        lengths: [1.7, 3.4, 5.1],
                        selectedDiameter: 2,
                        selectedLength: 1.7,
                        filterNumber: 1
                    };
                },
                
                saveProjectData() {
                    const projectData = {
                        globalData: this.globalData,
                        loadEstimationData: this.loadEstimationData,
                        airflowData: this.airflowData,
                        ductData: this.ductData,
                        rotaryFilterData: this.rotaryFilterData,
                        fanData: this.fanData
                    };
                    this.projectJsonData = JSON.stringify(projectData, null, 2);
                },
                
                loadProjectData() {
                    try {
                        const projectData = JSON.parse(this.projectJsonData);
                        this.globalData = projectData.globalData || this.globalData;
                        this.loadEstimationData = projectData.loadEstimationData || this.loadEstimationData;
                        this.airflowData = projectData.airflowData || this.airflowData;
                        this.ductData = projectData.ductData || this.ductData;
                        this.rotaryFilterData = projectData.rotaryFilterData || this.rotaryFilterData;
                        this.fanData = projectData.fanData || this.fanData;
                        alert('Project data loaded successfully!');
                    } catch (e) {
                        alert('Error loading project data: Invalid JSON format');
                    }
                },
                
                exportProjectData() {
                    this.saveProjectData();
                    this.downloadJSON(this.projectJsonData, 'hvac_project_data.json');
                },
                
                downloadJSON(data, filename) {
                    const blob = new Blob([data], { type: 'application/json' });
                    const url = URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = filename;
                    document.body.appendChild(a);
                    a.click();
                    document.body.removeChild(a);
                    URL.revokeObjectURL(url);
                },
                
                // Initialize calculations
                init() {
                    // Calculate initial values for spaces
                    this.airflowData.acUnits.forEach(ac => {
                        ac.spaces.forEach(space => {
                            this.calculateSpaceValues(space);
                        });
                    });
                    
                    // Set initial project JSON data
                    this.saveProjectData();
                    
                    // Initialize fan data with calculated airflow
                    if (this.airflowData.acUnits.length > 0 && this.airflowData.acUnits[0].spaces.length > 0) {
                        this.fanData.airflowRequired = this.airflowData.acUnits[0].spaces[0].airflowM3S;
                    }
                }
            };
        }
        
        // Initialize the app when Alpine is ready
        document.addEventListener('alpine:init', () => {
            Alpine.data('app', app);
        });
    </script>
</body>
</html>