<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Advanced Power Plant Simulator</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-annotation@2.0.1/dist/chartjs-plugin-annotation.min.js"></script>
    <style>
        :root {
            --primary: #4a9eff;
            --primary-dark: #2d5aa0;
            --secondary: #0c2461;
            --success: #4cd964;
            --warning: #ffcc00;
            --danger: #ff3b30;
            --danger-dark: #c0392b;
            --dark: #1a1a2e;
            --light: #f8f9fa;
            --surface: rgba(30, 40, 70, 0.95);
            --grid-color: #2ecc71;
            --turbine-color: #3498db;
            --generator-color: #9b59b6;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
            -webkit-user-select: none;
            user-select: none;
            touch-action: manipulation;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
            background: linear-gradient(135deg, #0c2461 0%, #1a1a2e 100%);
            color: var(--light);
            min-height: 100vh;
            overflow-x: hidden;
            line-height: 1.6;
        }
        
        /* Enhanced Mobile Container */
        .advanced-container {
            width: 100%;
            max-width: 100vw;
            min-height: 100vh;
            padding: 0;
            position: relative;
            overflow-x: hidden;
        }
        
        /* Enhanced Header */
        .advanced-header {
            background: linear-gradient(135deg, rgba(0, 0, 0, 0.8) 0%, rgba(26, 26, 46, 0.9) 100%);
            backdrop-filter: blur(20px);
            padding: 15px 20px;
            position: sticky;
            top: 0;
            z-index: 1000;
            border-bottom: 1px solid rgba(74, 158, 255, 0.2);
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.3);
        }
        
        .header-grid {
            display: grid;
            grid-template-columns: auto 1fr auto;
            gap: 15px;
            align-items: center;
        }
        
        .logo {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .logo-icon {
            width: 40px;
            height: 40px;
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
        }
        
        .logo-text {
            font-size: 1.1rem;
            font-weight: 700;
            color: var(--light);
        }
        
        .header-center {
            text-align: center;
        }
        
        .plant-title {
            font-size: 1.3rem;
            font-weight: 700;
            color: var(--primary);
            margin-bottom: 5px;
        }
        
        .plant-subtitle {
            font-size: 0.8rem;
            opacity: 0.8;
        }
        
        .header-actions {
            display: flex;
            gap: 10px;
        }
        
        .action-btn {
            width: 44px;
            height: 44px;
            border-radius: 12px;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s;
            position: relative;
        }
        
        .action-btn:active {
            transform: scale(0.95);
            background: rgba(255, 255, 255, 0.2);
        }
        
        .badge {
            position: absolute;
            top: -5px;
            right: -5px;
            background: var(--danger);
            color: white;
            font-size: 0.7rem;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        /* Main Dashboard */
        .dashboard {
            padding: 15px;
            padding-bottom: 100px;
        }
        
        /* Status Overview */
        .status-overview {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
            margin-bottom: 20px;
        }
        
        .status-card {
            background: var(--surface);
            border-radius: 15px;
            padding: 15px;
            border: 1px solid rgba(255, 255, 255, 0.05);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
            position: relative;
            overflow: hidden;
        }
        
        .status-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, var(--primary) 0%, var(--success) 100%);
        }
        
        .status-card.critical::before {
            background: linear-gradient(90deg, var(--danger) 0%, var(--warning) 100%);
        }
        
        .status-label {
            font-size: 0.8rem;
            opacity: 0.7;
            margin-bottom: 8px;
        }
        
        .status-value {
            font-size: 1.4rem;
            font-weight: 700;
            margin-bottom: 5px;
        }
        
        .status-trend {
            font-size: 0.8rem;
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .trend-up { color: var(--success); }
        .trend-down { color: var(--danger); }
        .trend-stable { color: var(--warning); }
        
        /* Control Panels */
        .control-section {
            margin-bottom: 25px;
        }
        
        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid rgba(74, 158, 255, 0.3);
        }
        
        .section-title {
            font-size: 1.1rem;
            font-weight: 600;
            color: var(--primary);
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .section-actions {
            display: flex;
            gap: 10px;
        }
        
        /* Turbine Grid */
        .turbine-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .turbine-card {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 15px;
            padding: 15px;
            border: 2px solid rgba(52, 152, 219, 0.3);
            position: relative;
            transition: all 0.3s;
        }
        
        .turbine-card.active {
            border-color: var(--turbine-color);
            box-shadow: 0 0 20px rgba(52, 152, 219, 0.3);
        }
        
        .turbine-card.tripped {
            border-color: var(--danger);
            box-shadow: 0 0 20px rgba(255, 59, 48, 0.3);
            animation: pulse-alarm 2s infinite;
        }
        
        @keyframes pulse-alarm {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }
        
        .turbine-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .turbine-id {
            font-weight: 700;
            font-size: 1.1rem;
            color: var(--turbine-color);
        }
        
        .turbine-status {
            padding: 5px 10px;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 600;
        }
        
        .status-online { background: rgba(76, 217, 100, 0.2); color: var(--success); }
        .status-starting { background: rgba(255, 149, 0, 0.2); color: #ff9500; }
        .status-syncing { background: rgba(255, 204, 0, 0.2); color: var(--warning); }
        .status-offline { background: rgba(108, 122, 137, 0.2); color: #7f8c8d; }
        .status-tripped { background: rgba(255, 59, 48, 0.2); color: var(--danger); }
        
        .turbine-visual {
            height: 100px;
            background: rgba(0, 0, 0, 0.5);
            border-radius: 10px;
            margin-bottom: 15px;
            position: relative;
            overflow: hidden;
        }
        
        .turbine-canvas {
            width: 100%;
            height: 100%;
        }
        
        .turbine-metrics {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
        }
        
        .metric {
            text-align: center;
        }
        
        .metric-label {
            font-size: 0.75rem;
            opacity: 0.7;
            margin-bottom: 5px;
        }
        
        .metric-value {
            font-size: 1rem;
            font-weight: 600;
        }
        
        .turbine-controls {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 8px;
            margin-top: 15px;
        }
        
        /* Advanced Controls */
        .advanced-controls {
            background: var(--surface);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 25px;
            border: 1px solid rgba(255, 255, 255, 0.05);
        }
        
        .control-group {
            margin-bottom: 20px;
        }
        
        .group-title {
            font-size: 1rem;
            font-weight: 600;
            margin-bottom: 15px;
            color: var(--primary);
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .slider-container {
            margin: 15px 0;
        }
        
        .slider-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
        }
        
        .slider-value {
            font-size: 1.3rem;
            font-weight: 700;
            color: var(--primary);
        }
        
        .range-slider {
            width: 100%;
            height: 10px;
            -webkit-appearance: none;
            appearance: none;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 5px;
            outline: none;
        }
        
        .range-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 25px;
            height: 25px;
            border-radius: 50%;
            background: var(--primary);
            cursor: pointer;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.3);
        }
        
        .slider-labels {
            display: flex;
            justify-content: space-between;
            margin-top: 5px;
            font-size: 0.8rem;
            opacity: 0.7;
        }
        
        /* Button Groups */
        .button-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
            margin-top: 20px;
        }
        
        .action-button {
            height: 60px;
            border-radius: 12px;
            border: none;
            font-size: 0.95rem;
            font-weight: 600;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 5px;
            cursor: pointer;
            transition: all 0.2s;
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            color: white;
            position: relative;
            overflow: hidden;
        }
        
        .action-button::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: left 0.5s;
        }
        
        .action-button:active::before {
            left: 100%;
        }
        
        .action-button:active {
            transform: scale(0.97);
        }
        
        .action-button.danger {
            background: linear-gradient(135deg, var(--danger) 0%, var(--danger-dark) 100%);
        }
        
        .action-button.success {
            background: linear-gradient(135deg, var(--success) 0%, #27ae60 100%);
        }
        
        .action-button.warning {
            background: linear-gradient(135deg, var(--warning) 0%, #f39c12 100%);
        }
        
        .action-button:disabled {
            background: #555;
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        /* Generator Section */
        .generator-section {
            background: var(--surface);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 25px;
            border: 1px solid rgba(155, 89, 182, 0.3);
        }
        
        .generator-visual {
            height: 150px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 10px;
            margin: 20px 0;
            position: relative;
            overflow: hidden;
        }
        
        .generator-metrics {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
        }
        
        /* Load Balancing */
        .load-balance-section {
            background: var(--surface);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 25px;
            border: 1px solid rgba(46, 204, 113, 0.3);
        }
        
        .balance-visual {
            height: 120px;
            position: relative;
            margin: 20px 0;
        }
        
        .balance-bar {
            position: absolute;
            bottom: 0;
            width: 100%;
            height: 40px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            overflow: hidden;
        }
        
        .balance-fill {
            position: absolute;
            bottom: 0;
            left: 0;
            width: 0%;
            height: 100%;
            background: linear-gradient(90deg, var(--success) 0%, var(--warning) 50%, var(--danger) 100%);
            border-radius: 10px;
            transition: width 0.5s;
        }
        
        .balance-labels {
            display: flex;
            justify-content: space-between;
            margin-top: 10px;
            font-size: 0.9rem;
        }
        
        /* Charts Container */
        .charts-container {
            display: grid;
            grid-template-columns: 1fr;
            gap: 20px;
            margin-bottom: 25px;
        }
        
        .chart-card {
            background: var(--surface);
            border-radius: 15px;
            padding: 20px;
            height: 300px;
        }
        
        /* Alarm Panel */
        .alarm-panel {
            background: rgba(231, 76, 60, 0.1);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 25px;
            border: 1px solid rgba(231, 76, 60, 0.3);
            animation: pulse-alarm 3s infinite;
        }
        
        .alarm-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 15px;
            color: var(--danger);
        }
        
        .alarm-list {
            max-height: 200px;
            overflow-y: auto;
        }
        
        .alarm-item {
            padding: 10px;
            margin-bottom: 10px;
            background: rgba(231, 76, 60, 0.2);
            border-radius: 10px;
            border-left: 4px solid var(--danger);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .alarm-time {
            font-size: 0.8rem;
            opacity: 0.8;
        }
        
        /* Bottom Navigation */
        .advanced-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: rgba(0, 0, 0, 0.9);
            backdrop-filter: blur(20px);
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            display: flex;
            justify-content: space-around;
            padding: 12px 0;
            z-index: 1000;
        }
        
        .nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 5px;
            padding: 10px 15px;
            border-radius: 15px;
            cursor: pointer;
            transition: all 0.2s;
            min-width: 70px;
        }
        
        .nav-item.active {
            background: rgba(74, 158, 255, 0.2);
        }
        
        .nav-icon {
            font-size: 1.2rem;
        }
        
        .nav-label {
            font-size: 0.8rem;
        }
        
        /* Modal Systems */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(10px);
            z-index: 2000;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s;
        }
        
        .modal-overlay.active {
            opacity: 1;
            visibility: visible;
        }
        
        .modal-content {
            background: var(--surface);
            border-radius: 25px;
            width: 100%;
            max-width: 500px;
            max-height: 90vh;
            overflow-y: auto;
            padding: 25px;
            transform: translateY(20px);
            transition: transform 0.3s;
        }
        
        .modal-overlay.active .modal-content {
            transform: translateY(0);
        }
        
        /* Responsive */
        @media (min-width: 768px) {
            .status-overview {
                grid-template-columns: repeat(4, 1fr);
            }
            
            .turbine-grid {
                grid-template-columns: repeat(4, 1fr);
            }
            
            .button-grid {
                grid-template-columns: repeat(4, 1fr);
            }
            
            .generator-metrics {
                grid-template-columns: repeat(6, 1fr);
            }
            
            .charts-container {
                grid-template-columns: repeat(2, 1fr);
            }
        }
        
        @media (max-width: 480px) {
            .header-grid {
                grid-template-columns: 1fr;
                gap: 10px;
            }
            
            .logo, .header-center, .header-actions {
                justify-content: center;
            }
        }
    </style>
</head>
<body>
    <div class="advanced-container">
        <!-- Enhanced Header -->
        <header class="advanced-header">
            <div class="header-grid">
                <div class="logo">
                    <div class="logo-icon">
                        <i class="fas fa-bolt"></i>
                    </div>
                    <div class="logo-text">PPS v2.0</div>
                </div>
                
                <div class="header-center">
                    <div class="plant-title">1000MW GAS POWER PLANT</div>
                    <div class="plant-subtitle">Advanced Simulation & Control System</div>
                </div>
                
                <div class="header-actions">
                    <div class="action-btn" id="alarm-btn">
                        <i class="fas fa-exclamation-triangle"></i>
                        <span class="badge" id="alarm-count">0</span>
                    </div>
                    <div class="action-btn" id="help-btn">
                        <i class="fas fa-question-circle"></i>
                    </div>
                    <div class="action-btn" id="settings-btn">
                        <i class="fas fa-cog"></i>
                    </div>
                </div>
            </div>
        </header>
        
        <!-- Main Dashboard -->
        <main class="dashboard">
            <!-- Status Overview -->
            <section class="status-overview">
                <div class="status-card">
                    <div class="status-label">PLANT STATUS</div>
                    <div class="status-value" id="plant-status">OFFLINE</div>
                    <div class="status-trend">
                        <i class="fas fa-circle"></i>
                        <span>Ready for startup</span>
                    </div>
                </div>
                
                <div class="status-card">
                    <div class="status-label">TOTAL OUTPUT</div>
                    <div class="status-value" id="total-output">0 MW</div>
                    <div class="status-trend">
                        <i class="fas fa-arrow-right"></i>
                        <span>Target: <span id="target-output">0 MW</span></span>
                    </div>
                </div>
                
                <div class="status-card">
                    <div class="status-label">GRID FREQUENCY</div>
                    <div class="status-value" id="grid-frequency">50.00 Hz</div>
                    <div class="status-trend">
                        <i class="fas fa-wave-square"></i>
                        <span>Stability: <span id="frequency-stability">100%</span></span>
                    </div>
                </div>
                
                <div class="status-card">
                    <div class="status-label">SYSTEM VOLTAGE</div>
                    <div class="status-value" id="system-voltage">0 kV</div>
                    <div class="status-trend">
                        <i class="fas fa-bolt"></i>
                        <span>Load: <span id="system-load">0%</span></span>
                    </div>
                </div>
            </section>
            
            <!-- Turbine Control Section -->
            <section class="control-section">
                <div class="section-header">
                    <div class="section-title">
                        <i class="fas fa-tachometer-alt"></i>
                        <span>Gas Turbine Array (4x 250MW Units)</span>
                    </div>
                    <div class="section-actions">
                        <button class="action-button" id="start-all-turbines">
                            <i class="fas fa-play-circle"></i>
                            <span>Start All</span>
                        </button>
                        <button class="action-button danger" id="stop-all-turbines">
                            <i class="fas fa-stop-circle"></i>
                            <span>Stop All</span>
                        </button>
                    </div>
                </div>
                
                <div class="turbine-grid" id="turbine-grid">
                    <!-- Turbine cards will be generated here -->
                </div>
            </section>
            
            <!-- Generator & Synchronization -->
            <section class="generator-section">
                <div class="section-header">
                    <div class="section-title">
                        <i class="fas fa-cogs"></i>
                        <span>Generator Synchronization</span>
                    </div>
                    <div class="section-actions">
                        <button class="action-button warning" id="sync-all-generators">
                            <i class="fas fa-sync-alt"></i>
                            <span>Sync All</span>
                        </button>
                    </div>
                </div>
                
                <div class="generator-visual" id="generator-visual">
                    <!-- Generator visualization canvas -->
                    <canvas id="generator-canvas"></canvas>
                </div>
                
                <div class="generator-metrics">
                    <div class="metric">
                        <div class="metric-label">SYNC STATUS</div>
                        <div class="metric-value" id="sync-status">NOT SYNCED</div>
                    </div>
                    <div class="metric">
                        <div class="metric-label">PHASE ANGLE</div>
                        <div class="metric-value" id="phase-angle">0Â°</div>
                    </div>
                    <div class="metric">
                        <div class="metric-label">SYNC SPEED</div>
                        <div class="metric-value" id="sync-speed">0 RPM</div>
                    </div>
                    <div class="metric">
                        <div class="metric-label">EXCITATION</div>
                        <div class="metric-value" id="excitation-voltage">0 V</div>
                    </div>
                    <div class="metric">
                        <div class="metric-label">FIELD CURRENT</div>
                        <div class="metric-value" id="field-current">0 A</div>
                    </div>
                    <div class="metric">
                        <div class="metric-label">POWER FACTOR</div>
                        <div class="metric-value" id="power-factor">0.00</div>
                    </div>
                </div>
            </section>
            
            <!-- Load Balancing Control -->
            <section class="load-balance-section">
                <div class="section-header">
                    <div class="section-title">
                        <i class="fas fa-balance-scale"></i>
                        <span>Load Balancing & Grid Connection</span>
                    </div>
                    <div class="section-actions">
                        <button class="action-button success" id="connect-to-grid">
                            <i class="fas fa-plug"></i>
                            <span>Connect Grid</span>
                        </button>
                    </div>
                </div>
                
                <div class="balance-visual">
                    <div class="balance-bar">
                        <div class="balance-fill" id="balance-fill"></div>
                    </div>
                    <div class="balance-labels">
                        <div>0%</div>
                        <div>50% (500MW)</div>
                        <div>100% (1000MW)</div>
                    </div>
                </div>
                
                <div class="control-group">
                    <div class="slider-header">
                        <div>Load Distribution Control</div>
                        <div class="slider-value" id="load-value">0 MW</div>
                    </div>
                    <input type="range" class="range-slider" id="load-slider" min="0" max="1000" value="0" step="10">
                    <div class="slider-labels">
                        <div>Minimum Load</div>
                        <div>Optimal Range</div>
                        <div>Maximum Capacity</div>
                    </div>
                </div>
                
                <div class="button-grid">
                    <button class="action-button" id="load-250">
                        <i class="fas fa-chart-line"></i>
                        <span>250 MW</span>
                    </button>
                    <button class="action-button" id="load-500">
                        <i class="fas fa-chart-line"></i>
                        <span>500 MW</span>
                    </button>
                    <button class="action-button" id="load-750">
                        <i class="fas fa-chart-line"></i>
                        <span>750 MW</span>
                    </button>
                    <button class="action-button warning" id="load-1000">
                        <i class="fas fa-chart-line"></i>
                        <span>1000 MW</span>
                    </button>
                    <button class="action-button" id="auto-balance">
                        <i class="fas fa-robot"></i>
                        <span>Auto Balance</span>
                    </button>
                    <button class="action-button" id="manual-control">
                        <i class="fas fa-hand-paper"></i>
                        <span>Manual Control</span>
                    </button>
                    <button class="action-button danger" id="emergency-trip">
                        <i class="fas fa-skull-crossbones"></i>
                        <span>Emergency Trip</span>
                    </button>
                    <button class="action-button" id="reset-faults">
                        <i class="fas fa-redo"></i>
                        <span>Reset Faults</span>
                    </button>
                </div>
            </section>
            
            <!-- Advanced Controls -->
            <section class="advanced-controls">
                <div class="section-header">
                    <div class="section-title">
                        <i class="fas fa-sliders-h"></i>
                        <span>Advanced System Controls</span>
                    </div>
                </div>
                
                <div class="control-group">
                    <div class="group-title">
                        <i class="fas fa-fire"></i>
                        <span>Combustion Control</span>
                    </div>
                    <div class="slider-container">
                        <div class="slider-header">
                            <div>Fuel Flow Rate</div>
                            <div class="slider-value" id="fuel-flow">0%</div>
                        </div>
                        <input type="range" class="range-slider" id="fuel-slider" min="0" max="100" value="0" step="1">
                    </div>
                    
                    <div class="slider-container">
                        <div class="slider-header">
                            <div>Air-Fuel Ratio</div>
                            <div class="slider-value" id="air-fuel-ratio">15:1</div>
                        </div>
                        <input type="range" class="range-slider" id="ratio-slider" min="10" max="20" value="15" step="0.1">
                    </div>
                </div>
                
                <div class="control-group">
                    <div class="group-title">
                        <i class="fas fa-fan"></i>
                        <span>Cooling System</span>
                    </div>
                    <div class="slider-container">
                        <div class="slider-header">
                            <div>Coolant Flow</div>
                            <div class="slider-value" id="coolant-flow">0%</div>
                        </div>
                        <input type="range" class="range-slider" id="coolant-slider" min="0" max="100" value="0" step="1">
                    </div>
                </div>
            </section>
            
            <!-- Charts Section -->
            <section class="charts-container">
                <div class="chart-card">
                    <canvas id="performance-chart"></canvas>
                </div>
                <div class="chart-card">
                    <canvas id="efficiency-chart"></canvas>
                </div>
            </section>
            
            <!-- Alarm Panel (Only shows when alarms exist) -->
            <section class="alarm-panel" id="alarm-panel" style="display: none;">
                <div class="alarm-header">
                    <i class="fas fa-exclamation-triangle"></i>
                    <h3>ACTIVE ALARMS</h3>
                </div>
                <div class="alarm-list" id="alarm-list">
                    <!-- Alarms will appear here -->
                </div>
            </section>
        </main>
        
        <!-- Bottom Navigation -->
        <nav class="advanced-nav">
            <div class="nav-item active" data-screen="dashboard">
                <div class="nav-icon"><i class="fas fa-tachometer-alt"></i></div>
                <div class="nav-label">Dashboard</div>
            </div>
            <div class="nav-item" data-screen="control">
                <div class="nav-icon"><i class="fas fa-gamepad"></i></div>
                <div class="nav-label">Control</div>
            </div>
            <div class="nav-item" data-screen="monitor">
                <div class="nav-icon"><i class="fas fa-chart-line"></i></div>
                <div class="nav-label">Monitor</div>
            </div>
            <div class="nav-item" data-screen="alarms">
                <div class="nav-icon"><i class="fas fa-exclamation-circle"></i></div>
                <div class="nav-label">Alarms</div>
            </div>
            <div class="nav-item" data-screen="logs">
                <div class="nav-icon"><i class="fas fa-clipboard-list"></i></div>
                <div class="nav-label">Logs</div>
            </div>
        </nav>
        
        <!-- Modals -->
        <div class="modal-overlay" id="help-modal">
            <div class="modal-content">
                <!-- Modal content would go here -->
            </div>
        </div>
    </div>

    <script>
        // Advanced Power Plant Simulation
        class PowerPlantSimulator {
            constructor() {
                this.state = {
                    plantStatus: "OFFLINE",
                    totalOutput: 0,
                    gridFrequency: 50.00,
                    systemVoltage: 0,
                    loadDemand: 0,
                    targetOutput: 0,
                    gridConnected: false,
                    synchronizationStatus: "NOT SYNCED",
                    phaseAngle: 0,
                    syncSpeed: 0,
                    excitationVoltage: 0,
                    fieldCurrent: 0,
                    powerFactor: 0,
                    fuelFlow: 0,
                    airFuelRatio: 15.0,
                    coolantFlow: 0,
                    efficiency: 0,
                    
                    turbines: [],
                    alarms: [],
                    faults: [],
                    logs: [],
                    
                    autoBalance: false,
                    manualControl: true,
                    
                    // Performance tracking
                    performanceData: [],
                    efficiencyData: []
                };
                
                // Initialize turbines
                this.initTurbines();
                
                // Charts
                this.performanceChart = null;
                this.efficiencyChart = null;
                
                // DOM Elements
                this.elements = {};
                
                // Simulation intervals
                this.intervals = [];
                
                // Initialize
                this.init();
            }
            
            init() {
                this.cacheElements();
                this.initCharts();
                this.initEventListeners();
                this.renderTurbines();
                this.startSimulation();
            }
            
            initTurbines() {
                for (let i = 0; i < 4; i++) {
                    this.state.turbines.push({
                        id: i + 1,
                        name: `Turbine ${i + 1}`,
                        status: "OFFLINE",
                        output: 0,
                        maxOutput: 250,
                        speed: 0,
                        maxSpeed: 3000,
                        temperature: 25,
                        maxTemperature: 650,
                        voltage: 0,
                        frequency: 0,
                        fuelConsumption: 0,
                        efficiency: 0,
                        synchronized: false,
                        tripped: false,
                        tripReason: "",
                        vibration: 0,
                        bearingTemp: 25,
                        exhaustTemp: 25,
                        startTime: 0,
                        metrics: {
                            availability: 100,
                            reliability: 100,
                            maintenanceRequired: false
                        }
                    });
                }
            }
            
            cacheElements() {
                // Status elements
                this.elements.plantStatus = document.getElementById('plant-status');
                this.elements.totalOutput = document.getElementById('total-output');
                this.elements.gridFrequency = document.getElementById('grid-frequency');
                this.elements.systemVoltage = document.getElementById('system-voltage');
                this.elements.targetOutput = document.getElementById('target-output');
                this.elements.frequencyStability = document.getElementById('frequency-stability');
                this.elements.systemLoad = document.getElementById('system-load');
                
                // Turbine grid
                this.elements.turbineGrid = document.getElementById('turbine-grid');
                
                // Generator elements
                this.elements.syncStatus = document.getElementById('sync-status');
                this.elements.phaseAngle = document.getElementById('phase-angle');
                this.elements.syncSpeed = document.getElementById('sync-speed');
                this.elements.excitationVoltage = document.getElementById('excitation-voltage');
                this.elements.fieldCurrent = document.getElementById('field-current');
                this.elements.powerFactor = document.getElementById('power-factor');
                
                // Load control
                this.elements.loadValue = document.getElementById('load-value');
                this.elements.loadSlider = document.getElementById('load-slider');
                this.elements.balanceFill = document.getElementById('balance-fill');
                
                // Control elements
                this.elements.fuelFlow = document.getElementById('fuel-flow');
                this.elements.fuelSlider = document.getElementById('fuel-slider');
                this.elements.airFuelRatio = document.getElementById('air-fuel-ratio');
                this.elements.ratioSlider = document.getElementById('ratio-slider');
                this.elements.coolantFlow = document.getElementById('coolant-flow');
                this.elements.coolantSlider = document.getElementById('coolant-slider');
                
                // Alarm elements
                this.elements.alarmCount = document.getElementById('alarm-count');
                this.elements.alarmPanel = document.getElementById('alarm-panel');
                this.elements.alarmList = document.getElementById('alarm-list');
                
                // Buttons
                this.cacheButtons();
            }
            
            cacheButtons() {
                const buttons = [
                    'start-all-turbines', 'stop-all-turbines', 'sync-all-generators',
                    'connect-to-grid', 'load-250', 'load-500', 'load-750', 'load-1000',
                    'auto-balance', 'manual-control', 'emergency-trip', 'reset-faults',
                    'alarm-btn', 'help-btn', 'settings-btn'
                ];
                
                buttons.forEach(id => {
                    this.elements[id] = document.getElementById(id);
                });
            }
            
            initCharts() {
                const performanceCtx = document.getElementById('performance-chart').getContext('2d');
                const efficiencyCtx = document.getElementById('efficiency-chart').getContext('2d');
                
                // Performance Chart
                this.performanceChart = new Chart(performanceCtx, {
                    type: 'line',
                    data: {
                        labels: Array(20).fill(''),
                        datasets: [
                            {
                                label: 'Output (MW)',
                                data: Array(20).fill(0),
                                borderColor: '#4cd964',
                                backgroundColor: 'rgba(76, 217, 100, 0.1)',
                                fill: true,
                                tension: 0.4,
                                borderWidth: 2
                            },
                            {
                                label: 'Demand (MW)',
                                data: Array(20).fill(0),
                                borderColor: '#4a9eff',
                                backgroundColor: 'rgba(74, 158, 255, 0.1)',
                                fill: true,
                                tension: 0.4,
                                borderWidth: 2
                            },
                            {
                                label: 'Frequency (Hz x 100)',
                                data: Array(20).fill(5000),
                                borderColor: '#ffcc00',
                                backgroundColor: 'transparent',
                                borderWidth: 1,
                                borderDash: [5, 5],
                                yAxisID: 'y1'
                            }
                        ]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                labels: { color: '#fff' }
                            },
                            annotation: {
                                annotations: {
                                    line1: {
                                        type: 'line',
                                        yMin: 5000,
                                        yMax: 5000,
                                        borderColor: 'rgba(255, 255, 255, 0.3)',
                                        borderWidth: 1,
                                        borderDash: [5, 5]
                                    }
                                }
                            }
                        },
                        scales: {
                            x: {
                                grid: { color: 'rgba(255, 255, 255, 0.05)' },
                                ticks: { color: '#aaa' }
                            },
                            y: {
                                type: 'linear',
                                display: true,
                                position: 'left',
                                grid: { color: 'rgba(255, 255, 255, 0.05)' },
                                ticks: { color: '#aaa' },
                                title: {
                                    display: true,
                                    text: 'Power (MW)',
                                    color: '#aaa'
                                },
                                min: 0,
                                max: 1000
                            },
                            y1: {
                                type: 'linear',
                                display: true,
                                position: 'right',
                                grid: { drawOnChartArea: false },
                                ticks: { color: '#ffcc00' },
                                title: {
                                    display: true,
                                    text: 'Frequency (Hz x 100)',
                                    color: '#ffcc00'
                                },
                                min: 4950,
                                max: 5050
                            }
                        }
                    }
                });
                
                // Efficiency Chart
                this.efficiencyChart = new Chart(efficiencyCtx, {
                    type: 'bar',
                    data: {
                        labels: ['T1', 'T2', 'T3', 'T4'],
                        datasets: [
                            {
                                label: 'Efficiency (%)',
                                data: [0, 0, 0, 0],
                                backgroundColor: [
                                    'rgba(52, 152, 219, 0.7)',
                                    'rgba(155, 89, 182, 0.7)',
                                    'rgba(46, 204, 113, 0.7)',
                                    'rgba(241, 196, 15, 0.7)'
                                ],
                                borderColor: [
                                    'rgb(52, 152, 219)',
                                    'rgb(155, 89, 182)',
                                    'rgb(46, 204, 113)',
                                    'rgb(241, 196, 15)'
                                ],
                                borderWidth: 1
                            },
                            {
                                label: 'Target',
                                data: [85, 85, 85, 85],
                                type: 'line',
                                borderColor: 'rgba(255, 255, 255, 0.5)',
                                borderWidth: 1,
                                borderDash: [5, 5],
                                fill: false,
                                pointRadius: 0
                            }
                        ]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                labels: { color: '#fff' }
                            }
                        },
                        scales: {
                            x: {
                                grid: { color: 'rgba(255, 255, 255, 0.05)' },
                                ticks: { color: '#aaa' }
                            },
                            y: {
                                grid: { color: 'rgba(255, 255, 255, 0.05)' },
                                ticks: { color: '#aaa' },
                                title: {
                                    display: true,
                                    text: 'Efficiency (%)',
                                    color: '#aaa'
                                },
                                min: 0,
                                max: 100
                            }
                        }
                    }
                });
            }
            
            initEventListeners() {
                // Start/Stop buttons
                this.elements['start-all-turbines'].addEventListener('click', () => this.startAllTurbines());
                this.elements['stop-all-turbines'].addEventListener('click', () => this.stopAllTurbines());
                this.elements['sync-all-generators'].addEventListener('click', () => this.synchronizeAll());
                this.elements['connect-to-grid'].addEventListener('click', () => this.connectToGrid());
                
                // Load control buttons
                this.elements['load-250'].addEventListener('click', () => this.setLoad(250));
                this.elements['load-500'].addEventListener('click', () => this.setLoad(500));
                this.elements['load-750'].addEventListener('click', () => this.setLoad(750));
                this.elements['load-1000'].addEventListener('click', () => this.setLoad(1000));
                
                // Control mode buttons
                this.elements['auto-balance'].addEventListener('click', () => this.toggleAutoBalance());
                this.elements['manual-control'].addEventListener('click', () => this.toggleManualControl());
                this.elements['emergency-trip'].addEventListener('click', () => this.emergencyTrip());
                this.elements['reset-faults'].addEventListener('click', () => this.resetFaults());
                
                // Sliders
                this.elements.loadSlider.addEventListener('input', (e) => {
                    const value = parseInt(e.target.value);
                    this.setLoad(value);
                });
                
                this.elements.fuelSlider.addEventListener('input', (e) => {
                    this.state.fuelFlow = parseInt(e.target.value);
                    this.elements.fuelFlow.textContent = `${this.state.fuelFlow}%`;
                    this.updateTurbinePerformance();
                });
                
                this.elements.ratioSlider.addEventListener('input', (e) => {
                    this.state.airFuelRatio = parseFloat(e.target.value);
                    this.elements.airFuelRatio.textContent = `${this.state.airFuelRatio.toFixed(1)}:1`;
                    this.updateCombustionEfficiency();
                });
                
                this.elements.coolantSlider.addEventListener('input', (e) => {
                    this.state.coolantFlow = parseInt(e.target.value);
                    this.elements.coolantFlow.textContent = `${this.state.coolantFlow}%`;
                    this.updateCoolingSystem();
                });
                
                // Alarm button
                this.elements['alarm-btn'].addEventListener('click', () => this.showAlarms());
                
                // Navigation
                document.querySelectorAll('.nav-item').forEach(item => {
                    item.addEventListener('click', (e) => {
                        document.querySelectorAll('.nav-item').forEach(i => i.classList.remove('active'));
                        item.classList.add('active');
                        // In full implementation, this would switch views
                    });
                });
                
                // Touch events for turbine cards
                document.addEventListener('click', (e) => {
                    if (e.target.closest('.turbine-controls')) {
                        const button = e.target.closest('button');
                        if (button) {
                            const turbineId = parseInt(button.dataset.turbine);
                            const action = button.dataset.action;
                            this.handleTurbineAction(turbineId, action);
                        }
                    }
                });
            }
            
            renderTurbines() {
                this.elements.turbineGrid.innerHTML = '';
                
                this.state.turbines.forEach(turbine => {
                    const card = document.createElement('div');
                    card.className = `turbine-card ${turbine.status.toLowerCase()} ${turbine.tripped ? 'tripped' : ''}`;
                    
                    card.innerHTML = `
                        <div class="turbine-header">
                            <div class="turbine-id">${turbine.name}</div>
                            <div class="turbine-status status-${turbine.status.toLowerCase()}">${turbine.status}</div>
                        </div>
                        
                        <div class="turbine-visual">
                            <canvas class="turbine-canvas" id="turbine-canvas-${turbine.id}"></canvas>
                        </div>
                        
                        <div class="turbine-metrics">
                            <div class="metric">
                                <div class="metric-label">OUTPUT</div>
                                <div class="metric-value">${Math.round(turbine.output)} MW</div>
                            </div>
                            <div class="metric">
                                <div class="metric-label">SPEED</div>
                                <div class="metric-value">${Math.round(turbine.speed)} RPM</div>
                            </div>
                            <div class="metric">
                                <div class="metric-label">TEMP</div>
                                <div class="metric-value">${Math.round(turbine.temperature)}Â°C</div>
                            </div>
                            <div class="metric">
                                <div class="metric-label">EFF</div>
                                <div class="metric-value">${Math.round(turbine.efficiency)}%</div>
                            </div>
                        </div>
                        
                        <div class="turbine-controls">
                            <button class="action-button" data-turbine="${turbine.id}" data-action="start" 
                                    ${turbine.status !== 'OFFLINE' ? 'disabled' : ''}>
                                <i class="fas fa-play"></i>
                            </button>
                            <button class="action-button warning" data-turbine="${turbine.id}" data-action="sync"
                                    ${!['RUNNING', 'ONLINE'].includes(turbine.status) ? 'disabled' : ''}>
                                <i class="fas fa-sync-alt"></i>
                            </button>
                            <button class="action-button danger" data-turbine="${turbine.id}" data-action="trip"
                                    ${turbine.status === 'OFFLINE' ? 'disabled' : ''}>
                                <i class="fas fa-power-off"></i>
                            </button>
                        </div>
                    `;
                    
                    this.elements.turbineGrid.appendChild(card);
                });
                
                // Initialize turbine visualizations
                this.initTurbineVisualizations();
            }
            
            initTurbineVisualizations() {
                this.state.turbines.forEach(turbine => {
                    const canvas = document.getElementById(`turbine-canvas-${turbine.id}`);
                    if (canvas) {
                        this.renderTurbineVisual(canvas, turbine);
                    }
                });
            }
            
            renderTurbineVisual(canvas, turbine) {
                const ctx = canvas.getContext('2d');
                const width = canvas.width || 200;
                const height = canvas.height || 100;
                
                // Clear canvas
                ctx.clearRect(0, 0, width, height);
                
                // Draw turbine based on status
                this.drawTurbine(ctx, width, height, turbine);
                
                // Schedule next frame
                requestAnimationFrame(() => this.renderTurbineVisual(canvas, turbine));
            }
            
            drawTurbine(ctx, width, height, turbine) {
                const centerX = width / 2;
                const centerY = height / 2;
                
                // Draw turbine body
                ctx.fillStyle = turbine.tripped ? '#e74c3c' : 
                               turbine.status === 'ONLINE' ? '#3498db' : 
                               turbine.status === 'RUNNING' ? '#9b59b6' :
                               turbine.status === 'STARTING' ? '#f39c12' : '#7f8c8d';
                
                ctx.fillRect(centerX - 40, centerY - 20, 80, 40);
                
                // Draw rotating blades if running
                if (['RUNNING', 'ONLINE', 'STARTING'].includes(turbine.status)) {
                    ctx.save();
                    ctx.translate(centerX, centerY);
                    
                    // Calculate rotation based on speed
                    const rotation = (Date.now() / 1000) * (turbine.speed / 3000);
                    ctx.rotate(rotation);
                    
                    // Draw three blades
                    for (let i = 0; i < 3; i++) {
                        ctx.rotate((Math.PI * 2) / 3);
                        ctx.fillStyle = '#2c3e50';
                        ctx.fillRect(-5, -30, 10, 30);
                    }
                    
                    ctx.restore();
                }
                
                // Draw exhaust based on temperature
                if (turbine.temperature > 100) {
                    const heatIntensity = Math.min(1, turbine.temperature / 650);
                    const gradient = ctx.createLinearGradient(centerX + 40, centerY, centerX + 80, centerY);
                    gradient.addColorStop(0, `rgba(255, ${100 + (155 * (1 - heatIntensity))}, 0, 0.8)`);
                    gradient.addColorStop(1, 'rgba(255, 100, 0, 0)');
                    
                    ctx.fillStyle = gradient;
                    ctx.beginPath();
                    ctx.ellipse(centerX + 60, centerY, 20, 10, 0, 0, Math.PI * 2);
                    ctx.fill();
                }
                
                // Draw status indicator
                ctx.fillStyle = turbine.tripped ? '#e74c3c' : 
                               turbine.status === 'ONLINE' ? '#2ecc71' :
                               turbine.status === 'RUNNING' ? '#3498db' :
                               turbine.status === 'STARTING' ? '#f39c12' : '#95a5a6';
                
                ctx.beginPath();
                ctx.arc(centerX, centerY - 30, 8, 0, Math.PI * 2);
                ctx.fill();
            }
            
            startAllTurbines() {
                let delay = 0;
                this.state.turbines.forEach(turbine => {
                    if (turbine.status === 'OFFLINE' && !turbine.tripped) {
                        setTimeout(() => {
                            this.startTurbine(turbine.id);
                        }, delay);
                        delay += 2000; // Staggered startup
                    }
                });
                
                this.addLog('Starting all turbines in sequence');
            }
            
            startTurbine(id) {
                const turbine = this.state.turbines.find(t => t.id === id);
                if (!turbine || turbine.status !== 'OFFLINE') return;
                
                turbine.status = 'STARTING';
                turbine.startTime = Date.now();
                
                // Random chance of startup failure (5%)
                if (Math.random() < 0.05) {
                    setTimeout(() => {
                        this.tripTurbine(id, 'Startup failure - Ignition fault');
                    }, 3000);
                } else {
                    setTimeout(() => {
                        turbine.status = 'RUNNING';
                        turbine.speed = 3000;
                        turbine.temperature = 300;
                        this.addLog(`${turbine.name} started successfully`);
                    }, 5000);
                }
                
                this.updatePlantStatus();
                this.renderTurbines();
            }
            
            stopAllTurbines() {
                this.state.turbines.forEach(turbine => {
                    if (turbine.status !== 'OFFLINE') {
                        this.stopTurbine(turbine.id);
                    }
                });
                
                this.addLog('Stopping all turbines');
            }
            
            stopTurbine(id) {
                const turbine = this.state.turbines.find(t => t.id === id);
                if (!turbine) return;
                
                turbine.status = 'OFFLINE';
                turbine.output = 0;
                turbine.speed = 0;
                turbine.temperature = 25;
                turbine.synchronized = false;
                
                this.updatePlantStatus();
                this.renderTurbines();
            }
            
            synchronizeAll() {
                this.state.turbines.forEach(turbine => {
                    if (turbine.status === 'RUNNING' && !turbine.synchronized) {
                        this.synchronizeTurbine(turbine.id);
                    }
                });
            }
            
            synchronizeTurbine(id) {
                const turbine = this.state.turbines.find(t => t.id === id);
                if (!turbine || turbine.status !== 'RUNNING') return;
                
                turbine.status = 'SYNCHRONIZING';
                
                // Simulate synchronization process
                setTimeout(() => {
                    if (!turbine.tripped) {
                        turbine.synchronized = true;
                        turbine.status = 'ONLINE';
                        turbine.voltage = 400;
                        turbine.frequency = 50.0;
                        this.addLog(`${turbine.name} synchronized with grid`);
                    }
                }, 3000);
                
                this.updateSynchronizationStatus();
                this.renderTurbines();
            }
            
            connectToGrid() {
                const synchronizedTurbines = this.state.turbines.filter(t => t.synchronized);
                
                if (synchronizedTurbines.length >= 2) {
                    this.state.gridConnected = true;
                    this.state.plantStatus = 'ONLINE';
                    this.elements['connect-to-grid'].disabled = true;
                    this.addLog('Connected to power grid');
                    
                    // Initialize load distribution
                    this.distributeLoad();
                } else {
                    this.addAlarm('Grid Connection Failed', 'Minimum 2 synchronized turbines required', 'warning');
                }
                
                this.updatePlantStatus();
            }
            
            setLoad(value) {
                this.state.loadDemand = Math.min(1000, Math.max(0, value));
                this.state.targetOutput = this.state.loadDemand;
                
                this.elements.loadValue.textContent = `${this.state.loadDemand} MW`;
                this.elements.loadSlider.value = this.state.loadDemand;
                
                const fillPercentage = (this.state.loadDemand / 1000) * 100;
                this.elements.balanceFill.style.width = `${fillPercentage}%`;
                
                if (this.state.gridConnected) {
                    this.distributeLoad();
                }
                
                // Check for overload
                if (this.state.loadDemand > this.getAvailableCapacity()) {
                    this.addAlarm('Overload Warning', `Demand (${this.state.loadDemand}MW) exceeds available capacity`, 'danger');
                    
                    // Chance of overload trip
                    if (this.state.loadDemand > this.getAvailableCapacity() * 1.1) {
                        setTimeout(() => {
                            this.overloadTrip();
                        }, 5000);
                    }
                }
                
                this.updatePlantStatus();
            }
            
            distributeLoad() {
                if (!this.state.gridConnected) return;
                
                const onlineTurbines = this.state.turbines.filter(t => t.status === 'ONLINE');
                if (onlineTurbines.length === 0) return;
                
                const loadPerTurbine = this.state.loadDemand / onlineTurbines.length;
                
                onlineTurbines.forEach(turbine => {
                    // Gradual load adjustment
                    const targetOutput = Math.min(turbine.maxOutput, loadPerTurbine);
                    turbine.output = this.approachValue(turbine.output, targetOutput, 5);
                    
                    // Update turbine metrics based on load
                    this.updateTurbineMetrics(turbine);
                });
                
                this.updateTotalOutput();
            }
            
            updateTurbineMetrics(turbine) {
                // Calculate efficiency based on load
                const loadPercentage = (turbine.output / turbine.maxOutput) * 100;
                turbine.efficiency = Math.min(95, 60 + (loadPercentage * 0.35));
                
                // Update temperature based on load
                const baseTemp = 300;
                const loadFactor = turbine.output / turbine.maxOutput;
                turbine.temperature = baseTemp + (loadFactor * 350);
                
                // Update vibration
                turbine.vibration = 1 + (loadFactor * 4) + Math.random() * 2;
                
                // Check for high temperature alarm
                if (turbine.temperature > 600) {
                    this.addAlarm(`${turbine.name} High Temperature`, 
                                `Temperature at ${Math.round(turbine.temperature)}Â°C`, 'warning');
                    
                    // Trip if temperature critical
                    if (turbine.temperature > 650) {
                        this.tripTurbine(turbine.id, 'Over temperature trip');
                    }
                }
                
                // Check for high vibration
                if (turbine.vibration > 5) {
                    this.addAlarm(`${turbine.name} High Vibration`, 
                                `Vibration at ${turbine.vibration.toFixed(1)} mm/s`, 'warning');
                }
            }
            
            updateTurbinePerformance() {
                // Update turbine outputs based on fuel flow
                const onlineTurbines = this.state.turbines.filter(t => t.status === 'ONLINE');
                
                onlineTurbines.forEach(turbine => {
                    const fuelFactor = this.state.fuelFlow / 100;
                    const maxPossible = turbine.maxOutput * fuelFactor;
                    
                    if (turbine.output > maxPossible) {
                        turbine.output = Math.max(0, turbine.output - 10);
                    }
                });
                
                this.updateTotalOutput();
            }
            
            updateCombustionEfficiency() {
                // Update efficiency based on air-fuel ratio
                const optimalRatio = 15.0;
                const ratioDifference = Math.abs(this.state.airFuelRatio - optimalRatio);
                
                let efficiencyPenalty = 0;
                if (ratioDifference > 1) {
                    efficiencyPenalty = ratioDifference * 2;
                }
                
                this.state.efficiency = Math.max(50, 85 - efficiencyPenalty);
                
                // Update turbine efficiencies
                this.state.turbines.forEach(turbine => {
                    if (turbine.status === 'ONLINE') {
                        turbine.efficiency = Math.max(50, turbine.efficiency - (efficiencyPenalty * 0.5));
                    }
                });
            }
            
            updateCoolingSystem() {
                // Reduce temperatures based on coolant flow
                const coolantFactor = this.state.coolantFlow / 100;
                
                this.state.turbines.forEach(turbine => {
                    if (turbine.status !== 'OFFLINE') {
                        const tempReduction = coolantFactor * 100;
                        turbine.temperature = Math.max(300, turbine.temperature - tempReduction * 0.1);
                    }
                });
            }
            
            toggleAutoBalance() {
                this.state.autoBalance = !this.state.autoBalance;
                this.state.manualControl = !this.state.autoBalance;
                
                const button = this.elements['auto-balance'];
                if (this.state.autoBalance) {
                    button.classList.add('active');
                    button.innerHTML = '<i class="fas fa-robot"></i><span>Auto On</span>';
                    this.addLog('Automatic load balancing enabled');
                } else {
                    button.classList.remove('active');
                    button.innerHTML = '<i class="fas fa-robot"></i><span>Auto Balance</span>';
                }
                
                this.elements['manual-control'].classList.toggle('active', this.state.manualControl);
            }
            
            toggleManualControl() {
                this.state.manualControl = !this.state.manualControl;
                this.state.autoBalance = !this.state.manualControl;
                
                const button = this.elements['manual-control'];
                if (this.state.manualControl) {
                    button.classList.add('active');
                    button.innerHTML = '<i class="fas fa-hand-paper"></i><span>Manual On</span>';
                } else {
                    button.classList.remove('active');
                    button.innerHTML = '<i class="fas fa-hand-paper"></i><span>Manual Control</span>';
                }
                
                this.elements['auto-balance'].classList.toggle('active', this.state.autoBalance);
            }
            
            emergencyTrip() {
                this.addAlarm('EMERGENCY TRIP', 'Manual emergency trip activated', 'danger');
                
                // Trip all turbines
                this.state.turbines.forEach(turbine => {
                    if (turbine.status !== 'OFFLINE') {
                        this.tripTurbine(turbine.id, 'Emergency manual trip');
                    }
                });
                
                this.state.gridConnected = false;
                this.state.plantStatus = 'TRIPPED';
                
                setTimeout(() => {
                    this.addLog('Emergency trip sequence completed');
                }, 1000);
            }
            
            tripTurbine(id, reason) {
                const turbine = this.state.turbines.find(t => t.id === id);
                if (!turbine) return;
                
                turbine.status = 'TRIPPED';
                turbine.tripped = true;
                turbine.tripReason = reason;
                turbine.output = 0;
                turbine.synchronized = false;
                
                this.addAlarm(`${turbine.name} Tripped`, reason, 'danger');
                this.addLog(`${turbine.name} tripped: ${reason}`);
                
                // Update plant status
                const onlineTurbines = this.state.turbines.filter(t => t.status === 'ONLINE');
                if (onlineTurbines.length === 0 && this.state.gridConnected) {
                    this.state.gridConnected = false;
                    this.state.plantStatus = 'TRIPPED';
                    this.addAlarm('Grid Disconnected', 'All turbines tripped', 'danger');
                }
                
                this.updatePlantStatus();
                this.renderTurbines();
            }
            
            overloadTrip() {
                // Randomly trip one or more turbines
                const onlineTurbines = this.state.turbines.filter(t => t.status === 'ONLINE');
                if (onlineTurbines.length === 0) return;
                
                // Trip 1-2 turbines randomly
                const trips = Math.min(2, Math.floor(Math.random() * onlineTurbines.length) + 1);
                
                for (let i = 0; i < trips; i++) {
                    const turbine = onlineTurbines[Math.floor(Math.random() * onlineTurbines.length)];
                    this.tripTurbine(turbine.id, 'Overload protection trip');
                }
                
                this.addAlarm('Overload Protection', 'System tripped due to overload', 'danger');
            }
            
            resetFaults() {
                this.state.turbines.forEach(turbine => {
                    if (turbine.tripped) {
                        turbine.tripped = false;
                        turbine.tripReason = '';
                        turbine.status = 'OFFLINE';
                    }
                });
                
                this.state.alarms = [];
                this.updateAlarmDisplay();
                
                this.addLog('All faults reset');
                this.renderTurbines();
            }
            
            updatePlantStatus() {
                // Update status display
                this.elements.plantStatus.textContent = this.state.plantStatus;
                this.elements.totalOutput.textContent = `${Math.round(this.state.totalOutput)} MW`;
                this.elements.targetOutput.textContent = `${this.state.targetOutput} MW`;
                this.elements.gridFrequency.textContent = `${this.state.gridFrequency.toFixed(2)} Hz`;
                this.elements.systemVoltage.textContent = `${this.state.systemVoltage} kV`;
                
                // Update frequency stability
                const frequencyDeviation = Math.abs(50.0 - this.state.gridFrequency);
                const stability = Math.max(0, 100 - (frequencyDeviation * 100));
                this.elements.frequencyStability.textContent = `${Math.round(stability)}%`;
                
                // Update system load
                const loadPercentage = (this.state.totalOutput / 1000) * 100;
                this.elements.systemLoad.textContent = `${Math.round(loadPercentage)}%`;
                
                // Update charts
                this.updateCharts();
                
                // Update efficiency chart
                this.updateEfficiencyChart();
            }
            
            updateTotalOutput() {
                this.state.totalOutput = this.state.turbines.reduce((sum, turbine) => sum + turbine.output, 0);
                
                // Update grid frequency based on load balance
                if (this.state.gridConnected) {
                    const loadDifference = this.state.totalOutput - this.state.loadDemand;
                    this.state.gridFrequency = 50.0 - (loadDifference / 1000) * 0.5;
                    this.state.gridFrequency += (Math.random() * 0.1 - 0.05); // Add noise
                    this.state.gridFrequency = Math.max(49.5, Math.min(50.5, this.state.gridFrequency));
                }
                
                // Update system voltage
                const onlineCount = this.state.turbines.filter(t => t.status === 'ONLINE').length;
                this.state.systemVoltage = onlineCount > 0 ? 400 : 0;
                
                this.updatePlantStatus();
            }
            
            updateSynchronizationStatus() {
                const synchronizedTurbines = this.state.turbines.filter(t => t.synchronized);
                
                if (synchronizedTurbines.length === 0) {
                    this.state.synchronizationStatus = 'NOT SYNCED';
                } else if (synchronizedTurbines.length === this.state.turbines.length) {
                    this.state.synchronizationStatus = 'FULLY SYNCED';
                } else {
                    this.state.synchronizationStatus = 'PARTIALLY SYNCED';
                }
                
                this.elements.syncStatus.textContent = this.state.synchronizationStatus;
                
                // Update synchronization metrics
                this.state.phaseAngle = synchronizedTurbines.length * 15;
                this.state.syncSpeed = synchronizedTurbines.length * 750;
                this.state.excitationVoltage = synchronizedTurbines.length * 100;
                this.state.fieldCurrent = synchronizedTurbines.length * 500;
                this.state.powerFactor = synchronizedTurbines.length > 0 ? 0.95 : 0;
                
                this.elements.phaseAngle.textContent = `${this.state.phaseAngle}Â°`;
                this.elements.syncSpeed.textContent = `${this.state.syncSpeed} RPM`;
                this.elements.excitationVoltage.textContent = `${this.state.excitationVoltage} V`;
                this.elements.fieldCurrent.textContent = `${this.state.fieldCurrent} A`;
                this.elements.powerFactor.textContent = this.state.powerFactor.toFixed(2);
            }
            
            updateCharts() {
                // Add new data point
                const now = new Date().toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});
                
                // Performance chart
                this.performanceChart.data.labels.push(now);
                this.performanceChart.data.labels.shift();
                
                this.performanceChart.data.datasets[0].data.push(this.state.totalOutput);
                this.performanceChart.data.datasets[0].data.shift();
                
                this.performanceChart.data.datasets[1].data.push(this.state.loadDemand);
                this.performanceChart.data.datasets[1].data.shift();
                
                this.performanceChart.data.datasets[2].data.push(this.state.gridFrequency * 100);
                this.performanceChart.data.datasets[2].data.shift();
                
                this.performanceChart.update('none');
            }
            
            updateEfficiencyChart() {
                const efficiencies = this.state.turbines.map(t => Math.round(t.efficiency));
                this.efficiencyChart.data.datasets[0].data = efficiencies;
                this.efficiencyChart.update('none');
            }
            
            addAlarm(title, message, type = 'warning') {
                const alarm = {
                    id: Date.now(),
                    title,
                    message,
                    type,
                    time: new Date().toLocaleTimeString(),
                    acknowledged: false
                };
                
                this.state.alarms.unshift(alarm);
                
                // Keep only last 20 alarms
                if (this.state.alarms.length > 20) {
                    this.state.alarms.pop();
                }
                
                this.updateAlarmDisplay();
                
                // Show alarm panel if not visible
                if (this.state.alarms.length > 0) {
                    this.elements.alarmPanel.style.display = 'block';
                }
            }
            
            addLog(message) {
                const log = {
                    time: new Date().toLocaleTimeString(),
                    message
                };
                
                this.state.logs.unshift(log);
                
                // Keep only last 100 logs
                if (this.state.logs.length > 100) {
                    this.state.logs.pop();
                }
            }
            
            updateAlarmDisplay() {
                // Update alarm count
                const unacknowledged = this.state.alarms.filter(a => !a.acknowledged).length;
                this.elements.alarmCount.textContent = unacknowledged;
                
                // Update alarm list
                this.elements.alarmList.innerHTML = '';
                
                this.state.alarms.slice(0, 5).forEach(alarm => {
                    const alarmEl = document.createElement('div');
                    alarmEl.className = 'alarm-item';
                    alarmEl.innerHTML = `
                        <div>
                            <strong>${alarm.title}</strong>
                            <div>${alarm.message}</div>
                        </div>
                        <div class="alarm-time">${alarm.time}</div>
                    `;
                    
                    this.elements.alarmList.appendChild(alarmEl);
                });
            }
            
            showAlarms() {
                // Acknowledge all alarms
                this.state.alarms.forEach(alarm => alarm.acknowledged = true);
                this.updateAlarmDisplay();
                
                // Hide alarm panel if no active alarms
                if (this.state.alarms.filter(a => !a.acknowledged).length === 0) {
                    this.elements.alarmPanel.style.display = 'none';
                }
            }
            
            getAvailableCapacity() {
                const onlineTurbines = this.state.turbines.filter(t => t.status === 'ONLINE');
                return onlineTurbines.reduce((sum, turbine) => sum + turbine.maxOutput, 0);
            }
            
            approachValue(current, target, step) {
                if (current < target) {
                    return Math.min(current + step, target);
                } else if (current > target) {
                    return Math.max(current - step, target);
                }
                return current;
            }
            
            handleTurbineAction(turbineId, action) {
                switch (action) {
                    case 'start':
                        this.startTurbine(turbineId);
                        break;
                    case 'sync':
                        this.synchronizeTurbine(turbineId);
                        break;
                    case 'trip':
                        this.tripTurbine(turbineId, 'Manual trip');
                        break;
                }
            }
            
            startSimulation() {
                // Main simulation loop
                const simulationLoop = () => {
                    // Update turbine states
                    this.state.turbines.forEach(turbine => {
                        if (turbine.status === 'STARTING') {
                            turbine.speed = this.approachValue(turbine.speed, 3000, 100);
                            turbine.temperature = this.approachValue(turbine.temperature, 300, 10);
                        } else if (turbine.status === 'RUNNING') {
                            // Maintain running state
                            turbine.speed = 3000 + (Math.random() * 20 - 10);
                        } else if (turbine.status === 'SYNCHRONIZING') {
                            // Approach grid parameters
                            turbine.frequency = this.approachValue(turbine.frequency, 50.0, 0.5);
                            turbine.voltage = this.approachValue(turbine.voltage, 400, 20);
                        } else if (turbine.status === 'ONLINE') {
                            // Small variations
                            turbine.frequency = 50.0 + (Math.random() * 0.2 - 0.1);
                        }
                    });
                    
                    // Auto balance if enabled
                    if (this.state.autoBalance && this.state.gridConnected) {
                        this.distributeLoad();
                    }
                    
                    // Random fault generation (1% chance per second)
                    if (Math.random() < 0.01) {
                        this.generateRandomFault();
                    }
                    
                    this.updateTotalOutput();
                    this.updateSynchronizationStatus();
                    this.renderTurbines();
                };
                
                // Run simulation at 1Hz
                this.intervals.push(setInterval(simulationLoop, 1000));
                
                // Performance monitoring at 2Hz
                this.intervals.push(setInterval(() => {
                    this.updateCharts();
                }, 500));
            }
            
            generateRandomFault() {
                const onlineTurbines = this.state.turbines.filter(t => 
                    ['RUNNING', 'ONLINE', 'SYNCHRONIZING'].includes(t.status)
                );
                
                if (onlineTurbines.length === 0) return;
                
                const faultTypes = [
                    { type: 'Vibration', threshold: 6, message: 'High vibration detected' },
                    { type: 'Temperature', threshold: 620, message: 'High temperature detected' },
                    { type: 'Bearing', threshold: 80, message: 'High bearing temperature' },
                    { type: 'Fuel', threshold: 0.1, message: 'Fuel supply issue' }
                ];
                
                const fault = faultTypes[Math.floor(Math.random() * faultTypes.length)];
                const turbine = onlineTurbines[Math.floor(Math.random() * onlineTurbines.length)];
                
                // Check if fault condition is met
                let conditionMet = false;
                switch (fault.type) {
                    case 'Vibration':
                        conditionMet = turbine.vibration > fault.threshold;
                        break;
                    case 'Temperature':
                        conditionMet = turbine.temperature > fault.threshold;
                        break;
                    case 'Bearing':
                        conditionMet = turbine.bearingTemp > fault.threshold;
                        break;
                    case 'Fuel':
                        conditionMet = Math.random() < fault.threshold;
                        break;
                }
                
                if (conditionMet) {
                    this.addAlarm(`${turbine.name} ${fault.type} Fault`, fault.message, 'warning');
                    
                    // 30% chance of trip
                    if (Math.random() < 0.3) {
                        this.tripTurbine(turbine.id, `${fault.type} fault trip`);
                    }
                }
            }
        }
        
        // Initialize simulator when page loads
        window.addEventListener('DOMContentLoaded', () => {
            window.powerPlant = new PowerPlantSimulator();
        });
    </script>
</body>
</html>