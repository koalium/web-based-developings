<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HVAC Airflow Calculator</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        
        .container {
            background: white;
            border-radius: 10px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }
        
        h1 {
            color: #333;
            text-align: center;
            margin-bottom: 30px;
        }
        
        .section {
            margin-bottom: 25px;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 8px;
            background: #f9f9f9;
        }
        
        .section h3 {
            margin-top: 0;
            color: #555;
            border-bottom: 2px solid #667eea;
            padding-bottom: 10px;
        }
        
        .input-group {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            margin-bottom: 15px;
        }
        
        .input-field {
            flex: 1;
            min-width: 200px;
        }
        
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
            color: #333;
        }
        
        input, select {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
        }
        
        button {
            background: #667eea;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 16px;
            margin: 5px;
            transition: background 0.3s;
        }
        
        button:hover {
            background: #5a67d8;
        }
        
        .results {
            background: #e8f5e8;
            padding: 20px;
            border-radius: 8px;
            margin-top: 20px;
        }
        
        .result-item {
            margin: 10px 0;
            padding: 10px;
            background: white;
            border-radius: 4px;
            border-left: 4px solid #667eea;
        }
        
        .controls {
            text-align: center;
            margin: 20px 0;
        }
        
        .json-area {
            width: 100%;
            height: 200px;
            margin-top: 10px;
            font-family: monospace;
            font-size: 12px;
        }
        
        .velocity-limits {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            padding: 15px;
            border-radius: 6px;
            margin-top: 15px;
        }
        
        .velocity-limits h4 {
            margin-top: 0;
            color: #856404;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>HVAC Airflow Calculator</h1>
        
        <div class="section">
            <h3>Basic Room Parameters</h3>
            <div class="input-group">
                <div class="input-field">
                    <label for="length">Length (m):</label>
                    <input type="number" id="length" step="0.1" value="5">
                </div>
                <div class="input-field">
                    <label for="width">Width (m):</label>
                    <input type="number" id="width" step="0.1" value="4">
                </div>
                <div class="input-field">
                    <label for="height">Height (m):</label>
                    <input type="number" id="height" step="0.1" value="3">
                </div>
                <div class="input-field">
                    <label for="ach">ACH (Air Changes per Hour):</label>
                    <input type="number" id="ach" step="0.1" value="6">
                </div>
            </div>
        </div>

        <div class="section">
            <h3>Return Duct Parameters</h3>
            <div class="input-group">
                <div class="input-field">
                    <label for="returnDuctNumber">Number of Return Ducts:</label>
                    <input type="number" id="returnDuctNumber" value="2">
                </div>
                <div class="input-field">
                    <label for="returnDuctWidth">Duct Width (m):</label>
                    <input type="number" id="returnDuctWidth" step="0.01" value="0.3">
                </div>
                <div class="input-field">
                    <label for="returnDuctHeight">Duct Height (m):</label>
                    <input type="number" id="returnDuctHeight" step="0.01" value="0.2">
                </div>
            </div>
        </div>

        <div class="section">
            <h3>Supply Duct Parameters</h3>
            <div class="input-group">
                <div class="input-field">
                    <label for="supplyDuctNumber">Number of Supply Ducts:</label>
                    <input type="number" id="supplyDuctNumber" value="4">
                </div>
                <div class="input-field">
                    <label for="supplyDuctDiameter">Duct Diameter (m):</label>
                    <input type="number" id="supplyDuctDiameter" step="0.01" value="0.2">
                </div>
            </div>
        </div>

        <div class="section">
            <h3>Return Vent Parameters</h3>
            <div class="input-group">
                <div class="input-field">
                    <label for="returnVentNumber">Number of Return Vents:</label>
                    <input type="number" id="returnVentNumber" value="2">
                </div>
                <div class="input-field">
                    <label for="returnVentWidth">Vent Width (m):</label>
                    <input type="number" id="returnVentWidth" step="0.01" value="0.25">
                </div>
                <div class="input-field">
                    <label for="returnVentLength">Vent Length (m):</label>
                    <input type="number" id="returnVentLength" step="0.01" value="0.15">
                </div>
            </div>
        </div>

        <div class="section">
            <h3>Supply Valve Parameters</h3>
            <div class="input-group">
                <div class="input-field">
                    <label for="supplyValveShape">Valve Shape:</label>
                    <select id="supplyValveShape">
                        <option value="rectangular">Rectangular</option>
                        <option value="circular">Circular</option>
                    </select>
                </div>
                <div class="input-field" id="rectValveInputs">
                    <label for="supplyValveWidth">Valve Width (m):</label>
                    <input type="number" id="supplyValveWidth" step="0.01" value="0.15">
                </div>
                <div class="input-field" id="rectValveInputs2">
                    <label for="supplyValveHeight">Valve Height (m):</label>
                    <input type="number" id="supplyValveHeight" step="0.01" value="0.1">
                </div>
                <div class="input-field" id="circValveInputs" style="display:none;">
                    <label for="supplyValveDiameter">Valve Diameter (m):</label>
                    <input type="number" id="supplyValveDiameter" step="0.01" value="0.15">
                </div>
                <div class="input-field">
                    <label for="supplyValveNumber">Number of Supply Valves:</label>
                    <input type="number" id="supplyValveNumber" value="4">
                </div>
            </div>
        </div>

        <div class="section">
            <h3>Air Velocity Limits (m/s)</h3>
            <div class="input-group">
                <div class="input-field">
                    <label for="ductVelocityMin">Duct Velocity Min:</label>
                    <input type="number" id="ductVelocityMin" step="0.1" value="3">
                </div>
                <div class="input-field">
                    <label for="ductVelocityMax">Duct Velocity Max:</label>
                    <input type="number" id="ductVelocityMax" step="0.1" value="8">
                </div>
                <div class="input-field">
                    <label for="ventVelocityMin">Vent Velocity Min:</label>
                    <input type="number" id="ventVelocityMin" step="0.1" value="1">
                </div>
                <div class="input-field">
                    <label for="ventVelocityMax">Vent Velocity Max:</label>
                    <input type="number" id="ventVelocityMax" step="0.1" value="4">
                </div>
            </div>
        </div>

        <div class="controls">
            <button onclick="hvacCalculator.calculate()">Calculate</button>
            <button onclick="hvacCalculator.saveToJSON()">Save to JSON</button>
            <button onclick="hvacCalculator.loadFromJSON()">Load from JSON</button>
            <button onclick="hvacCalculator.resetCalculator()">Reset</button>
        </div>

        <div id="results" class="results" style="display:none;">
            <h3>Calculation Results</h3>
            <div id="resultsContent"></div>
        </div>

        <div class="section">
            <h3>JSON Data</h3>
            <textarea id="jsonData" class="json-area" placeholder="JSON data will appear here..."></textarea>
        </div>
    </div>

    <script>
        const hvacCalculator = {
            // Default velocity limits
            velocityLimits: {
                ductVelocityMin: 3,
                ductVelocityMax: 8,
                ventVelocityMin: 1,
                ventVelocityMax: 4
            },

            // Initialize the calculator
            init() {
                this.setupEventListeners();
                this.loadVelocityLimits();
            },

            // Setup event listeners
            setupEventListeners() {
                document.getElementById('supplyValveShape').addEventListener('change', this.toggleValveInputs);
                
                // Auto-calculate when inputs change
                const inputs = document.querySelectorAll('input, select');
                inputs.forEach(input => {
                    input.addEventListener('change', () => {
                        if (document.getElementById('results').style.display !== 'none') {
                            this.calculate();
                        }
                    });
                });
            },

            // Toggle valve input fields based on shape
            toggleValveInputs() {
                const shape = document.getElementById('supplyValveShape').value;
                const rectInputs = document.getElementById('rectValveInputs');
                const rectInputs2 = document.getElementById('rectValveInputs2');
                const circInputs = document.getElementById('circValveInputs');
                
                if (shape === 'circular') {
                    rectInputs.style.display = 'none';
                    rectInputs2.style.display = 'none';
                    circInputs.style.display = 'block';
                } else {
                    rectInputs.style.display = 'block';
                    rectInputs2.style.display = 'block';
                    circInputs.style.display = 'none';
                }
            },

            // Load velocity limits from inputs
            loadVelocityLimits() {
                this.velocityLimits = {
                    ductVelocityMin: parseFloat(document.getElementById('ductVelocityMin').value),
                    ductVelocityMax: parseFloat(document.getElementById('ductVelocityMax').value),
                    ventVelocityMin: parseFloat(document.getElementById('ventVelocityMin').value),
                    ventVelocityMax: parseFloat(document.getElementById('ventVelocityMax').value)
                };
            },

            // Get all input values
            getInputValues() {
                return {
                    // Basic parameters
                    length: parseFloat(document.getElementById('length').value),
                    width: parseFloat(document.getElementById('width').value),
                    height: parseFloat(document.getElementById('height').value),
                    ach: parseFloat(document.getElementById('ach').value),
                    
                    // Return duct parameters
                    returnDuctNumber: parseInt(document.getElementById('returnDuctNumber').value),
                    returnDuctWidth: parseFloat(document.getElementById('returnDuctWidth').value),
                    returnDuctHeight: parseFloat(document.getElementById('returnDuctHeight').value),
                    
                    // Supply duct parameters
                    supplyDuctNumber: parseInt(document.getElementById('supplyDuctNumber').value),
                    supplyDuctDiameter: parseFloat(document.getElementById('supplyDuctDiameter').value),
                    
                    // Return vent parameters
                    returnVentNumber: parseInt(document.getElementById('returnVentNumber').value),
                    returnVentWidth: parseFloat(document.getElementById('returnVentWidth').value),
                    returnVentLength: parseFloat(document.getElementById('returnVentLength').value),
                    
                    // Supply valve parameters
                    supplyValveShape: document.getElementById('supplyValveShape').value,
                    supplyValveWidth: parseFloat(document.getElementById('supplyValveWidth').value),
                    supplyValveHeight: parseFloat(document.getElementById('supplyValveHeight').value),
                    supplyValveDiameter: parseFloat(document.getElementById('supplyValveDiameter').value),
                    supplyValveNumber: parseInt(document.getElementById('supplyValveNumber').value),
                    
                    // Velocity limits
                    velocityLimits: {
                        ductVelocityMin: parseFloat(document.getElementById('ductVelocityMin').value),
                        ductVelocityMax: parseFloat(document.getElementById('ductVelocityMax').value),
                        ventVelocityMin: parseFloat(document.getElementById('ventVelocityMin').value),
                        ventVelocityMax: parseFloat(document.getElementById('ventVelocityMax').value)
                    }
                };
            },

            // Set input values
            setInputValues(data) {
                Object.keys(data).forEach(key => {
                    if (key === 'velocityLimits') {
                        Object.keys(data[key]).forEach(limitKey => {
                            const element = document.getElementById(limitKey);
                            if (element) element.value = data[key][limitKey];
                        });
                    } else {
                        const element = document.getElementById(key);
                        if (element) element.value = data[key];
                    }
                });
                this.toggleValveInputs();
            },

            // Check if velocity is within limits
            checkVelocityLimits(velocity, type) {
                const limits = this.velocityLimits;
                let min, max, status;
                
                if (type === 'duct') {
                    min = limits.ductVelocityMin;
                    max = limits.ductVelocityMax;
                } else {
                    min = limits.ventVelocityMin;
                    max = limits.ventVelocityMax;
                }
                
                if (velocity < min) {
                    status = 'LOW';
                } else if (velocity > max) {
                    status = 'HIGH';
                } else {
                    status = 'OK';
                }
                
                return { min, max, status };
            },

            // Main calculation function
            calculate() {
                this.loadVelocityLimits();
                const inputs = this.getInputValues();
                
                // Basic calculations
                const area = inputs.length * inputs.width;
                const volume = area * inputs.height;
                const airflowM3Hr = inputs.ach * volume;
                const airflowM3S = airflowM3Hr / 3600;
                const airflowCFM = airflowM3Hr / 1.699;
                
                // Duct area calculations
                const returnDuctArea = inputs.returnDuctNumber * inputs.returnDuctWidth * inputs.returnDuctHeight;
                const supplyDuctArea = inputs.supplyDuctNumber * Math.PI * Math.pow(inputs.supplyDuctDiameter / 2, 2);
                
                // Air velocity in ducts
                const returnDuctVelocity = airflowM3S / returnDuctArea;
                const supplyDuctVelocity = airflowM3S / supplyDuctArea;
                
                // Return vent area and velocity
                const returnVentArea = inputs.returnVentNumber * inputs.returnVentWidth * inputs.returnVentLength;
                const returnVentVelocity = airflowM3S / returnVentArea;
                
                // Supply valve area and velocity
                let supplyValveArea;
                if (inputs.supplyValveShape === 'circular') {
                    supplyValveArea = inputs.supplyValveNumber * Math.PI * Math.pow(inputs.supplyValveDiameter / 2, 2);
                } else {
                    supplyValveArea = inputs.supplyValveNumber * inputs.supplyValveWidth * inputs.supplyValveHeight;
                }
                const supplyValveVelocity = airflowM3S / supplyValveArea;
                
                // Check velocity limits
                const returnDuctVelCheck = this.checkVelocityLimits(returnDuctVelocity, 'duct');
                const supplyDuctVelCheck = this.checkVelocityLimits(supplyDuctVelocity, 'duct');
                const returnVentVelCheck = this.checkVelocityLimits(returnVentVelocity, 'vent');
                const supplyValveVelCheck = this.checkVelocityLimits(supplyValveVelocity, 'vent');
                
                // Store results
                const results = {
                    inputs: inputs,
                    calculations: {
                        area: area,
                        volume: volume,
                        airflowM3Hr: airflowM3Hr,
                        airflowM3S: airflowM3S,
                        airflowCFM: airflowCFM,
                        returnDuctArea: returnDuctArea,
                        supplyDuctArea: supplyDuctArea,
                        returnDuctVelocity: returnDuctVelocity,
                        supplyDuctVelocity: supplyDuctVelocity,
                        returnVentArea: returnVentArea,
                        returnVentVelocity: returnVentVelocity,
                        supplyValveArea: supplyValveArea,
                        supplyValveVelocity: supplyValveVelocity
                    },
                    velocityChecks: {
                        returnDuctVelCheck: returnDuctVelCheck,
                        supplyDuctVelCheck: supplyDuctVelCheck,
                        returnVentVelCheck: returnVentVelCheck,
                        supplyValveVelCheck: supplyValveVelCheck
                    },
                    timestamp: new Date().toISOString()
                };
                
                this.displayResults(results);
                this.currentResults = results;
            },

            // Display results
            displayResults(results) {
                const resultsDiv = document.getElementById('results');
                const resultsContent = document.getElementById('resultsContent');
                
                const getStatusColor = (status) => {
                    switch(status) {
                        case 'LOW': return '#dc3545';
                        case 'HIGH': return '#fd7e14';
                        case 'OK': return '#28a745';
                        default: return '#6c757d';
                    }
                };
                
                const getStatusText = (check) => {
                    return `${check.status} (${check.min}-${check.max} m/s)`;
                };
                
                resultsContent.innerHTML = `
                    <div class="result-item">
                        <strong>Room Area:</strong> ${results.calculations.area.toFixed(2)} m²
                    </div>
                    <div class="result-item">
                        <strong>Room Volume:</strong> ${results.calculations.volume.toFixed(2)} m³
                    </div>
                    <div class="result-item">
                        <strong>Airflow:</strong> ${results.calculations.airflowM3Hr.toFixed(2)} m³/hr | 
                        ${results.calculations.airflowM3S.toFixed(3)} m³/s | 
                        ${results.calculations.airflowCFM.toFixed(2)} CFM
                    </div>
                    <div class="result-item">
                        <strong>Return Duct Area:</strong> ${results.calculations.returnDuctArea.toFixed(4)} m²
                    </div>
                    <div class="result-item">
                        <strong>Supply Duct Area:</strong> ${results.calculations.supplyDuctArea.toFixed(4)} m²
                    </div>
                    <div class="result-item">
                        <strong>Return Vent Area:</strong> ${results.calculations.returnVentArea.toFixed(4)} m²
                    </div>
                    <div class="result-item">
                        <strong>Supply Valve Area:</strong> ${results.calculations.supplyValveArea.toFixed(4)} m²
                    </div>
                    <div class="result-item">
                        <strong>Return Duct Velocity:</strong> ${results.calculations.returnDuctVelocity.toFixed(2)} m/s
                        <span style="color: ${getStatusColor(results.velocityChecks.returnDuctVelCheck.status)}; font-weight: bold;">
                            ${getStatusText(results.velocityChecks.returnDuctVelCheck)}
                        </span>
                    </div>
                    <div class="result-item">
                        <strong>Supply Duct Velocity:</strong> ${results.calculations.supplyDuctVelocity.toFixed(2)} m/s
                        <span style="color: ${getStatusColor(results.velocityChecks.supplyDuctVelCheck.status)}; font-weight: bold;">
                            ${getStatusText(results.velocityChecks.supplyDuctVelCheck)}
                        </span>
                    </div>
                    <div class="result-item">
                        <strong>Return Vent Velocity:</strong> ${results.calculations.returnVentVelocity.toFixed(2)} m/s
                        <span style="color: ${getStatusColor(results.velocityChecks.returnVentVelCheck.status)}; font-weight: bold;">
                            ${getStatusText(results.velocityChecks.returnVentVelCheck)}
                        </span>
                    </div>
                    <div class="result-item">
                        <strong>Supply Valve Velocity:</strong> ${results.calculations.supplyValveVelocity.toFixed(2)} m/s
                        <span style="color: ${getStatusColor(results.velocityChecks.supplyValveVelCheck.status)}; font-weight: bold;">
                            ${getStatusText(results.velocityChecks.supplyValveVelCheck)}
                        </span>
                    </div>
                `;
                
                resultsDiv.style.display = 'block';
            },

            // Save data to JSON
            saveToJSON() {
                const data = this.currentResults || this.getInputValues();
                const jsonString = JSON.stringify(data, null, 2);
                document.getElementById('jsonData').value = jsonString;
                
                // Also download as file
                const blob = new Blob([jsonString], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = 'hvac_calculation_' + new Date().toISOString().split('T')[0] + '.json';
                a.click();
                URL.revokeObjectURL(url);
            },

            // Load data from JSON
            loadFromJSON() {
                const jsonString = document.getElementById('jsonData').value.trim();
                if (!jsonString) {
                    alert('Please paste JSON data in the textarea first.');
                    return;
                }
                
                try {
                    const data = JSON.parse(jsonString);
                    
                    // If it's a full results object, extract inputs
                    const inputData = data.inputs || data;
                    
                    this.setInputValues(inputData);
                    
                    // If it has calculations, display them
                    if (data.calculations) {
                        this.displayResults(data);
                        this.currentResults = data;
                    }
                    
                    alert('Data loaded successfully!');
                } catch (error) {
                    alert('Invalid JSON format: ' + error.message);
                }
            },

            // Reset calculator
            resetCalculator() {
                document.getElementById('results').style.display = 'none';
                document.getElementById('jsonData').value = '';
                this.currentResults = null;
                
                // Reset to default values
                document.getElementById('length').value = 5;
                document.getElementById('width').value = 4;
                document.getElementById('height').value = 3;
                document.getElementById('ach').value = 6;
                document.getElementById('returnDuctNumber').value = 2;
                document.getElementById('returnDuctWidth').value = 0.3;
                document.getElementById('returnDuctHeight').value = 0.2;
                document.getElementById('supplyDuctNumber').value = 4;
                document.getElementById('supplyDuctDiameter').value = 0.2;
                document.getElementById('returnVentNumber').value = 2;
                document.getElementById('returnVentWidth').value = 0.25;
                document.getElementById('returnVentLength').value = 0.15;
                document.getElementById('supplyValveShape').value = 'rectangular';
                document.getElementById('supplyValveWidth').value = 0.15;
                document.getElementById('supplyValveHeight').value = 0.1;
                document.getElementById('supplyValveDiameter').value = 0.15;
                document.getElementById('supplyValveNumber').value = 4;
                document.getElementById('ductVelocityMin').value = 3;
                document.getElementById('ductVelocityMax').value = 8;
                document.getElementById('ventVelocityMin').value = 1;
                document.getElementById('ventVelocityMax').value = 4;
                
                this.toggleValveInputs();
            }
        };

        // Initialize the calculator when the page loads
        document.addEventListener('DOMContentLoaded', () => {
            hvacCalculator.init();
        });
    </script>
</body>
</html>