<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>سیستم مدیریت سازمانی</title>
    <script src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js" defer></script>
    <script src="https://cdn.jsdelivr.net/npm/persian-date@1.1.0/dist/persian-date.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/persian-datepicker@1.2.0/dist/js/persian-datepicker.min.js"></script>
    
</head>
<body x-data="app()" x-init="initApp()" class="min-h-screen flex flex-col">
    <!-- Login Screen -->
    <template x-if="currentScreen === 'login'">
        <div class="min-h-screen flex items-center justify-center p-4">
            <div class="card p-8 w-full max-w-md">
                <div class="text-center mb-8">
                    <h1 class="text-2xl font-bold mb-2">سیستم مدیریت سازمانی</h1>
                    <p class="text-text-muted">لطفا وارد شوید</p>
                </div>
                
                <form @submit.prevent="handleLogin" class="space-y-4">
                    <div>
                        <label class="form-label">نام کاربری</label>
                        <input type="text" x-model="loginForm.username" class="form-input w-full" required>
                    </div>
                    
                    <div>
                        <label class="form-label">رمز عبور</label>
                        <input type="password" x-model="loginForm.password" class="form-input w-full" required>
                    </div>
                    
                    <button type="submit" class="btn-primary w-full" :disabled="loginLoading">
                        <span x-show="!loginLoading">ورود</span>
                        <span x-show="loginLoading">در حال ورود...</span>
                    </button>
                    
                    <div x-show="loginError" class="mt-4 p-3 bg-red-900 text-red-100 rounded">
                        <span x-text="loginError"></span>
                    </div>
                </form>
                
                <div class="mt-6 text-center text-text-muted">
                    <p>نام کاربری پیشفرض: admin</p>
                    <p>رمز عبور پیشفرض: 654321</p>
                </div>
            </div>
        </div>
    </template>
    
<!-- Main Application -->
    <template x-if="currentScreen === 'main'">
        <div class="flex flex-col h-screen">
            <!-- Top Navigation -->
            <header class="bg-dark-card p-4 flex justify-between items-center border-b border-dark-card-light">
                <div class="flex items-center space-x-4 space-x-reverse">
                    <button @click="toggleSidebar" class="text-text-light">
                        <i class="fas fa-bars"></i>
                    </button>
                    <h1 class="text-xl font-bold">سیستم مدیریت سازمانی</h1>
                </div>
                
                <div class="flex items-center space-x-4 space-x-reverse">
                    <!-- Notifications -->
                    <div class="relative" x-data="{ open: false }">
                        <button @click="open = !open; markNotificationsAsRead()" class="flex items-center space-x-2 space-x-reverse text-text-light relative">
                            <i class="fas fa-bell"></i>
                            <span x-show="unreadNotifications > 0" class="notification-badge" x-text="unreadNotifications"></span>
                        </button>
                        
                        <div x-show="open" @click.outside="open = false" class="absolute left-0 mt-2 w-80 card p-4 z-10">
                            <h3 class="font-bold mb-2">اعلان‌ها</h3>
                            <div class="max-h-64 overflow-y-auto">
                                <template x-for="notification in notifications" :key="notification.id">
                                    <div class="notification" :class="{ 'unread': !notification.read }">
                                        <div class="flex justify-between">
                                            <span x-text="notification.title" class="font-medium"></span>
                                            <span x-text="notification.time" class="text-xs text-text-muted"></span>
                                        </div>
                                        <p x-text="notification.message" class="text-sm mt-1"></p>
                                    </div>
                                </template>
                            </div>
                            <button class="btn-primary w-full mt-2">مشاهده همه</button>
                        </div>
                    </div>
                    
                    <!-- Quick Actions -->
                    <div class="relative" x-data="{ open: false }">
                        <button @click="open = !open" class="flex items-center space-x-2 space-x-reverse text-text-light">
                            <i class="fas fa-bolt"></i>
                        </button>
                        
                        <div x-show="open" @click.outside="open = false" class="absolute left-0 mt-2 w-48 card p-2 z-10">
                            <a href="#" class="block sidebar-item" @click="openTaskModal(); open = false">
                                <i class="fas fa-plus ml-2"></i>
                                وظیفه جدید
                            </a>
                            <a href="#" class="block sidebar-item" @click="openProjectModal(); open = false">
                                <i class="fas fa-project-diagram ml-2"></i>
                                پروژه جدید
                            </a>
                            <a href="#" class="block sidebar-item" @click="openTransactionModal(); open = false">
                                <i class="fas fa-exchange-alt ml-2"></i>
                                تراکنش جدید
                            </a>
                            <hr class="border-dark-card-light my-2">
                            <a href="#" class="block sidebar-item" @click="openReminderModal(); open = false">
                                <i class="fas fa-bell ml-2"></i>
                                یادآور جدید
                            </a>
                        </div>
                    </div>
                    
                    <!-- User Menu -->
                    <div class="relative" x-data="{ open: false }">
                        <button @click="open = !open" class="flex items-center space-x-2 space-x-reverse text-text-light">
                            <i class="fas fa-user-circle text-2xl"></i>
                            <span x-text="currentUser.name"></span>
                            <i class="fas fa-chevron-down text-xs"></i>
                        </button>
                        
                        <div x-show="open" @click.outside="open = false" class="absolute left-0 mt-2 w-48 card p-2 z-10">
                            <a href="#" class="block sidebar-item" @click="changeModule('profile'); open = false">
                                <i class="fas fa-user ml-2"></i>
                                پروفایل
                            </a>
                            <a href="#" class="block sidebar-item" @click="changeModule('settings'); open = false">
                                <i class="fas fa-cog ml-2"></i>
                                تنظیمات
                            </a>
                            <hr class="border-dark-card-light my-2">
                            <button @click="logout" class="block sidebar-item w-full text-right text-red-400">
                                <i class="fas fa-sign-out-alt ml-2"></i>
                                خروج
                            </button>
                        </div>
                    </div>
                </div>
            </header>
            
            <div class="flex flex-1 overflow-hidden">
                <!-- Sidebar -->
                <aside class="sidebar bg-dark-card w-64 flex-shrink-0 overflow-y-auto" :class="{ 'hidden': !sidebarOpen }">
                    <nav class="p-4 space-y-2">
                        <template x-for="item in menuItems" :key="item.id">
                            <div>
                                <a 
                                    href="#" 
                                    class="sidebar-item flex justify-between items-center" 
                                    :class="{ 'active': currentModule === item.id }"
                                    @click="changeModule(item.id)"
                                >
                                    <div class="flex items-center space-x-2 space-x-reverse">
                                        <i :class="item.icon"></i>
                                        <span x-text="item.title"></span>
                                    </div>
                                    <i x-show="item.children" class="fas fa-chevron-down text-xs transition-transform" :class="{ 'rotate-180': item.open }"></i>
                                </a>
                                
                                <div x-show="item.open && item.children" class="mr-4 mt-1 space-y-1">
                                    <template x-for="child in item.children" :key="child.id">
                                        <a 
                                            href="#" 
                                            class="block py-2 px-4 text-sm rounded hover:bg-dark-card-light transition-colors" 
                                            :class="{ 'text-primary': currentModule === child.id }"
                                            @click="changeModule(child.id)"
                                        >
                                            <span x-text="child.title"></span>
                                        </a>
                                    </template>
                                </div>
                            </div>
                        </template>
                    </nav>
                </aside>
                
                <!-- Main Content -->
                <main class="flex-1 overflow-y-auto p-4">
                    <!-- Dashboard (unchanged) -->
                    <template x-if="currentModule === 'dashboard'">
                        <div>
                            <h2 class="text-xl font-bold mb-4">داشبورد</h2>
                            
                            <!-- Stats Cards -->
                            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-6">
                                <div class="stat-card">
                                    <div class="flex justify-between items-start">
                                        <div>
                                            <p class="text-text-muted">وظایف من</p>
                                            <h3 class="text-2xl font-bold mt-2" x-text="dashboardStats.myTasks"></h3>
                                        </div>
                                        <div class="p-3 rounded-full bg-primary bg-opacity-20 text-primary">
                                            <i class="fas fa-tasks"></i>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="stat-card">
                                    <div class="flex justify-between items-start">
                                        <div>
                                            <p class="text-text-muted">پروژه‌های فعال</p>
                                            <h3 class="text-2xl font-bold mt-2" x-text="dashboardStats.activeProjects"></h3>
                                        </div>
                                        <div class="p-3 rounded-full bg-blue-500 bg-opacity-20 text-blue-500">
                                            <i class="fas fa-project-diagram"></i>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="stat-card">
                                    <div class="flex justify-between items-start">
                                        <div>
                                            <p class="text-text-muted">موجودی کل</p>
                                            <h3 class="text-2xl font-bold mt-2" x-text="formatCurrency(dashboardStats.totalBalance)"></h3>
                                        </div>
                                        <div class="p-3 rounded-full bg-green-500 bg-opacity-20 text-green-500">
                                            <i class="fas fa-wallet"></i>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="stat-card">
                                    <div class="flex justify-between items-start">
                                        <div>
                                            <p class="text-text-muted">یادآورهای امروز</p>
                                            <h3 class="text-2xl font-bold mt-2" x-text="dashboardStats.todayReminders"></h3>
                                        </div>
                                        <div class="p-3 rounded-full bg-yellow-500 bg-opacity-20 text-yellow-500">
                                            <i class="fas fa-bell"></i>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Tabs -->
                            <div class="mb-4 border-b border-dark-card-light">
                                <div class="flex space-x-1 space-x-reverse">
                                    <button 
                                        class="tab" 
                                        :class="{ 'active': dashboardTab === 'activities' }"
                                        @click="dashboardTab = 'activities'"
                                    >
                                        فعالیت‌های اخیر
                                    </button>
                                    <button 
                                        class="tab" 
                                        :class="{ 'active': dashboardTab === 'tasks' }"
                                        @click="dashboardTab = 'tasks'"
                                    >
                                        وظایف امروز
                                    </button>
                                    <button 
                                        class="tab" 
                                        :class="{ 'active': dashboardTab === 'progress' }"
                                        @click="dashboardTab = 'progress'"
                                    >
                                        پیشرفت پروژه‌ها
                                    </button>
                                </div>
                            </div>
                            
                            <!-- Tab Content -->
                            <div>
                                <!-- Activities -->
                                <template x-if="dashboardTab === 'activities'">
                                    <div class="card p-4">
                                        <h3 class="font-bold mb-4">فعالیت‌های اخیر</h3>
                                        <div class="space-y-3">
                                            <template x-for="activity in recentActivities" :key="activity.id">
                                                <div class="flex items-start space-x-3 space-x-reverse">
                                                    <div class="p-2 rounded-full bg-dark-card-light mt-1">
                                                        <i :class="activity.icon" class="text-primary"></i>
                                                    </div>
                                                    <div class="flex-1">
                                                        <p x-text="activity.description"></p>
                                                        <p class="text-xs text-text-muted mt-1" x-text="activity.time"></p>
                                                    </div>
                                                </div>
                                            </template>
                                        </div>
                                    </div>
                                </template>
                                
                                <!-- Today's Tasks -->
                                <template x-if="dashboardTab === 'tasks'">
                                    <div class="card p-4">
                                        <h3 class="font-bold mb-4">وظایف امروز</h3>
                                        <div class="space-y-3">
                                            <template x-for="task in todaysTasks" :key="task.id">
                                                <div class="flex items-center justify-between p-3 bg-dark-card-light rounded">
                                                    <div class="flex items-center space-x-3 space-x-reverse">
                                                        <input type="checkbox" x-model="task.completed" class="rounded text-primary">
                                                        <span :class="{ 'line-through text-text-muted': task.completed }" x-text="task.title"></span>
                                                    </div>
                                                    <div class="flex items-center space-x-2 space-x-reverse">
                                                        <span class="text-xs px-2 py-1 rounded" :class="getPriorityClass(task.priority)" x-text="task.priorityText"></span>
                                                        <span class="text-xs text-text-muted" x-text="task.time"></span>
                                                    </div>
                                                </div>
                                            </template>
                                        </div>
                                    </div>
                                </template>
                                
                                <!-- Project Progress -->
                                <template x-if="dashboardTab === 'progress'">
                                    <div class="card p-4">
                                        <h3 class="font-bold mb-4">پیشرفت پروژه‌ها</h3>
                                        <div class="space-y-4">
                                            <template x-for="project in projectProgress" :key="project.id">
                                                <div>
                                                    <div class="flex justify-between mb-1">
                                                        <span x-text="project.name"></span>
                                                        <span x-text="project.progress + '%'"></span>
                                                    </div>
                                                    <div class="progress-bar">
                                                        <div class="progress-fill" :style="'width: ' + project.progress + '%'"></div>
                                                    </div>
                                                </div>
                                            </template>
                                        </div>
                                    </div>
                                </template>
                            </div>
                        </div>
                    </template>
                        <!-- Calendar (unchanged) -->
                    <template x-if="currentModule === 'calendar'">
                        <div>
                            <h2 class="text-xl font-bold mb-4">تقویم</h2>
                            <div class="card p-4">
                                <div class="flex justify-between items-center mb-4">
                                    <h3 class="font-bold" x-text="calendarTitle"></h3>
                                    <div class="flex space-x-2 space-x-reverse">
                                        <button class="btn-primary" @click="prevMonth">
                                            <i class="fas fa-chevron-right"></i>
                                        </button>
                                        <button class="btn-primary" @click="nextMonth">
                                            <i class="fas fa-chevron-left"></i>
                                        </button>
                                        <button class="btn-primary" @click="goToToday">
                                            امروز
                                        </button>
                                    </div>
                                </div>
                                
                                <div class="grid grid-cols-7 gap-1 mb-2">
                                    <template x-for="day in persianWeekDays" :key="day">
                                        <div class="text-center py-2 font-bold" x-text="day"></div>
                                    </template>
                                </div>
                                
                                <div class="grid grid-cols-7 gap-1">
                                    <template x-for="day in calendarDays" :key="day.date">
                                        <div 
                                            class="calendar-day" 
                                            :class="{
                                                'today': day.isToday,
                                                'event': day.hasEvent,
                                                'text-text-muted': !day.isCurrentMonth
                                            }"
                                            @click="openDayEvents(day)"
                                        >
                                            <span x-text="day.day"></span>
                                        </div>
                                    </template>
                                </div>
                            </div>
                        </div>
                    </template>

                    <!-- Tasks (unchanged) -->
                    <template x-if="currentModule === 'tasks'">
                        <div>
                            <h2 class="text-xl font-bold mb-4">مدیریت وظایف</h2>
                            <div class="card p-4">
                                <div class="flex justify-between items-center mb-4">
                                    <button class="btn-primary" @click="openTaskModal()">
                                        <i class="fas fa-plus ml-2"></i>
                                        وظیفه جدید
                                    </button>
                                    
                                    <div class="flex space-x-2 space-x-reverse">
                                        <input type="text" placeholder="جستجو..." class="form-input" x-model="taskSearch">
                                        <select class="form-input" x-model="taskFilter">
                                            <option value="all">همه</option>
                                            <option value="active">فعال</option>
                                            <option value="completed">تکمیل شده</option>
                                        </select>
                                    </div>
                                </div>
                                
                                <div class="overflow-x-auto">
                                    <table class="w-full">
                                        <thead>
                                            <tr class="text-right border-b border-dark-card-light">
                                                <th class="py-2 px-4">عنوان</th>
                                                <th class="py-2 px-4">پروژه</th>
                                                <th class="py-2 px-4">اولویت</th>
                                                <th class="py-2 px-4">وضعیت</th>
                                                <th class="py-2 px-4">تاریخ</th>
                                                <th class="py-2 px-4">عملیات</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <template x-for="task in filteredTasks" :key="task.id">
                                                <tr class="table-row">
                                                    <td class="py-3 px-4" x-text="task.title"></td>
                                                    <td class="py-3 px-4" x-text="task.project"></td>
                                                    <td class="py-3 px-4">
                                                        <span class="text-xs px-2 py-1 rounded" :class="getPriorityClass(task.priority)" x-text="task.priorityText"></span>
                                                    </td>
                                                    <td class="py-3 px-4">
                                                        <span class="text-xs px-2 py-1 rounded" :class="task.completed ? 'bg-green-900 text-green-100' : 'bg-yellow-900 text-yellow-100'" x-text="task.completed ? 'تکمیل شده' : 'در حال انجام'"></span>
                                                    </td>
                                                    <td class="py-3 px-4" x-text="task.date"></td>
                                                    <td class="py-3 px-4">
                                                        <div class="flex space-x-2 space-x-reverse">
                                                            <button class="text-blue-400" @click="openTaskModal(task)">
                                                                <i class="fas fa-edit"></i>
                                                            </button>
                                                            <button class="text-red-400" @click="deleteTask(task.id)">
                                                                <i class="fas fa-trash"></i>
                                                            </button>
                                                        </div>
                                                    </td>
                                                </tr>
                                            </template>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </template>
                    
                    <!-- Projects (unchanged) -->
                    <template x-if="currentModule === 'projects'">
                        <div>
                            <h2 class="text-xl font-bold mb-4">مدیریت پروژه‌ها</h2>
                            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                                <template x-for="project in projects" :key="project.id">
                                    <div class="card p-4">
                                        <div class="flex justify-between items-start mb-4">
                                            <h3 class="font-bold" x-text="project.name"></h3>
                                            <span class="text-xs px-2 py-1 rounded" :class="getStatusClass(project.status)" x-text="project.statusText"></span>
                                        </div>
                                        
                                        <p class="text-text-muted text-sm mb-4" x-text="project.description"></p>
                                        
                                        <div class="mb-4">
                                            <div class="flex justify-between text-sm mb-1">
                                                <span>پیشرفت</span>
                                                <span x-text="project.progress + '%'"></span>
                                            </div>
                                            <div class="progress-bar">
                                                <div class="progress-fill" :style="'width: ' + project.progress + '%'"></div>
                                            </div>
                                        </div>
                                        
                                        <div class="flex justify-between text-sm text-text-muted">
                                            <div>
                                                <i class="fas fa-calendar ml-1"></i>
                                                <span x-text="project.endDate"></span>
                                            </div>
                                            <div>
                                                <i class="fas fa-users ml-1"></i>
                                                <span x-text="project.teamSize"></span>
                                            </div>
                                        </div>
                                        
                                        <div class="flex justify-between mt-4">
                                            <button class="text-primary text-sm" @click="openProjectModal(project)">
                                                <i class="fas fa-eye ml-1"></i>
                                                مشاهده جزئیات
                                            </button>
                                            <button class="text-text-muted text-sm" @click="openProjectModal(project)">
                                                <i class="fas fa-edit ml-1"></i>
                                                ویرایش
                                            </button>
                                        </div>
                                    </div>
                                </template>
                            </div>
                        </div>
                    </template>
                    
                
                    <!-- Financial Management -->
                    <template x-if="currentModule === 'transactions'">
                        <div>
                            <h2 class="text-xl font-bold mb-4">مدیریت تراکنش‌ها</h2>
                            <div class="card p-4">
                                <div class="flex justify-between items-center mb-4">
                                    <button class="btn-primary" @click="openTransactionModal()">
                                        <i class="fas fa-plus ml-2"></i>
                                        تراکنش جدید
                                    </button>
                                    
                                    <div class="flex items-center space-x-4 space-x-reverse">
                                        <div class="bg-green-900 text-green-100 px-3 py-1 rounded">
                                            <span>درآمد: </span>
                                            <span x-text="formatCurrency(totalIncome)"></span>
                                        </div>
                                        <div class="bg-red-900 text-red-100 px-3 py-1 rounded">
                                            <span>هزینه: </span>
                                            <span x-text="formatCurrency(totalExpense)"></span>
                                        </div>
                                        <div class="bg-blue-900 text-blue-100 px-3 py-1 rounded">
                                            <span>موجودی: </span>
                                            <span x-text="formatCurrency(totalBalance)"></span>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="overflow-x-auto">
                                    <table class="w-full">
                                        <thead>
                                            <tr class="text-right border-b border-dark-card-light">
                                                <th class="py-2 px-4">عنوان</th>
                                                <th class="py-2 px-4">نوع</th>
                                                <th class="py-2 px-4">مبلغ</th>
                                                <th class="py-2 px-4">تاریخ</th>
                                                <th class="py-2 px-4">دسته‌بندی</th>
                                                <th class="py-2 px-4">پروژه</th>
                                                <th class="py-2 px-4">عملیات</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <template x-for="transaction in transactions" :key="transaction.id">
                                                <tr class="table-row">
                                                    <td class="py-3 px-4" x-text="transaction.title"></td>
                                                    <td class="py-3 px-4">
                                                        <span class="text-xs px-2 py-1 rounded" :class="transaction.type === 'income' ? 'bg-green-900 text-green-100' : 'bg-red-900 text-red-100'" x-text="transaction.type === 'income' ? 'درآمد' : 'هزینه'"></span>
                                                    </td>
                                                    <td class="py-3 px-4" :class="transaction.type === 'income' ? 'text-green-400' : 'text-red-400'" x-text="formatCurrency(transaction.amount)"></td>
                                                    <td class="py-3 px-4" x-text="transaction.date"></td>
                                                    <td class="py-3 px-4" x-text="transaction.category"></td>
                                                    <td class="py-3 px-4" x-text="transaction.project"></td>
                                                    <td class="py-3 px-4">
                                                        <div class="flex space-x-2 space-x-reverse">
                                                            <button class="text-blue-400" @click="openTransactionModal(transaction)">
                                                                <i class="fas fa-edit"></i>
                                                            </button>
                                                            <button class="text-red-400" @click="deleteTransaction(transaction.id)">
                                                                <i class="fas fa-trash"></i>
                                                            </button>
                                                        </div>
                                                    </td>
                                                </tr>
                                            </template>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </template>

                    <!-- Contacts Management -->
                    <template x-if="currentModule === 'contacts'">
                        <div>
                            <h2 class="text-xl font-bold mb-4">مدیریت مخاطبین</h2>
                            <div class="card p-4">
                                <div class="flex justify-between items-center mb-4">
                                    <button class="btn-primary" @click="openContactModal()">
                                        <i class="fas fa-plus ml-2"></i>
                                        مخاطب جدید
                                    </button>
                                    
                                    <div class="flex space-x-2 space-x-reverse">
                                        <input type="text" placeholder="جستجو..." class="form-input" x-model="contactSearch">
                                        <select class="form-input" x-model="contactFilter">
                                            <option value="all">همه</option>
                                            <option value="person">شخص حقیقی</option>
                                            <option value="company">شخص حقوقی</option>
                                        </select>
                                    </div>
                                </div>
                                
                                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                                    <template x-for="contact in filteredContacts" :key="contact.id">
                                        <div class="contact-card card p-4">
                                            <div class="flex items-start justify-between mb-3">
                                                <div class="flex items-center space-x-3 space-x-reverse">
                                                    <div class="w-12 h-12 rounded-full bg-primary flex items-center justify-center text-white">
                                                        <i class="fas fa-user"></i>
                                                    </div>
                                                    <div>
                                                        <h3 class="font-bold" x-text="contact.name"></h3>
                                                        <p class="text-sm text-text-muted" x-text="contact.type === 'person' ? 'شخص حقیقی' : 'شخص حقوقی'"></p>
                                                    </div>
                                                </div>
                                                <span class="text-xs px-2 py-1 rounded" :class="contact.role === 'customer' ? 'bg-blue-900 text-blue-100' : 'bg-green-900 text-green-100'" x-text="contact.role === 'customer' ? 'مشتری' : 'تأمین‌کننده'"></span>
                                            </div>
                                            
                                            <div class="space-y-2 text-sm">
                                                <div class="flex items-center space-x-2 space-x-reverse">
                                                    <i class="fas fa-phone text-text-muted"></i>
                                                    <span x-text="contact.phone"></span>
                                                </div>
                                                <div class="flex items-center space-x-2 space-x-reverse" x-show="contact.email">
                                                    <i class="fas fa-envelope text-text-muted"></i>
                                                    <span x-text="contact.email"></span>
                                                </div>
                                                <div class="flex items-center space-x-2 space-x-reverse" x-show="contact.company">
                                                    <i class="fas fa-building text-text-muted"></i>
                                                    <span x-text="contact.company"></span>
                                                </div>
                                            </div>
                                            
                                            <div class="flex justify-between mt-4">
                                                <button class="text-primary text-sm" @click="openContactModal(contact)">
                                                    <i class="fas fa-eye ml-1"></i>
                                                    جزئیات
                                                </button>
                                                <button class="text-text-muted text-sm" @click="openContactModal(contact)">
                                                    <i class="fas fa-edit ml-1"></i>
                                                    ویرایش
                                                </button>
                                            </div>
                                        </div>
                                    </template>
                                </div>
                            </div>
                        </div>
                    </template>

                    <!-- Team Collaboration -->
                    <template x-if="currentModule === 'teams'">
                        <div>
                            <h2 class="text-xl font-bold mb-4">مدیریت تیم‌ها</h2>
                            <div class="card p-4">
                                <div class="flex justify-between items-center mb-4">
                                    <button class="btn-primary" @click="openTeamModal()">
                                        <i class="fas fa-plus ml-2"></i>
                                        تیم جدید
                                    </button>
                                    
                                    <div class="flex space-x-2 space-x-reverse">
                                        <input type="text" placeholder="جستجو..." class="form-input" x-model="teamSearch">
                                    </div>
                                </div>
                                
                                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                                    <template x-for="team in filteredTeams" :key="team.id">
                                        <div class="card p-4">
                                            <div class="flex items-start justify-between mb-3">
                                                <h3 class="font-bold" x-text="team.name"></h3>
                                                <span class="text-xs px-2 py-1 rounded bg-primary text-white" x-text="team.members.length + ' عضو'"></span>
                                            </div>
                                            
                                            <p class="text-text-muted text-sm mb-4" x-text="team.description"></p>
                                            
                                            <div class="mb-4">
                                                <div class="flex justify-between text-sm mb-1">
                                                    <span>پیشرفت پروژه‌ها</span>
                                                    <span x-text="team.progress + '%'"></span>
                                                </div>
                                                <div class="progress-bar">
                                                    <div class="progress-fill" :style="'width: ' + team.progress + '%'"></div>
                                                </div>
                                            </div>
                                            
                                            <div class="flex -space-x-2">
                                                <template x-for="member in team.members.slice(0, 5)" :key="member.id">
                                                    <div class="team-member w-8 h-8 rounded-full bg-dark-card-light flex items-center justify-center text-xs border-2 border-dark-card" :class="{ 'online': member.online }" :title="member.name"></div>
                                                </template>
                                                <div x-show="team.members.length > 5" class="w-8 h-8 rounded-full bg-dark-card-light flex items-center justify-center text-xs border-2 border-dark-card">
                                                    <span x-text="'+' + (team.members.length - 5)"></span>
                                                </div>
                                            </div>
                                            
                                            <div class="flex justify-between mt-4">
                                                <button class="text-primary text-sm" @click="openTeamModal(team)">
                                                    <i class="fas fa-eye ml-1"></i>
                                                    مشاهده
                                                </button>
                                                <button class="text-text-muted text-sm" @click="openTeamModal(team)">
                                                    <i class="fas fa-edit ml-1"></i>
                                                    ویرایش
                                                </button>
                                            </div>
                                        </div>
                                    </template>
                                </div>
                            </div>
                        </div>
                    </template>

                    <!-- File Management -->
                    <template x-if="currentModule === 'fileshare'">
                        <div>
                            <h2 class="text-xl font-bold mb-4">مدیریت فایل‌ها</h2>
                            <div class="card p-4">
                                <div class="flex justify-between items-center mb-4">
                                    <button class="btn-primary" @click="openFileUploadModal()">
                                        <i class="fas fa-upload ml-2"></i>
                                        آپلود فایل
                                    </button>
                                    
                                    <div class="flex space-x-2 space-x-reverse">
                                        <input type="text" placeholder="جستجو..." class="form-input" x-model="fileSearch">
                                        <select class="form-input" x-model="fileFilter">
                                            <option value="all">همه</option>
                                            <option value="document">اسناد</option>
                                            <option value="image">تصاویر</option>
                                            <option value="archive">آرشیو</option>
                                        </select>
                                    </div>
                                </div>
                                
                                <div class="overflow-x-auto">
                                    <table class="w-full">
                                        <thead>
                                            <tr class="text-right border-b border-dark-card-light">
                                                <th class="py-2 px-4">نام فایل</th>
                                                <th class="py-2 px-4">نوع</th>
                                                <th class="py-2 px-4">حجم</th>
                                                <th class="py-2 px-4">تاریخ آپلود</th>
                                                <th class="py-2 px-4">آپلود کننده</th>
                                                <th class="py-2 px-4">عملیات</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <template x-for="file in filteredFiles" :key="file.id">
                                                <tr class="table-row file-item">
                                                    <td class="py-3 px-4">
                                                        <div class="flex items-center space-x-2 space-x-reverse">
                                                            <i :class="getFileIcon(file.type)" class="text-primary"></i>
                                                            <span x-text="file.name"></span>
                                                        </div>
                                                    </td>
                                                    <td class="py-3 px-4">
                                                        <span class="text-xs px-2 py-1 rounded bg-dark-card-light" x-text="file.type"></span>
                                                    </td>
                                                    <td class="py-3 px-4" x-text="file.size"></td>
                                                    <td class="py-3 px-4" x-text="file.uploadDate"></td>
                                                    <td class="py-3 px-4" x-text="file.uploader"></td>
                                                    <td class="py-3 px-4">
                                                        <div class="flex space-x-2 space-x-reverse">
                                                            <button class="text-blue-400">
                                                                <i class="fas fa-download"></i>
                                                            </button>
                                                            <button class="text-green-400">
                                                                <i class="fas fa-share"></i>
                                                            </button>
                                                            <button class="text-red-400" @click="deleteFile(file.id)">
                                                                <i class="fas fa-trash"></i>
                                                            </button>
                                                        </div>
                                                    </td>
                                                </tr>
                                            </template>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </template>

                    <!-- User Management -->
                    <template x-if="currentModule === 'users'">
                        <div>
                            <h2 class="text-xl font-bold mb-4">مدیریت کاربران</h2>
                            <div class="card p-4">
                                <div class="flex justify-between items-center mb-4">
                                    <button class="btn-primary" @click="openUserModal()">
                                        <i class="fas fa-plus ml-2"></i>
                                        کاربر جدید
                                    </button>
                                    
                                    <div class="flex space-x-2 space-x-reverse">
                                        <input type="text" placeholder="جستجو..." class="form-input" x-model="userSearch">
                                        <select class="form-input" x-model="userFilter">
                                            <option value="all">همه</option>
                                            <option value="active">فعال</option>
                                            <option value="inactive">غیرفعال</option>
                                        </select>
                                    </div>
                                </div>
                                
                                <div class="overflow-x-auto">
                                    <table class="w-full">
                                        <thead>
                                            <tr class="text-right border-b border-dark-card-light">
                                                <th class="py-2 px-4">کاربر</th>
                                                <th class="py-2 px-4">نقش</th>
                                                <th class="py-2 px-4">ایمیل</th>
                                                <th class="py-2 px-4">تلفن</th>
                                                <th class="py-2 px-4">وضعیت</th>
                                                <th class="py-2 px-4">آخرین ورود</th>
                                                <th class="py-2 px-4">عملیات</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <template x-for="user in filteredUsers" :key="user.id">
                                                <tr class="table-row">
                                                    <td class="py-3 px-4">
                                                        <div class="flex items-center space-x-2 space-x-reverse">
                                                            <div class="w-8 h-8 rounded-full flex items-center justify-center text-white text-xs" :class="getUserRoleClass(user.role)">
                                                                <i class="fas fa-user"></i>
                                                            </div>
                                                            <div>
                                                                <span x-text="user.name"></span>
                                                                <p class="text-xs text-text-muted" x-text="user.username"></p>
                                                            </div>
                                                        </div>
                                                    </td>
                                                    <td class="py-3 px-4">
                                                        <span class="text-xs px-2 py-1 rounded" :class="getUserRoleBadgeClass(user.role)" x-text="user.roleText"></span>
                                                    </td>
                                                    <td class="py-3 px-4" x-text="user.email"></td>
                                                    <td class="py-3 px-4" x-text="user.phone"></td>
                                                    <td class="py-3 px-4">
                                                        <span class="text-xs px-2 py-1 rounded" :class="user.active ? 'bg-green-900 text-green-100' : 'bg-red-900 text-red-100'" x-text="user.active ? 'فعال' : 'غیرفعال'"></span>
                                                    </td>
                                                    <td class="py-3 px-4" x-text="user.lastLogin"></td>
                                                    <td class="py-3 px-4">
                                                        <div class="flex space-x-2 space-x-reverse">
                                                            <button class="text-blue-400" @click="openUserModal(user)">
                                                                <i class="fas fa-edit"></i>
                                                            </button>
                                                            <button class="text-yellow-400" @click="toggleUserStatus(user.id)">
                                                                <i class="fas fa-power-off"></i>
                                                            </button>
                                                            <button class="text-red-400" @click="deleteUser(user.id)" x-show="user.id !== currentUser.id">
                                                                <i class="fas fa-trash"></i>
                                                            </button>
                                                        </div>
                                                    </td>
                                                </tr>
                                            </template>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </template>

                    <!-- Reports -->
                    <template x-if="currentModule === 'reports'">
                        <div>
                            <h2 class="text-xl font-bold mb-4">گزارش‌ها و آمار</h2>
                            <div class="card p-4">
                                <div class="mb-4 border-b border-dark-card-light">
                                    <div class="flex space-x-1 space-x-reverse">
                                        <button 
                                            class="tab" 
                                            :class="{ 'active': reportsTab === 'financial' }"
                                            @click="reportsTab = 'financial'"
                                        >
                                            مالی
                                        </button>
                                        <button 
                                            class="tab" 
                                            :class="{ 'active': reportsTab === 'projects' }"
                                            @click="reportsTab = 'projects'"
                                        >
                                            پروژه‌ها
                                        </button>
                                        <button 
                                            class="tab" 
                                            :class="{ 'active': reportsTab === 'tasks' }"
                                            @click="reportsTab = 'tasks'"
                                        >
                                            وظایف
                                        </button>
                                        <button 
                                            class="tab" 
                                            :class="{ 'active': reportsTab === 'users' }"
                                            @click="reportsTab = 'users'"
                                        >
                                            کاربران
                                        </button>
                                    </div>
                                </div>
                                
                                <div>
                                    <!-- Financial Reports -->
                                    <template x-if="reportsTab === 'financial'">
                                        <div class="space-y-6">
                                            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                                <div class="card p-4">
                                                    <h3 class="font-bold mb-4">درآمد و هزینه</h3>
                                                    <div class="chart-container">
                                                        <!-- Placeholder for chart -->
                                                        <div class="w-full h-full flex items-center justify-center bg-dark-card-light rounded">
                                                            <p class="text-text-muted">نمودار درآمد و هزینه</p>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="card p-4">
                                                    <h3 class="font-bold mb-4">تراکنش‌ها بر اساس دسته‌بندی</h3>
                                                    <div class="chart-container">
                                                        <!-- Placeholder for chart -->
                                                        <div class="w-full h-full flex items-center justify-center bg-dark-card-light rounded">
                                                            <p class="text-text-muted">نمودار دسته‌بندی‌ها</p>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            
                                            <div class="card p-4">
                                                <h3 class="font-bold mb-4">خلاصه مالی</h3>
                                                <div class="overflow-x-auto">
                                                    <table class="w-full">
                                                        <thead>
                                                            <tr class="text-right border-b border-dark-card-light">
                                                                <th class="py-2 px-4">دوره</th>
                                                                <th class="py-2 px-4">درآمد</th>
                                                                <th class="py-2 px-4">هزینه</th>
                                                                <th class="py-2 px-4">سود/زیان</th>
                                                                <th class="py-2 px-4">موجودی</th>
                                                            </tr>
                                                        </thead>
                                                        <tbody>
                                                            <template x-for="report in financialReports" :key="report.period">
                                                                <tr class="table-row">
                                                                    <td class="py-3 px-4" x-text="report.period"></td>
                                                                    <td class="py-3 px-4 text-green-400" x-text="formatCurrency(report.income)"></td>
                                                                    <td class="py-3 px-4 text-red-400" x-text="formatCurrency(report.expense)"></td>
                                                                    <td class="py-3 px-4" :class="report.profit >= 0 ? 'text-green-400' : 'text-red-400'" x-text="formatCurrency(report.profit)"></td>
                                                                    <td class="py-3 px-4" x-text="formatCurrency(report.balance)"></td>
                                                                </tr>
                                                            </template>
                                                        </tbody>
                                                    </table>
                                                </div>
                                            </div>
                                        </div>
                                    </template>
                                    
                                    <!-- Project Reports -->
                                    <template x-if="reportsTab === 'projects'">
                                        <div class="space-y-6">
                                            <div class="card p-4">
                                                <h3 class="font-bold mb-4">پیشرفت پروژه‌ها</h3>
                                                <div class="space-y-4">
                                                    <template x-for="project in projectProgress" :key="project.id">
                                                        <div>
                                                            <div class="flex justify-between mb-1">
                                                                <span x-text="project.name"></span>
                                                                <span x-text="project.progress + '%'"></span>
                                                            </div>
                                                            <div class="progress-bar">
                                                                <div class="progress-fill" :style="'width: ' + project.progress + '%'"></div>
                                                            </div>
                                                        </div>
                                                    </template>
                                                </div>
                                            </div>
                                            
                                            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                                <div class="card p-4">
                                                    <h3 class="font-bold mb-4">وضعیت پروژه‌ها</h3>
                                                    <div class="chart-container">
                                                        <!-- Placeholder for chart -->
                                                        <div class="w-full h-full flex items-center justify-center bg-dark-card-light rounded">
                                                            <p class="text-text-muted">نمودار وضعیت پروژه‌ها</p>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="card p-4">
                                                    <h3 class="font-bold mb-4">تیم‌های پروژه</h3>
                                                    <div class="chart-container">
                                                        <!-- Placeholder for chart -->
                                                        <div class="w-full h-full flex items-center justify-center bg-dark-card-light rounded">
                                                            <p class="text-text-muted">نمودار تیم‌ها</p>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </template>
                                </div>
                            </div>
                        </div>
                    </template>

                    <!-- Settings (unchanged) -->
                    <template x-if="currentModule === 'settings'">
                        <div>
                            <h2 class="text-xl font-bold mb-4">تنظیمات</h2>
                            
                            <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                                <!-- Sidebar -->
                                <div class="lg:col-span-1">
                                    <div class="card p-4">
                                        <div class="space-y-2">
                                            <button 
                                                class="sidebar-item w-full text-right" 
                                                :class="{ 'active': settingsTab === 'profile' }"
                                                @click="settingsTab = 'profile'"
                                            >
                                                <i class="fas fa-user ml-2"></i>
                                                پروفایل
                                            </button>
                                            <button 
                                                class="sidebar-item w-full text-right" 
                                                :class="{ 'active': settingsTab === 'preferences' }"
                                                @click="settingsTab = 'preferences'"
                                            >
                                                <i class="fas fa-palette ml-2"></i>
                                                تنظیمات ظاهری
                                            </button>
                                            <button 
                                                class="sidebar-item w-full text-right" 
                                                :class="{ 'active': settingsTab === 'connect' }"
                                                @click="settingsTab = 'connect'"
                                            >
                                                <i class="fas fa-wifi ml-2"></i>
                                                اتصال
                                            </button>
                                            <button 
                                                class="sidebar-item w-full text-right" 
                                                :class="{ 'active': settingsTab === 'database' }"
                                                @click="settingsTab = 'database'"
                                            >
                                                <i class="fas fa-database ml-2"></i>
                                                پایگاه داده
                                            </button>
                                            <button 
                                                class="sidebar-item w-full text-right" 
                                                :class="{ 'active': settingsTab === 'options' }"
                                                @click="settingsTab = 'options'"
                                            >
                                                <i class="fas fa-cog ml-2"></i>
                                                گزینه‌ها
                                            </button>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Content -->
                                <div class="lg:col-span-2">
                                    <div class="card p-4">
                                        <!-- Profile -->
                                        <template x-if="settingsTab === 'profile'">
                                            <div>
                                                <h3 class="font-bold mb-4">پروفایل کاربر</h3>
                                                <div class="space-y-4">
                                                    <div class="flex items-center space-x-4 space-x-reverse">
                                                        <div class="w-20 h-20 rounded-full bg-primary flex items-center justify-center text-white text-2xl">
                                                            <i class="fas fa-user"></i>
                                                        </div>
                                                        <div>
                                                            <button class="btn-primary">تغییر عکس</button>
                                                            <p class="text-sm text-text-muted mt-1">فرمت‌های مجاز: JPG, PNG (حداکثر 2MB)</p>
                                                        </div>
                                                    </div>
                                                    
                                                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                                        <div>
                                                            <label class="form-label">نام کاربری</label>
                                                            <input type="text" class="form-input w-full" x-model="userProfile.username">
                                                        </div>
                                                        <div>
                                                            <label class="form-label">ایمیل</label>
                                                            <input type="email" class="form-input w-full" x-model="userProfile.email">
                                                        </div>
                                                        <div>
                                                            <label class="form-label">نام</label>
                                                            <input type="text" class="form-input w-full" x-model="userProfile.firstName">
                                                        </div>
                                                        <div>
                                                            <label class="form-label">نام خانوادگی</label>
                                                            <input type="text" class="form-input w-full" x-model="userProfile.lastName">
                                                        </div>
                                                        <div>
                                                            <label class="form-label">تلفن</label>
                                                            <input type="tel" class="form-input w-full" x-model="userProfile.phone">
                                                        </div>
                                                        <div>
                                                            <label class="form-label">موبایل</label>
                                                            <input type="tel" class="form-input w-full" x-model="userProfile.mobile">
                                                        </div>
                                                    </div>
                                                    
                                                    <div>
                                                        <label class="form-label">آدرس</label>
                                                        <textarea class="form-input w-full" rows="3" x-model="userProfile.address"></textarea>
                                                    </div>
                                                    
                                                    <div class="flex justify-end">
                                                        <button class="btn-primary">ذخیره تغییرات</button>
                                                    </div>
                                                </div>
                                            </div>
                                        </template>
                                        
                                        <!-- Preferences -->
                                        <template x-if="settingsTab === 'preferences'">
                                            <div>
                                                <h3 class="font-bold mb-4">تنظیمات ظاهری</h3>
                                                <div class="space-y-6">
                                                    <div>
                                                        <h4 class="font-medium mb-2">زبان</h4>
                                                        <select class="form-input w-full" x-model="preferences.language">
                                                            <option value="fa">فارسی</option>
                                                            <option value="en">English</option>
                                                        </select>
                                                    </div>
                                                    
                                                    <div>
                                                        <h4 class="font-medium mb-2">تقویم</h4>
                                                        <select class="form-input w-full" x-model="preferences.calendar">
                                                            <option value="jalali">جلالی (فارسی)</option>
                                                            <option value="gregorian">میلادی</option>
                                                        </select>
                                                    </div>
                                                    
                                                    <div>
                                                        <h4 class="font-medium mb-2">تم</h4>
                                                        <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                                                            <div 
                                                                class="border-2 rounded-lg p-4 cursor-pointer transition-all" 
                                                                :class="preferences.theme === 'dark' ? 'border-primary' : 'border-transparent'"
                                                                @click="preferences.theme = 'dark'"
                                                            >
                                                                <div class="h-20 rounded bg-dark-card mb-2"></div>
                                                                <p class="text-center">تیره</p>
                                                            </div>
                                                            <div 
                                                                class="border-2 rounded-lg p-4 cursor-pointer transition-all" 
                                                                :class="preferences.theme === 'light' ? 'border-primary' : 'border-transparent'"
                                                                @click="preferences.theme = 'light'"
                                                            >
                                                                <div class="h-20 rounded bg-gray-200 mb-2"></div>
                                                                <p class="text-center">روشن</p>
                                                            </div>
                                                            <div 
                                                                class="border-2 rounded-lg p-4 cursor-pointer transition-all" 
                                                                :class="preferences.theme === 'blue' ? 'border-primary' : 'border-transparent'"
                                                                @click="preferences.theme = 'blue'"
                                                            >
                                                                <div class="h-20 rounded bg-blue-900 mb-2"></div>
                                                                <p class="text-center">آبی</p>
                                                            </div>
                                                            <div 
                                                                class="border-2 rounded-lg p-4 cursor-pointer transition-all" 
                                                                :class="preferences.theme === 'green' ? 'border-primary' : 'border-transparent'"
                                                                @click="preferences.theme = 'green'"
                                                            >
                                                                <div class="h-20 rounded bg-green-900 mb-2"></div>
                                                                <p class="text-center">سبز</p>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    
                                                    <div>
                                                        <h4 class="font-medium mb-2">فونت</h4>
                                                        <div class="grid grid-cols-2 gap-4">
                                                            <div>
                                                                <label class="form-label">اندازه فونت</label>
                                                                <select class="form-input w-full" x-model="preferences.fontSize">
                                                                    <option value="small">کوچک</option>
                                                                    <option value="medium">متوسط</option>
                                                                    <option value="large">بزرگ</option>
                                                                </select>
                                                            </div>
                                                            <div>
                                                                <label class="form-label">نوع فونت</label>
                                                                <select class="form-input w-full" x-model="preferences.fontFamily">
                                                                    <option value="vazir">وزیر</option>
                                                                    <option value="iran-sans">ایران سنس</option>
                                                                    <option value="tahoma">تهرانی</option>
                                                                </select>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    
                                                    <div class="flex justify-end">
                                                        <button class="btn-primary">ذخیره تنظیمات</button>
                                                    </div>
                                                </div>
                                            </div>
                                        </template>
                                        
                                        <!-- Connect -->
                                        <template x-if="settingsTab === 'connect'">
                                            <div>
                                                <h3 class="font-bold mb-4">اتصال</h3>
                                                <div class="space-y-4">
                                                    <div class="flex items-center justify-between">
                                                        <span>وضعیت اتصال</span>
                                                        <span class="px-3 py-1 rounded-full" :class="connectionStatus === 'online' ? 'bg-green-900 text-green-100' : 'bg-red-900 text-red-100'" x-text="connectionStatus === 'online' ? 'آنلاین' : 'آفلاین'"></span>
                                                    </div>
                                                    
                                                    <div>
                                                        <label class="form-label">آدرس سرور</label>
                                                        <input type="text" class="form-input w-full" x-model="connectionSettings.serverUrl" placeholder="https://api.example.com">
                                                    </div>
                                                    
                                                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                                        <div>
                                                            <label class="form-label">نام کاربری آنلاین</label>
                                                            <input type="text" class="form-input w-full" x-model="connectionSettings.onlineUsername">
                                                        </div>
                                                        <div>
                                                            <label class="form-label">رمز عبور آنلاین</label>
                                                            <input type="password" class="form-input w-full" x-model="connectionSettings.onlinePassword">
                                                        </div>
                                                    </div>
                                                    
                                                    <div class="flex items-center justify-between p-3 bg-dark-card-light rounded">
                                                        <span>همگام‌سازی خودکار</span>
                                                        <label class="toggle-switch">
                                                            <input type="checkbox" x-model="connectionSettings.autoSync">
                                                            <span class="toggle-slider"></span>
                                                        </label>
                                                    </div>
                                                    
                                                    <div class="flex space-x-2 space-x-reverse">
                                                        <button class="btn-primary" @click="testConnection">آزمایش اتصال</button>
                                                        <button class="btn-primary" @click="syncData">همگام‌سازی</button>
                                                    </div>
                                                </div>
                                            </div>
                                        </template>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </template>
                </main>
                <!-- Project Management with Kanban -->
                    <template x-if="currentModule === 'projectmanagement'">
                        <div>
                            <h2 class="text-xl font-bold mb-4">مدیریت پیشرفته پروژه‌ها</h2>
                            
                            <div class="mb-4 flex justify-between items-center">
                                <div class="flex space-x-2 space-x-reverse">
                                    <button class="btn-primary" @click="openProjectModal()">
                                        <i class="fas fa-plus ml-2"></i>
                                        پروژه جدید
                                    </button>
                                    <button class="btn-primary" @click="showGanttView = !showGanttView">
                                        <i class="fas fa-chart-bar ml-2"></i>
                                        <span x-text="showGanttView ? 'نمای کانبان' : 'نمودار گانت'"></span>
                                    </button>
                                </div>
                                
                                <div class="flex items-center space-x-4 space-x-reverse">
                                    <div class="text-sm">
                                        <span class="text-text-muted">پیشرفت کل: </span>
                                        <span class="font-bold" x-text="totalProjectProgress + '%'"></span>
                                    </div>
                                    <div class="text-sm">
                                        <span class="text-text-muted">تعداد پروژه‌ها: </span>
                                        <span class="font-bold" x-text="projects.length"></span>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Gantt Chart View -->
                            <template x-if="showGanttView">
                                <div class="card p-4">
                                    <h3 class="font-bold mb-4">نمودار گانت پروژه‌ها</h3>
                                    <div class="gantt-chart">
                                        <div class="flex mb-4">
                                            <div class="w-48 flex-shrink-0 font-bold">نام پروژه</div>
                                            <div class="flex-1 relative">
                                                <div class="flex justify-between text-sm">
                                                    <template x-for="month in ganttMonths" :key="month">
                                                        <span x-text="month"></span>
                                                    </template>
                                                </div>
                                            </div>
                                        </div>
                                        
                                        <template x-for="project in projects" :key="project.id">
                                            <div class="flex mb-2 items-center">
                                                <div class="w-48 flex-shrink-0" x-text="project.name"></div>
                                                <div class="flex-1 relative h-8 bg-dark-card-light rounded">
                                                    <div class="gantt-bar" 
                                                         :style="'width: ' + project.progress + '%; background: ' + getProjectColor(project.status)"></div>
                                                    <div class="gantt-milestone" 
                                                         :style="'left: ' + calculateMilestonePosition(project) + '%'"></div>
                                                </div>
                                            </div>
                                        </template>
                                    </div>
                                </div>
                            </template>
                            
                            <!-- Kanban View -->
                            <template x-if="!showGanttView">
                                <div class="kanban-board">
                                    <template x-for="column in projectKanbanColumns" :key="column.id">
                                        <div class="kanban-column">
                                            <div class="flex justify-between items-center mb-4">
                                                <h3 class="font-bold" x-text="column.title"></h3>
                                                <span class="bg-dark-card text-text-light text-xs rounded-full px-2 py-1" 
                                                      x-text="column.tasks.length"></span>
                                            </div>
                                            
                                            <div class="space-y-3">
                                                <template x-for="task in column.tasks" :key="task.id">
                                                    <div class="kanban-task" 
                                                         :class="'kanban-task ' + task.priority + '-priority'"
                                                         @click="openTaskModal(task)">
                                                        <div class="flex justify-between items-start mb-2">
                                                            <h4 class="font-medium" x-text="task.title"></h4>
                                                            <span class="text-xs px-2 py-1 rounded" 
                                                                  :class="getPriorityClass(task.priority)" 
                                                                  x-text="task.priorityText"></span>
                                                        </div>
                                                        <p class="text-sm text-text-muted mb-2" x-text="task.description"></p>
                                                        <div class="flex justify-between items-center text-xs text-text-muted">
                                                            <span x-text="task.dueDate"></span>
                                                            <div class="flex -space-x-2">
                                                                <template x-for="member in task.assignedTo.slice(0, 3)" :key="member.id">
                                                                    <div class="w-6 h-6 rounded-full bg-primary text-white flex items-center justify-center text-xs" 
                                                                         :title="member.name"></div>
                                                                </template>
                                                                <div x-show="task.assignedTo.length > 3" 
                                                                     class="w-6 h-6 rounded-full bg-dark-card-light text-text-muted flex items-center justify-center text-xs">
                                                                    <span x-text="'+' + (task.assignedTo.length - 3)"></span>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </template>
                                            </div>
                                        </div>
                                    </template>
                                </div>
                            </template>
                        </div>
                    </template>
                    
                    <!-- Budget and Prediction -->
                    <template x-if="currentModule === 'budget'">
                        <div>
                            <h2 class="text-xl font-bold mb-4">بودجه‌بندی و پیش‌بینی مالی</h2>
                            
                            <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 mb-6">
                                <!-- Budget Summary -->
                                <div class="budget-card under-budget">
                                    <div class="flex justify-between items-start mb-4">
                                        <div>
                                            <p class="text-text-muted">بودجه اختصاص یافته</p>
                                            <h3 class="text-2xl font-bold mt-2" x-text="formatCurrency(budgetSummary.allocated)"></h3>
                                        </div>
                                        <div class="p-3 rounded-full bg-green-500 bg-opacity-20 text-green-500">
                                            <i class="fas fa-wallet"></i>
                                        </div>
                                    </div>
                                    <div class="space-y-2">
                                        <div class="flex justify-between">
                                            <span>هزینه شده:</span>
                                            <span x-text="formatCurrency(budgetSummary.spent)"></span>
                                        </div>
                                        <div class="flex justify-between">
                                            <span>مانده:</span>
                                            <span class="text-green-400" x-text="formatCurrency(budgetSummary.remaining)"></span>
                                        </div>
                                        <div class="progress-bar mt-2">
                                            <div class="progress-fill bg-green-500" 
                                                 :style="'width: ' + budgetSummary.utilization + '%'"></div>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Prediction -->
                                <div class="budget-card">
                                    <div class="flex justify-between items-start mb-4">
                                        <div>
                                            <p class="text-text-muted">پیش‌بینی درآمد</p>
                                            <h3 class="text-2xl font-bold mt-2" x-text="formatCurrency(prediction.nextMonthIncome)"></h3>
                                        </div>
                                        <div class="p-3 rounded-full bg-blue-500 bg-opacity-20 text-blue-500">
                                            <i class="fas fa-chart-line"></i>
                                        </div>
                                    </div>
                                    <p class="text-sm text-text-muted mb-4">بر اساس داده‌های ۶ ماه گذشته</p>
                                    <div class="prediction-chart">
                                        <template x-for="month in prediction.months" :key="month.name">
                                            <div class="prediction-bar" 
                                                 :style="'height: ' + month.value + '%'"
                                                 :title="month.name + ': ' + formatCurrency(month.amount)">
                                                <div class="absolute bottom-0 right-0 left-0 text-center text-xs py-1">
                                                    <span x-text="month.name"></span>
                                                </div>
                                            </div>
                                        </template>
                                    </div>
                                </div>
                                
                                <!-- Alerts -->
                                <div class="budget-card">
                                    <div class="flex justify-between items-start mb-4">
                                        <div>
                                            <p class="text-text-muted">هشدارهای بودجه</p>
                                            <h3 class="text-2xl font-bold mt-2" x-text="budgetAlerts.length"></h3>
                                        </div>
                                        <div class="p-3 rounded-full bg-yellow-500 bg-opacity-20 text-yellow-500">
                                            <i class="fas fa-exclamation-triangle"></i>
                                        </div>
                                    </div>
                                    <div class="space-y-3">
                                        <template x-for="alert in budgetAlerts" :key="alert.id">
                                            <div class="p-3 bg-dark-card-light rounded flex items-center space-x-3 space-x-reverse">
                                                <i class="fas fa-exclamation-circle text-yellow-500"></i>
                                                <div class="flex-1">
                                                    <p class="text-sm" x-text="alert.message"></p>
                                                    <p class="text-xs text-text-muted" x-text="alert.project"></p>
                                                </div>
                                            </div>
                                        </template>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Detailed Budget Table -->
                            <div class="card p-4">
                                <h3 class="font-bold mb-4">جزئیات بودجه پروژه‌ها</h3>
                                <div class="overflow-x-auto">
                                    <table class="w-full">
                                        <thead>
                                            <tr class="text-right border-b border-dark-card-light">
                                                <th class="py-2 px-4">پروژه</th>
                                                <th class="py-2 px-4">بودجه اختصاص یافته</th>
                                                <th class="py-2 px-4">هزینه شده</th>
                                                <th class="py-2 px-4">مانده</th>
                                                <th class="py-2 px-4">درصد مصرف</th>
                                                <th class="py-2 px-4">پیش‌بینی تکمیل</th>
                                                <th class="py-2 px-4">وضعیت</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <template x-for="project in budgetDetails" :key="project.id">
                                                <tr class="table-row">
                                                    <td class="py-3 px-4" x-text="project.name"></td>
                                                    <td class="py-3 px-4" x-text="formatCurrency(project.allocated)"></td>
                                                    <td class="py-3 px-4" x-text="formatCurrency(project.spent)"></td>
                                                    <td class="py-3 px-4" 
                                                        :class="project.remaining >= 0 ? 'text-green-400' : 'text-red-400'"
                                                        x-text="formatCurrency(project.remaining)"></td>
                                                    <td class="py-3 px-4">
                                                        <div class="flex items-center space-x-2 space-x-reverse">
                                                            <div class="progress-bar flex-1">
                                                                <div class="progress-fill" 
                                                                     :class="project.utilization > 90 ? 'bg-red-500' : 'bg-primary'"
                                                                     :style="'width: ' + project.utilization + '%'"></div>
                                                            </div>
                                                            <span x-text="project.utilization + '%'"></span>
                                                        </div>
                                                    </td>
                                                    <td class="py-3 px-4" x-text="project.completionDate"></td>
                                                    <td class="py-3 px-4">
                                                        <span class="text-xs px-2 py-1 rounded" 
                                                              :class="getBudgetStatusClass(project)"
                                                              x-text="getBudgetStatusText(project)"></span>
                                                    </td>
                                                </tr>
                                            </template>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </template>
                    
                    <!-- Contract Management -->
                    <template x-if="currentModule === 'contracts'">
                        <div>
                            <h2 class="text-xl font-bold mb-4">مدیریت قراردادها</h2>
                            
                            <div class="card p-4">
                                <div class="flex justify-between items-center mb-4">
                                    <button class="btn-primary" @click="openContractModal()">
                                        <i class="fas fa-plus ml-2"></i>
                                        قرارداد جدید
                                    </button>
                                    
                                    <div class="flex space-x-2 space-x-reverse">
                                        <input type="text" placeholder="جستجو..." class="form-input" x-model="contractSearch">
                                        <select class="form-input" x-model="contractFilter">
                                            <option value="all">همه</option>
                                            <option value="active">فعال</option>
                                            <option value="expired">منقضی شده</option>
                                            <option value="pending">در انتظار امضا</option>
                                        </select>
                                    </div>
                                </div>
                                
                                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                                    <template x-for="contract in filteredContracts" :key="contract.id">
                                        <div class="document-card contract-status-signed">
                                            <div class="flex justify-between items-start mb-3">
                                                <h3 class="font-bold" x-text="contract.title"></h3>
                                                <span class="text-xs px-2 py-1 rounded" 
                                                      :class="getContractStatusClass(contract)"
                                                      x-text="contract.statusText"></span>
                                            </div>
                                            
                                            <div class="space-y-2 text-sm mb-4">
                                                <div class="flex justify-between">
                                                    <span class="text-text-muted">طرف قرارداد:</span>
                                                    <span x-text="contract.party"></span>
                                                </div>
                                                <div class="flex justify-between">
                                                    <span class="text-text-muted">مبلغ:</span>
                                                    <span x-text="formatCurrency(contract.amount)"></span>
                                                </div>
                                                <div class="flex justify-between">
                                                    <span class="text-text-muted">تاریخ شروع:</span>
                                                    <span x-text="contract.startDate"></span>
                                                </div>
                                                <div class="flex justify-between">
                                                    <span class="text-text-muted">تاریخ پایان:</span>
                                                    <span x-text="contract.endDate"></span>
                                                </div>
                                                <div class="flex justify-between">
                                                    <span class="text-text-muted">مانده زمان:</span>
                                                    <span x-text="contract.remainingDays + ' روز'"></span>
                                                </div>
                                            </div>
                                            
                                            <div class="flex justify-between">
                                                <button class="text-primary text-sm" @click="openContractModal(contract)">
                                                    <i class="fas fa-eye ml-1"></i>
                                                    جزئیات
                                                </button>
                                                <div class="flex space-x-2 space-x-reverse">
                                                    <button class="text-blue-400 text-sm">
                                                        <i class="fas fa-download"></i>
                                                    </button>
                                                    <button class="text-text-muted text-sm" @click="openContractModal(contract)">
                                                        <i class="fas fa-edit"></i>
                                                    </button>
                                                </div>
                                            </div>
                                        </div>
                                    </template>
                                </div>
                            </div>
                        </div>
                    </template>
                    
                    <!-- Member Management -->
                    <template x-if="currentModule === 'members'">
                        <div>
                            <h2 class="text-xl font-bold mb-4">مدیریت اعضا و پرسنل</h2>
                            
                            <div class="card p-4">
                                <div class="flex justify-between items-center mb-4">
                                    <button class="btn-primary" @click="openMemberModal()">
                                        <i class="fas fa-plus ml-2"></i>
                                        عضو جدید
                                    </button>
                                    
                                    <div class="flex space-x-2 space-x-reverse">
                                        <input type="text" placeholder="جستجو..." class="form-input" x-model="memberSearch">
                                        <select class="form-input" x-model="memberFilter">
                                            <option value="all">همه</option>
                                            <option value="active">فعال</option>
                                            <option value="inactive">غیرفعال</option>
                                        </select>
                                    </div>
                                </div>
                                
                                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                                    <template x-for="member in filteredMembers" :key="member.id">
                                        <div class="document-card">
                                            <div class="member-profile">
                                                <div class="member-avatar">
                                                    <i class="fas fa-user"></i>
                                                </div>
                                                <h3 class="font-bold text-lg" x-text="member.name"></h3>
                                                <p class="text-text-muted" x-text="member.position"></p>
                                                <p class="text-sm text-text-muted mb-4" x-text="member.department"></p>
                                                
                                                <div class="space-y-2 text-sm">
                                                    <div class="flex justify-between">
                                                        <span class="text-text-muted">کد پرسنلی:</span>
                                                        <span x-text="member.employeeId"></span>
                                                    </div>
                                                    <div class="flex justify-between">
                                                        <span class="text-text-muted">تاریخ استخدام:</span>
                                                        <span x-text="member.hireDate"></span>
                                                    </div>
                                                    <div class="flex justify-between">
                                                        <span class="text-text-muted">وضعیت:</span>
                                                        <span class="text-xs px-2 py-1 rounded" 
                                                              :class="member.active ? 'bg-green-900 text-green-100' : 'bg-red-900 text-red-100'"
                                                              x-text="member.active ? 'فعال' : 'غیرفعال'"></span>
                                                    </div>
                                                </div>
                                            </div>
                                            
                                            <div class="flex justify-between mt-4">
                                                <button class="text-primary text-sm" @click="openMemberModal(member)">
                                                    <i class="fas fa-eye ml-1"></i>
                                                    پروفایل کامل
                                                </button>
                                                <button class="text-text-muted text-sm" @click="openMemberModal(member)">
                                                    <i class="fas fa-edit ml-1"></i>
                                                    ویرایش
                                                </button>
                                            </div>
                                        </div>
                                    </template>
                                </div>
                            </div>
                        </div>
                    </template>
                    
                    <!-- Advanced Search -->
                    <template x-if="currentModule === 'search'">
                        <div>
                            <h2 class="text-xl font-bold mb-4">جستجو و فیلتر پیشرفته</h2>
                            
                            <div class="search-advanced">
                                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-4">
                                    <div>
                                        <label class="form-label">کلیدواژه</label>
                                        <input type="text" class="form-input w-full" x-model="searchQuery.keyword" placeholder="جستجو در همه فیلدها...">
                                    </div>
                                    
                                    <div>
                                        <label class="form-label">نوع محتوا</label>
                                        <select class="form-input w-full" x-model="searchQuery.type">
                                            <option value="all">همه</option>
                                            <option value="tasks">وظایف</option>
                                            <option value="projects">پروژه‌ها</option>
                                            <option value="contacts">مخاطبین</option>
                                            <option value="transactions">تراکنش‌ها</option>
                                            <option value="documents">اسناد</option>
                                        </select>
                                    </div>
                                    
                                    <div>
                                        <label class="form-label">تاریخ از</label>
                                        <input type="text" class="form-input w-full" x-model="searchQuery.dateFrom" placeholder="1402/01/01">
                                    </div>
                                    
                                    <div>
                                        <label class="form-label">تاریخ تا</label>
                                        <input type="text" class="form-input w-full" x-model="searchQuery.dateTo" placeholder="1402/12/29">
                                    </div>
                                </div>
                                
                                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-4">
                                    <div>
                                        <label class="form-label">اولویت</label>
                                        <select class="form-input w-full" x-model="searchQuery.priority">
                                            <option value="all">همه</option>
                                            <option value="high">بالا</option>
                                            <option value="medium">متوسط</option>
                                            <option value="low">کم</option>
                                        </select>
                                    </div>
                                    
                                    <div>
                                        <label class="form-label">وضعیت</label>
                                        <select class="form-input w-full" x-model="searchQuery.status">
                                            <option value="all">همه</option>
                                            <option value="active">فعال</option>
                                            <option value="completed">تکمیل شده</option>
                                            <option value="pending">در انتظار</option>
                                        </select>
                                    </div>
                                    
                                    <div>
                                        <label class="form-label">پروژه</label>
                                        <select class="form-input w-full" x-model="searchQuery.project">
                                            <option value="all">همه</option>
                                            <template x-for="project in projects" :key="project.id">
                                                <option :value="project.id" x-text="project.name"></option>
                                            </template>
                                        </select>
                                    </div>
                                    
                                    <div>
                                        <label class="form-label">دسته‌بندی</label>
                                        <select class="form-input w-full" x-model="searchQuery.category">
                                            <option value="all">همه</option>
                                            <option value="financial">مالی</option>
                                            <option value="technical">فنی</option>
                                            <option value="administrative">اداری</option>
                                            <option value="sales">فروش</option>
                                        </select>
                                    </div>
                                </div>
                                
                                <div class="flex justify-end space-x-2 space-x-reverse">
                                    <button class="px-4 py-2 rounded border border-dark-card-light hover:bg-dark-card-light transition-colors" 
                                            @click="resetSearch">پاک کردن فیلترها</button>
                                    <button class="btn-primary" @click="performSearch">
                                        <i class="fas fa-search ml-2"></i>
                                        اجرای جستجو
                                    </button>
                                </div>
                            </div>
                            
                            <div class="card p-4">
                                <h3 class="font-bold mb-4">نتایج جستجو</h3>
                                
                                <div class="flex justify-between items-center mb-4">
                                    <p class="text-text-muted" x-text="'تعداد نتایج: ' + searchResults.length"></p>
                                    <div class="flex space-x-2 space-x-reverse">
                                        <button class="text-sm text-text-muted">
                                            <i class="fas fa-download ml-1"></i>
                                            خروجی Excel
                                        </button>
                                        <button class="text-sm text-text-muted">
                                            <i class="fas fa-print ml-1"></i>
                                            چاپ
                                        </button>
                                    </div>
                                </div>
                                
                                <div class="search-results">
                                    <template x-for="result in searchResults" :key="result.id + '-' + result.type">
                                        <div class="result-item">
                                            <div class="flex justify-between items-start">
                                                <div>
                                                    <h4 class="font-bold" x-text="result.title"></h4>
                                                    <p class="text-sm text-text-muted mt-1" x-text="result.description"></p>
                                                </div>
                                                <div class="flex items-center space-x-2 space-x-reverse">
                                                    <span class="text-xs px-2 py-1 rounded bg-dark-card-light" 
                                                          x-text="result.typeText"></span>
                                                    <span class="text-xs text-text-muted" x-text="result.date"></span>
                                                </div>
                                            </div>
                                            <div class="flex items-center space-x-4 space-x-reverse mt-2 text-xs text-text-muted">
                                                <template x-if="result.project">
                                                    <span><i class="fas fa-project-diagram ml-1"></i> <span x-text="result.project"></span></span>
                                                </template>
                                                <template x-if="result.priority">
                                                    <span><i class="fas fa-flag ml-1"></i> <span x-text="result.priorityText"></span></span>
                                                </template>
                                                <template x-if="result.amount">
                                                    <span><i class="fas fa-dollar-sign ml-1"></i> <span x-text="formatCurrency(result.amount)"></span></span>
                                                </template>
                                            </div>
                                        </div>
                                    </template>
                                </div>
                            </div>
                        </div>
                    </template>
                    
                    <!-- User Activity Log -->
                    <template x-if="currentModule === 'activity'">
                        <div>
                            <h2 class="text-xl font-bold mb-4">گزارش فعالیت کاربران</h2>
                            
                            <div class="card p-4">
                                <div class="flex justify-between items-center mb-4">
                                    <div class="flex space-x-2 space-x-reverse">
                                        <input type="text" placeholder="جستجو کاربر..." class="form-input" x-model="activitySearch">
                                        <select class="form-input" x-model="activityFilter">
                                            <option value="all">همه فعالیت‌ها</option>
                                            <option value="create">ایجاد</option>
                                            <option value="update">ویرایش</option>
                                            <option value="delete">حذف</option>
                                            <option value="login">ورود</option>
                                        </select>
                                    </div>
                                    
                                    <div class="flex space-x-2 space-x-reverse">
                                        <input type="text" placeholder="تاریخ از" class="form-input" x-model="activityDateFrom">
                                        <input type="text" placeholder="تاریخ تا" class="form-input" x-model="activityDateTo">
                                    </div>
                                </div>
                                
                                <div class="activity-timeline">
                                    <template x-for="activity in filteredActivities" :key="activity.id">
                                        <div class="activity-item">
                                            <div class="flex justify-between items-start">
                                                <div>
                                                    <h4 class="font-bold" x-text="activity.user"></h4>
                                                    <p class="text-sm mt-1" x-text="activity.action"></p>
                                                    <p class="text-xs text-text-muted mt-1" x-text="activity.details"></p>
                                                </div>
                                                <div class="text-sm text-text-muted" x-text="activity.time"></div>
                                            </div>
                                            <div class="mt-2">
                                                <span class="text-xs px-2 py-1 rounded" 
                                                      :class="getActivityTypeClass(activity.type)"
                                                      x-text="activity.typeText"></span>
                                                <span class="text-xs px-2 py-1 rounded bg-dark-card-light text-text-muted mr-2" 
                                                      x-text="activity.module"></span>
                                            </div>
                                        </div>
                                    </template>
                                </div>
                            </div>
                        </div>
                    </template>
            

                 l
                
                  
                    
                    
                 
                                
                            

                    <!-- Accounts Management Template -->
                    <template x-if="currentModule === 'accounts'">
                        <div x-data="accounts">
                            <h2 class="text-xl font-bold mb-4">مدیریت حساب‌ها</h2>
                            
                            <div class="card p-4 mb-6">
                                <div class="flex justify-between items-center">
                                    <div>
                                        <h3 class="font-bold text-lg">موجودی کل: <span x-text="formatCurrency(totalBalance)"></span></h3>
                                        <p class="text-text-muted">جمع موجودی تمام حساب‌ها</p>
                                    </div>
                                    <button class="btn-primary" @click="openAccountModal()">
                                        <i class="fas fa-plus ml-2"></i>
                                        حساب جدید
                                    </button>
                                </div>
                            </div>

                            <div class="card p-4">
                                <div class="flex justify-between items-center mb-4">
                                    <div class="flex space-x-2 space-x-reverse">
                                        <input type="text" placeholder="جستجو..." class="form-input" x-model="accountSearch">
                                        <select class="form-input" x-model="accountFilter">
                                            <option value="all">همه حساب‌ها</option>
                                            <option value="bank">بانکی</option>
                                            <option value="cash">نقدی</option>
                                            <option value="card">کارت</option>
                                            <option value="wallet">کیف پول</option>
                                        </select>
                                    </div>
                                </div>

                                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                                    <template x-for="account in filteredAccounts" :key="account.id">
                                        <div class="card p-4">
                                            <div class="flex justify-between items-start mb-3">
                                                <div class="flex items-center space-x-2 space-x-reverse">
                                                    <i :class="getAccountTypeIcon(account.type)" class="text-primary text-xl"></i>
                                                    <div>
                                                        <h3 class="font-bold" x-text="account.name"></h3>
                                                        <p class="text-sm text-text-muted" x-text="getAccountTypeLabel(account.type)"></p>
                                                    </div>
                                                </div>
                                                <span class="text-xs px-2 py-1 rounded" :class="account.isActive ? 'bg-green-900 text-green-100' : 'bg-red-900 text-red-100'" x-text="account.isActive ? 'فعال' : 'غیرفعال'"></span>
                                            </div>

                                            <div class="space-y-2 mb-4">
                                                <div class="flex justify-between">
                                                    <span class="text-text-muted">موجودی:</span>
                                                    <span class="font-bold" :class="account.balance >= 0 ? 'text-green-400' : 'text-red-400'" x-text="formatCurrency(account.balance, account.currency)"></span>
                                                </div>
                                                <div class="flex justify-between" x-show="account.accountNumber">
                                                    <span class="text-text-muted">شماره حساب:</span>
                                                    <span x-text="account.accountNumber"></span>
                                                </div>
                                                <div class="flex justify-between" x-show="account.sheba">
                                                    <span class="text-text-muted">شبا:</span>
                                                    <span class="text-xs" x-text="account.sheba"></span>
                                                </div>
                                            </div>

                                            <div class="flex justify-between">
                                                <button class="text-primary text-sm" @click="openAccountModal(account)">
                                                    <i class="fas fa-edit ml-1"></i>
                                                    ویرایش
                                                </button>
                                                <button class="text-red-400 text-sm" @click="deleteAccount(account.id)" x-show="account.id !== 1">
                                                    <i class="fas fa-trash ml-1"></i>
                                                    حذف
                                                </button>
                                            </div>
                                        </div>
                                    </template>
                                </div>
                            </div>

                            <!-- Account Modal -->
                            <div x-show="showAccountModal" class="modal-overlay fixed inset-0 flex items-center justify-center z-50 p-4">
                                <div class="modal-content w-full max-w-2xl">
                                    <div class="p-4 border-b border-dark-card-light flex justify-between items-center">
                                        <h3 class="font-bold" x-text="editingAccount ? 'ویرایش حساب' : 'حساب جدید'"></h3>
                                        <button @click="showAccountModal = false" class="text-text-muted hover:text-text-light">
                                            <i class="fas fa-times"></i>
                                        </button>
                                    </div>

                                    <div class="p-4 space-y-4">
                                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                            <div>
                                                <label class="form-label">نام حساب</label>
                                                <input type="text" class="form-input w-full" x-model="accountForm.name">
                                            </div>
                                            <div>
                                                <label class="form-label">نوع حساب</label>
                                                <select class="form-input w-full" x-model="accountForm.type">
                                                    <template x-for="type in accountTypes" :key="type.value">
                                                        <option :value="type.value" x-text="type.label"></option>
                                                    </template>
                                                </select>
                                            </div>
                                            <div>
                                                <label class="form-label">موجودی اولیه</label>
                                                <input type="number" class="form-input w-full" x-model="accountForm.balance">
                                            </div>
                                            <div>
                                                <label class="form-label">ارز</label>
                                                <select class="form-input w-full" x-model="accountForm.currency">
                                                    <option value="IRR">ریال ایران</option>
                                                    <option value="USD">دلار آمریکا</option>
                                                    <option value="EUR">یورو</option>
                                                </select>
                                            </div>
                                            <div x-show="accountForm.type === 'bank' || accountForm.type === 'card'">
                                                <label class="form-label">شماره حساب/کارت</label>
                                                <input type="text" class="form-input w-full" x-model="accountForm.accountNumber">
                                            </div>
                                            <div x-show="accountForm.type === 'bank'">
                                                <label class="form-label">شماره شبا</label>
                                                <input type="text" class="form-input w-full" x-model="accountForm.sheba">
                                            </div>
                                        </div>

                                        <div class="flex items-center space-x-2 space-x-reverse">
                                            <input type="checkbox" id="isActive" x-model="accountForm.isActive" class="rounded text-primary">
                                            <label for="isActive">حساب فعال</label>
                                        </div>
                                    </div>

                                    <div class="p-4 border-t border-dark-card-light flex justify-end space-x-2 space-x-reverse">
                                        <button @click="showAccountModal = false" class="px-4 py-2 rounded border border-dark-card-light hover:bg-dark-card-light transition-colors">انصراف</button>
                                        <button @click="saveAccount" class="btn-primary">ذخیره</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </template>

                    <!-- Budget and Prediction Template -->
                    <template x-if="currentModule === 'budget'">
                        <div x-data="budget">
                            <h2 class="text-xl font-bold mb-4">بودجه‌بندی و پیش‌بینی</h2>

                            <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 mb-6">
                                <div class="card p-4">
                                    <h3 class="font-bold mb-2">خلاصه بودجه</h3>
                                    <div class="space-y-2">
                                        <div class="flex justify-between">
                                            <span>بودجه تخصیص یافته:</span>
                                            <span class="font-bold" x-text="formatCurrency(budgetSummary.totalAllocated)"></span>
                                        </div>
                                        <div class="flex justify-between">
                                            <span>هزینه شده:</span>
                                            <span class="font-bold text-red-400" x-text="formatCurrency(budgetSummary.totalSpent)"></span>
                                        </div>
                                        <div class="flex justify-between">
                                            <span>مانده:</span>
                                            <span class="font-bold text-green-400" x-text="formatCurrency(budgetSummary.remaining)"></span>
                                        </div>
                                        <div class="flex justify-between">
                                            <span>نرخ استفاده:</span>
                                            <span class="font-bold" x-text="budgetSummary.utilizationRate.toFixed(1) + '%'"></span>
                                        </div>
                                    </div>
                                </div>

                                <div class="card p-4 lg:col-span-2">
                                    <h3 class="font-bold mb-4">پیش‌بینی‌ها</h3>
                                    <div class="space-y-3">
                                        <template x-for="prediction in predictions" :key="prediction.id">
                                            <div class="flex items-center justify-between p-3 bg-dark-card-light rounded">
                                                <div>
                                                    <h4 class="font-medium" x-text="prediction.title"></h4>
                                                    <p class="text-sm text-text-muted" x-text="prediction.factors.join('، ')"></p>
                                                </div>
                                                <div class="text-right">
                                                    <div :class="prediction.type === 'income' ? 'text-green-400' : 'text-red-400'" x-text="formatCurrency(prediction.amount)"></div>
                                                    <div class="text-xs text-text-muted" x-text="'اطمینان: ' + prediction.confidence + '%'"></div>
                                                </div>
                                            </div>
                                        </template>
                                    </div>
                                </div>
                            </div>

                            <div class="card p-4">
                                <div class="flex justify-between items-center mb-4">
                                    <button class="btn-primary" @click="openBudgetModal()">
                                        <i class="fas fa-plus ml-2"></i>
                                        بودجه جدید
                                    </button>

                                    <div class="flex space-x-2 space-x-reverse">
                                        <input type="text" placeholder="جستجو..." class="form-input" x-model="budgetSearch">
                                        <select class="form-input" x-model="budgetPeriod">
                                            <option value="all">همه دوره‌ها</option>
                                            <option value="monthly">ماهانه</option>
                                            <option value="quarterly">سه‌ماهه</option>
                                            <option value="yearly">سالانه</option>
                                        </select>
                                    </div>
                                </div>

                                <div class="overflow-x-auto">
                                    <table class="w-full">
                                        <thead>
                                            <tr class="text-right border-b border-dark-card-light">
                                                <th class="py-2 px-4">دسته‌بندی</th>
                                                <th class="py-2 px-4">تخصیص یافته</th>
                                                <th class="py-2 px-4">هزینه شده</th>
                                                <th class="py-2 px-4">مانده</th>
                                                <th class="py-2 px-4">وضعیت</th>
                                                <th class="py-2 px-4">دوره</th>
                                                <th class="py-2 px-4">عملیات</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <template x-for="budget in filteredBudgets" :key="budget.id">
                                                <tr class="table-row">
                                                    <td class="py-3 px-4" x-text="budget.category"></td>
                                                    <td class="py-3 px-4" x-text="formatCurrency(budget.allocated)"></td>
                                                    <td class="py-3 px-4" x-text="formatCurrency(budget.spent)"></td>
                                                    <td class="py-3 px-4" :class="(budget.allocated - budget.spent) >= 0 ? 'text-green-400' : 'text-red-400'" x-text="formatCurrency(budget.allocated - budget.spent)"></td>
                                                    <td class="py-3 px-4">
                                                        <span class="text-xs px-2 py-1 rounded" :class="getBudgetStatusColor(budget)" x-text="getBudgetStatusText(budget)"></span>
                                                    </td>
                                                    <td class="py-3 px-4" x-text="budget.period"></td>
                                                    <td class="py-3 px-4">
                                                        <div class="flex space-x-2 space-x-reverse">
                                                            <button class="text-blue-400" @click="openBudgetModal(budget)">
                                                                <i class="fas fa-edit"></i>
                                                            </button>
                                                        </div>
                                                    </td>
                                                </tr>
                                            </template>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </template>
            </div>
        </div>
    </template>
    
    <!-- Task Modal -->
    <template x-if="showTaskModal">
        <div class="modal-overlay fixed inset-0 flex items-center justify-center z-50 p-4">
            <div class="modal-content w-full max-w-2xl">
                <div class="p-4 border-b border-dark-card-light flex justify-between items-center">
                    <h3 class="font-bold" x-text="editingTask ? 'ویرایش وظیفه' : 'وظیفه جدید'"></h3>
                    <button @click="showTaskModal = false" class="text-text-muted hover:text-text-light">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                
                <div class="p-4 space-y-4">
                    <div>
                        <label class="form-label">عنوان</label>
                        <input type="text" class="form-input w-full" x-model="taskForm.title">
                    </div>
                    
                    <div>
                        <label class="form-label">توضیحات</label>
                        <textarea class="form-input w-full" rows="3" x-model="taskForm.description"></textarea>
                    </div>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label class="form-label">پروژه</label>
                            <select class="form-input w-full" x-model="taskForm.projectId">
                                <option value="">بدون پروژه</option>
                                <template x-for="project in projects" :key="project.id">
                                    <option :value="project.id" x-text="project.name"></option>
                                </template>
                            </select>
                        </div>
                        
                        <div>
                            <label class="form-label">اولویت</label>
                            <select class="form-input w-full" x-model="taskForm.priority">
                                <option value="low">کم</option>
                                <option value="normal">عادی</option>
                                <option value="high">بالا</option>
                                <option value="urgent">فوری</option>
                            </select>
                        </div>
                        
                        <div>
                            <label class="form-label">تاریخ شروع</label>
                            <input type="text" class="form-input w-full" x-model="taskForm.startDate">
                        </div>
                        
                        <div>
                            <label class="form-label">تاریخ پایان</label>
                            <input type="text" class="form-input w-full" x-model="taskForm.endDate">
                        </div>
                    </div>
                    
                    <div class="flex items-center space-x-2 space-x-reverse">
                        <input type="checkbox" id="completed" x-model="taskForm.completed" class="rounded text-primary">
                        <label for="completed">تکمیل شده</label>
                    </div>
                </div>
                
                <div class="p-4 border-t border-dark-card-light flex justify-end space-x-2 space-x-reverse">
                    <button @click="showTaskModal = false" class="px-4 py-2 rounded border border-dark-card-light hover:bg-dark-card-light transition-colors">انصراف</button>
                    <button @click="saveTask" class="btn-primary">ذخیره</button>
                </div>
            </div>
        </div>
    </template>
    
    <!-- Project Modal -->
    <template x-if="showProjectModal">
        <div class="modal-overlay fixed inset-0 flex items-center justify-center z-50 p-4">
            <div class="modal-content w-full max-w-4xl">
                <div class="p-4 border-b border-dark-card-light flex justify-between items-center">
                    <h3 class="font-bold" x-text="editingProject ? 'ویرایش پروژه' : 'پروژه جدید'"></h3>
                    <button @click="showProjectModal = false" class="text-text-muted hover:text-text-light">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                
                <div class="p-4">
                    <div class="mb-4 border-b border-dark-card-light">
                        <div class="flex space-x-1 space-x-reverse">
                            <button 
                                class="tab" 
                                :class="{ 'active': projectTab === 'info' }"
                                @click="projectTab = 'info'"
                            >
                                اطلاعات اصلی
                            </button>
                            <button 
                                class="tab" 
                                :class="{ 'active': projectTab === 'tasks' }"
                                @click="projectTab = 'tasks'"
                            >
                                وظایف
                            </button>
                            <button 
                                class="tab" 
                                :class="{ 'active': projectTab === 'team' }"
                                @click="projectTab = 'team'"
                            >
                                تیم
                            </button>
                            <button 
                                class="tab" 
                                :class="{ 'active': projectTab === 'documents' }"
                                @click="projectTab = 'documents'"
                            >
                                اسناد
                            </button>
                        </div>
                    </div>
                    
                    <div>
                        <!-- Project Info -->
                        <template x-if="projectTab === 'info'">
                            <div class="space-y-4">
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                    <div>
                                        <label class="form-label">نام پروژه</label>
                                        <input type="text" class="form-input w-full" x-model="projectForm.name">
                                    </div>
                                    <div>
                                        <label class="form-label">وضعیت</label>
                                        <select class="form-input w-full" x-model="projectForm.status">
                                            <option value="planning">در حال برنامه‌ریزی</option>
                                            <option value="active">فعال</option>
                                            <option value="on-hold">متوقف شده</option>
                                            <option value="completed">تکمیل شده</option>
                                        </select>
                                    </div>
                                    <div>
                                        <label class="form-label">تاریخ شروع</label>
                                        <input type="text" class="form-input w-full" x-model="projectForm.startDate">
                                    </div>
                                    <div>
                                        <label class="form-label">تاریخ پایان</label>
                                        <input type="text" class="form-input w-full" x-model="projectForm.endDate">
                                    </div>
                                </div>
                                
                                <div>
                                    <label class="form-label">توضیحات</label>
                                    <textarea class="form-input w-full" rows="4" x-model="projectForm.description"></textarea>
                                </div>
                                
                                <div>
                                    <label class="form-label">پیشرفت</label>
                                    <div class="flex items-center space-x-4 space-x-reverse">
                                        <input type="range" min="0" max="100" class="w-full" x-model="projectForm.progress">
                                        <span x-text="projectForm.progress + '%'"></span>
                                    </div>
                                </div>
                                
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                    <div>
                                        <label class="form-label">بودجه</label>
                                        <input type="number" class="form-input w-full" x-model="projectForm.budget">
                                    </div>
                                    <div>
                                        <label class="form-label">هزینه واقعی</label>
                                        <input type="number" class="form-input w-full" x-model="projectForm.actualCost">
                                    </div>
                                </div>
                            </div>
                        </template>
                        
                        <!-- Project Tasks -->
                        <template x-if="projectTab === 'tasks'">
                            <div>
                                <div class="flex justify-between items-center mb-4">
                                    <h4 class="font-bold">وظایف پروژه</h4>
                                    <button class="btn-primary" @click="openTaskModal()">
                                        <i class="fas fa-plus ml-2"></i>
                                        وظیفه جدید
                                    </button>
                                </div>
                                
                                <div class="space-y-3">
                                    <template x-for="task in projectTasks" :key="task.id">
                                        <div class="flex items-center justify-between p-3 bg-dark-card-light rounded">
                                            <div class="flex items-center space-x-3 space-x-reverse">
                                                <input type="checkbox" x-model="task.completed" class="rounded text-primary">
                                                <span :class="{ 'line-through text-text-muted': task.completed }" x-text="task.title"></span>
                                            </div>
                                            <div class="flex items-center space-x-2 space-x-reverse">
                                                <span class="text-xs px-2 py-1 rounded" :class="getPriorityClass(task.priority)" x-text="task.priorityText"></span>
                                                <span class="text-xs text-text-muted" x-text="task.date"></span>
                                            </div>
                                        </div>
                                    </template>
                                </div>
                            </div>
                        </template>
                    </div>
                </div>
                
                <div class="p-4 border-t border-dark-card-light flex justify-end space-x-2 space-x-reverse">
                    <button @click="showProjectModal = false" class="px-4 py-2 rounded border border-dark-card-light hover:bg-dark-card-light transition-colors">انصراف</button>
                    <button @click="saveProject" class="btn-primary">ذخیره</button>
                </div>
            </div>
        </div>
    </template>

    
    <!-- Transaction Modal -->
    <template x-if="showTransactionModal">
        <div class="modal-overlay fixed inset-0 flex items-center justify-center z-50 p-4">
            <div class="modal-content w-full max-w-2xl">
                <div class="p-4 border-b border-dark-card-light flex justify-between items-center">
                    <h3 class="font-bold" x-text="editingTransaction ? 'ویرایش تراکنش' : 'تراکنش جدید'"></h3>
                    <button @click="showTransactionModal = false" class="text-text-muted hover:text-text-light">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                
                <div class="card p-4">
                <div class="flex flex-col lg:flex-row lg:items-center lg:justify-between space-y-4 lg:space-y-0">
                <div class="flex flex-wrap gap-2">
                    <!-- Search -->
                    <div class="relative">
                        <input type="text" placeholder="جستجو..." class="form-input pr-10" x-model="transactionSearch">
                        <i class="fas fa-search absolute right-3 top-1/2 transform -translate-y-1/2 text-text-muted"></i>
                    </div>
                    
                    <!-- Type Filter -->
                    <select class="form-input" x-model="transactionType">
                        <option value="all">همه انواع</option>
                        <option value="income">درآمد</option>
                        <option value="expense">هزینه</option>
                    </select>
                    
                    <!-- Status Filter -->
                    <select class="form-input" x-model="transactionStatus">
                        <option value="all">همه وضعیت‌ها</option>
                        <option value="pending">در انتظار</option>
                        <option value="completed">تکمیل شده</option>
                        <option value="cancelled">لغو شده</option>
                        <option value="draft">پیش‌نویس</option>
                    </select>
                    
                    <!-- Category Filter -->
                    <select class="form-input" x-model="transactionCategory">
                        <option value="all">همه دسته‌بندی‌ها</option>
                        <template x-for="category in categories" :key="category">
                            <option :value="category" x-text="category"></option>
                        </template>
                    </select>
                </div>
                
                <div class="flex space-x-2 space-x-reverse">
                    <!-- Persian Date Range -->
                    <div class="flex space-x-2 space-x-reverse">
                        <div class="relative" x-data="persianDateInput(dateRange.start)">
                            <input type="text" 
                                   class="form-input calendar-input" 
                                   placeholder="از تاریخ"
                                   x-model="displayValue"
                                   @click="showPicker = true"
                                   readonly>
                            <div x-show="showPicker" class="calendar-dropdown">
                                <div x-data="persianCalendar(dateRange.start)" 
                                     @date-selected="onDateSelected($event); $parent.dateRange.start = $event.detail.formatted"
                                     class="persian-calendar w-80">
                                </div>
                            </div>
                        </div>
                        
                        <div class="relative" x-data="persianDateInput(dateRange.end)">
                            <input type="text" 
                                   class="form-input calendar-input" 
                                   placeholder="تا تاریخ"
                                   x-model="displayValue"
                                   @click="showPicker = true"
                                   readonly>
                            <div x-show="showPicker" class="calendar-dropdown">
                                <div x-data="persianCalendar(dateRange.end)" 
                                     @date-selected="onDateSelected($event); $parent.dateRange.end = $event.detail.formatted"
                                     class="persian-calendar w-80">
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Export -->
                    <button class="btn-primary" @click="exportTransactions('csv')">
                        <i class="fas fa-download ml-2"></i>
                        خروجی
                    </button>
                </div>
            </div>
             </div>
                
                <div class="p-4 border-t border-dark-card-light flex justify-end space-x-2 space-x-reverse">
                    <button @click="showTransactionModal = false" class="px-4 py-2 rounded border border-dark-card-light hover:bg-dark-card-light transition-colors">انصراف</button>
                    <button @click="saveTransaction" class="btn-primary">ذخیره</button>
                </div>
            </div>
           <!-- Updated Transaction Modal with Persian Date Input -->
        <div x-show="showTransactionModal" class="modal-overlay fixed inset-0 flex items-center justify-center z-50 p-4">
            <div class="modal-content w-full max-w-4xl max-h-[90vh] overflow-hidden">
                <!-- ... modal header and tabs ... -->

                <div class="overflow-y-auto flex-1">
                    <div class="p-4">
                        <!-- Basic Information Tab -->
                        <div x-show="activeTransactionTab === 'basic'" class="space-y-4">
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <!-- ... other fields ... -->
                                
                                <div>
                                    <label class="form-label">تاریخ</label>
                                    <div class="relative" x-data="persianDateInput(transactionForm.date)">
                                        <input type="text" 
                                               class="form-input w-full calendar-input" 
                                               x-model="displayValue"
                                               @click="showPicker = true"
                                               readonly>
                                        <div x-show="showPicker" class="calendar-dropdown">
                                            <div x-data="persianCalendar(transactionForm.date)" 
                                                 @date-selected="onDateSelected($event); $parent.transactionForm.date = $event.detail.formatted"
                                                 class="persian-calendar w-80">
                                            </div>
                                        </div>
                                        <i class="fas fa-calendar absolute left-3 top-1/2 transform -translate-y-1/2 text-text-muted"></i>
                                    </div>
                                </div>
                                
                                <!-- ... other fields ... -->
                            </div>
                            <!-- ... rest of basic tab ... -->
                        </div>
                    </div>
                </div>
            </div>
        </div>
        </div>
    </template>

    <!-- Contact Modal -->
    <template x-if="showContactModal">
        <div class="modal-overlay fixed inset-0 flex items-center justify-center z-50 p-4">
            <div class="modal-content w-full max-w-2xl">
                <div class="p-4 border-b border-dark-card-light flex justify-between items-center">
                    <h3 class="font-bold" x-text="editingContact ? 'ویرایش مخاطب' : 'مخاطب جدید'"></h3>
                    <button @click="showContactModal = false" class="text-text-muted hover:text-text-light">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                
                <div class="p-4 space-y-4">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label class="form-label">نوع</label>
                            <select class="form-input w-full" x-model="contactForm.type">
                                <option value="person">شخص حقیقی</option>
                                <option value="company">شخص حقوقی</option>
                            </select>
                        </div>
                        
                        <div>
                            <label class="form-label">نقش</label>
                            <select class="form-input w-full" x-model="contactForm.role">
                                <option value="customer">مشتری</option>
                                <option value="supplier">تأمین‌کننده</option>
                                <option value="both">هر دو</option>
                            </select>
                        </div>
                        
                        <div>
                            <label class="form-label">نام" x-text="contactForm.type === 'person' ? 'نام' : 'نام شرکت'"></label>
                            <input type="text" class="form-input w-full" x-model="contactForm.name">
                        </div>
                        
                        <div x-show="contactForm.type === 'person'">
                            <label class="form-label">نام خانوادگی</label>
                            <input type="text" class="form-input w-full" x-model="contactForm.lastName">
                        </div>
                        
                        <div>
                            <label class="form-label">تلفن</label>
                            <input type="tel" class="form-input w-full" x-model="contactForm.phone">
                        </div>
                        
                        <div>
                            <label class="form-label">ایمیل</label>
                            <input type="email" class="form-input w-full" x-model="contactForm.email">
                        </div>
                        
                        <div x-show="contactForm.type === 'company'">
                            <label class="form-label">شماره ثبت</label>
                            <input type="text" class="form-input w-full" x-model="contactForm.registrationNumber">
                        </div>
                        
                        <div x-show="contactForm.type === 'person'">
                            <label class="form-label">کد ملی</label>
                            <input type="text" class="form-input w-full" x-model="contactForm.nationalCode">
                        </div>
                    </div>
                    
                    <div>
                        <label class="form-label">آدرس</label>
                        <textarea class="form-input w-full" rows="3" x-model="contactForm.address"></textarea>
                    </div>
                    
                    <div>
                        <label class="form-label">یادداشت</label>
                        <textarea class="form-input w-full" rows="2" x-model="contactForm.notes"></textarea>
                    </div>
                </div>
                
                <div class="p-4 border-t border-dark-card-light flex justify-end space-x-2 space-x-reverse">
                    <button @click="showContactModal = false" class="px-4 py-2 rounded border border-dark-card-light hover:bg-dark-card-light transition-colors">انصراف</button>
                    <button @click="saveContact" class="btn-primary">ذخیره</button>
                </div>
            </div>
        </div>
    </template>
        <!-- Contract Modal -->
    <template x-if="showContractModal">
        <div class="modal-overlay fixed inset-0 flex items-center justify-center z-50 p-4">
            <div class="modal-content w-full max-w-4xl">
                <div class="p-4 border-b border-dark-card-light flex justify-between items-center">
                    <h3 class="font-bold" x-text="editingContract ? 'ویرایش قرارداد' : 'قرارداد جدید'"></h3>
                    <button @click="showContractModal = false" class="text-text-muted hover:text-text-light">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                
                <div class="p-4">
                    <div class="mb-4 border-b border-dark-card-light">
                        <div class="flex space-x-1 space-x-reverse">
                            <button class="tab" :class="{ 'active': contractTab === 'basic' }" @click="contractTab = 'basic'">اطلاعات پایه</button>
                            <button class="tab" :class="{ 'active': contractTab === 'terms' }" @click="contractTab = 'terms'">شرایط و ضوابط</button>
                            <button class="tab" :class="{ 'active': contractTab === 'payments' }" @click="contractTab = 'payments'">پرداخت‌ها</button>
                            <button class="tab" :class="{ 'active': contractTab === 'documents' }" @click="contractTab = 'documents'">مستندات</button>
                        </div>
                    </div>
                    
                    <div>
                        <!-- Basic Information -->
                        <template x-if="contractTab === 'basic'">
                            <div class="space-y-4">
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                    <div>
                                        <label class="form-label">عنوان قرارداد</label>
                                        <input type="text" class="form-input w-full" x-model="contractForm.title">
                                    </div>
                                    <div>
                                        <label class="form-label">طرف قرارداد</label>
                                        <select class="form-input w-full" x-model="contractForm.partyId">
                                            <option value="">انتخاب مخاطب</option>
                                            <template x-for="contact in contacts" :key="contact.id">
                                                <option :value="contact.id" x-text="contact.name"></option>
                                            </template>
                                        </select>
                                    </div>
                                    <div>
                                        <label class="form-label">تاریخ شروع</label>
                                        <input type="text" class="form-input w-full" x-model="contractForm.startDate">
                                    </div>
                                    <div>
                                        <label class="form-label">تاریخ پایان</label>
                                        <input type="text" class="form-input w-full" x-model="contractForm.endDate">
                                    </div>
                                    <div>
                                        <label class="form-label">مبلغ قرارداد</label>
                                        <input type="number" class="form-input w-full" x-model="contractForm.amount">
                                    </div>
                                    <div>
                                        <label class="form-label">وضعیت</label>
                                        <select class="form-input w-full" x-model="contractForm.status">
                                            <option value="draft">پیش‌نویس</option>
                                            <option value="pending">در انتظار امضا</option>
                                            <option value="active">فعال</option>
                                            <option value="expired">منقضی شده</option>
                                        </select>
                                    </div>
                                </div>
                                
                                <div>
                                    <label class="form-label">توضیحات</label>
                                    <textarea class="form-input w-full" rows="4" x-model="contractForm.description"></textarea>
                                </div>
                            </div>
                        </template>
                        
                        <!-- Payment Schedule -->
                        <template x-if="contractTab === 'payments'">
                            <div>
                                <div class="flex justify-between items-center mb-4">
                                    <h4 class="font-bold">برنامه پرداخت‌ها</h4>
                                    <button class="btn-primary" @click="addPaymentSchedule()">
                                        <i class="fas fa-plus ml-2"></i>
                                        پرداخت جدید
                                    </button>
                                </div>
                                
                                <div class="space-y-3">
                                    <template x-for="payment in contractForm.payments" :key="payment.id">
                                        <div class="flex items-center space-x-4 space-x-reverse p-3 bg-dark-card-light rounded">
                                            <div class="flex-1 grid grid-cols-1 md:grid-cols-3 gap-4">
                                                <div>
                                                    <label class="form-label text-xs">تاریخ پرداخت</label>
                                                    <input type="text" class="form-input w-full" x-model="payment.dueDate">
                                                </div>
                                                <div>
                                                    <label class="form-label text-xs">مبلغ</label>
                                                    <input type="number" class="form-input w-full" x-model="payment.amount">
                                                </div>
                                                <div>
                                                    <label class="form-label text-xs">وضعیت</label>
                                                    <select class="form-input w-full" x-model="payment.status">
                                                        <option value="pending">در انتظار</option>
                                                        <option value="paid">پرداخت شده</option>
                                                        <option value="overdue">معوقه</option>
                                                    </select>
                                                </div>
                                            </div>
                                            <button class="text-red-400" @click="removePaymentSchedule(payment.id)">
                                                <i class="fas fa-trash"></i>
                                            </button>
                                        </div>
                                    </template>
                                </div>
                            </div>
                        </template>
                    </div>
                </div>
                
                <div class="p-4 border-t border-dark-card-light flex justify-end space-x-2 space-x-reverse">
                    <button @click="showContractModal = false" class="px-4 py-2 rounded border border-dark-card-light hover:bg-dark-card-light transition-colors">انصراف</button>
                    <button @click="saveContract" class="btn-primary">ذخیره قرارداد</button>
                </div>
            </div>
        </div>
    </template>

    <!-- Member Modal -->
    <template x-if="showMemberModal">
        <div class="modal-overlay fixed inset-0 flex items-center justify-center z-50 p-4">
            <div class="modal-content w-full max-w-4xl">
                <div class="p-4 border-b border-dark-card-light flex justify-between items-center">
                    <h3 class="font-bold" x-text="editingMember ? 'ویرایش پروفایل عضو' : 'عضو جدید'"></h3>
                    <button @click="showMemberModal = false" class="text-text-muted hover:text-text-light">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                
                <div class="p-4">
                    <div class="mb-4 border-b border-dark-card-light">
                        <div class="flex space-x-1 space-x-reverse">
                            <button class="tab" :class="{ 'active': memberTab === 'personal' }" @click="memberTab = 'personal'">اطلاعات شخصی</button>
                            <button class="tab" :class="{ 'active': memberTab === 'employment' }" @click="memberTab = 'employment'">اطلاعات شغلی</button>
                            <button class="tab" :class="{ 'active': memberTab === 'skills' }" @click="memberTab = 'skills'">مهارت‌ها</button>
                            <button class="tab" :class="{ 'active': memberTab === 'documents' }" @click="memberTab = 'documents'">مستندات</button>
                        </div>
                    </div>
                    
                    <div>
                        <!-- Personal Information -->
                        <template x-if="memberTab === 'personal'">
                            <div class="space-y-4">
                                <div class="flex items-center space-x-4 space-x-reverse">
                                    <div class="member-avatar">
                                        <i class="fas fa-user"></i>
                                    </div>
                                    <div>
                                        <button class="btn-primary">تغییر عکس</button>
                                        <p class="text-sm text-text-muted mt-1">فرمت‌های مجاز: JPG, PNG (حداکثر 2MB)</p>
                                    </div>
                                </div>
                                
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                    <div>
                                        <label class="form-label">نام</label>
                                        <input type="text" class="form-input w-full" x-model="memberForm.firstName">
                                    </div>
                                    <div>
                                        <label class="form-label">نام خانوادگی</label>
                                        <input type="text" class="form-input w-full" x-model="memberForm.lastName">
                                    </div>
                                    <div>
                                        <label class="form-label">کد ملی</label>
                                        <input type="text" class="form-input w-full" x-model="memberForm.nationalId">
                                    </div>
                                    <div>
                                        <label class="form-label">کد پرسنلی</label>
                                        <input type="text" class="form-input w-full" x-model="memberForm.employeeId">
                                    </div>
                                    <div>
                                        <label class="form-label">تلفن همراه</label>
                                        <input type="tel" class="form-input w-full" x-model="memberForm.mobile">
                                    </div>
                                    <div>
                                        <label class="form-label">ایمیل</label>
                                        <input type="email" class="form-input w-full" x-model="memberForm.email">
                                    </div>
                                </div>
                                
                                <div>
                                    <label class="form-label">آدرس</label>
                                    <textarea class="form-input w-full" rows="3" x-model="memberForm.address"></textarea>
                                </div>
                            </div>
                        </template>
                        
                        <!-- Employment Information -->
                        <template x-if="memberTab === 'employment'">
                            <div class="space-y-4">
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                    <div>
                                        <label class="form-label">سمت</label>
                                        <input type="text" class="form-input w-full" x-model="memberForm.position">
                                    </div>
                                    <div>
                                        <label class="form-label">دپارتمان</label>
                                        <select class="form-input w-full" x-model="memberForm.department">
                                            <option value="development">توسعه</option>
                                            <option value="sales">فروش</option>
                                            <option value="marketing">بازاریابی</option>
                                            <option value="support">پشتیبانی</option>
                                            <option value="finance">مالی</option>
                                        </select>
                                    </div>
                                    <div>
                                        <label class="form-label">تاریخ استخدام</label>
                                        <input type="text" class="form-input w-full" x-model="memberForm.hireDate">
                                    </div>
                                    <div>
                                        <label class="form-label">نوع قرارداد</label>
                                        <select class="form-input w-full" x-model="memberForm.contractType">
                                            <option value="fulltime">تمام وقت</option>
                                            <option value="parttime">پاره وقت</option>
                                            <option value="contractual">قراردادی</option>
                                        </select>
                                    </div>
                                    <div>
                                        <label class="form-label">حقوق پایه</label>
                                        <input type="number" class="form-input w-full" x-model="memberForm.baseSalary">
                                    </div>
                                    <div>
                                        <label class="form-label">سرپرست مستقیم</label>
                                        <select class="form-input w-full" x-model="memberForm.supervisorId">
                                            <option value="">بدون سرپرست</option>
                                            <template x-for="member in members" :key="member.id">
                                                <option :value="member.id" x-text="member.name"></option>
                                            </template>
                                        </select>
                                    </div>
                                </div>
                                
                                <div class="flex items-center space-x-2 space-x-reverse">
                                    <input type="checkbox" id="active" x-model="memberForm.active" class="rounded text-primary">
                                    <label for="active">عضو فعال</label>
                                </div>
                            </div>
                        </template>
                    </div>
                </div>
                
                <div class="p-4 border-t border-dark-card-light flex justify-end space-x-2 space-x-reverse">
                    <button @click="showMemberModal = false" class="px-4 py-2 rounded border border-dark-card-light hover:bg-dark-card-light transition-colors">انصراف</button>
                    <button @click="saveMember" class="btn-primary">ذخیره اطلاعات</button>
                </div>
            </div>
        </div>
    </template>

        <!-- Notebook Modal -->
    <template x-if="showNotebookModal">
        <div class="modal-overlay fixed inset-0 flex items-center justify-center z-50 p-4">
            <div class="modal-content w-full max-w-md">
                <div class="p-4 border-b border-dark-card-light flex justify-between items-center">
                    <h3 class="font-bold" x-text="editingNotebook ? 'ویرایش دفترچه' : 'دفترچه جدید'"></h3>
                    <button @click="showNotebookModal = false" class="text-text-muted hover:text-text-light">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                
                <div class="p-4 space-y-4">
                    <div>
                        <label class="form-label">عنوان دفترچه</label>
                        <input type="text" class="form-input w-full" x-model="notebookForm.title">
                    </div>
                    
                    <div>
                        <label class="form-label">توضیحات</label>
                        <textarea class="form-input w-full" rows="3" x-model="notebookForm.description"></textarea>
                    </div>
                    
                    <div>
                        <label class="form-label">رنگ</label>
                        <div class="flex space-x-2 space-x-reverse">
                            <template x-for="color in notebookColors" :key="color">
                                <div class="w-8 h-8 rounded-full cursor-pointer border-2" 
                                     :class="{ 'border-primary': notebookForm.color === color }"
                                     :style="'background-color: ' + color"
                                     @click="notebookForm.color = color"></div>
                            </template>
                        </div>
                    </div>
                    
                    <div>
                        <label class="form-label">آیکون</label>
                        <select class="form-input w-full" x-model="notebookForm.icon">
                            <option value="fas fa-book">کتاب</option>
                            <option value="fas fa-briefcase">کار</option>
                            <option value="fas fa-lightbulb">ایده</option>
                            <option value="fas fa-heart">شخصی</option>
                        </select>
                    </div>
                </div>
                
                <div class="p-4 border-t border-dark-card-light flex justify-end space-x-2 space-x-reverse">
                    <button @click="showNotebookModal = false" class="px-4 py-2 rounded border border-dark-card-light hover:bg-dark-card-light transition-colors">انصراف</button>
                    <button @click="saveNotebook()" class="btn-primary">ذخیره</button>
                </div>
            </div>
        </div>
    </template>

    <!-- Reminder Modal -->
    <template x-if="showReminderModal">
        <div class="modal-overlay fixed inset-0 flex items-center justify-center z-50 p-4">
            <div class="modal-content w-full max-w-md">
                <div class="p-4 border-b border-dark-card-light flex justify-between items-center">
                    <h3 class="font-bold" x-text="editingReminder ? 'ویرایش یادآور' : 'یادآور جدید'"></h3>
                    <button @click="showReminderModal = false" class="text-text-muted hover:text-text-light">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                
                <div class="p-4 space-y-4">
                    <div>
                        <label class="form-label">عنوان یادآور</label>
                        <input type="text" class="form-input w-full" x-model="reminderForm.title">
                    </div>
                    
                    <div>
                        <label class="form-label">توضیحات</label>
                        <textarea class="form-input w-full" rows="3" x-model="reminderForm.description"></textarea>
                    </div>
                    
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label class="form-label">اولویت</label>
                            <select class="form-input w-full" x-model="reminderForm.priority">
                                <option value="low">کم</option>
                                <option value="normal">عادی</option>
                                <option value="important">مهم</option>
                                <option value="urgent">فوری</option>
                            </select>
                        </div>
                        
                        <div>
                            <label class="form-label">تکرار</label>
                            <select class="form-input w-full" x-model="reminderForm.repeat">
                                <option value="none">بدون تکرار</option>
                                <option value="daily">روزانه</option>
                                <option value="weekly">هفتگی</option>
                                <option value="monthly">ماهانه</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label class="form-label">تاریخ</label>
                            <input type="text" class="form-input w-full" x-model="reminderForm.dueDate">
                        </div>
                        
                        <div>
                            <label class="form-label">زمان</label>
                            <input type="time" class="form-input w-full" x-model="reminderForm.dueTime">
                        </div>
                    </div>
                </div>
                
                <div class="p-4 border-t border-dark-card-light flex justify-end space-x-2 space-x-reverse">
                    <button @click="showReminderModal = false" class="px-4 py-2 rounded border border-dark-card-light hover:bg-dark-card-light transition-colors">انصراف</button>
                    <button @click="saveReminder()" class="btn-primary">ذخیره</button>
                </div>
            </div>
        </div>
    </template>

    <!-- Floating Action Button -->
    <div class="floating-action" @click="openQuickActionMenu()">
        <i class="fas fa-plus"></i>
    </div>

    <!-- Quick Action Menu -->
    <template x-if="showQuickActionMenu">
        <div class="context-menu" style="bottom: 5rem; right: 2rem;">
            <div class="context-menu-item" @click="openTaskModal(); showQuickActionMenu = false">
                <i class="fas fa-tasks ml-2"></i>
                وظیفه جدید
            </div>
            <div class="context-menu-item" @click="openReminderModal(); showQuickActionMenu = false">
                <i class="fas fa-bell ml-2"></i>
                یادآور جدید
            </div>
            <div class="context-menu-item" @click="openNotebookModal(); showQuickActionMenu = false">
                <i class="fas fa-book ml-2"></i>
                یادداشت جدید
            </div>
            <div class="context-menu-item" @click="showQuickActionMenu = false">
                <i class="fas fa-times ml-2"></i>
                بستن
            </div>
        </div>
    </template>

    <!-- Loading Overlay -->
    <template x-if="isLoading">
        <div class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50">
            <div class="text-center">
                <div class="loading-spinner mb-4"></div>
                <p class="text-white" x-text="loadingMessage"></p>
            </div>
        </div>
    </template>

    
    <!-- Accounts Management Template -->
    <template x-if="accounts">
        <div x-data="accounts">
            <h2 class="text-xl font-bold mb-4">مدیریت حساب‌ها</h2>
            
            <div class="card p-4 mb-6">
                <div class="flex justify-between items-center">
                    <div>
                        <h3 class="font-bold text-lg">موجودی کل: <span x-text="formatCurrency(totalBalance)"></span></h3>
                        <p class="text-text-muted">جمع موجودی تمام حساب‌ها</p>
                    </div>
                    <button class="btn-primary" @click="openAccountModal()">
                        <i class="fas fa-plus ml-2"></i>
                        حساب جدید
                    </button>
                </div>
            </div>

            <div class="card p-4">
                <div class="flex justify-between items-center mb-4">
                    <div class="flex space-x-2 space-x-reverse">
                        <input type="text" placeholder="جستجو..." class="form-input" x-model="accountSearch">
                        <select class="form-input" x-model="accountFilter">
                            <option value="all">همه حساب‌ها</option>
                            <option value="bank">بانکی</option>
                            <option value="cash">نقدی</option>
                            <option value="card">کارت</option>
                            <option value="wallet">کیف پول</option>
                        </select>
                    </div>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                    <template x-for="account in filteredAccounts" :key="account.id">
                        <div class="card p-4">
                            <div class="flex justify-between items-start mb-3">
                                <div class="flex items-center space-x-2 space-x-reverse">
                                    <i :class="getAccountTypeIcon(account.type)" class="text-primary text-xl"></i>
                                    <div>
                                        <h3 class="font-bold" x-text="account.name"></h3>
                                        <p class="text-sm text-text-muted" x-text="getAccountTypeLabel(account.type)"></p>
                                    </div>
                                </div>
                                <span class="text-xs px-2 py-1 rounded" :class="account.isActive ? 'bg-green-900 text-green-100' : 'bg-red-900 text-red-100'" x-text="account.isActive ? 'فعال' : 'غیرفعال'"></span>
                            </div>

                            <div class="space-y-2 mb-4">
                                <div class="flex justify-between">
                                    <span class="text-text-muted">موجودی:</span>
                                    <span class="font-bold" :class="account.balance >= 0 ? 'text-green-400' : 'text-red-400'" x-text="formatCurrency(account.balance, account.currency)"></span>
                                </div>
                                <div class="flex justify-between" x-show="account.accountNumber">
                                    <span class="text-text-muted">شماره حساب:</span>
                                    <span x-text="account.accountNumber"></span>
                                </div>
                                <div class="flex justify-between" x-show="account.sheba">
                                    <span class="text-text-muted">شبا:</span>
                                    <span class="text-xs" x-text="account.sheba"></span>
                                </div>
                            </div>

                            <div class="flex justify-between">
                                <button class="text-primary text-sm" @click="openAccountModal(account)">
                                    <i class="fas fa-edit ml-1"></i>
                                    ویرایش
                                </button>
                                <button class="text-red-400 text-sm" @click="deleteAccount(account.id)" x-show="account.id !== 1">
                                    <i class="fas fa-trash ml-1"></i>
                                    حذف
                                </button>
                            </div>
                        </div>
                    </template>
                </div>
            </div>

            <!-- Account Modal -->
            <div x-show="showAccountModal" class="modal-overlay fixed inset-0 flex items-center justify-center z-50 p-4">
                <div class="modal-content w-full max-w-2xl">
                    <div class="p-4 border-b border-dark-card-light flex justify-between items-center">
                        <h3 class="font-bold" x-text="editingAccount ? 'ویرایش حساب' : 'حساب جدید'"></h3>
                        <button @click="showAccountModal = false" class="text-text-muted hover:text-text-light">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>

                    <div class="p-4 space-y-4">
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label class="form-label">نام حساب</label>
                                <input type="text" class="form-input w-full" x-model="accountForm.name">
                            </div>
                            <div>
                                <label class="form-label">نوع حساب</label>
                                <select class="form-input w-full" x-model="accountForm.type">
                                    <template x-for="type in accountTypes" :key="type.value">
                                        <option :value="type.value" x-text="type.label"></option>
                                    </template>
                                </select>
                            </div>
                            <div>
                                <label class="form-label">موجودی اولیه</label>
                                <input type="number" class="form-input w-full" x-model="accountForm.balance">
                            </div>
                            <div>
                                <label class="form-label">ارز</label>
                                <select class="form-input w-full" x-model="accountForm.currency">
                                    <option value="IRR">ریال ایران</option>
                                    <option value="USD">دلار آمریکا</option>
                                    <option value="EUR">یورو</option>
                                </select>
                            </div>
                            <div x-show="accountForm.type === 'bank' || accountForm.type === 'card'">
                                <label class="form-label">شماره حساب/کارت</label>
                                <input type="text" class="form-input w-full" x-model="accountForm.accountNumber">
                            </div>
                            <div x-show="accountForm.type === 'bank'">
                                <label class="form-label">شماره شبا</label>
                                <input type="text" class="form-input w-full" x-model="accountForm.sheba">
                            </div>
                        </div>

                        <div class="flex items-center space-x-2 space-x-reverse">
                            <input type="checkbox" id="isActive" x-model="accountForm.isActive" class="rounded text-primary">
                            <label for="isActive">حساب فعال</label>
                        </div>
                    </div>

                    <div class="p-4 border-t border-dark-card-light flex justify-end space-x-2 space-x-reverse">
                        <button @click="showAccountModal = false" class="px-4 py-2 rounded border border-dark-card-light hover:bg-dark-card-light transition-colors">انصراف</button>
                        <button @click="saveAccount" class="btn-primary">ذخیره</button>
                    </div>
                </div>
            </div>
        </div>
    </template>

    <!-- Budget and Prediction Template -->
    <template x-if="budget">
        <div x-data="budget">
            <h2 class="text-xl font-bold mb-4">بودجه‌بندی و پیش‌بینی</h2>

            <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 mb-6">
                <div class="card p-4">
                    <h3 class="font-bold mb-2">خلاصه بودجه</h3>
                    <div class="space-y-2">
                        <div class="flex justify-between">
                            <span>بودجه تخصیص یافته:</span>
                            <span class="font-bold" x-text="formatCurrency(budgetSummary.totalAllocated)"></span>
                        </div>
                        <div class="flex justify-between">
                            <span>هزینه شده:</span>
                            <span class="font-bold text-red-400" x-text="formatCurrency(budgetSummary.totalSpent)"></span>
                        </div>
                        <div class="flex justify-between">
                            <span>مانده:</span>
                            <span class="font-bold text-green-400" x-text="formatCurrency(budgetSummary.remaining)"></span>
                        </div>
                        <div class="flex justify-between">
                            <span>نرخ استفاده:</span>
                            <span class="font-bold" x-text="budgetSummary.utilizationRate.toFixed(1) + '%'"></span>
                        </div>
                    </div>
                </div>

                <div class="card p-4 lg:col-span-2">
                    <h3 class="font-bold mb-4">پیش‌بینی‌ها</h3>
                    <div class="space-y-3">
                        <template x-for="prediction in predictions" :key="prediction.id">
                            <div class="flex items-center justify-between p-3 bg-dark-card-light rounded">
                                <div>
                                    <h4 class="font-medium" x-text="prediction.title"></h4>
                                    <p class="text-sm text-text-muted" x-text="prediction.factors.join('، ')"></p>
                                </div>
                                <div class="text-right">
                                    <div :class="prediction.type === 'income' ? 'text-green-400' : 'text-red-400'" x-text="formatCurrency(prediction.amount)"></div>
                                    <div class="text-xs text-text-muted" x-text="'اطمینان: ' + prediction.confidence + '%'"></div>
                                </div>
                            </div>
                        </template>
                    </div>
                </div>
            </div>

            <div class="card p-4">
                <div class="flex justify-between items-center mb-4">
                    <button class="btn-primary" @click="openBudgetModal()">
                        <i class="fas fa-plus ml-2"></i>
                        بودجه جدید
                    </button>

                    <div class="flex space-x-2 space-x-reverse">
                        <input type="text" placeholder="جستجو..." class="form-input" x-model="budgetSearch">
                        <select class="form-input" x-model="budgetPeriod">
                            <option value="all">همه دوره‌ها</option>
                            <option value="monthly">ماهانه</option>
                            <option value="quarterly">سه‌ماهه</option>
                            <option value="yearly">سالانه</option>
                        </select>
                    </div>
                </div>

                <div class="overflow-x-auto">
                    <table class="w-full">
                        <thead>
                            <tr class="text-right border-b border-dark-card-light">
                                <th class="py-2 px-4">دسته‌بندی</th>
                                <th class="py-2 px-4">تخصیص یافته</th>
                                <th class="py-2 px-4">هزینه شده</th>
                                <th class="py-2 px-4">مانده</th>
                                <th class="py-2 px-4">وضعیت</th>
                                <th class="py-2 px-4">دوره</th>
                                <th class="py-2 px-4">عملیات</th>
                            </tr>
                        </thead>
                        <tbody>
                            <template x-for="budget in filteredBudgets" :key="budget.id">
                                <tr class="table-row">
                                    <td class="py-3 px-4" x-text="budget.category"></td>
                                    <td class="py-3 px-4" x-text="formatCurrency(budget.allocated)"></td>
                                    <td class="py-3 px-4" x-text="formatCurrency(budget.spent)"></td>
                                    <td class="py-3 px-4" :class="(budget.allocated - budget.spent) >= 0 ? 'text-green-400' : 'text-red-400'" x-text="formatCurrency(budget.allocated - budget.spent)"></td>
                                    <td class="py-3 px-4">
                                        <span class="text-xs px-2 py-1 rounded" :class="getBudgetStatusColor(budget)" x-text="getBudgetStatusText(budget)"></span>
                                    </td>
                                    <td class="py-3 px-4" x-text="budget.period"></td>
                                    <td class="py-3 px-4">
                                        <div class="flex space-x-2 space-x-reverse">
                                            <button class="text-blue-400" @click="openBudgetModal(budget)">
                                                <i class="fas fa-edit"></i>
                                            </button>
                                        </div>
                                    </td>
                                </tr>
                            </template>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </template>

    <!-- Standalone Persian Calendar Component Example -->
    <template x-if="currentModule === 'calendar'">
        <div>
            <h2 class="text-xl font-bold mb-4">تقویم فارسی</h2>
            
            <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                <!-- Calendar Widget -->
                <div class="lg:col-span-2">
                    <div class="card p-4">
                        <div x-data="persianCalendar()" class="persian-calendar">
                            <div class="calendar-header">
                                <button @click="prevMonth()" class="calendar-nav-btn">
                                    <i class="fas fa-chevron-right"></i>
                                </button>
                                <h3 class="text-lg font-bold" x-text="calendarTitle"></h3>
                                <button @click="nextMonth()" class="calendar-nav-btn">
                                    <i class="fas fa-chevron-left"></i>
                                </button>
                            </div>
                            
                            <div class="calendar-weekdays">
                                <template x-for="weekday in weekdays" :key="weekday">
                                    <div class="calendar-weekday" x-text="weekday"></div>
                                </template>
                            </div>
                            
                            <div class="calendar-grid">
                                <template x-for="day in calendarDays" :key="day.date.toString()">
                                    <div class="calendar-day"
                                        :class="{
                                            'today': day.isToday,
                                            'selected': day.isSelected,
                                            'other-month': !day.isCurrentMonth,
                                            'has-event': day.hasEvent
                                        }"
                                        @click="selectDate(day)">
                                        <span x-text="day.day"></span>
                                    </div>
                                </template>
                            </div>
                            
                            <div class="p-4 border-t border-dark-card-light flex justify-between">
                                <button @click="goToToday()" class="btn-primary text-sm">
                                    امروز
                                </button>
                                <div class="text-sm text-text-muted" x-text="selectedDate ? formatDate(selectedDate) : ''"></div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Quick Actions and Events -->
                <div class="space-y-6">
                    <div class="card p-4">
                        <h3 class="font-bold mb-4">رویدادهای امروز</h3>
                        <div x-data="persianCalendar()" class="space-y-2">
                            <template x-for="event in events" :key="event.date.toString()">
                                <div class="flex items-center justify-between p-3 bg-dark-card-light rounded">
                                    <div class="flex items-center space-x-2 space-x-reverse">
                                        <i class="fas fa-calendar text-primary"></i>
                                        <span x-text="event.title"></span>
                                    </div>
                                    <span class="text-xs text-text-muted" x-text="formatDate(event.date)"></span>
                                </div>
                            </template>
                        </div>
                    </div>
                    
                    <!-- Quick Date Input -->
                    <div class="card p-4">
                        <h3 class="font-bold mb-4">انتخاب تاریخ</h3>
                        <div class="relative" x-data="persianDateInput()">
                            <input type="text" 
                                class="form-input w-full calendar-input" 
                                placeholder="انتخاب تاریخ..."
                                x-model="displayValue"
                                @click="showPicker = true"
                                readonly>
                            <div x-show="showPicker" class="calendar-dropdown">
                                <div x-data="persianCalendar()" 
                                    @date-selected="onDateSelected($event)"
                                    class="persian-calendar">
                                </div>
                            </div>
                            <i class="fas fa-calendar absolute left-3 top-1/2 transform -translate-y-1/2 text-text-muted"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </template>

    <script>
        document.addEventListener('alpine:init', () => {
            Alpine.data('app', () => ({
                // Application state
                currentScreen: 'login',
                currentModule: 'dashboard',
                sidebarOpen: true,
                // Financial state
                transactions: [
                    { id: 1, title: 'فروش محصول A', type: 'income', amount: 5000000, date: '1402/05/10', category: 'فروش', project: 'بهبود سیستم', description: 'فروش به شرکت نمونه' },
                    { id: 2, title: 'خرید تجهیزات', type: 'expense', amount: 2500000, date: '1402/05/12', category: 'خرید', project: 'طراحی سایت', description: 'خرید مانیتور جدید' },
                    { id: 3, title: 'حقوق کارکنان', type: 'expense', amount: 8000000, date: '1402/05/15', category: 'حقوق', project: '', description: 'حقوق ماهانه' },
                    { id: 4, title: 'فروش خدمات پشتیبانی', type: 'income', amount: 3000000, date: '1402/05/18', category: 'خدمات', project: 'توسعه اپلیکیشن', description: 'پشتیبانی سالانه' }
                ],
                showTransactionModal: false,
                editingTransaction: null,
                transactionForm: {
                    title: '',
                    type: 'income',
                    amount: 0,
                    date: '',
                    category: '',
                    project: '',
                    account: 'نقدی',
                    description: ''
                },
                
                // Contacts state
                contacts: [
                    { id: 1, name: 'علی محمدی', type: 'person', role: 'customer', phone: '09123456789', email: 'ali@example.com', company: 'شرکت نمونه', address: 'تهران، خیابان نمونه', notes: 'مشتری دائمی' },
                    { id: 2, name: 'شرکت توسعه', type: 'company', role: 'supplier', phone: '021-1234567', email: 'info@tosee.com', registrationNumber: '12345', address: 'اصفهان، خیابان توسعه', notes: 'تأمین‌کننده نرم‌افزار' },
                    { id: 3, name: 'مریم کریمی', type: 'person', role: 'customer', phone: '09129876543', email: 'maryam@example.com', company: '', address: 'مشهد، بلوار شهید', notes: '' }
                ],
                contactSearch: '',
                contactFilter: 'all',
                showContactModal: false,
                editingContact: null,
                contactForm: {
                    type: 'person',
                    role: 'customer',
                    name: '',
                    lastName: '',
                    phone: '',
                    email: '',
                    company: '',
                    registrationNumber: '',
                    nationalCode: '',
                    address: '',
                    notes: ''
                },
                
                // Teams state
                teams: [
                    { id: 1, name: 'تیم توسعه', description: 'تیم مسئول توسعه نرم‌افزار', progress: 75, members: [
                        { id: 1, name: 'علی', online: true },
                        { id: 2, name: 'مریم', online: false },
                        { id: 3, name: 'رضا', online: true },
                        { id: 4, name: 'سارا', online: true }
                    ]},
                    { id: 2, name: 'تیم فروش', description: 'تیم مسئول فروش و بازاریابی', progress: 60, members: [
                        { id: 5, name: 'محمد', online: false },
                        { id: 6, name: 'فاطمه', online: true }
                    ]},
                    { id: 3, name: 'تیم پشتیبانی', description: 'تیم مسئول پشتیبانی مشتریان', progress: 90, members: [
                        { id: 7, name: 'امیر', online: true },
                        { id: 8, name: 'نازنین', online: true },
                        { id: 9, name: 'حسین', online: false }
                    ]}
                ],
                teamSearch: '',
                showTeamModal: false,
                editingTeam: null,
                teamForm: {
                    name: '',
                    description: '',
                    members: []
                },
                
                // Files state
                files: [
                    { id: 1, name: 'گزارش مالی.pdf', type: 'document', size: '2.5 MB', uploadDate: '1402/05/10', uploader: 'مدیر سیستم' },
                    { id: 2, name: 'نمودار پیشرفت.png', type: 'image', size: '1.2 MB', uploadDate: '1402/05/12', uploader: 'علی محمدی' },
                    { id: 3, name: 'مستندات فنی.zip', type: 'archive', size: '5.7 MB', uploadDate: '1402/05/15', uploader: 'مریم کریمی' },
                    { id: 4, name: 'قرارداد همکاری.docx', type: 'document', size: '0.8 MB', uploadDate: '1402/05/18', uploader: 'مدیر سیستم' }
                ],
                fileSearch: '',
                fileFilter: 'all',
                showFileUploadModal: false,
                
                // Users state
                users: [
                    { id: 1, name: 'مدیر سیستم', username: 'admin', role: 'admin', roleText: 'مدیر', email: 'admin@example.com', phone: '021-1234567', active: true, lastLogin: '1402/05/20 10:30' },
                    { id: 2, name: 'علی محمدی', username: 'ali', role: 'manager', roleText: 'مدیر پروژه', email: 'ali@example.com', phone: '09123456789', active: true, lastLogin: '1402/05/20 09:15' },
                    { id: 3, name: 'مریم کریمی', username: 'maryam', role: 'user', roleText: 'کاربر', email: 'maryam@example.com', phone: '09129876543', active: true, lastLogin: '1402/05/19 14:20' },
                    { id: 4, name: 'رضا احمدی', username: 'reza', role: 'user', roleText: 'کاربر', email: 'reza@example.com', phone: '09351234567', active: false, lastLogin: '1402/05/10 11:45' }
                ],
                userSearch: '',
                userFilter: 'all',
                showUserModal: false,
                editingUser: null,
                userForm: {
                    name: '',
                    username: '',
                    role: 'user',
                    email: '',
                    phone: '',
                    active: true
                },
                
                // Reports state
                reportsTab: 'financial',
                financialReports: [
                    { period: 'اردیبهشت 1402', income: 15000000, expense: 9500000, profit: 5500000, balance: 5500000 },
                    { period: 'خرداد 1402', income: 12000000, expense: 8000000, profit: 4000000, balance: 9500000 },
                    { period: 'تیر 1402', income: 18000000, expense: 11000000, profit: 7000000, balance: 16500000 }
                ],
                
                // New methods for additional modules
                
                // Financial methods
                get totalIncome() {
                    return this.transactions
                        .filter(t => t.type === 'income')
                        .reduce((sum, t) => sum + t.amount, 0);
                },
                
                get totalExpense() {
                    return this.transactions
                        .filter(t => t.type === 'expense')
                        .reduce((sum, t) => sum + t.amount, 0);
                },
                
                get totalBalance() {
                    return this.totalIncome - this.totalExpense;
                },
                
                openTransactionModal(transaction = null) {
                    this.editingTransaction = transaction;
                    
                    if (transaction) {
                        this.transactionForm = { ...transaction };
                    } else {
                        this.transactionForm = {
                            title: '',
                            type: 'income',
                            amount: 0,
                            date: '',
                            category: '',
                            project: '',
                            account: 'نقدی',
                            description: ''
                        };
                    }
                    
                    this.showTransactionModal = true;
                },
                
                saveTransaction() {
                    if (this.editingTransaction) {
                        // Update existing transaction
                        const index = this.transactions.findIndex(t => t.id === this.editingTransaction.id);
                        if (index !== -1) {
                            this.transactions[index] = { ...this.editingTransaction, ...this.transactionForm };
                        }
                    } else {
                        // Add new transaction
                        const newTransaction = {
                            id: Math.max(...this.transactions.map(t => t.id)) + 1,
                            ...this.transactionForm
                        };
                        this.transactions.push(newTransaction);
                    }
                    
                    this.showTransactionModal = false;
                    this.updateDashboardStats();
                },
                
                deleteTransaction(transactionId) {
                    if (confirm('آیا از حذف این تراکنش اطمینان دارید؟')) {
                        this.transactions = this.transactions.filter(transaction => transaction.id !== transactionId);
                        this.updateDashboardStats();
                    }
                },
                
                // Contacts methods
                get filteredContacts() {
                    let filtered = this.contacts;
                    
                    // Apply search filter
                    if (this.contactSearch) {
                        filtered = filtered.filter(contact => 
                            contact.name.includes(this.contactSearch) || 
                            contact.phone.includes(this.contactSearch) ||
                            contact.email.includes(this.contactSearch)
                        );
                    }
                    
                    // Apply type filter
                    if (this.contactFilter !== 'all') {
                        filtered = filtered.filter(contact => contact.type === this.contactFilter);
                    }
                    
                    return filtered;
                },
                
                openContactModal(contact = null) {
                    this.editingContact = contact;
                    
                    if (contact) {
                        this.contactForm = { ...contact };
                    } else {
                        this.contactForm = {
                            type: 'person',
                            role: 'customer',
                            name: '',
                            lastName: '',
                            phone: '',
                            email: '',
                            company: '',
                            registrationNumber: '',
                            nationalCode: '',
                            address: '',
                            notes: ''
                        };
                    }
                    
                    this.showContactModal = true;
                },
                
                saveContact() {
                    if (this.editingContact) {
                        // Update existing contact
                        const index = this.contacts.findIndex(c => c.id === this.editingContact.id);
                        if (index !== -1) {
                            this.contacts[index] = { ...this.editingContact, ...this.contactForm };
                        }
                    } else {
                        // Add new contact
                        const newContact = {
                            id: Math.max(...this.contacts.map(c => c.id)) + 1,
                            ...this.contactForm
                        };
                        this.contacts.push(newContact);
                    }
                    
                    this.showContactModal = false;
                },
                
                // Teams methods
                get filteredTeams() {
                    let filtered = this.teams;
                    
                    // Apply search filter
                    if (this.teamSearch) {
                        filtered = filtered.filter(team => 
                            team.name.includes(this.teamSearch) || 
                            team.description.includes(this.teamSearch)
                        );
                    }
                    
                    return filtered;
                },
                
                openTeamModal(team = null) {
                    this.editingTeam = team;
                    
                    if (team) {
                        this.teamForm = { ...team };
                    } else {
                        this.teamForm = {
                            name: '',
                            description: '',
                            members: []
                        };
                    }
                    
                    this.showTeamModal = true;
                },
                
                // Files methods
                get filteredFiles() {
                    let filtered = this.files;
                    
                    // Apply search filter
                    if (this.fileSearch) {
                        filtered = filtered.filter(file => 
                            file.name.includes(this.fileSearch)
                        );
                    }
                    
                    // Apply type filter
                    if (this.fileFilter !== 'all') {
                        filtered = filtered.filter(file => file.type === this.fileFilter);
                    }
                    
                    return filtered;
                },
                
                getFileIcon(fileType) {
                    const icons = {
                        'document': 'fas fa-file-pdf',
                        'image': 'fas fa-file-image',
                        'archive': 'fas fa-file-archive',
                        'default': 'fas fa-file'
                    };
                    return icons[fileType] || icons.default;
                },
                
                openFileUploadModal() {
                    this.showFileUploadModal = true;
                },
                
                deleteFile(fileId) {
                    if (confirm('آیا از حذف این فایل اطمینان دارید؟')) {
                        this.files = this.files.filter(file => file.id !== fileId);
                    }
                },
                
                // Users methods
                get filteredUsers() {
                    let filtered = this.users;
                    
                    // Apply search filter
                    if (this.userSearch) {
                        filtered = filtered.filter(user => 
                            user.name.includes(this.userSearch) || 
                            user.username.includes(this.userSearch) ||
                            user.email.includes(this.userSearch)
                        );
                    }
                    
                    // Apply status filter
                    if (this.userFilter === 'active') {
                        filtered = filtered.filter(user => user.active);
                    } else if (this.userFilter === 'inactive') {
                        filtered = filtered.filter(user => !user.active);
                    }
                    
                    return filtered;
                },
                
                getUserRoleClass(role) {
                    const classes = {
                        'admin': 'user-role-admin',
                        'manager': 'user-role-manager',
                        'user': 'user-role-user'
                    };
                    return classes[role] || classes.user;
                },
                
                getUserRoleBadgeClass(role) {
                    const classes = {
                        'admin': 'bg-yellow-700 text-yellow-100',
                        'manager': 'bg-blue-700 text-blue-100',
                        'user': 'bg-gray-700 text-gray-100'
                    };
                    return classes[role] || classes.user;
                },
                
                openUserModal(user = null) {
                    this.editingUser = user;
                    
                    if (user) {
                        this.userForm = { ...user };
                    } else {
                        this.userForm = {
                            name: '',
                            username: '',
                            role: 'user',
                            email: '',
                            phone: '',
                            active: true
                        };
                    }
                    
                    this.showUserModal = true;
                },
                
                toggleUserStatus(userId) {
                    const user = this.users.find(u => u.id === userId);
                    if (user) {
                        user.active = !user.active;
                    }
                },
                
                deleteUser(userId) {
                    if (confirm('آیا از حذف این کاربر اطمینان دارید؟')) {
                        this.users = this.users.filter(user => user.id !== userId);
                    }
                },
                
                // Notification methods
                markNotificationsAsRead() {
                    this.notifications.forEach(notification => {
                        notification.read = true;
                    });
                },
                
                // Update dashboard stats
                updateDashboardStats() {
                    this.dashboardStats.totalBalance = this.totalBalance;
                },
               
                // Login state
                loginForm: {
                    username: '',
                    password: ''
                },
                loginLoading: false,
                loginError: '',
                loginAttempts: 0,
                
                // User state
                currentUser: {
                    id: 1,
                    name: 'مدیر سیستم',
                    role: 'admin',
                    username: 'admin'
                },
                
                // Dashboard state
                dashboardTab: 'activities',
                dashboardStats: {
                    myTasks: 12,
                    activeProjects: 5,
                    totalBalance: 125000000,
                    todayReminders: 3
                },
                recentActivities: [
                    { id: 1, icon: 'fas fa-tasks', description: 'وظیفه "بررسی گزارش مالی" تکمیل شد', time: '2 ساعت پیش' },
                    { id: 2, icon: 'fas fa-project-diagram', description: 'پروژه "بهبود سیستم" آغاز شد', time: '5 ساعت پیش' },
                    { id: 3, icon: 'fas fa-comment', description: 'نظر جدید در پروژه "طراحی سایت"', time: '1 روز پیش' },
                    { id: 4, icon: 'fas fa-user-plus', description: 'کاربر جدید "علی محمدی" اضافه شد', time: '1 روز پیش' }
                ],
                todaysTasks: [
                    { id: 1, title: 'بررسی گزارش مالی', priority: 'high', priorityText: 'بالا', completed: true, time: '10:00' },
                    { id: 2, title: 'جلسه با تیم توسعه', priority: 'normal', priorityText: 'عادی', completed: false, time: '11:30' },
                    { id: 3, title: 'ارسال ایمیل به مشتری', priority: 'low', priorityText: 'کم', completed: false, time: '14:00' }
                ],
                projectProgress: [
                    { id: 1, name: 'بهبود سیستم', progress: 75 },
                    { id: 2, name: 'طراحی سایت', progress: 40 },
                    { id: 3, name: 'توسعه اپلیکیشن', progress: 20 },
                    { id: 4, name: 'مهاجرت داده', progress: 90 }
                ],
                
                // Tasks state
                taskSearch: '',
                taskFilter: 'all',
                tasks: [
                    { id: 1, title: 'بررسی گزارش مالی', project: 'بهبود سیستم', priority: 'high', priorityText: 'بالا', completed: true, date: '1402/05/15' },
                    { id: 2, title: 'جلسه با تیم توسعه', project: 'توسعه اپلیکیشن', priority: 'normal', priorityText: 'عادی', completed: false, date: '1402/05/16' },
                    { id: 3, title: 'ارسال ایمیل به مشتری', project: 'طراحی سایت', priority: 'low', priorityText: 'کم', completed: false, date: '1402/05/16' },
                    { id: 4, title: 'آپدیت دیتابیس', project: 'مهاجرت داده', priority: 'urgent', priorityText: 'فوری', completed: false, date: '1402/05/17' }
                ],
                showTaskModal: false,
                editingTask: null,
                taskForm: {
                    title: '',
                    description: '',
                    projectId: '',
                    priority: 'normal',
                    startDate: '',
                    endDate: '',
                    completed: false
                },
                
                // Projects state
                projects: [
                    { id: 1, name: 'بهبود سیستم', description: 'ارتقاء سیستم مدیریت موجودی', status: 'active', statusText: 'فعال', progress: 75, endDate: '1402/07/30', teamSize: 5 },
                    { id: 2, name: 'طراحی سایت', description: 'طراحی و توسعه وبسایت جدید شرکت', status: 'active', statusText: 'فعال', progress: 40, endDate: '1402/08/15', teamSize: 3 },
                    { id: 3, name: 'توسعه اپلیکیشن', description: 'توسعه اپلیکیشن موبایل برای مشتریان', status: 'planning', statusText: 'برنامه‌ریزی', progress: 20, endDate: '1402/09/10', teamSize: 4 },
                    { id: 4, name: 'مهاجرت داده', description: 'انتقال داده‌ها به سرور جدید', status: 'active', statusText: 'فعال', progress: 90, endDate: '1402/06/20', teamSize: 2 }
                ],
                showProjectModal: false,
                editingProject: null,
                projectTab: 'info',
                projectForm: {
                    name: '',
                    description: '',
                    status: 'planning',
                    startDate: '',
                    endDate: '',
                    progress: 0,
                    budget: 0,
                    actualCost: 0
                },
                projectTasks: [],
                
                // Calendar state
                calendarTitle: '',
                calendarDays: [],
                persianWeekDays: ['ش', 'ی', 'د', 'س', 'چ', 'پ', 'ج'],
                currentCalendarDate: null,
                
                // Notifications state
                notifications: [
                    { id: 1, title: 'یادآوری جلسه', message: 'جلسه با تیم توسعه امروز ساعت 11:30', time: '2 ساعت پیش', read: false },
                    { id: 2, title: 'تکمیل وظیفه', message: 'وظیفه "بررسی گزارش مالی" تکمیل شد', time: '3 ساعت پیش', read: true },
                    { id: 3, title: 'نظر جدید', message: 'نظر جدید در پروژه "طراحی سایت"', time: '5 ساعت پیش', read: false }
                ],
                
                // Settings state
                settingsTab: 'profile',
                userProfile: {
                    username: 'admin',
                    email: 'admin@example.com',
                    firstName: 'مدیر',
                    lastName: 'سیستم',
                    phone: '021-1234567',
                    mobile: '09123456789',
                    address: 'تهران، خیابان نمونه، پلاک 123'
                },
                preferences: {
                    language: 'fa',
                    calendar: 'jalali',
                    theme: 'dark',
                    fontSize: 'medium',
                    fontFamily: 'vazir'
                },
                connectionStatus: 'online',
                connectionSettings: {
                    serverUrl: 'https://api.esmartis.ir',
                    onlineUsername: 'admin',
                    onlinePassword: '',
                    autoSync: true
                },
                
                // Menu items
                menuItems: [
                    { id: 'dashboard', title: 'داشبورد', icon: 'fas fa-tachometer-alt', open: false },
                    { id: 'calendar', title: 'تقویم', icon: 'fas fa-calendar', open: false },
                    { id: 'tasks', title: 'وظایف', icon: 'fas fa-tasks', open: false },
                    { id: 'projects', title: 'پروژه‌ها', icon: 'fas fa-project-diagram', open: false },
                    
                    { 
                        id: 'finance', 
                        title: 'مالی', 
                        icon: 'fas fa-wallet', 
                        open: false,
                        children: [
                            { id: 'transactions', title: 'تراکنش‌ها' },
                            { id: 'accounts', title: 'حساب‌ها' },
                            { id: 'budget', title: 'بودجه‌بندی' }
                        ]
                    },
                    { 
                        id: 'collaboration', 
                        title: 'همکاری', 
                        icon: 'fas fa-users', 
                        open: false,
                        children: [
                            { id: 'teams', title: 'تیم‌ها' },
                            { id: 'contacts', title: 'مخاطبین' },
                            { id: 'fileshare', title: 'اشتراک فایل' }
                        ]
                    },
                    { 
                        id: 'tools', 
                        title: 'ابزارها', 
                        icon: 'fas fa-toolbox', 
                        open: false,
                        children: [
                            { id: 'notebook', title: 'یادداشت' },
                            { id: 'whiteboard', title: 'تخته سفید' },
                            { id: 'reminder', title: 'یادآور' }
                        ]
                    },
                    { 
                        id: 'admin', 
                        title: 'مدیریت', 
                        icon: 'fas fa-cogs', 
                        open: false,
                        children: [
                            { id: 'users', title: 'کاربران' },
                            { id: 'permissions', title: 'مجوزها' },
                            { id: 'reports', title: 'گزارش‌ها' },
                            { id: 'activity', title: 'فعالیت‌ها' }
                        ]
                    },
                    { id: 'settings', title: 'تنظیمات', icon: 'fas fa-cog', open: false }
                ],
                
                
              
                
                // Login methods
                async handleLogin() {
                    this.loginLoading = true;
                    this.loginError = '';
                    
                    // Simulate API call
                    await new Promise(resolve => setTimeout(resolve, 1000));
                    
                    if (this.loginForm.username === 'admin' && this.loginForm.password === '654321') {
                        this.currentScreen = 'main';
                        this.loginAttempts = 0;
                    } else {
                        this.loginError = 'نام کاربری یا رمز عبور نادرست است';
                        this.loginAttempts++;
                        
                        if (this.loginAttempts >= 3) {
                            this.loginError = 'تلاش‌های ناموفق زیاد بود. لطفا 10 ثانیه دیگر تلاش کنید.';
                            this.loginLoading = true;
                            
                            setTimeout(() => {
                                this.loginLoading = false;
                            }, 10000);
                        }
                    }
                    
                    this.loginLoading = false;
                },
                
                logout() {
                    this.currentScreen = 'login';
                    this.loginForm.username = '';
                    this.loginForm.password = '';
                },
                
                // Navigation methods
                toggleSidebar() {
                    this.sidebarOpen = !this.sidebarOpen;
                },
                
                changeModule(moduleId) {
                    this.currentModule = moduleId;
                    
                    // Toggle submenu if exists
                    const menuItem = this.menuItems.find(item => item.id === moduleId);
                    if (menuItem && menuItem.children) {
                        menuItem.open = !menuItem.open;
                    }
                },
                
                // Dashboard methods
                getPriorityClass(priority) {
                    const classes = {
                        'low': 'bg-gray-700 text-gray-100',
                        'normal': 'bg-blue-700 text-blue-100',
                        'high': 'bg-yellow-700 text-yellow-100',
                        'urgent': 'bg-red-700 text-red-100'
                    };
                    return classes[priority] || classes.normal;
                },
                
                getStatusClass(status) {
                    const classes = {
                        'planning': 'bg-gray-700 text-gray-100',
                        'active': 'bg-green-700 text-green-100',
                        'on-hold': 'bg-yellow-700 text-yellow-100',
                        'completed': 'bg-blue-700 text-blue-100'
                    };
                    return classes[status] || classes.planning;
                },
                
                formatCurrency(amount) {
                    return new Intl.NumberFormat('fa-IR').format(amount) + ' ریال';
                },
                
                // Task methods
                get filteredTasks() {
                    let filtered = this.tasks;
                    
                    // Apply search filter
                    if (this.taskSearch) {
                        filtered = filtered.filter(task => 
                            task.title.includes(this.taskSearch) || 
                            task.project.includes(this.taskSearch)
                        );
                    }
                    
                    // Apply status filter
                    if (this.taskFilter === 'active') {
                        filtered = filtered.filter(task => !task.completed);
                    } else if (this.taskFilter === 'completed') {
                        filtered = filtered.filter(task => task.completed);
                    }
                    
                    return filtered;
                },
                
                openTaskModal(task = null) {
                    this.editingTask = task;
                    
                    if (task) {
                        this.taskForm = { ...task };
                    } else {
                        this.taskForm = {
                            title: '',
                            description: '',
                            projectId: '',
                            priority: 'normal',
                            startDate: '',
                            endDate: '',
                            completed: false
                        };
                    }
                    
                    this.showTaskModal = true;
                },
                
                saveTask() {
                    if (this.editingTask) {
                        // Update existing task
                        const index = this.tasks.findIndex(t => t.id === this.editingTask.id);
                        if (index !== -1) {
                            this.tasks[index] = { ...this.editingTask, ...this.taskForm };
                        }
                    } else {
                        // Add new task
                        const newTask = {
                            id: Math.max(...this.tasks.map(t => t.id)) + 1,
                            ...this.taskForm,
                            project: this.projects.find(p => p.id === this.taskForm.projectId)?.name || 'بدون پروژه'
                        };
                        this.tasks.push(newTask);
                    }
                    
                    this.showTaskModal = false;
                },
                
                deleteTask(taskId) {
                    if (confirm('آیا از حذف این وظیفه اطمینان دارید؟')) {
                        this.tasks = this.tasks.filter(task => task.id !== taskId);
                    }
                },
                
                // Project methods
                openProjectModal(project = null) {
                    this.editingProject = project;
                    this.projectTab = 'info';
                    
                    if (project) {
                        this.projectForm = { ...project };
                        this.projectTasks = this.tasks.filter(task => task.project === project.name);
                    } else {
                        this.projectForm = {
                            name: '',
                            description: '',
                            status: 'planning',
                            startDate: '',
                            endDate: '',
                            progress: 0,
                            budget: 0,
                            actualCost: 0
                        };
                        this.projectTasks = [];
                    }
                    
                    this.showProjectModal = true;
                },
                
                saveProject() {
                    if (this.editingProject) {
                        // Update existing project
                        const index = this.projects.findIndex(p => p.id === this.editingProject.id);
                        if (index !== -1) {
                            this.projects[index] = { ...this.editingProject, ...this.projectForm };
                        }
                    } else {
                        // Add new project
                        const newProject = {
                            id: Math.max(...this.projects.map(p => p.id)) + 1,
                            ...this.projectForm,
                            teamSize: 0
                        };
                        this.projects.push(newProject);
                    }
                    
                    this.showProjectModal = false;
                },
                
                // Calendar methods
                initCalendar() {
                    this.currentCalendarDate = new Date();
                    this.updateCalendar();
                },
                
                updateCalendar() {
                    const year = this.currentCalendarDate.getFullYear();
                    const month = this.currentCalendarDate.getMonth();
                    
                    // Set calendar title (in Persian)
                    const persianMonths = ['فروردین', 'اردیبهشت', 'خرداد', 'تیر', 'مرداد', 'شهریور', 'مهر', 'آبان', 'آذر', 'دی', 'بهمن', 'اسفند'];
                    this.calendarTitle = `${persianMonths[month]} ${year + 621}`;
                    
                    // Generate calendar days
                    const firstDay = new Date(year, month, 1);
                    const lastDay = new Date(year, month + 1, 0);
                    const daysInMonth = lastDay.getDate();
                    const startingDay = firstDay.getDay();
                    
                    this.calendarDays = [];
                    
                    // Add previous month's days
                    const prevMonthLastDay = new Date(year, month, 0).getDate();
                    for (let i = 0; i < startingDay; i++) {
                        this.calendarDays.push({
                            day: prevMonthLastDay - i,
                            date: `${year}-${month}-${prevMonthLastDay - i}`,
                            isToday: false,
                            hasEvent: Math.random() > 0.7,
                            isCurrentMonth: false
                        });
                    }
                    this.calendarDays.reverse();
                    
                    // Add current month's days
                    const today = new Date();
                    for (let i = 1; i <= daysInMonth; i++) {
                        const isToday = today.getDate() === i && today.getMonth() === month && today.getFullYear() === year;
                        this.calendarDays.push({
                            day: i,
                            date: `${year}-${month + 1}-${i}`,
                            isToday: isToday,
                            hasEvent: Math.random() > 0.7,
                            isCurrentMonth: true
                        });
                    }
                    
                    // Add next month's days to fill the grid
                    const totalCells = 42; // 6 weeks
                    const remainingDays = totalCells - this.calendarDays.length;
                    for (let i = 1; i <= remainingDays; i++) {
                        this.calendarDays.push({
                            day: i,
                            date: `${year}-${month + 2}-${i}`,
                            isToday: false,
                            hasEvent: Math.random() > 0.7,
                            isCurrentMonth: false
                        });
                    }
                },
                
                prevMonth() {
                    this.currentCalendarDate = new Date(
                        this.currentCalendarDate.getFullYear(),
                        this.currentCalendarDate.getMonth() - 1,
                        1
                    );
                    this.updateCalendar();
                },
                
                nextMonth() {
                    this.currentCalendarDate = new Date(
                        this.currentCalendarDate.getFullYear(),
                        this.currentCalendarDate.getMonth() + 1,
                        1
                    );
                    this.updateCalendar();
                },
                
                goToToday() {
                    this.currentCalendarDate = new Date();
                    this.updateCalendar();
                },
                
                openDayEvents(day) {
                    alert(`رویدادهای روز ${day.day}`);
                },
                
                // Settings methods
                testConnection() {
                    alert('اتصال در حال آزمایش...');
                },
                
                syncData() {
                    alert('داده‌ها در حال همگام‌سازی...');
                },
                
                // Utility methods
                loadDefaultData() {
                    // In a real app, this would load data from an API or localStorage
                    console.log('Loading default data...');
                },
                
                // Project Management
                showGanttView: false,
                projectKanbanColumns: [
                    { id: 'todo', title: 'در انتظار', tasks: [] },
                    { id: 'inprogress', title: 'در حال انجام', tasks: [] },
                    { id: 'review', title: 'در حال بررسی', tasks: [] },
                    { id: 'done', title: 'تکمیل شده', tasks: [] }
                ],
                ganttMonths: ['فروردین', 'اردیبهشت', 'خرداد', 'تیر', 'مرداد', 'شهریور'],
                
                // Budget and Prediction
                budgetSummary: {
                    allocated: 500000000,
                    spent: 320000000,
                    remaining: 180000000,
                    utilization: 64
                },
                prediction: {
                    nextMonthIncome: 85000000,
                    months: [
                        { name: 'فروردین', value: 60, amount: 60000000 },
                        { name: 'اردیبهشت', value: 75, amount: 75000000 },
                        { name: 'خرداد', value: 80, amount: 80000000 },
                        { name: 'تیر', value: 70, amount: 70000000 },
                        { name: 'مرداد', value: 85, amount: 85000000 },
                        { name: 'شهریور', value: 90, amount: 90000000 }
                    ]
                },
                budgetAlerts: [
                    { id: 1, message: 'بودجه پروژه طراحی سایت در حال اتمام است', project: 'طراحی سایت' },
                    { id: 2, message: 'هزینه‌های اداری از بودجه ماهانه بیشتر شده', project: 'عمومی' }
                ],
                budgetDetails: [
                    { id: 1, name: 'بهبود سیستم', allocated: 200000000, spent: 150000000, remaining: 50000000, utilization: 75, completionDate: '1402/07/30', status: 'on-track' },
                    { id: 2, name: 'طراحی سایت', allocated: 80000000, spent: 70000000, remaining: 10000000, utilization: 87, completionDate: '1402/08/15', status: 'warning' },
                    { id: 3, name: 'توسعه اپلیکیشن', allocated: 150000000, spent: 70000000, remaining: 80000000, utilization: 47, completionDate: '1402/09/10', status: 'on-track' },
                    { id: 4, name: 'مهاجرت داده', allocated: 70000000, spent: 30000000, remaining: 40000000, utilization: 43, completionDate: '1402/06/20', status: 'on-track' }
                ],
                
                // Contract Management
                contracts: [
                    { id: 1, title: 'قرارداد توسعه نرم‌افزار', party: 'شرکت نمونه', amount: 50000000, startDate: '1402/03/01', endDate: '1402/09/01', status: 'active', statusText: 'فعال', remainingDays: 45 },
                    { id: 2, title: 'قرارداد پشتیبانی', party: 'سازمان فناوری', amount: 30000000, startDate: '1402/05/01', endDate: '1403/05/01', status: 'active', statusText: 'فعال', remainingDays: 270 },
                    { id: 3, title: 'قرارداد طراحی', party: 'آژانس تبلیغاتی', amount: 25000000, startDate: '1402/04/15', endDate: '1402/07/15', status: 'expired', statusText: 'منقضی شده', remainingDays: -15 }
                ],
                contractSearch: '',
                contractFilter: 'all',
                showContractModal: false,
                editingContract: null,
                contractTab: 'basic',
                contractForm: {
                    title: '',
                    partyId: '',
                    startDate: '',
                    endDate: '',
                    amount: 0,
                    status: 'draft',
                    description: '',
                    payments: []
                },
                
                // Member Management
                members: [
                    { id: 1, name: 'علی محمدی', position: 'توسعه‌دهنده ارشد', department: 'توسعه', employeeId: 'EMP-001', hireDate: '1401/03/15', active: true },
                    { id: 2, name: 'مریم کریمی', position: 'مدیر پروژه', department: 'توسعه', employeeId: 'EMP-002', hireDate: '1401/06/20', active: true },
                    { id: 3, name: 'رضا احمدی', position: 'توسعه‌دهنده', department: 'توسعه', employeeId: 'EMP-003', hireDate: '1402/01/10', active: true },
                    { id: 4, name: 'سارا حسینی', position: 'متخصص بازاریابی', department: 'بازاریابی', employeeId: 'EMP-004', hireDate: '1401/11/05', active: false }
                ],
                memberSearch: '',
                memberFilter: 'all',
                showMemberModal: false,
                editingMember: null,
                memberTab: 'personal',
                memberForm: {
                    firstName: '',
                    lastName: '',
                    nationalId: '',
                    employeeId: '',
                    mobile: '',
                    email: '',
                    address: '',
                    position: '',
                    department: '',
                    hireDate: '',
                    contractType: 'fulltime',
                    baseSalary: 0,
                    supervisorId: '',
                    active: true
                },
                
                // Advanced Search
                searchQuery: {
                    keyword: '',
                    type: 'all',
                    dateFrom: '',
                    dateTo: '',
                    priority: 'all',
                    status: 'all',
                    project: 'all',
                    category: 'all'
                },
                searchResults: [],
                
                // User Activity
                activities: [
                    { id: 1, user: 'مدیر سیستم', action: 'ایجاد پروژه جدید', details: 'پروژه "بهبود سیستم" ایجاد شد', type: 'create', typeText: 'ایجاد', module: 'پروژه‌ها', time: '1402/05/20 10:30' },
                    { id: 2, user: 'علی محمدی', action: 'تکمیل وظیفه', details: 'وظیفه "بررسی گزارش مالی" تکمیل شد', type: 'update', typeText: 'ویرایش', module: 'وظایف', time: '1402/05/20 09:15' },
                    { id: 3, user: 'مریم کریمی', action: 'ویرایش مخاطب', details: 'اطلاعات مخاطب "شرکت توسعه" به‌روزرسانی شد', type: 'update', typeText: 'ویرایش', module: 'مخاطبین', time: '1402/05/19 16:45' },
                    { id: 4, user: 'مدیر سیستم', action: 'حذف تراکنش', details: 'تراکنش مالی با شناسه #125 حذف شد', type: 'delete', typeText: 'حذف', module: 'مالی', time: '1402/05/19 14:20' }
                ],
                activitySearch: '',
                activityFilter: 'all',
                activityDateFrom: '',
                activityDateTo: '',
                
                // System Administration
                lastBackup: {
                    time: '1402/05/19 02:00',
                    size: '45.2 MB',
                    status: 'success'
                },
                backupHistory: [
                    { id: 1, name: 'backup_14020519.zip', time: '1402/05/19 02:00', size: '45.2 MB', status: 'success' },
                    { id: 2, name: 'backup_14020518.zip', time: '1402/05/18 02:00', size: '44.8 MB', status: 'success' },
                    { id: 3, name: 'backup_14020517.zip', time: '1402/05/17 02:00', size: '44.5 MB', status: 'warning' }
                ],
                systemHealth: {
                    databaseSize: '45.2 MB',
                    activeUsers: 8,
                    cpuUsage: 45,
                    memoryUsage: 62,
                    storageUsage: 78
                },
                integrations: [
                    { id: 1, name: 'ایمیل', icon: 'fas fa-envelope', description: 'ارسال نوتیفیکیشن از طریق ایمیل', enabled: true },
                    { id: 2, name: 'پیامک', icon: 'fas fa-sms', description: 'ارسال پیامک به کاربران', enabled: false },
                    { id: 3, name: 'درگاه پرداخت', icon: 'fas fa-credit-card', description: 'پرداخت‌های آنلاین', enabled: true },
                    { id: 4, name: 'کلود استوریج', icon: 'fas fa-cloud', description: 'ذخیره‌سازی ابری فایل‌ها', enabled: false }
                ],
                automationRules: [
                    { id: 1, name: 'یادآوری سررسید', description: 'ارسال نوتیفیکیشن 3 روز قبل از سررسید وظایف', enabled: true, trigger: 'سررسید وظیفه', action: 'ارسال نوتیفیکیشن' },
                    { id: 2, name: 'بستن پروژه', description: 'بستن خودکار پروژه پس از تکمیل همه وظایف', enabled: true, trigger: 'تکمیل همه وظایف', action: 'بستن پروژه' },
                    { id: 3, name: 'ایجاد فاکتور', description: 'ایجاد خودکار فاکتور پس از تکمیل پروژه', enabled: false, trigger: 'تکمیل پروژه', action: 'ایجاد فاکتور' }
                ],
                
                // New methods for additional modules
                
                // Project Management Methods
                get totalProjectProgress() {
                    if (this.projects.length === 0) return 0;
                    const total = this.projects.reduce((sum, project) => sum + project.progress, 0);
                    return Math.round(total / this.projects.length);
                },
                
                getProjectColor(status) {
                    const colors = {
                        'planning': '#6b7280',
                        'active': '#3b82f6',
                        'on-hold': '#f59e0b',
                        'completed': '#10b981'
                    };
                    return colors[status] || colors.active;
                },
                
                calculateMilestonePosition(project) {
                    // Simplified calculation for demo
                    return Math.min(project.progress + 10, 95);
                },
                
                initKanbanTasks() {
                    // Initialize kanban tasks from projects
                    this.projects.forEach(project => {
                        // This would be populated from actual project tasks in a real app
                        this.projectKanbanColumns[0].tasks.push({
                            id: project.id * 10 + 1,
                            title: `وظیفه نمونه برای ${project.name}`,
                            description: 'توضیحات مربوط به این وظیفه',
                            priority: 'high',
                            priorityText: 'بالا',
                            dueDate: '1402/06/15',
                            assignedTo: [{ id: 1, name: 'علی' }, { id: 2, name: 'مریم' }]
                        });
                    });
                },
                
                // Budget Methods
                getBudgetStatusClass(project) {
                    if (project.utilization > 90) return 'bg-red-900 text-red-100';
                    if (project.utilization > 75) return 'bg-yellow-900 text-yellow-100';
                    return 'bg-green-900 text-green-100';
                },
                
                getBudgetStatusText(project) {
                    if (project.utilization > 90) return 'فراتر از بودجه';
                    if (project.utilization > 75) return 'نیازمند توجه';
                    return 'در مسیر درست';
                },
                
                // Contract Methods
                get filteredContracts() {
                    let filtered = this.contracts;
                    
                    // Apply search filter
                    if (this.contractSearch) {
                        filtered = filtered.filter(contract => 
                            contract.title.includes(this.contractSearch) || 
                            contract.party.includes(this.contractSearch)
                        );
                    }
                    
                    // Apply status filter
                    if (this.contractFilter === 'active') {
                        filtered = filtered.filter(contract => contract.status === 'active');
                    } else if (this.contractFilter === 'expired') {
                        filtered = filtered.filter(contract => contract.status === 'expired');
                    } else if (this.contractFilter === 'pending') {
                        filtered = filtered.filter(contract => contract.status === 'pending');
                    }
                    
                    return filtered;
                },
                
                getContractStatusClass(contract) {
                    const classes = {
                        'active': 'bg-green-900 text-green-100',
                        'expired': 'bg-red-900 text-red-100',
                        'pending': 'bg-yellow-900 text-yellow-100',
                        'draft': 'bg-gray-700 text-gray-100'
                    };
                    return classes[contract.status] || classes.draft;
                },
                
                openContractModal(contract = null) {
                    this.editingContract = contract;
                    this.contractTab = 'basic';
                    
                    if (contract) {
                        this.contractForm = { ...contract };
                    } else {
                        this.contractForm = {
                            title: '',
                            partyId: '',
                            startDate: '',
                            endDate: '',
                            amount: 0,
                            status: 'draft',
                            description: '',
                            payments: []
                        };
                    }
                    
                    this.showContractModal = true;
                },
                
                addPaymentSchedule() {
                    this.contractForm.payments.push({
                        id: Date.now(),
                        dueDate: '',
                        amount: 0,
                        status: 'pending'
                    });
                },
                
                removePaymentSchedule(paymentId) {
                    this.contractForm.payments = this.contractForm.payments.filter(p => p.id !== paymentId);
                },
                
                saveContract() {
                    if (this.editingContract) {
                        // Update existing contract
                        const index = this.contracts.findIndex(c => c.id === this.editingContract.id);
                        if (index !== -1) {
                            this.contracts[index] = { ...this.editingContract, ...this.contractForm };
                        }
                    } else {
                        // Add new contract
                        const newContract = {
                            id: Math.max(...this.contracts.map(c => c.id)) + 1,
                            ...this.contractForm,
                            party: this.contacts.find(c => c.id === this.contractForm.partyId)?.name || 'نامشخص',
                            remainingDays: 30 // Simplified calculation
                        };
                        this.contracts.push(newContract);
                    }
                    
                    this.showContractModal = false;
                },
                
                // Member Methods
                get filteredMembers() {
                    let filtered = this.members;
                    
                    // Apply search filter
                    if (this.memberSearch) {
                        filtered = filtered.filter(member => 
                            member.name.includes(this.memberSearch) || 
                            member.position.includes(this.memberSearch) ||
                            member.employeeId.includes(this.memberSearch)
                        );
                    }
                    
                    // Apply status filter
                    if (this.memberFilter === 'active') {
                        filtered = filtered.filter(member => member.active);
                    } else if (this.memberFilter === 'inactive') {
                        filtered = filtered.filter(member => !member.active);
                    }
                    
                    return filtered;
                },
                
                openMemberModal(member = null) {
                    this.editingMember = member;
                    this.memberTab = 'personal';
                    
                    if (member) {
                        // Split full name into first and last name for the form
                        const nameParts = member.name.split(' ');
                        this.memberForm = {
                            firstName: nameParts[0] || '',
                            lastName: nameParts.slice(1).join(' ') || '',
                            nationalId: '',
                            employeeId: member.employeeId,
                            mobile: '',
                            email: '',
                            address: '',
                            position: member.position,
                            department: member.department,
                            hireDate: member.hireDate,
                            contractType: 'fulltime',
                            baseSalary: 0,
                            supervisorId: '',
                            active: member.active
                        };
                    } else {
                        this.memberForm = {
                            firstName: '',
                            lastName: '',
                            nationalId: '',
                            employeeId: '',
                            mobile: '',
                            email: '',
                            address: '',
                            position: '',
                            department: '',
                            hireDate: '',
                            contractType: 'fulltime',
                            baseSalary: 0,
                            supervisorId: '',
                            active: true
                        };
                    }
                    
                    this.showMemberModal = true;
                },
                
                saveMember() {
                    const fullName = `${this.memberForm.firstName} ${this.memberForm.lastName}`.trim();
                    
                    if (this.editingMember) {
                        // Update existing member
                        const index = this.members.findIndex(m => m.id === this.editingMember.id);
                        if (index !== -1) {
                            this.members[index] = {
                                ...this.editingMember,
                                name: fullName,
                                position: this.memberForm.position,
                                department: this.memberForm.department,
                                employeeId: this.memberForm.employeeId,
                                hireDate: this.memberForm.hireDate,
                                active: this.memberForm.active
                            };
                        }
                    } else {
                        // Add new member
                        const newMember = {
                            id: Math.max(...this.members.map(m => m.id)) + 1,
                            name: fullName,
                            position: this.memberForm.position,
                            department: this.memberForm.department,
                            employeeId: this.memberForm.employeeId,
                            hireDate: this.memberForm.hireDate,
                            active: this.memberForm.active
                        };
                        this.members.push(newMember);
                    }
                    
                    this.showMemberModal = false;
                },
                
                // Search Methods
                performSearch() {
                    // This would perform actual search across all modules in a real app
                    // For demo, we'll create some sample results
                    this.searchResults = [
                        {
                            id: 1,
                            title: 'گزارش مالی سه ماهه',
                            description: 'گزارش کامل عملکرد مالی شرکت در سه ماهه اول',
                            type: 'documents',
                            typeText: 'سند',
                            date: '1402/05/15',
                            project: 'مالی',
                            amount: 0
                        },
                        {
                            id: 2,
                            title: 'بررسی UI/UX',
                            description: 'بررسی و بهبود رابط کاربری سیستم',
                            type: 'tasks',
                            typeText: 'وظیفه',
                            date: '1402/05/18',
                            project: 'بهبود سیستم',
                            priority: 'high',
                            priorityText: 'بالا',
                            amount: 0
                        },
                        {
                            id: 3,
                            title: 'فروش به شرکت نمونه',
                            description: 'فروش محصول A به شرکت نمونه',
                            type: 'transactions',
                            typeText: 'تراکنش',
                            date: '1402/05/10',
                            amount: 5000000
                        }
                    ];
                },
                
                resetSearch() {
                    this.searchQuery = {
                        keyword: '',
                        type: 'all',
                        dateFrom: '',
                        dateTo: '',
                        priority: 'all',
                        status: 'all',
                        project: 'all',
                        category: 'all'
                    };
                    this.searchResults = [];
                },
                
                // Activity Methods
                get filteredActivities() {
                    let filtered = this.activities;
                    
                    // Apply search filter
                    if (this.activitySearch) {
                        filtered = filtered.filter(activity => 
                            activity.user.includes(this.activitySearch) || 
                            activity.action.includes(this.activitySearch)
                        );
                    }
                    
                    // Apply type filter
                    if (this.activityFilter !== 'all') {
                        filtered = filtered.filter(activity => activity.type === this.activityFilter);
                    }
                    
                    // Apply date filters (simplified)
                    if (this.activityDateFrom) {
                        // Date filtering logic would go here
                    }
                    
                    if (this.activityDateTo) {
                        // Date filtering logic would go here
                    }
                    
                    return filtered;
                },
                
                getActivityTypeClass(type) {
                    const classes = {
                        'create': 'bg-green-900 text-green-100',
                        'update': 'bg-blue-900 text-blue-100',
                        'delete': 'bg-red-900 text-red-100',
                        'login': 'bg-gray-700 text-gray-100'
                    };
                    return classes[type] || classes.update;
                },
                
                // System Methods
                createBackup() {
                    alert('پشتیبان‌گیری در حال انجام...');
                    // In a real app, this would trigger the backup process
                },
                
                restoreBackup() {
                    alert('بازیابی از پشتیبان...');
                    // In a real app, this would trigger the restore process
                },
                
                deleteBackup(backupId) {
                    if (confirm('آیا از حذف این پشتیبان اطمینان دارید؟')) {
                        this.backupHistory = this.backupHistory.filter(backup => backup.id !== backupId);
                    }
                },
                
                // Initialize additional data
                initAdditionalData() {
                    this.initKanbanTasks();
                },
                // Notebook
                notebooks: [
                    { id: 1, title: 'یادداشت‌های کاری', icon: 'fas fa-briefcase', color: '#409E91', pageCount: 5 },
                    { id: 2, title: 'ایده‌ها', icon: 'fas fa-lightbulb', color: '#f59e0b', pageCount: 3 },
                    { id: 3, title: 'شخصی', icon: 'fas fa-heart', color: '#ef4444', pageCount: 2 }
                ],
                currentNotebook: 1,
                currentPageIndex: 0,
                showNotebookModal: false,
                editingNotebook: null,
                notebookForm: {
                    title: '',
                    description: '',
                    color: '#409E91',
                    icon: 'fas fa-book'
                },
                notebookColors: ['#409E91', '#3b82f6', '#f59e0b', '#ef4444', '#10b981', '#8b5cf6'],
                notebookPages: {
                    1: [
                        { content: 'جلسه با تیم توسعه - ۱۴۰۲/۰۵/۲۰\nموضوع: بررسی پیشرفت پروژه بهبود سیستم' },
                        { content: 'یادداشت‌های جلسه:\n- پیشرفت کلی: ۷۵٪\n- موانع: نیاز به منابع بیشتر\n- اقدامات: درخواست دو توسعه‌دهنده جدید' },
                        { content: 'لیست وظایف هفته:\n- تکمیل ماژول گزارش‌گیری\n- تست سیستم\n- مستندسازی' }
                    ],
                    2: [
                        { content: 'ایده‌های جدید برای محصول:\n- سیستم هوش مصنوعی برای پیش‌بینی بازار\n- اپلیکیشن موبایل با قابلیت‌های آفلاین' },
                        { content: 'بهبودهای رابط کاربری:\n- اضافه کردن تم‌های بیشتر\n- پشتیبانی از حالت تیره/روشن\n- قابلیت شخصی‌سازی داشبورد' }
                    ],
                    3: [
                        { content: 'اهداف شخصی:\n- یادگیری زبان جدید\n- مطالعه ۱۲ کتاب در سال\n- ورزش منظم' }
                    ]
                },
                
                // Whiteboard
                showWhiteboardModal: false,
                currentWhiteboard: null,
                drawingTools: [
                    { id: 'pen', name: 'قلم', icon: 'fas fa-pen' },
                    { id: 'brush', name: 'قلم مو', icon: 'fas fa-paint-brush' },
                    { id: 'line', name: 'خط', icon: 'fas fa-minus' },
                    { id: 'rectangle', name: 'مستطیل', icon: 'fas fa-square' },
                    { id: 'circle', name: 'دایره', icon: 'fas fa-circle' },
                    { id: 'text', name: 'متن', icon: 'fas fa-font' },
                    { id: 'eraser', name: 'پاک کن', icon: 'fas fa-eraser' }
                ],
                currentTool: 'pen',
                drawingColor: '#409E91',
                brushSize: 3,
                isDrawing: false,
                lastX: 0,
                lastY: 0,
                drawingHistory: [],
                historyIndex: -1,
                
                // Reminders
                reminders: [
                    { 
                        id: 1, 
                        title: 'جلسه با تیم فروش', 
                        description: 'بررسی عملکرد سه ماهه اول', 
                        priority: 'important', 
                        priorityText: 'مهم',
                        dueDate: '1402/05/22', 
                        dueTime: '10:30', 
                        completed: false,
                        repeat: 'none'
                    },
                    { 
                        id: 2, 
                        title: 'تحویل گزارش مالی', 
                        description: 'گزارش عملکرد مالی به مدیریت', 
                        priority: 'urgent', 
                        priorityText: 'فوری',
                        dueDate: '1402/05/20', 
                        dueTime: '14:00', 
                        completed: false,
                        repeat: 'none'
                    },
                    { 
                        id: 3, 
                        title: 'بررسی قرارداد جدید', 
                        description: 'مطالعه و آنالیز قرارداد با شرکت توسعه', 
                        priority: 'normal', 
                        priorityText: 'عادی',
                        dueDate: '1402/05/25', 
                        dueTime: '09:00', 
                        completed: true,
                        repeat: 'none'
                    }
                ],
                reminderSearch: '',
                reminderFilter: 'all',
                showReminderModal: false,
                editingReminder: null,
                reminderForm: {
                    title: '',
                    description: '',
                    priority: 'normal',
                    dueDate: '',
                    dueTime: '',
                    repeat: 'none',
                    completed: false
                },
                
                // Collaboration
                currentTeam: 1,
                onlineMembers: [
                    { id: 1, name: 'علی محمدی' },
                    { id: 2, name: 'مریم کریمی' },
                    { id: 3, name: 'رضا احمدی' }
                ],
                teamMessages: [
                    { id: 1, sender: 1, text: 'سلام به همه! گزارشی که فرستادم رو دیدید؟', time: '10:15' },
                    { id: 2, sender: 2, text: 'بله، عالی بود. فقط قسمت تحلیل بازار نیاز به کمی جزئیات بیشتر داره', time: '10:16' },
                    { id: 3, sender: 3, text: 'منم موافقم. می‌تونیم فردا جلسه بذاریم راجع بهش صحبت کنیم', time: '10:18' },
                    { id: 4, sender: 1, text: 'حتما. ساعت ۱۱ فردا چطوره؟', time: '10:20' }
                ],
                newMessage: '',
                
                // Time Tracking
                timerRunning: false,
                timerInterval: null,
                currentSession: {
                    startTime: null,
                    duration: 0,
                    task: '',
                    description: ''
                },
                todaySessions: [
                    { id: 1, task: 'توسعه ماژول گزارش', description: 'پیاده سازی بخش نمودارها', duration: 7200, timeRange: '08:00 - 10:00' },
                    { id: 2, task: 'جلسه تیم', description: 'بررسی مشکلات فنی', duration: 3600, timeRange: '11:00 - 12:00' },
                    { id: 3, task: 'تست سیستم', description: 'تست ماژول جدید', duration: 5400, timeRange: '13:00 - 14:30' }
                ],
                activeTasks: [
                    { id: 1, title: 'توسعه ماژول گزارش' },
                    { id: 2, title: 'تست سیستم' },
                    { id: 3, title: 'مستندسازی' },
                    { id: 4, title: 'بررسی باگ‌ها' }
                ],
                
                // Workflow Automation
                workflows: [
                    { 
                        id: 1, 
                        name: 'تایید پروژه', 
                        description: 'گردش کار تأیید و راه‌اندازی پروژه جدید', 
                        enabled: true,
                        processedCount: 15,
                        lastRun: '1402/05/19'
                    },
                    { 
                        id: 2, 
                        name: 'مدیریت درخواست‌ها', 
                        description: 'پردازش خودکار درخواست‌های پشتیبانی', 
                        enabled: true,
                        processedCount: 42,
                        lastRun: '1402/05/20'
                    },
                    { 
                        id: 3, 
                        name: 'گزارش‌گیری ماهانه', 
                        description: 'تهیه و ارسال گزارش‌های دوره‌ای', 
                        enabled: false,
                        processedCount: 0,
                        lastRun: '1402/04/30'
                    }
                ],
                workflowSteps: [
                    { id: 1, name: 'ثبت درخواست', description: 'دریافت و ثبت اطلاعات اولیه پروژه', status: 'completed', statusText: 'تکمیل شده', duration: '1 روز', assignee: 'سیستم' },
                    { id: 2, name: 'بررسی فنی', description: 'آنالیز نیازمندی‌ها و قابلیت اجرا', status: 'completed', statusText: 'تکمیل شده', duration: '2 روز', assignee: 'تیم فنی' },
                    { id: 3, name: 'تأیید مالی', description: 'بررسی جنبه‌های مالی و بودجه', status: 'active', statusText: 'در حال انجام', duration: '1 روز', assignee: 'مدیریت مالی' },
                    { id: 4, name: 'راه‌اندازی', description: 'تخصیص منابع و شروع پروژه', status: 'pending', statusText: 'در انتظار', duration: '1 روز', assignee: 'مدیر پروژه' }
                ],
                showWorkflowModal: false,
                editingWorkflow: null,
                
                // Audit & Security
                securityStats: {
                    failedLogins: 3,
                    onlineUsers: 8,
                    securityLogs: 1247,
                    lastUpdate: '1402/05/20 14:30'
                },
                auditLogs: [
                    { 
                        id: 1, 
                        title: 'ورود ناموفق', 
                        description: 'تلاش برای ورود با نام کاربری ناشناس', 
                        type: 'security', 
                        user: 'نامشخص',
                        ip: '192.168.1.100',
                        time: '1402/05/20 10:15',
                        severity: 'high',
                        severityText: 'بالا'
                    },
                    { 
                        id: 2, 
                        title: 'تغییر تنظیمات سیستم', 
                        description: 'تغییر تنظیمات امنیتی توسط مدیر سیستم', 
                        type: 'system', 
                        user: 'مدیر سیستم',
                        ip: '192.168.1.10',
                        time: '1402/05/20 09:30',
                        severity: 'medium',
                        severityText: 'متوسط'
                    },
                    { 
                        id: 3, 
                        title: 'دسترسی به داده‌های حساس', 
                        description: 'مشاهده گزارش مالی توسط کاربر مجاز', 
                        type: 'data', 
                        user: 'علی محمدی',
                        ip: '192.168.1.25',
                        time: '1402/05/20 08:45',
                        severity: 'low',
                        severityText: 'کم'
                    }
                ],
                auditSearch: '',
                auditFilter: 'all',
                
                // UI State
                showQuickActionMenu: false,
                isLoading: false,
                loadingMessage: 'در حال بارگذاری...',
                showWelcomeTour: true,
                currentTourStep: 0,
                
                // New methods for additional modules
                
                // Notebook Methods
                get currentNotebookTitle() {
                    const notebook = this.notebooks.find(n => n.id === this.currentNotebook);
                    return notebook ? notebook.title : 'دفترچه‌ها';
                },
                
                get currentNotebookPages() {
                    return this.notebookPages[this.currentNotebook] || [];
                },
                
                get currentPageContent() {
                    return this.currentNotebookPages[this.currentPageIndex]?.content || '';
                },
                
                set currentPageContent(value) {
                    if (this.currentNotebookPages[this.currentPageIndex]) {
                        this.currentNotebookPages[this.currentPageIndex].content = value;
                    }
                },
                
                selectNotebook(notebookId) {
                    this.currentNotebook = notebookId;
                    this.currentPageIndex = 0;
                },
                
                addNewPage() {
                    if (!this.notebookPages[this.currentNotebook]) {
                        this.notebookPages[this.currentNotebook] = [];
                    }
                    this.notebookPages[this.currentNotebook].push({ content: '' });
                    this.currentPageIndex = this.notebookPages[this.currentNotebook].length - 1;
                },
                
                previousPage() {
                    if (this.currentPageIndex > 0) {
                        this.currentPageIndex--;
                    }
                },
                
                nextPage() {
                    if (this.currentPageIndex < this.currentNotebookPages.length - 1) {
                        this.currentPageIndex++;
                    }
                },
                
                deleteCurrentPage() {
                    if (this.currentNotebookPages.length > 1) {
                        this.currentNotebookPages.splice(this.currentPageIndex, 1);
                        if (this.currentPageIndex >= this.currentNotebookPages.length) {
                            this.currentPageIndex = this.currentNotebookPages.length - 1;
                        }
                    }
                },
                
                openNotebookModal(notebook = null) {
                    this.editingNotebook = notebook;
                    
                    if (notebook) {
                        this.notebookForm = { ...notebook };
                    } else {
                        this.notebookForm = {
                            title: '',
                            description: '',
                            color: '#409E91',
                            icon: 'fas fa-book'
                        };
                    }
                    
                    this.showNotebookModal = true;
                },
                
                saveNotebook() {
                    if (this.editingNotebook) {
                        // Update existing notebook
                        const index = this.notebooks.findIndex(n => n.id === this.editingNotebook.id);
                        if (index !== -1) {
                            this.notebooks[index] = { ...this.editingNotebook, ...this.notebookForm };
                        }
                    } else {
                        // Add new notebook
                        const newNotebook = {
                            id: Math.max(...this.notebooks.map(n => n.id)) + 1,
                            ...this.notebookForm,
                            pageCount: 1
                        };
                        this.notebooks.push(newNotebook);
                        
                        // Initialize pages for new notebook
                        this.notebookPages[newNotebook.id] = [{ content: '' }];
                        this.currentNotebook = newNotebook.id;
                        this.currentPageIndex = 0;
                    }
                    
                    this.showNotebookModal = false;
                },
                
                // Whiteboard Methods
                initWhiteboard() {
                    const canvas = this.$refs.whiteboard;
                    const ctx = canvas.getContext('2d');
                    
                    // Set canvas size
                    canvas.width = canvas.offsetWidth;
                    canvas.height = canvas.offsetHeight;
                    
                    // Set default styles
                    ctx.strokeStyle = this.drawingColor;
                    ctx.lineWidth = this.brushSize;
                    ctx.lineCap = 'round';
                    ctx.lineJoin = 'round';
                },
                
                startDrawing(e) {
                    this.isDrawing = true;
                    const canvas = this.$refs.whiteboard;
                    const rect = canvas.getBoundingClientRect();
                    
                    this.lastX = e.clientX - rect.left;
                    this.lastY = e.clientY - rect.top;
                    
                    // Save current state for undo
                    this.saveCanvasState();
                },
                
                draw(e) {
                    if (!this.isDrawing) return;
                    
                    const canvas = this.$refs.whiteboard;
                    const ctx = canvas.getContext('2d');
                    const rect = canvas.getBoundingClientRect();
                    
                    const currentX = e.clientX - rect.left;
                    const currentY = e.clientY - rect.top;
                    
                    ctx.strokeStyle = this.drawingColor;
                    ctx.lineWidth = this.brushSize;
                    
                    ctx.beginPath();
                    ctx.moveTo(this.lastX, this.lastY);
                    ctx.lineTo(currentX, currentY);
                    ctx.stroke();
                    
                    this.lastX = currentX;
                    this.lastY = currentY;
                },
                
                stopDrawing() {
                    this.isDrawing = false;
                },
                
                selectTool(toolId) {
                    this.currentTool = toolId;
                },
                
                clearWhiteboard() {
                    const canvas = this.$refs.whiteboard;
                    const ctx = canvas.getContext('2d');
                    ctx.clearRect(0, 0, canvas.width, canvas.height);
                    this.saveCanvasState();
                },
                
                saveCanvasState() {
                    const canvas = this.$refs.whiteboard;
                    this.drawingHistory = this.drawingHistory.slice(0, this.historyIndex + 1);
                    this.drawingHistory.push(canvas.toDataURL());
                    this.historyIndex++;
                },
                
                undoDrawing() {
                    if (this.historyIndex > 0) {
                        this.historyIndex--;
                        this.redrawCanvas();
                    }
                },
                
                redoDrawing() {
                    if (this.historyIndex < this.drawingHistory.length - 1) {
                        this.historyIndex++;
                        this.redrawCanvas();
                    }
                },
                
                redrawCanvas() {
                    const canvas = this.$refs.whiteboard;
                    const ctx = canvas.getContext('2d');
                    const img = new Image();
                    
                    img.onload = () => {
                        ctx.clearRect(0, 0, canvas.width, canvas.height);
                        ctx.drawImage(img, 0, 0);
                    };
                    
                    img.src = this.drawingHistory[this.historyIndex];
                },
                
                saveWhiteboard() {
                    // In a real app, this would save the whiteboard to server
                    alert('تخته سفید ذخیره شد');
                },
                
                // Reminder Methods
                get filteredReminders() {
                    let filtered = this.reminders;
                    
                    // Apply search filter
                    if (this.reminderSearch) {
                        filtered = filtered.filter(reminder => 
                            reminder.title.includes(this.reminderSearch) || 
                            reminder.description.includes(this.reminderSearch)
                        );
                    }
                    
                    // Apply status filter
                    if (this.reminderFilter === 'today') {
                        // Filter for today's reminders (simplified)
                        filtered = filtered.filter(reminder => reminder.dueDate === '1402/05/20');
                    } else if (this.reminderFilter === 'urgent') {
                        filtered = filtered.filter(reminder => reminder.priority === 'urgent');
                    } else if (this.reminderFilter === 'completed') {
                        filtered = filtered.filter(reminder => reminder.completed);
                    }
                    
                    return filtered;
                },
                
                get todayRemindersCount() {
                    return this.reminders.filter(r => r.dueDate === '1402/05/20').length;
                },
                
                get urgentRemindersCount() {
                    return this.reminders.filter(r => r.priority === 'urgent').length;
                },
                
                get completedRemindersCount() {
                    return this.reminders.filter(r => r.completed).length;
                },
                
                openReminderModal(reminder = null) {
                    this.editingReminder = reminder;
                    
                    if (reminder) {
                        this.reminderForm = { ...reminder };
                    } else {
                        this.reminderForm = {
                            title: '',
                            description: '',
                            priority: 'normal',
                            dueDate: '1402/05/20',
                            dueTime: '12:00',
                            repeat: 'none',
                            completed: false
                        };
                    }
                    
                    this.showReminderModal = true;
                },
                
                saveReminder() {
                    if (this.editingReminder) {
                        // Update existing reminder
                        const index = this.reminders.findIndex(r => r.id === this.editingReminder.id);
                        if (index !== -1) {
                            this.reminders[index] = { ...this.editingReminder, ...this.reminderForm };
                        }
                    } else {
                        // Add new reminder
                        const newReminder = {
                            id: Math.max(...this.reminders.map(r => r.id)) + 1,
                            ...this.reminderForm,
                            priorityText: this.getPriorityText(this.reminderForm.priority)
                        };
                        this.reminders.push(newReminder);
                    }
                    
                    this.showReminderModal = false;
                },
                
                getPriorityText(priority) {
                    const texts = {
                        'low': 'کم',
                        'normal': 'عادی',
                        'important': 'مهم',
                        'urgent': 'فوری'
                    };
                    return texts[priority] || 'عادی';
                },
                
                toggleReminderComplete(reminderId) {
                    const reminder = this.reminders.find(r => r.id === reminderId);
                    if (reminder) {
                        reminder.completed = !reminder.completed;
                    }
                },
                
                deleteReminder(reminderId) {
                    if (confirm('آیا از حذف این یادآور اطمینان دارید؟')) {
                        this.reminders = this.reminders.filter(reminder => reminder.id !== reminderId);
                    }
                },
                
                // Collaboration Methods
                get currentTeamName() {
                    const team = this.teams.find(t => t.id === this.currentTeam);
                    return team ? team.name : 'تیم';
                },
                
                selectTeam(teamId) {
                    this.currentTeam = teamId;
                },
                
                sendMessage() {
                    if (this.newMessage.trim()) {
                        const newMsg = {
                            id: this.teamMessages.length + 1,
                            sender: this.currentUser.id,
                            text: this.newMessage,
                            time: new Date().toLocaleTimeString('fa-IR', { hour: '2-digit', minute: '2-digit' })
                        };
                        this.teamMessages.push(newMsg);
                        this.newMessage = '';
                        
                        // Auto-scroll to bottom
                        setTimeout(() => {
                            const container = document.querySelector('.chat-messages');
                            if (container) {
                                container.scrollTop = container.scrollHeight;
                            }
                        }, 100);
                    }
                },
                
                // Time Tracking Methods
                toggleTimer() {
                    if (this.timerRunning) {
                        this.stopTimer();
                    } else {
                        this.startTimer();
                    }
                },
                
                startTimer() {
                    this.timerRunning = true;
                    this.currentSession.startTime = Date.now();
                    
                    this.timerInterval = setInterval(() => {
                        this.currentSession.duration += 1;
                    }, 1000);
                },
                
                stopTimer() {
                    this.timerRunning = false;
                    clearInterval(this.timerInterval);
                },
                
                formatTime(seconds) {
                    const hours = Math.floor(seconds / 3600);
                    const minutes = Math.floor((seconds % 3600) / 60);
                    const secs = seconds % 60;
                    
                    return `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
                },
                
                get totalTimeToday() {
                    return this.todaySessions.reduce((total, session) => total + session.duration, 0) + this.currentSession.duration;
                },
                
                saveTimeSession() {
                    if (this.currentSession.task && this.currentSession.duration > 0) {
                        const newSession = {
                            id: this.todaySessions.length + 1,
                            task: this.currentSession.task,
                            description: this.currentSession.description,
                            duration: this.currentSession.duration,
                            timeRange: new Date().toLocaleTimeString('fa-IR', { hour: '2-digit', minute: '2-digit' })
                        };
                        this.todaySessions.push(newSession);
                        
                        // Reset current session
                        this.currentSession = {
                            startTime: null,
                            duration: 0,
                            task: '',
                            description: ''
                        };
                    }
                },
                
                deleteTimeSession(sessionId) {
                    if (confirm('آیا از حذف این جلسه اطمینان دارید؟')) {
                        this.todaySessions = this.todaySessions.filter(session => session.id !== sessionId);
                    }
                },
                
                // Workflow Methods
                getStepStatusClass(status) {
                    const classes = {
                        'completed': 'bg-green-900 text-green-100',
                        'active': 'bg-primary text-white',
                        'pending': 'bg-gray-700 text-gray-100'
                    };
                    return classes[status] || classes.pending;
                },
                
                runWorkflow(workflowId) {
                    this.isLoading = true;
                    this.loadingMessage = 'در حال اجرای گردش کار...';
                    
                    // Simulate workflow execution
                    setTimeout(() => {
                        this.isLoading = false;
                        const workflow = this.workflows.find(w => w.id === workflowId);
                        if (workflow) {
                            workflow.processedCount += 1;
                            workflow.lastRun = '1402/05/20 ' + new Date().toLocaleTimeString('fa-IR', { hour: '2-digit', minute: '2-digit' });
                        }
                        alert('گردش کار با موفقیت اجرا شد');
                    }, 2000);
                },
                
                // Audit Methods
                get filteredAuditLogs() {
                    let filtered = this.auditLogs;
                    
                    // Apply search filter
                    if (this.auditSearch) {
                        filtered = filtered.filter(log => 
                            log.title.includes(this.auditSearch) || 
                            log.description.includes(this.auditSearch) ||
                            log.user.includes(this.auditSearch)
                        );
                    }
                    
                    // Apply type filter
                    if (this.auditFilter !== 'all') {
                        filtered = filtered.filter(log => log.type === this.auditFilter);
                    }
                    
                    return filtered;
                },
                
                // UI Methods
                openQuickActionMenu() {
                    this.showQuickActionMenu = !this.showQuickActionMenu;
                },
                
                skipTour() {
                    this.showWelcomeTour = false;
                },
                
                startTour() {
                    this.showWelcomeTour = false;
                    // In a real app, this would start an interactive tour
                    alert('راهنمای تعاملی سیستم آغاز شد');
                },
                
                // Initialize additional features
                initAdditionalFeatures() {
                    this.initWhiteboard();
                    
                    // Check if it's first visit
                    const hasVisited = localStorage.getItem('hasVisited');
                    if (hasVisited) {
                        this.showWelcomeTour = false;
                    } else {
                        localStorage.setItem('hasVisited', 'true');
                    }
                },
                
                // Update the existing initApp method
                initApp() {
                    this.initCalendar();
                    this.loadDefaultData();
                    this.initAdditionalData();
                    this.initAdditionalFeatures();
                },
                // Computed properties
                get unreadNotifications() {
                    return this.notifications.filter(n => !n.read).length;
                }
            }));
        });
    </script>

    
<script>
// Account Management Component
document.addEventListener('alpine:init', () => {
    Alpine.data('accounts', () => ({
        accounts: [
            { id: 1, name: 'حساب جاری بانک ملت', type: 'bank', balance: 50000000, accountNumber: '6104-3371-1234-5678', sheba: 'IR080120000000003337112345', currency: 'IRR', isActive: true },
            { id: 2, name: 'صندوق نقدی', type: 'cash', balance: 15000000, accountNumber: '', sheba: '', currency: 'IRR', isActive: true },
            { id: 3, name: 'کارت اعتباری', type: 'card', balance: -5000000, accountNumber: '6037-9971-4321-8765', sheba: '', currency: 'IRR', isActive: true },
            { id: 4, name: 'حساب دلاری', type: 'bank', balance: 5000, accountNumber: '1234-5678', sheba: '', currency: 'USD', isActive: true }
        ],
        accountSearch: '',
        accountFilter: 'all',
        showAccountModal: false,
        editingAccount: null,
        accountForm: {
            name: '',
            type: 'bank',
            balance: 0,
            accountNumber: '',
            sheba: '',
            currency: 'IRR',
            isActive: true
        },

        init() {
            this.calculateTotalBalance();
        },

        get filteredAccounts() {
            let filtered = this.accounts;
            
            if (this.accountSearch) {
                filtered = filtered.filter(account => 
                    account.name.includes(this.accountSearch) ||
                    account.accountNumber.includes(this.accountSearch)
                );
            }
            
            if (this.accountFilter !== 'all') {
                filtered = filtered.filter(account => account.type === this.accountFilter);
            }
            
            return filtered;
        },

        get totalBalance() {
            return this.accounts.reduce((sum, account) => sum + account.balance, 0);
        },

        get accountTypes() {
            return [
                { value: 'bank', label: 'بانکی', icon: 'fas fa-university' },
                { value: 'cash', label: 'نقدی', icon: 'fas fa-money-bill-wave' },
                { value: 'card', label: 'کارت', icon: 'fas fa-credit-card' },
                { value: 'wallet', label: 'کیف پول', icon: 'fas fa-wallet' },
                { value: 'virtual', label: 'مجازی', icon: 'fas fa-mobile-alt' }
            ];
        },

        openAccountModal(account = null) {
            this.editingAccount = account;
            
            if (account) {
                this.accountForm = { ...account };
            } else {
                this.accountForm = {
                    name: '',
                    type: 'bank',
                    balance: 0,
                    accountNumber: '',
                    sheba: '',
                    currency: 'IRR',
                    isActive: true
                };
            }
            
            this.showAccountModal = true;
        },

        saveAccount() {
            if (this.editingAccount) {
                const index = this.accounts.findIndex(a => a.id === this.editingAccount.id);
                if (index !== -1) {
                    this.accounts[index] = { ...this.editingAccount, ...this.accountForm };
                }
            } else {
                const newAccount = {
                    id: Math.max(...this.accounts.map(a => a.id)) + 1,
                    ...this.accountForm
                };
                this.accounts.push(newAccount);
            }
            
            this.showAccountModal = false;
            this.calculateTotalBalance();
        },

        deleteAccount(accountId) {
            if (confirm('آیا از حذف این حساب اطمینان دارید؟')) {
                this.accounts = this.accounts.filter(account => account.id !== accountId);
                this.calculateTotalBalance();
            }
        },

        calculateTotalBalance() {
            // Update any external balance displays if needed
            const event = new CustomEvent('accountsUpdated', { 
                detail: { totalBalance: this.totalBalance } 
            });
            window.dispatchEvent(event);
        },

        formatCurrency(amount, currency = 'IRR') {
            if (currency === 'USD') {
                return '$' + new Intl.NumberFormat('en-US').format(amount);
            } else if (currency === 'EUR') {
                return '€' + new Intl.NumberFormat('en-US').format(amount);
            }
            return new Intl.NumberFormat('fa-IR').format(amount) + ' ریال';
        },

        getAccountTypeLabel(type) {
            const typeObj = this.accountTypes.find(t => t.value === type);
            return typeObj ? typeObj.label : type;
        },

        getAccountTypeIcon(type) {
            const typeObj = this.accountTypes.find(t => t.value === type);
            return typeObj ? typeObj.icon : 'fas fa-wallet';
        }
    }));
});

// Budget and Prediction Component
document.addEventListener('alpine:init', () => {
    Alpine.data('budget', () => ({
        budgets: [
            { id: 1, category: 'حقوق و دستمزد', allocated: 50000000, spent: 45000000, period: 'ماهانه', startDate: '1402/05/01', endDate: '1402/05/31', status: 'on-track' },
            { id: 2, category: 'تجهیزات اداری', allocated: 10000000, spent: 12000000, period: 'ماهانه', startDate: '1402/05/01', endDate: '1402/05/31', status: 'over-budget' },
            { id: 3, category: 'مارکتینگ', allocated: 20000000, spent: 15000000, period: 'ماهانه', startDate: '1402/05/01', endDate: '1402/05/31', status: 'on-track' },
            { id: 4, category: 'توسعه نرم‌افزار', allocated: 30000000, spent: 28000000, period: 'ماهانه', startDate: '1402/05/01', endDate: '1402/05/31', status: 'on-track' }
        ],
        predictions: [
            { id: 1, title: 'پیش‌بینی درآمد فصل پاییز', type: 'income', amount: 450000000, confidence: 85, factors: ['رشد بازار', 'فصل فروش'], date: '1402/07/01' },
            { id: 2, title: 'پیش‌بینی هزینه‌های پروژه جدید', type: 'expense', amount: 120000000, confidence: 70, factors: ['تورم', 'نوسانات ارز'], date: '1402/06/15' }
        ],
        budgetSearch: '',
        budgetPeriod: 'monthly',
        showBudgetModal: false,
        editingBudget: null,
        budgetForm: {
            category: '',
            allocated: 0,
            spent: 0,
            period: 'monthly',
            startDate: '',
            endDate: ''
        },

        get filteredBudgets() {
            let filtered = this.budgets;
            
            if (this.budgetSearch) {
                filtered = filtered.filter(budget => 
                    budget.category.includes(this.budgetSearch)
                );
            }
            
            if (this.budgetPeriod !== 'all') {
                filtered = filtered.filter(budget => budget.period === this.budgetPeriod);
            }
            
            return filtered;
        },

        get budgetSummary() {
            const totalAllocated = this.budgets.reduce((sum, budget) => sum + budget.allocated, 0);
            const totalSpent = this.budgets.reduce((sum, budget) => sum + budget.spent, 0);
            const remaining = totalAllocated - totalSpent;
            const utilizationRate = totalAllocated > 0 ? (totalSpent / totalAllocated) * 100 : 0;
            
            return {
                totalAllocated,
                totalSpent,
                remaining,
                utilizationRate
            };
        },

        getBudgetStatus(budget) {
            const utilization = (budget.spent / budget.allocated) * 100;
            if (utilization <= 80) return 'on-track';
            if (utilization <= 100) return 'warning';
            return 'over-budget';
        },

        getBudgetStatusText(budget) {
            const status = this.getBudgetStatus(budget);
            const texts = {
                'on-track': 'در مسیر',
                'warning': 'هشدار',
                'over-budget': 'فراتر از بودجه'
            };
            return texts[status];
        },

        getBudgetStatusColor(budget) {
            const status = this.getBudgetStatus(budget);
            const colors = {
                'on-track': 'bg-green-900 text-green-100',
                'warning': 'bg-yellow-900 text-yellow-100',
                'over-budget': 'bg-red-900 text-red-100'
            };
            return colors[status];
        },

        openBudgetModal(budget = null) {
            this.editingBudget = budget;
            
            if (budget) {
                this.budgetForm = { ...budget };
            } else {
                this.budgetForm = {
                    category: '',
                    allocated: 0,
                    spent: 0,
                    period: 'monthly',
                    startDate: '',
                    endDate: ''
                };
            }
            
            this.showBudgetModal = true;
        },

        saveBudget() {
            if (this.editingBudget) {
                const index = this.budgets.findIndex(b => b.id === this.editingBudget.id);
                if (index !== -1) {
                    this.budgets[index] = { 
                        ...this.editingBudget, 
                        ...this.budgetForm,
                        status: this.getBudgetStatus(this.budgetForm)
                    };
                }
            } else {
                const newBudget = {
                    id: Math.max(...this.budgets.map(b => b.id)) + 1,
                    ...this.budgetForm,
                    status: this.getBudgetStatus(this.budgetForm)
                };
                this.budgets.push(newBudget);
            }
            
            this.showBudgetModal = false;
        },

        formatCurrency(amount) {
            return new Intl.NumberFormat('fa-IR').format(amount) + ' ریال';
        }
    }));
});

// Contract Management Component
document.addEventListener('alpine:init', () => {
    Alpine.data('contracts', () => ({
        contracts: [
            { 
                id: 1, 
                title: 'قرارداد توسعه نرم‌افزار', 
                parties: 'شرکت الف - شرکت ب',
                value: 250000000,
                startDate: '1402/04/01',
                endDate: '1402/10/01',
                status: 'active',
                type: 'development',
                attachments: 3,
                reminders: 2
            },
            { 
                id: 2, 
                title: 'قرارداد پشتیبانی سالانه', 
                parties: 'شرکت الف - شرکت ج',
                value: 50000000,
                startDate: '1402/05/01',
                endDate: '1403/05/01',
                status: 'active',
                type: 'support',
                attachments: 1,
                reminders: 1
            },
            { 
                id: 3, 
                title: 'قرارداد مشاوره فنی', 
                parties: 'شرکت الف - شرکت د',
                value: 80000000,
                startDate: '1402/03/15',
                endDate: '1402/06/15',
                status: 'completed',
                type: 'consulting',
                attachments: 2,
                reminders: 0
            }
        ],
        contractSearch: '',
        contractFilter: 'all',
        showContractModal: false,
        editingContract: null,
        contractForm: {
            title: '',
            parties: '',
            value: 0,
            startDate: '',
            endDate: '',
            status: 'draft',
            type: 'general',
            description: '',
            terms: ''
        },

        get filteredContracts() {
            let filtered = this.contracts;
            
            if (this.contractSearch) {
                filtered = filtered.filter(contract => 
                    contract.title.includes(this.contractSearch) ||
                    contract.parties.includes(this.contractSearch)
                );
            }
            
            if (this.contractFilter !== 'all') {
                filtered = filtered.filter(contract => contract.status === this.contractFilter);
            }
            
            return filtered;
        },

        get contractStats() {
            const total = this.contracts.length;
            const active = this.contracts.filter(c => c.status === 'active').length;
            const completed = this.contracts.filter(c => c.status === 'completed').length;
            const draft = this.contracts.filter(c => c.status === 'draft').length;
            const totalValue = this.contracts.reduce((sum, contract) => sum + contract.value, 0);
            
            return { total, active, completed, draft, totalValue };
        },

        getContractStatusText(status) {
            const statuses = {
                'draft': 'پیش‌نویس',
                'active': 'فعال',
                'completed': 'تکمیل شده',
                'cancelled': 'لغو شده',
                'expired': 'منقضی شده'
            };
            return statuses[status] || status;
        },

        getContractStatusColor(status) {
            const colors = {
                'draft': 'bg-gray-700 text-gray-100',
                'active': 'bg-green-700 text-green-100',
                'completed': 'bg-blue-700 text-blue-100',
                'cancelled': 'bg-red-700 text-red-100',
                'expired': 'bg-yellow-700 text-yellow-100'
            };
            return colors[status] || colors.draft;
        },

        getContractTypeText(type) {
            const types = {
                'development': 'توسعه',
                'support': 'پشتیبانی',
                'consulting': 'مشاوره',
                'general': 'عمومی'
            };
            return types[type] || type;
        },

        openContractModal(contract = null) {
            this.editingContract = contract;
            
            if (contract) {
                this.contractForm = { ...contract };
            } else {
                this.contractForm = {
                    title: '',
                    parties: '',
                    value: 0,
                    startDate: '',
                    endDate: '',
                    status: 'draft',
                    type: 'general',
                    description: '',
                    terms: ''
                };
            }
            
            this.showContractModal = true;
        },

        saveContract() {
            if (this.editingContract) {
                const index = this.contracts.findIndex(c => c.id === this.editingContract.id);
                if (index !== -1) {
                    this.contracts[index] = { ...this.editingContract, ...this.contractForm };
                }
            } else {
                const newContract = {
                    id: Math.max(...this.contracts.map(c => c.id)) + 1,
                    ...this.contractForm,
                    attachments: 0,
                    reminders: 0
                };
                this.contracts.push(newContract);
            }
            
            this.showContractModal = false;
        },

        formatCurrency(amount) {
            return new Intl.NumberFormat('fa-IR').format(amount) + ' ریال';
        },

        daysRemaining(endDate) {
            // Simple implementation - in real app would use proper date calculation
            const today = new Date();
            const end = new Date(endDate);
            const diffTime = end - today;
            const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
            return diffDays > 0 ? diffDays : 0;
        }
    }));
});

// Collaboration and Team Management Component
document.addEventListener('alpine:init', () => {
    Alpine.data('collaboration', () => ({
        teams: [
            {
                id: 1,
                name: 'تیم توسعه اصلی',
                description: 'تیم اصلی توسعه نرم‌افزار',
                members: [1, 2, 3],
                projects: [1, 2],
                permissions: {
                    tasks: ['read', 'write'],
                    projects: ['read', 'write'],
                    files: ['read', 'write'],
                    financial: ['read']
                },
                created: '1402/03/15',
                isActive: true
            },
            {
                id: 2,
                name: 'تیم پشتیبانی',
                description: 'تیم پشتیبانی مشتریان',
                members: [4, 5],
                projects: [1],
                permissions: {
                    tasks: ['read'],
                    projects: ['read'],
                    files: ['read'],
                    financial: []
                },
                created: '1402/04/20',
                isActive: true
            }
        ],
        teamMembers: [
            { id: 1, name: 'علی محمدی', role: 'developer', email: 'ali@example.com', teams: [1], joinDate: '1402/03/15' },
            { id: 2, name: 'مریم کریمی', role: 'designer', email: 'maryam@example.com', teams: [1], joinDate: '1402/03/20' },
            { id: 3, name: 'رضا احمدی', role: 'developer', email: 'reza@example.com', teams: [1], joinDate: '1402/04/01' },
            { id: 4, name: 'سارا حسینی', role: 'support', email: 'sara@example.com', teams: [2], joinDate: '1402/04/20' },
            { id: 5, name: 'محمد رضایی', role: 'support', email: 'mohammad@example.com', teams: [2], joinDate: '1402/05/01' }
        ],
        teamSearch: '',
        showTeamModal: false,
        editingTeam: null,
        teamForm: {
            name: '',
            description: '',
            members: [],
            permissions: {
                tasks: [],
                projects: [],
                files: [],
                financial: []
            }
        },

        get filteredTeams() {
            if (!this.teamSearch) return this.teams;
            
            return this.teams.filter(team =>
                team.name.includes(this.teamSearch) ||
                team.description.includes(this.teamSearch)
            );
        },

        getMemberName(memberId) {
            const member = this.teamMembers.find(m => m.id === memberId);
            return member ? member.name : 'نامشخص';
        },

        getMemberRole(memberId) {
            const member = this.teamMembers.find(m => m.id === memberId);
            return member ? member.role : 'نامشخص';
        },

        getTeamMembers(teamId) {
            const team = this.teams.find(t => t.id === teamId);
            if (!team) return [];
            
            return this.teamMembers.filter(member => 
                team.members.includes(member.id)
            );
        },

        openTeamModal(team = null) {
            this.editingTeam = team;
            
            if (team) {
                this.teamForm = { ...team };
            } else {
                this.teamForm = {
                    name: '',
                    description: '',
                    members: [],
                    permissions: {
                        tasks: [],
                        projects: [],
                        files: [],
                        financial: []
                    }
                };
            }
            
            this.showTeamModal = true;
        },

        saveTeam() {
            if (this.editingTeam) {
                const index = this.teams.findIndex(t => t.id === this.editingTeam.id);
                if (index !== -1) {
                    this.teams[index] = { ...this.editingTeam, ...this.teamForm };
                }
            } else {
                const newTeam = {
                    id: Math.max(...this.teams.map(t => t.id)) + 1,
                    ...this.teamForm,
                    created: new Date().toLocaleDateString('fa-IR'),
                    isActive: true
                };
                this.teams.push(newTeam);
            }
            
            this.showTeamModal = false;
        },

        togglePermission(team, module, permission) {
            const permissions = team.permissions[module];
            const index = permissions.indexOf(permission);
            
            if (index > -1) {
                permissions.splice(index, 1);
            } else {
                permissions.push(permission);
            }
        },

        hasPermission(team, module, permission) {
            return team.permissions[module].includes(permission);
        }
    }));
});

// Notification and Reminder System Component
document.addEventListener('alpine:init', () => {
    Alpine.data('notifications', () => ({
        notifications: [
            {
                id: 1,
                title: 'تکمیل وظیفه',
                message: 'وظیفه "بررسی گزارش مالی" تکمیل شد',
                type: 'task',
                priority: 'normal',
                read: false,
                timestamp: '2 ساعت پیش',
                action: { type: 'view_task', id: 1 }
            },
            {
                id: 2,
                title: 'یادآوری جلسه',
                message: 'جلسه با تیم توسعه امروز ساعت 11:30',
                type: 'meeting',
                priority: 'high',
                read: false,
                timestamp: '1 ساعت پیش',
                action: { type: 'view_calendar', id: 1 }
            },
            {
                id: 3,
                title: 'پایان قرارداد',
                message: 'قرارداد پشتیبانی شرکت نمونه تا 3 روز دیگر پایان می‌یابد',
                type: 'contract',
                priority: 'urgent',
                read: true,
                timestamp: '1 روز پیش',
                action: { type: 'view_contract', id: 2 }
            }
        ],
        reminders: [
            {
                id: 1,
                title: 'پرداخت حقوق',
                description: 'پرداخت حقوق کارکنان برای ماه جاری',
                type: 'payment',
                dueDate: '1402/06/05',
                priority: 'high',
                completed: false,
                recurring: true
            },
            {
                id: 2,
                title: 'ارسال گزارش',
                description: 'ارسال گزارش عملکرد به مدیریت',
                type: 'report',
                dueDate: '1402/06/01',
                priority: 'normal',
                completed: true,
                recurring: false
            },
            {
                id: 3,
                title: 'تمدید مجوز',
                description: 'تمدید مجوز نرم‌افزار',
                type: 'license',
                dueDate: '1402/07/15',
                priority: 'normal',
                completed: false,
                recurring: true
            }
        ],
        showNotificationModal: false,
        showReminderModal: false,
        editingReminder: null,
        reminderForm: {
            title: '',
            description: '',
            type: 'general',
            dueDate: '',
            priority: 'normal',
            recurring: false
        },

        get unreadNotifications() {
            return this.notifications.filter(n => !n.read).length;
        },

        get upcomingReminders() {
            return this.reminders.filter(r => !r.completed);
        },

        get notificationStats() {
            const total = this.notifications.length;
            const unread = this.unreadNotifications;
            const reminders = this.upcomingReminders.length;
            
            return { total, unread, reminders };
        },

        markAsRead(notificationId) {
            const notification = this.notifications.find(n => n.id === notificationId);
            if (notification) {
                notification.read = true;
            }
        },

        markAllAsRead() {
            this.notifications.forEach(notification => {
                notification.read = true;
            });
        },

        deleteNotification(notificationId) {
            this.notifications = this.notifications.filter(n => n.id !== notificationId);
        },

        getNotificationIcon(type) {
            const icons = {
                'task': 'fas fa-tasks',
                'meeting': 'fas fa-calendar-alt',
                'contract': 'fas fa-file-contract',
                'payment': 'fas fa-money-bill-wave',
                'system': 'fas fa-cog'
            };
            return icons[type] || 'fas fa-bell';
        },

        getPriorityColor(priority) {
            const colors = {
                'low': 'text-gray-400',
                'normal': 'text-blue-400',
                'high': 'text-yellow-400',
                'urgent': 'text-red-400'
            };
            return colors[priority] || colors.normal;
        },

        openReminderModal(reminder = null) {
            this.editingReminder = reminder;
            
            if (reminder) {
                this.reminderForm = { ...reminder };
            } else {
                this.reminderForm = {
                    title: '',
                    description: '',
                    type: 'general',
                    dueDate: '',
                    priority: 'normal',
                    recurring: false
                };
            }
            
            this.showReminderModal = true;
        },

        saveReminder() {
            if (this.editingReminder) {
                const index = this.reminders.findIndex(r => r.id === this.editingReminder.id);
                if (index !== -1) {
                    this.reminders[index] = { ...this.editingReminder, ...this.reminderForm };
                }
            } else {
                const newReminder = {
                    id: Math.max(...this.reminders.map(r => r.id)) + 1,
                    ...this.reminderForm,
                    completed: false
                };
                this.reminders.push(newReminder);
            }
            
            this.showReminderModal = false;
        },

        toggleReminderCompletion(reminderId) {
            const reminder = this.reminders.find(r => r.id === reminderId);
            if (reminder) {
                reminder.completed = !reminder.completed;
            }
        },

        deleteReminder(reminderId) {
            this.reminders = this.reminders.filter(r => r.id !== reminderId);
        }
    }));
});

// Advanced Search and Filter Component
document.addEventListener('alpine:init', () => {
    Alpine.data('advancedSearch', () => ({
        searchQuery: '',
        searchType: 'all',
        searchResults: [],
        filters: {
            dateRange: { start: '', end: '' },
            categories: [],
            status: [],
            priority: [],
            assignedTo: [],
            tags: []
        },
        isSearching: false,
        recentSearches: ['گزارش مالی', 'پروژه توسعه', 'قرارداد پشتیبانی'],

        async performSearch() {
            this.isSearching = true;
            
            // Simulate API call delay
            await new Promise(resolve => setTimeout(resolve, 1000));
            
            // In a real application, this would be an API call
            this.searchResults = this.mockSearch();
            
            this.isSearching = false;
            
            // Add to recent searches
            if (this.searchQuery && !this.recentSearches.includes(this.searchQuery)) {
                this.recentSearches.unshift(this.searchQuery);
                if (this.recentSearches.length > 5) {
                    this.recentSearches.pop();
                }
            }
        },

        mockSearch() {
            // Mock search results - in real app this would come from backend
            const mockData = [
                { 
                    id: 1, 
                    type: 'task', 
                    title: 'بررسی گزارش مالی', 
                    description: 'بررسی و تایید گزارش مالی سه ماهه اول',
                    date: '1402/05/15',
                    relevance: 95
                },
                { 
                    id: 2, 
                    type: 'project', 
                    title: 'پروژه توسعه سیستم', 
                    description: 'توسعه سیستم مدیریت سازمانی',
                    date: '1402/04/01',
                    relevance: 87
                },
                { 
                    id: 3, 
                    type: 'document', 
                    title: 'قرارداد پشتیبانی', 
                    description: 'قرارداد پشتیبانی فنی به مدت یک سال',
                    date: '1402/03/20',
                    relevance: 76
                }
            ];
            
            return mockData.filter(item => 
                item.title.includes(this.searchQuery) ||
                item.description.includes(this.searchQuery)
            );
        },

        clearSearch() {
            this.searchQuery = '';
            this.searchResults = [];
            this.resetFilters();
        },

        resetFilters() {
            this.filters = {
                dateRange: { start: '', end: '' },
                categories: [],
                status: [],
                priority: [],
                assignedTo: [],
                tags: []
            };
        },

        get searchStats() {
            return {
                total: this.searchResults.length,
                byType: this.searchResults.reduce((acc, result) => {
                    acc[result.type] = (acc[result.type] || 0) + 1;
                    return acc;
                }, {})
            };
        },

        getResultIcon(type) {
            const icons = {
                'task': 'fas fa-tasks',
                'project': 'fas fa-project-diagram',
                'document': 'fas fa-file',
                'contact': 'fas fa-user',
                'transaction': 'fas fa-exchange-alt'
            };
            return icons[type] || 'fas fa-search';
        },

        getResultColor(type) {
            const colors = {
                'task': 'text-blue-400',
                'project': 'text-green-400',
                'document': 'text-yellow-400',
                'contact': 'text-purple-400',
                'transaction': 'text-indigo-400'
            };
            return colors[type] || 'text-gray-400';
        }
    }));
});

// Member Management Component (HR)
document.addEventListener('alpine:init', () => {
    Alpine.data('members', () => ({
        members: [
            {
                id: 1,
                personalCode: 'EMP001',
                firstName: 'علی',
                lastName: 'محمدی',
                fatherName: 'رضا',
                nationalCode: '1234567890',
                birthDate: '1365/03/15',
                birthPlace: 'تهران',
                gender: 'male',
                maritalStatus: 'married',
                mobile: '09123456789',
                phone: '021-1234567',
                email: 'ali@company.com',
                address: 'تهران، خیابان نمونه، پلاک 123',
                postalCode: '1234567890',
                emergencyContact: { name: 'فاطمه محمدی', phone: '09129876543', relation: 'همسر' },
                
                position: 'توسعه‌دهنده ارشد',
                department: 'فنی',
                employmentType: 'fulltime',
                hireDate: '1400/05/01',
                contractType: 'رسمی',
                contractDuration: 'نامحدود',
                workLocation: 'دفتر مرکزی',
                supervisor: 'مدیر فنی',
                workShift: 'صبح',
                weeklyHours: 45,
                probationPeriod: 3,
                insuranceNumber: '123456789',
                insuranceDate: '1400/05/01',
                
                skills: [
                    { name: 'JavaScript', level: 'expert', experience: 5 },
                    { name: 'Python', level: 'advanced', experience: 3 }
                ],
                education: [
                    { degree: 'کارشناسی', field: 'مهندسی نرم‌افزار', university: 'تهران', period: '1383-1387' }
                ],
                certificates: ['AWS Certified', 'Scrum Master'],
                
                projects: [
                    { projectId: 1, role: 'توسعه‌دهنده اصلی', allocation: 80 },
                    { projectId: 2, role: 'مشاور فنی', allocation: 20 }
                ],
                
                salary: {
                    base: 50000000,
                    housing: 10000000,
                    transportation: 5000000,
                    food: 3000000,
                    overtimeRate: 50000
                },
                
                leaveBalance: {
                    total: 30,
                    used: 15,
                    remaining: 15
                },
                
                documents: [
                    { type: 'شناسنامه', uploadDate: '1400/05/01', size: '2MB', expiry: '' },
                    { type: 'کارت ملی', uploadDate: '1400/05/01', size: '1.5MB', expiry: '' }
                ],
                
                isActive: true
            }
        ],
        memberSearch: '',
        memberFilter: 'all',
        showMemberModal: false,
        editingMember: null,
        activeTab: 'personal',
        
        memberForm: {
            personalCode: '',
            firstName: '',
            lastName: '',
            fatherName: '',
            nationalCode: '',
            birthDate: '',
            birthPlace: '',
            gender: 'male',
            maritalStatus: 'single',
            mobile: '',
            phone: '',
            email: '',
            address: '',
            postalCode: '',
            emergencyContact: { name: '', phone: '', relation: '' },
            
            position: '',
            department: '',
            employmentType: 'fulltime',
            hireDate: '',
            contractType: 'رسمی',
            contractDuration: '',
            workLocation: '',
            supervisor: '',
            workShift: 'صبح',
            weeklyHours: 45,
            probationPeriod: 3,
            insuranceNumber: '',
            insuranceDate: '',
            
            skills: [],
            education: [],
            certificates: [],
            
            projects: [],
            
            salary: {
                base: 0,
                housing: 0,
                transportation: 0,
                food: 0,
                overtimeRate: 0
            },
            
            isActive: true
        },

        newSkill: { name: '', level: 'intermediate', experience: 0 },
        newEducation: { degree: '', field: '', university: '', period: '' },
        newProject: { projectId: '', role: '', allocation: 0 },

        get filteredMembers() {
            let filtered = this.members;
            
            if (this.memberSearch) {
                filtered = filtered.filter(member => 
                    member.firstName.includes(this.memberSearch) ||
                    member.lastName.includes(this.memberSearch) ||
                    member.personalCode.includes(this.memberSearch)
                );
            }
            
            if (this.memberFilter === 'active') {
                filtered = filtered.filter(member => member.isActive);
            } else if (this.memberFilter === 'inactive') {
                filtered = filtered.filter(member => !member.isActive);
            }
            
            return filtered;
        },

        get memberStats() {
            const total = this.members.length;
            const active = this.members.filter(m => m.isActive).length;
            const byDepartment = this.members.reduce((acc, member) => {
                acc[member.department] = (acc[member.department] || 0) + 1;
                return acc;
            }, {});
            
            return { total, active, byDepartment };
        },

        openMemberModal(member = null) {
            this.editingMember = member;
            this.activeTab = 'personal';
            
            if (member) {
                this.memberForm = JSON.parse(JSON.stringify(member));
            } else {
                this.resetMemberForm();
            }
            
            this.showMemberModal = true;
        },

        resetMemberForm() {
            this.memberForm = {
                personalCode: this.generatePersonalCode(),
                firstName: '',
                lastName: '',
                fatherName: '',
                nationalCode: '',
                birthDate: '',
                birthPlace: '',
                gender: 'male',
                maritalStatus: 'single',
                mobile: '',
                phone: '',
                email: '',
                address: '',
                postalCode: '',
                emergencyContact: { name: '', phone: '', relation: '' },
                
                position: '',
                department: '',
                employmentType: 'fulltime',
                hireDate: '',
                contractType: 'رسمی',
                contractDuration: '',
                workLocation: '',
                supervisor: '',
                workShift: 'صبح',
                weeklyHours: 45,
                probationPeriod: 3,
                insuranceNumber: '',
                insuranceDate: '',
                
                skills: [],
                education: [],
                certificates: [],
                
                projects: [],
                
                salary: {
                    base: 0,
                    housing: 0,
                    transportation: 0,
                    food: 0,
                    overtimeRate: 0
                },
                
                isActive: true
            };
        },

        generatePersonalCode() {
            const lastCode = Math.max(...this.members.map(m => parseInt(m.personalCode.replace('EMP', '')) || 0));
            return 'EMP' + String(lastCode + 1).padStart(3, '0');
        },

        saveMember() {
            if (this.editingMember) {
                const index = this.members.findIndex(m => m.id === this.editingMember.id);
                if (index !== -1) {
                    this.members[index] = { ...this.editingMember, ...this.memberForm };
                }
            } else {
                const newMember = {
                    id: Math.max(...this.members.map(m => m.id)) + 1,
                    ...this.memberForm,
                    leaveBalance: { total: 30, used: 0, remaining: 30 },
                    documents: []
                };
                this.members.push(newMember);
            }
            
            this.showMemberModal = false;
        },

        addSkill() {
            if (this.newSkill.name) {
                this.memberForm.skills.push({ ...this.newSkill });
                this.newSkill = { name: '', level: 'intermediate', experience: 0 };
            }
        },

        removeSkill(index) {
            this.memberForm.skills.splice(index, 1);
        },

        addEducation() {
            if (this.newEducation.degree && this.newEducation.field) {
                this.memberForm.education.push({ ...this.newEducation });
                this.newEducation = { degree: '', field: '', university: '', period: '' };
            }
        },

        removeEducation(index) {
            this.memberForm.education.splice(index, 1);
        },

        addProject() {
            if (this.newProject.projectId && this.newProject.role) {
                this.memberForm.projects.push({ ...this.newProject });
                this.newProject = { projectId: '', role: '', allocation: 0 };
            }
        },

        removeProject(index) {
            this.memberForm.projects.splice(index, 1);
        },

        calculateTotalSalary() {
            const salary = this.memberForm.salary;
            return salary.base + salary.housing + salary.transportation + salary.food;
        },

        formatCurrency(amount) {
            return new Intl.NumberFormat('fa-IR').format(amount) + ' ریال';
        }
    }));
});

// Database and Backup Management Component
document.addEventListener('alpine:init', () => {
    Alpine.data('database', () => ({
        backups: [
            { id: 1, name: 'backup_1402_05_20.sql', size: '45.2 MB', date: '1402/05/20 14:30', type: 'manual', status: 'completed' },
            { id: 2, name: 'backup_1402_05_19.sql', size: '44.8 MB', date: '1402/05/19 02:00', type: 'auto', status: 'completed' },
            { id: 3, name: 'backup_1402_05_18.sql', size: '44.5 MB', date: '1402/05/18 02:00', type: 'auto', status: 'completed' }
        ],
        settings: {
            autoBackup: true,
            backupTime: '02:00',
            backupInterval: 'daily',
            keepBackups: 30,
            backupPath: '/backups/',
            compressBackups: true,
            notifyOnBackup: true
        },
        isBackingUp: false,
        showSettingsModal: false,

        async createBackup() {
            this.isBackingUp = true;
            
            // Simulate backup process
            await new Promise(resolve => setTimeout(resolve, 3000));
            
            const newBackup = {
                id: Math.max(...this.backups.map(b => b.id)) + 1,
                name: `backup_${new Date().toLocaleDateString('fa-IR').replace(/\//g, '_')}.sql`,
                size: '45.5 MB',
                date: new Date().toLocaleString('fa-IR'),
                type: 'manual',
                status: 'completed'
            };
            
            this.backups.unshift(newBackup);
            this.isBackingUp = false;
        },

        async restoreBackup(backupId) {
            if (confirm('آیا از بازیابی این پشتیبان اطمینان دارید؟ تمام داده‌های فعلی جایگزین خواهند شد.')) {
                // Simulate restore process
                await new Promise(resolve => setTimeout(resolve, 2000));
                alert('بازیابی با موفقیت انجام شد.');
            }
        },

        deleteBackup(backupId) {
            if (confirm('آیا از حذف این پشتیبان اطمینان دارید؟')) {
                this.backups = this.backups.filter(backup => backup.id !== backupId);
            }
        },

        downloadBackup(backupId) {
            const backup = this.backups.find(b => b.id === backupId);
            if (backup) {
                // Simulate download
                alert(`در حال دانلود ${backup.name}`);
            }
        },

        get backupStats() {
            const totalSize = this.backups.reduce((sum, backup) => {
                const size = parseFloat(backup.size);
                return sum + (isNaN(size) ? 0 : size);
            }, 0);
            
            const manualCount = this.backups.filter(b => b.type === 'manual').length;
            const autoCount = this.backups.filter(b => b.type === 'auto').length;
            
            return {
                total: this.backups.length,
                totalSize: totalSize.toFixed(1) + ' MB',
                manualCount,
                autoCount
            };
        },

        saveSettings() {
            // In real app, this would save to backend
            localStorage.setItem('databaseSettings', JSON.stringify(this.settings));
            this.showSettingsModal = false;
            alert('تنظیمات ذخیره شد.');
        },

        exportData(format = 'json') {
            const data = {
                timestamp: new Date().toISOString(),
                version: '1.0',
                tables: ['users', 'projects', 'tasks', 'transactions'] // Example tables
            };
            
            const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `export_${new Date().getTime()}.${format}`;
            a.click();
            URL.revokeObjectURL(url);
        },

        importData(event) {
            const file = event.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = (e) => {
                    try {
                        const data = JSON.parse(e.target.result);
                        alert('داده با موفقیت وارد شد.');
                        console.log('Imported data:', data);
                    } catch (error) {
                        alert('خطا در وارد کردن داده: ' + error.message);
                    }
                };
                reader.readAsText(file);
            }
        }
    }));
});
</script>
</body>
</html>