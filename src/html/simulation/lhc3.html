<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Advanced Particle Physics Simulation</title>
    <script src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js" defer></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        :root {
            --accelerator-primary: #2563eb;
            --accelerator-secondary: #7c3aed;
            --detector-atlas: #dc2626;
            --detector-cms: #059669;
            --proton-beam: #3b82f6;
            --antiproton-beam: #ef4444;
            --electron-beam: #8b5cf6;
            --positron-beam: #06b6d4;
            --photon: #f59e0b;
            --gluon: #f97316;
            --higgs: #ec4899;
            --top-quark: #10b981;
            --bottom-quark: #8b5cf6;
            --charm-quark: #ef4444;
            --strange-quark: #84cc16;
            --up-quark: #3b82f6;
            --down-quark: #06b6d4;
            --muon: #d946ef;
            --tau: #f97316;
            --neutrino: #6b7280;
            --w-boson: #dc2626;
            --z-boson: #7c3aed;
            --pion: #ec4899;
            --kaon: #84cc16;
            --tracker: #f59e0b;
            --calorimeter: #10b981;
            --muon-chamber: #8b5cf6;
            --magnet: #6b7280;
            --dark-bg: #0f172a;
            --card-bg: #1e293b;
            --text: #e2e8f0;
            --highlight: #10b981;
        }
        
        body {
            background: linear-gradient(135deg, var(--dark-bg), #1e1b4b);
            color: var(--text);
            line-height: 1.6;
            min-height: 100vh;
            padding: 20px;
            overflow-x: hidden;
        }
        
        .container {
            max-width: 2000px;
            margin: 0 auto;
        }
        
        header {
            text-align: center;
            margin-bottom: 40px;
            padding: 30px;
            background: rgba(30, 41, 59, 0.7);
            border-radius: 16px;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(100, 116, 139, 0.3);
            position: relative;
            overflow: hidden;
        }
        
        header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, var(--accelerator-primary), var(--detector-atlas), var(--detector-cms));
        }
        
        h1 {
            font-size: 2.8rem;
            margin-bottom: 15px;
            background: linear-gradient(90deg, var(--accelerator-primary), var(--detector-atlas));
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            text-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
        }
        
        .subtitle {
            font-size: 1.3rem;
            opacity: 0.9;
            max-width: 800px;
            margin: 0 auto 20px;
        }
        
        .simulation-layout {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-bottom: 40px;
        }
        
        @media (max-width: 1600px) {
            .simulation-layout {
                grid-template-columns: 1fr;
            }
        }
        
        .accelerator-panel {
            background: var(--card-bg);
            border-radius: 16px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(100, 116, 139, 0.3);
            display: flex;
            flex-direction: column;
        }
        
        .detector-panel {
            background: var(--card-bg);
            border-radius: 16px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(100, 116, 139, 0.3);
            display: flex;
            flex-direction: column;
        }
        
        .panel-title {
            font-size: 1.6rem;
            margin-bottom: 20px;
            color: var(--accelerator-primary);
            border-bottom: 2px solid rgba(100, 150, 255, 0.3);
            padding-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .detector-panel .panel-title {
            color: var(--detector-atlas);
        }
        
        .panel-title::before {
            content: '';
            width: 12px;
            height: 12px;
            border-radius: 50%;
        }
        
        .accelerator-panel .panel-title::before {
            background: var(--accelerator-primary);
        }
        
        .detector-panel .panel-title::before {
            background: var(--detector-atlas);
        }
        
        .visualization-area {
            position: relative;
            width: 100%;
            height: 500px;
            background: rgba(15, 23, 42, 0.7);
            border-radius: 12px;
            border: 1px solid rgba(100, 116, 139, 0.3);
            overflow: hidden;
            margin-bottom: 20px;
        }
        
        .accelerator-ring {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 400px;
            height: 400px;
            border-radius: 50%;
            border: 3px solid var(--accelerator-primary);
            background: transparent;
            box-shadow: 0 0 30px rgba(37, 99, 235, 0.3);
        }
        
        .beam-pipe {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 380px;
            height: 380px;
            border-radius: 50%;
            border: 2px dashed rgba(100, 116, 139, 0.5);
            background: transparent;
        }
        
        .beam-particle {
            position: absolute;
            width: 8px;
            height: 8px;
            border-radius: 50%;
            transform: translate(-50%, -50%);
        }
        
        .proton-beam { background: var(--proton-beam); }
        .antiproton-beam { background: var(--antiproton-beam); }
        .electron-beam { background: var(--electron-beam); }
        .positron-beam { background: var(--positron-beam); }
        
        .interaction-point {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: rgba(220, 38, 38, 0.7);
            box-shadow: 0 0 20px rgba(220, 38, 38, 0.5);
            z-index: 10;
        }
        
        .detector-visualization {
            position: relative;
            width: 100%;
            height: 100%;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        
        .detector-layer {
            position: absolute;
            border-radius: 50%;
            border-style: solid;
            display: flex;
            justify-content: center;
            align-items: center;
            color: white;
            font-weight: bold;
            font-size: 14px;
        }
        
        .tracker { 
            border-color: var(--tracker);
            background: rgba(245, 158, 11, 0.1);
        }
        
        .calorimeter { 
            border-color: var(--calorimeter);
            background: rgba(16, 185, 129, 0.1);
        }
        
        .muon-system { 
            border-color: var(--muon-chamber);
            background: rgba(139, 92, 246, 0.1);
        }
        
        .magnet {
            position: absolute;
            background: rgba(107, 114, 128, 0.3);
            border: 2px solid var(--magnet);
            display: flex;
            justify-content: center;
            align-items: center;
            color: white;
            font-weight: bold;
        }
        
        .collision-particle {
            position: absolute;
            width: 8px;
            height: 8px;
            border-radius: 50%;
            transform: translate(-50%, -50%);
            animation: particleMove 2s linear forwards;
            z-index: 10;
        }
        
        @keyframes particleMove {
            0% { 
                transform: translate(-50%, -50%) scale(1);
                opacity: 1;
            }
            100% { 
                transform: translate(var(--target-x), var(--target-y)) scale(0.5);
                opacity: 0;
            }
        }
        
        .particle-track {
            position: absolute;
            height: 2px;
            background: linear-gradient(90deg, var(--tracker), transparent);
            transform-origin: 0 0;
            z-index: 5;
        }
        
        .energy-deposit {
            position: absolute;
            border-radius: 50%;
            background: radial-gradient(circle, var(--calorimeter), transparent);
            transform: translate(-50%, -50%);
            opacity: 0.7;
            animation: energyPulse 1.5s ease-out;
        }
        
        @keyframes energyPulse {
            0% { transform: translate(-50%, -50%) scale(0); opacity: 0.8; }
            50% { transform: translate(-50%, -50%) scale(1); opacity: 0.5; }
            100% { transform: translate(-50%, -50%) scale(1.5); opacity: 0; }
        }
        
        .particle-spin {
            position: absolute;
            width: 16px;
            height: 16px;
            border-radius: 50%;
            border: 2px solid;
            animation: spin 2s linear infinite;
            z-index: 15;
        }
        
        @keyframes spin {
            0% { transform: translate(-50%, -50%) rotate(0deg); }
            100% { transform: translate(-50%, -50%) rotate(360deg); }
        }
        
        .particle-label {
            position: absolute;
            font-size: 10px;
            font-weight: bold;
            color: white;
            text-shadow: 1px 1px 2px black;
            z-index: 20;
            pointer-events: none;
        }
        
        .annihilation-flash {
            position: absolute;
            border-radius: 50%;
            background: radial-gradient(circle, rgba(255,255,255,0.8), transparent);
            transform: translate(-50%, -50%);
            animation: flashExpand 0.3s ease-out forwards;
            z-index: 25;
        }
        
        @keyframes flashExpand {
            0% { width: 0; height: 0; opacity: 1; }
            100% { width: 100px; height: 100px; opacity: 0; }
        }
        
        .creation-event {
            position: absolute;
            border-radius: 50%;
            background: radial-gradient(circle, rgba(255,255,255,0.6), transparent);
            transform: translate(-50%, -50%);
            animation: creationPulse 0.5s ease-out forwards;
            z-index: 25;
        }
        
        @keyframes creationPulse {
            0% { width: 0; height: 0; opacity: 1; }
            50% { width: 60px; height: 60px; opacity: 0.7; }
            100% { width: 100px; height: 100px; opacity: 0; }
        }
        
        .jet-event {
            position: absolute;
            width: 0;
            height: 0;
            border-radius: 50%;
            background: conic-gradient(from 0deg, rgba(255,0,0,0.7), rgba(255,165,0,0.7), rgba(255,255,0,0.7), rgba(0,255,0,0.7), rgba(0,0,255,0.7), rgba(75,0,130,0.7), rgba(238,130,238,0.7), rgba(255,0,0,0.7));
            transform: translate(-50%, -50%);
            animation: jetExpand 1s ease-out forwards;
            z-index: 30;
        }
        
        @keyframes jetExpand {
            0% { width: 0; height: 0; opacity: 1; }
            100% { width: 150px; height: 150px; opacity: 0; }
        }
        
        .controls-panel {
            background: var(--card-bg);
            border-radius: 16px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(100, 116, 139, 0.3);
            margin-top: 30px;
        }
        
        .control-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 25px;
            border-bottom: 1px solid rgba(100, 116, 139, 0.3);
            padding-bottom: 15px;
        }
        
        .tab {
            padding: 10px 20px;
            background: rgba(15, 23, 42, 0.7);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            border: 1px solid transparent;
        }
        
        .tab.active {
            background: var(--accelerator-primary);
            border-color: var(--accelerator-primary);
        }
        
        .control-group {
            margin-bottom: 25px;
        }
        
        .control-title {
            font-size: 1.2rem;
            margin-bottom: 15px;
            color: var(--accelerator-primary);
        }
        
        .slider-container {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 10px;
        }
        
        label {
            min-width: 200px;
            font-weight: 600;
        }
        
        input[type="range"] {
            flex: 1;
            height: 8px;
            border-radius: 4px;
            background: rgba(100, 116, 139, 0.3);
            outline: none;
            -webkit-appearance: none;
        }
        
        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: var(--accelerator-primary);
            cursor: pointer;
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.3);
        }
        
        .value-display {
            min-width: 80px;
            text-align: center;
            padding: 5px 10px;
            background: rgba(30, 41, 59, 0.7);
            border-radius: 6px;
            font-family: 'Courier New', monospace;
            font-weight: bold;
        }
        
        .button-group {
            display: flex;
            gap: 15px;
            margin-top: 20px;
            flex-wrap: wrap;
        }
        
        button {
            background: linear-gradient(90deg, var(--accelerator-primary), #3b82f6);
            border: none;
            color: white;
            padding: 12px 24px;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
            flex: 1;
            min-width: 150px;
        }
        
        button:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 18px rgba(0, 0, 0, 0.3);
        }
        
        button:active {
            transform: translateY(1px);
        }
        
        .detector-selector {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .detector-option {
            flex: 1;
            padding: 15px;
            background: rgba(15, 23, 42, 0.7);
            border-radius: 8px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            border: 2px solid transparent;
        }
        
        .detector-option.active {
            border-color: var(--detector-atlas);
        }
        
        .detector-option.cms.active {
            border-color: var(--detector-cms);
        }
        
        .collision-type-selector {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 10px;
            margin-bottom: 20px;
        }
        
        .collision-type {
            padding: 10px;
            background: rgba(15, 23, 42, 0.7);
            border-radius: 8px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            border: 2px solid transparent;
        }
        
        .collision-type.active {
            border-color: var(--highlight);
        }
        
        .stats-panel {
            background: var(--card-bg);
            border-radius: 16px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(100, 116, 139, 0.3);
            margin-top: 30px;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        
        .stat-card {
            background: rgba(15, 23, 42, 0.7);
            border-radius: 12px;
            padding: 20px;
            border-left: 4px solid var(--highlight);
        }
        
        .stat-title {
            font-weight: bold;
            margin-bottom: 10px;
            color: var(--accelerator-primary);
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .stat-value {
            font-size: 1.5rem;
            font-weight: bold;
            color: var(--highlight);
            font-family: 'Courier New', monospace;
        }
        
        .event-display {
            background: var(--card-bg);
            border-radius: 16px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(100, 116, 139, 0.3);
            margin-top: 30px;
            max-height: 400px;
            overflow-y: auto;
        }
        
        .event-log {
            font-family: 'Courier New', monospace;
            font-size: 0.9rem;
        }
        
        .log-entry {
            margin-bottom: 8px;
            padding-bottom: 8px;
            border-bottom: 1px solid rgba(100, 116, 139, 0.3);
        }
        
        .log-time {
            color: var(--highlight);
            font-weight: bold;
        }
        
        .particle-legend {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            margin: 20px 0;
            justify-content: center;
        }
        
        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px 15px;
            background: rgba(15, 23, 42, 0.7);
            border-radius: 8px;
        }
        
        .legend-color {
            width: 16px;
            height: 16px;
            border-radius: 50%;
        }
        
        .proton-legend { background: var(--proton-beam); }
        .antiproton-legend { background: var(--antiproton-beam); }
        .electron-legend { background: var(--electron-beam); }
        .positron-legend { background: var(--positron-beam); }
        .photon-legend { background: var(--photon); }
        .higgs-legend { background: var(--higgs); }
        
        footer {
            text-align: center;
            margin-top: 50px;
            padding: 25px;
            font-size: 0.9rem;
            opacity: 0.8;
            border-top: 1px solid rgba(100, 116, 139, 0.3);
        }
        
        .collision-animation {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 0;
            height: 0;
            border-radius: 50%;
            background: radial-gradient(circle, rgba(220, 38, 38, 0.8), transparent);
            animation: collisionExpand 0.5s ease-out forwards;
            z-index: 20;
        }
        
        @keyframes collisionExpand {
            0% { width: 0; height: 0; opacity: 1; }
            100% { width: 100px; height: 100px; opacity: 0; }
        }
        
        .chart-container {
            background: var(--card-bg);
            border-radius: 16px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(100, 116, 139, 0.3);
            margin-top: 30px;
            height: 300px;
        }
        
        .particle-info {
            position: absolute;
            background: rgba(15, 23, 42, 0.9);
            border: 1px solid var(--highlight);
            border-radius: 8px;
            padding: 10px;
            font-size: 12px;
            max-width: 200px;
            z-index: 100;
            pointer-events: none;
            opacity: 0;
            transition: opacity 0.3s;
        }
        
        .decay-chain {
            position: absolute;
            width: 2px;
            background: linear-gradient(to bottom, rgba(255,255,255,0.8), transparent);
            transform-origin: 0 0;
            z-index: 5;
        }
    </style>
</head>
<body>
    <div class="container" x-data="advancedParticleSimulation()">
        <header>
            <h1>Advanced Particle Physics Simulation</h1>
            <p class="subtitle">Real-time visualization of particle collisions, creation, annihilation, and decay processes with spin representation</p>
            
            <div class="particle-legend">
                <div class="legend-item">
                    <div class="legend-color proton-legend"></div>
                    <span>Proton</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color electron-legend"></div>
                    <span>Electron</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color photon-legend"></div>
                    <span>Photon</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color higgs-legend"></div>
                    <span>Higgs Boson</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background: var(--muon);"></div>
                    <span>Muon</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background: var(--w-boson);"></div>
                    <span>W Boson</span>
                </div>
            </div>
        </header>
        
        <div class="simulation-layout">
            <div class="accelerator-panel">
                <h2 class="panel-title">Particle Accelerator</h2>
                <div class="visualization-area" id="acceleratorViz">
                    <div class="accelerator-ring"></div>
                    <div class="beam-pipe"></div>
                    <div class="interaction-point"></div>
                    <!-- Beam particles will be generated here -->
                </div>
                
                <div class="detector-selector">
                    <div class="detector-option active" @click="selectDetector('ATLAS')">
                        <h3>ATLAS Detector</h3>
                        <p>General-purpose detector at LHC</p>
                    </div>
                    <div class="detector-option cms" @click="selectDetector('CMS')">
                        <h3>CMS Detector</h3>
                        <p>Compact Muon Solenoid at LHC</p>
                    </div>
                </div>
                
                <div class="collision-type-selector">
                    <div class="collision-type active" @click="selectCollisionType('pp')">Proton-Proton</div>
                    <div class="collision-type" @click="selectCollisionType('ee')">Electron-Positron</div>
                    <div class="collision-type" @click="selectCollisionType('heavy-ion')">Heavy Ion</div>
                    <div class="collision-type" @click="selectCollisionType('photon')">Photon-Photon</div>
                    <div class="collision-type" @click="selectCollisionType('higgs')">Higgs Production</div>
                    <div class="collision-type" @click="selectCollisionType('top')">Top Quark</div>
                </div>
            </div>
            
            <div class="detector-panel">
                <h2 class="panel-title" x-text="`${selectedDetector} Detector Response`"></h2>
                <div class="visualization-area">
                    <div class="detector-visualization" id="detectorViz">
                        <!-- Detector layers and collision events will be rendered here -->
                    </div>
                </div>
                
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-title">Collision Energy</div>
                        <div class="stat-value" x-text="`${collisionEnergy} TeV`"></div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-title">Luminosity</div>
                        <div class="stat-value" x-text="`${luminosity} cm⁻²s⁻¹`"></div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-title">Events Recorded</div>
                        <div class="stat-value" x-text="eventsRecorded"></div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-title">Event Rate</div>
                        <div class="stat-value" x-text="`${eventRate} Hz`"></div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="controls-panel">
            <div class="control-tabs">
                <div class="tab active" @click="activeTab = 'accelerator'">Accelerator Controls</div>
                <div class="tab" @click="activeTab = 'beam'">Beam Parameters</div>
                <div class="tab" @click="activeTab = 'detector'">Detector Settings</div>
                <div class="tab" @click="activeTab = 'physics'">Physics Processes</div>
            </div>
            
            <div x-show="activeTab === 'accelerator'">
                <div class="control-group">
                    <h3 class="control-title">Accelerator Parameters</h3>
                    <div class="slider-container">
                        <label for="collision-energy">Collision Energy (TeV)</label>
                        <input type="range" id="collision-energy" min="0.5" max="14" step="0.1" 
                               x-model="collisionEnergy" @input="updateAccelerator">
                        <div class="value-display" x-text="`${collisionEnergy} TeV`"></div>
                    </div>
                    
                    <div class="slider-container">
                        <label for="luminosity">Luminosity (10³⁴ cm⁻²s⁻¹)</label>
                        <input type="range" id="luminosity" min="0.1" max="5.0" step="0.1" 
                               x-model="luminosity" @input="updateAccelerator">
                        <div class="value-display" x-text="`${luminosity}`"></div>
                    </div>
                    
                    <div class="slider-container">
                        <label for="bunch-intensity">Bunch Intensity (10¹¹ particles)</label>
                        <input type="range" id="bunch-intensity" min="0.5" max="2.5" step="0.1" 
                               x-model="bunchIntensity" @input="updateAccelerator">
                        <div class="value-display" x-text="`${bunchIntensity}`"></div>
                    </div>
                </div>
            </div>
            
            <div x-show="activeTab === 'physics'">
                <div class="control-group">
                    <h3 class="control-title">Physics Process Rates</h3>
                    <div class="slider-container">
                        <label for="higgs-production">Higgs Production</label>
                        <input type="range" id="higgs-production" min="0" max="100" step="1" 
                               x-model="processRates.higgs" @input="updateProcessRates">
                        <div class="value-display" x-text="`${processRates.higgs}%`"></div>
                    </div>
                    
                    <div class="slider-container">
                        <label for="top-production">Top Quark Production</label>
                        <input type="range" id="top-production" min="0" max="100" step="1" 
                               x-model="processRates.top" @input="updateProcessRates">
                        <div class="value-display" x-text="`${processRates.top}%`"></div>
                    </div>
                    
                    <div class="slider-container">
                        <label for="jet-production">Jet Production</label>
                        <input type="range" id="jet-production" min="0" max="100" step="1" 
                               x-model="processRates.jets" @input="updateProcessRates">
                        <div class="value-display" x-text="`${processRates.jets}%`"></div>
                    </div>
                    
                    <div class="slider-container">
                        <label for="annihilation">Annihilation Events</label>
                        <input type="range" id="annihilation" min="0" max="100" step="1" 
                               x-model="processRates.annihilation" @input="updateProcessRates">
                        <div class="value-display" x-text="`${processRates.annihilation}%`"></div>
                    </div>
                </div>
            </div>
            
            <div class="button-group">
                <button @click="startCollisions()">Start Collisions</button>
                <button @click="pauseCollisions()">Pause</button>
                <button @click="resetSimulation()">Reset</button>
                <button @click="singleCollision()">Single Collision</button>
                <button @click="triggerSpecialEvent()">Special Event</button>
                <button @click="exportData()">Export Data</button>
            </div>
        </div>
        
        <div class="chart-container">
            <h2 class="panel-title">Particle Production Rates</h2>
            <canvas id="productionChart" width="400" height="200"></canvas>
        </div>
        
        <div class="event-display">
            <h2 class="panel-title">Collision Event Log</h2>
            <div class="event-log" x-html="eventLog"></div>
        </div>
        
        <footer>
            <p>Advanced Particle Physics Simulation | Real-time visualization of creation, annihilation, and decay processes</p>
            <p>Based on real physics data from LHC experiments</p>
        </footer>
    </div>

    <script>
        document.addEventListener('alpine:init', () => {
            Alpine.data('advancedParticleSimulation', () => ({
                // Simulation state
                isRunning: false,
                simulationTime: 0,
                activeTab: 'accelerator',
                selectedDetector: 'ATLAS',
                selectedCollisionType: 'pp',
                
                // Accelerator parameters
                collisionEnergy: 13.6,
                luminosity: 2.0,
                bunchIntensity: 1.2,
                
                // Beam parameters
                beamType: 'proton-proton',
                bunchSpacing: 25,
                beamFocus: 0.4,
                
                // Process rates
                processRates: {
                    higgs: 5,
                    top: 15,
                    jets: 60,
                    annihilation: 20
                },
                
                // Statistics
                eventsRecorded: 0,
                eventRate: 0,
                
                // Visualization elements
                beamParticles: [],
                collisionEvents: [],
                eventLog: '',
                productionChart: null,
                
                // Particle database
                particles: {
                    proton: { name: 'Proton', mass: 0.938, charge: 1, spin: 0.5, color: 'var(--proton-beam)', type: 'baryon' },
                    antiproton: { name: 'Antiproton', mass: 0.938, charge: -1, spin: 0.5, color: 'var(--antiproton-beam)', type: 'baryon' },
                    electron: { name: 'Electron', mass: 0.000511, charge: -1, spin: 0.5, color: 'var(--electron-beam)', type: 'lepton' },
                    positron: { name: 'Positron', mass: 0.000511, charge: 1, spin: 0.5, color: 'var(--positron-beam)', type: 'lepton' },
                    photon: { name: 'Photon', mass: 0, charge: 0, spin: 1, color: 'var(--photon)', type: 'boson' },
                    higgs: { name: 'Higgs Boson', mass: 125.1, charge: 0, spin: 0, color: 'var(--higgs)', type: 'boson' },
                    gluon: { name: 'Gluon', mass: 0, charge: 0, spin: 1, color: 'var(--gluon)', type: 'boson' },
                    'top-quark': { name: 'Top Quark', mass: 173.1, charge: 0.666, spin: 0.5, color: 'var(--top-quark)', type: 'quark' },
                    'bottom-quark': { name: 'Bottom Quark', mass: 4.18, charge: -0.333, spin: 0.5, color: 'var(--bottom-quark)', type: 'quark' },
                    muon: { name: 'Muon', mass: 0.105, charge: -1, spin: 0.5, color: 'var(--muon)', type: 'lepton' },
                    'w-boson': { name: 'W Boson', mass: 80.4, charge: 1, spin: 1, color: 'var(--w-boson)', type: 'boson' },
                    'z-boson': { name: 'Z Boson', mass: 91.2, charge: 0, spin: 1, color: 'var(--z-boson)', type: 'boson' },
                    pion: { name: 'Pion', mass: 0.139, charge: 1, spin: 0, color: 'var(--pion)', type: 'meson' },
                    kaon: { name: 'Kaon', mass: 0.493, charge: 1, spin: 0, color: 'var(--kaon)', type: 'meson' }
                },
                
                init() {
                    this.initializeBeams();
                    this.setupDetector();
                    this.setupChart();
                    this.startCollisions();
                },
                
                initializeBeams() {
                    this.beamParticles = [];
                    
                    // Create beam particles for both directions
                    const numParticles = 30;
                    const radius = 190; // Radius of the beam pipe
                    
                    for (let i = 0; i < numParticles; i++) {
                        const angle = (i / numParticles) * 2 * Math.PI;
                        
                        // Clockwise beam
                        this.beamParticles.push({
                            type: this.getBeamType(true),
                            x: 200 + radius * Math.cos(angle),
                            y: 200 + radius * Math.sin(angle),
                            angle: angle,
                            direction: 1, // clockwise
                            speed: 0.02 + Math.random() * 0.01
                        });
                        
                        // Counter-clockwise beam
                        this.beamParticles.push({
                            type: this.getBeamType(false),
                            x: 200 + radius * Math.cos(angle),
                            y: 200 + radius * Math.sin(angle),
                            angle: angle,
                            direction: -1, // counter-clockwise
                            speed: 0.02 + Math.random() * 0.01
                        });
                    }
                    
                    this.renderAccelerator();
                },
                
                getBeamType(isClockwise) {
                    if (this.selectedCollisionType === 'pp') {
                        return isClockwise ? 'proton' : 'proton';
                    } else if (this.selectedCollisionType === 'ee') {
                        return isClockwise ? 'electron' : 'positron';
                    } else if (this.selectedCollisionType === 'photon') {
                        return isClockwise ? 'photon' : 'photon';
                    } else {
                        return isClockwise ? 'proton' : 'proton';
                    }
                },
                
                setupDetector() {
                    const container = document.getElementById('detectorViz');
                    container.innerHTML = '';
                    
                    // Define detector layers based on selected detector
                    const layers = this.selectedDetector === 'ATLAS' ? 
                        [
                            { name: 'Inner Tracker', radius: 50, thickness: 5, color: 'tracker' },
                            { name: 'Calorimeter', radius: 100, thickness: 10, color: 'calorimeter' },
                            { name: 'Muon System', radius: 150, thickness: 15, color: 'muon-system' }
                        ] : 
                        [
                            { name: 'Silicon Tracker', radius: 60, thickness: 6, color: 'tracker' },
                            { name: 'ECAL', radius: 90, thickness: 8, color: 'calorimeter' },
                            { name: 'HCAL', radius: 120, thickness: 10, color: 'calorimeter' },
                            { name: 'Muon Chambers', radius: 170, thickness: 12, color: 'muon-system' }
                        ];
                    
                    // Create detector layers
                    layers.forEach(layer => {
                        const layerEl = document.createElement('div');
                        layerEl.className = `detector-layer ${layer.color}`;
                        layerEl.style.width = `${layer.radius * 2}px`;
                        layerEl.style.height = `${layer.radius * 2}px`;
                        layerEl.style.borderWidth = `${layer.thickness}px`;
                        layerEl.textContent = layer.name;
                        container.appendChild(layerEl);
                    });
                    
                    // Add magnet for CMS
                    if (this.selectedDetector === 'CMS') {
                        const magnet = document.createElement('div');
                        magnet.className = 'magnet';
                        magnet.style.width = '140px';
                        magnet.style.height = '140px';
                        magnet.textContent = 'Solenoid Magnet';
                        container.appendChild(magnet);
                    }
                },
                
                setupChart() {
                    const ctx = document.getElementById('productionChart').getContext('2d');
                    this.productionChart = new Chart(ctx, {
                        type: 'bar',
                        data: {
                            labels: ['Photons', 'Electrons', 'Muons', 'Jets', 'Higgs', 'Top Quarks'],
                            datasets: [{
                                label: 'Particles per 1000 collisions',
                                data: [320, 180, 45, 420, 1, 8],
                                backgroundColor: [
                                    'rgba(255, 205, 86, 0.7)',
                                    'rgba(54, 162, 235, 0.7)',
                                    'rgba(153, 102, 255, 0.7)',
                                    'rgba(255, 99, 132, 0.7)',
                                    'rgba(75, 192, 192, 0.7)',
                                    'rgba(255, 159, 64, 0.7)'
                                ],
                                borderColor: [
                                    'rgba(255, 205, 86, 1)',
                                    'rgba(54, 162, 235, 1)',
                                    'rgba(153, 102, 255, 1)',
                                    'rgba(255, 99, 132, 1)',
                                    'rgba(75, 192, 192, 1)',
                                    'rgba(255, 159, 64, 1)'
                                ],
                                borderWidth: 1
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            scales: {
                                y: {
                                    beginAtZero: true,
                                    title: {
                                        display: true,
                                        text: 'Count per 1000 collisions'
                                    }
                                }
                            },
                            plugins: {
                                legend: {
                                    display: false
                                },
                                title: {
                                    display: true,
                                    text: 'Particle Production Rates'
                                }
                            }
                        }
                    });
                },
                
                startCollisions() {
                    this.isRunning = true;
                    this.simulationLoop();
                    this.addEvent('Collisions started');
                },
                
                pauseCollisions() {
                    this.isRunning = false;
                    this.addEvent('Collisions paused');
                },
                
                resetSimulation() {
                    this.pauseCollisions();
                    this.simulationTime = 0;
                    this.eventsRecorded = 0;
                    this.eventRate = 0;
                    this.collisionEvents = [];
                    this.eventLog = '';
                    this.initializeBeams();
                    this.addEvent('Simulation reset');
                },
                
                singleCollision() {
                    this.simulateCollision();
                    this.addEvent('Single collision triggered');
                },
                
                triggerSpecialEvent() {
                    // Trigger a special event based on current collision type
                    if (this.selectedCollisionType === 'higgs') {
                        this.simulateHiggsEvent();
                    } else if (this.selectedCollisionType === 'top') {
                        this.simulateTopQuarkEvent();
                    } else if (this.selectedCollisionType === 'ee') {
                        this.simulateAnnihilation();
                    } else {
                        this.simulateJetEvent();
                    }
                },
                
                simulationLoop() {
                    if (!this.isRunning) return;
                    
                    this.simulationTime += 0.1;
                    
                    // Update beam particles
                    this.updateBeamParticles();
                    
                    // Simulate collisions based on luminosity
                    if (Math.random() * 100 < this.luminosity * 5) {
                        this.simulateCollision();
                    }
                    
                    // Update event rate
                    this.updateEventRate();
                    
                    // Continue the loop
                    setTimeout(() => {
                        this.simulationLoop();
                    }, 100);
                },
                
                updateBeamParticles() {
                    this.beamParticles.forEach(particle => {
                        particle.angle += particle.direction * particle.speed;
                        const radius = 190;
                        particle.x = 200 + radius * Math.cos(particle.angle);
                        particle.y = 200 + radius * Math.sin(particle.angle);
                    });
                    
                    this.renderAccelerator();
                },
                
                renderAccelerator() {
                    const container = document.getElementById('acceleratorViz');
                    
                    // Clear previous particles
                    container.querySelectorAll('.beam-particle').forEach(el => el.remove());
                    
                    // Render beam particles
                    this.beamParticles.forEach(particle => {
                        const el = document.createElement('div');
                        el.className = `beam-particle ${particle.type}-beam`;
                        el.style.left = `${particle.x}px`;
                        el.style.top = `${particle.y}px`;
                        container.appendChild(el);
                    });
                },
                
                simulateCollision() {
                    this.eventsRecorded++;
                    
                    // Create collision animation
                    this.createCollisionAnimation();
                    
                    // Generate collision products based on collision type
                    if (this.selectedCollisionType === 'pp') {
                        this.simulateProtonProtonCollision();
                    } else if (this.selectedCollisionType === 'ee') {
                        this.simulateElectronPositronCollision();
                    } else if (this.selectedCollisionType === 'higgs') {
                        if (Math.random() * 100 < this.processRates.higgs) {
                            this.simulateHiggsEvent();
                        } else {
                            this.simulateProtonProtonCollision();
                        }
                    } else if (this.selectedCollisionType === 'top') {
                        if (Math.random() * 100 < this.processRates.top) {
                            this.simulateTopQuarkEvent();
                        } else {
                            this.simulateProtonProtonCollision();
                        }
                    } else {
                        this.simulateProtonProtonCollision();
                    }
                    
                    // Update statistics
                    this.updateStatistics();
                    
                    // Add to event log
                    this.addEvent(`Collision #${this.eventsRecorded} at ${this.collisionEnergy} TeV`);
                },
                
                simulateProtonProtonCollision() {
                    const numParticles = 8 + Math.floor(Math.random() * 15);
                    this.generateCollisionProducts(numParticles, ['photon', 'electron', 'muon', 'pion', 'kaon', 'gluon']);
                    
                    // Occasionally produce jets
                    if (Math.random() * 100 < this.processRates.jets) {
                        this.createJetEvent();
                    }
                },
                
                simulateElectronPositronCollision() {
                    // Electron-positron annihilation
                    this.createAnnihilationFlash();
                    
                    // Produce particle pairs
                    const particleTypes = [['electron', 'positron'], ['muon', 'antimuon'], ['photon', 'photon']];
                    const selectedType = particleTypes[Math.floor(Math.random() * particleTypes.length)];
                    
                    this.generateCollisionProducts(2, selectedType, true);
                    
                    this.addEvent(`e⁺e⁻ annihilation → ${selectedType[0]} + ${selectedType[1]}`);
                },
                
                simulateHiggsEvent() {
                    this.addEvent('Higgs boson production detected!');
                    
                    // Create special Higgs animation
                    this.createHiggsAnimation();
                    
                    // Higgs decay channels
                    const decayChannels = [
                        ['photon', 'photon'],
                        ['z-boson', 'z-boson'],
                        ['w-boson', 'w-boson'],
                        ['bottom-quark', 'bottom-quark']
                    ];
                    
                    const selectedDecay = decayChannels[Math.floor(Math.random() * decayChannels.length)];
                    this.generateCollisionProducts(2, selectedDecay, true);
                    
                    this.addEvent(`H → ${selectedDecay[0]} + ${selectedDecay[1]}`);
                },
                
                simulateTopQuarkEvent() {
                    this.addEvent('Top quark pair production detected!');
                    
                    // Top quark decay (almost always to W boson and bottom quark)
                    this.generateCollisionProducts(4, ['w-boson', 'bottom-quark', 'w-boson', 'bottom-quark'], true);
                    
                    // W boson decays
                    setTimeout(() => {
                        this.generateCollisionProducts(2, ['electron', 'neutrino'], false, 150, 100);
                        this.generateCollisionProducts(2, ['quark', 'quark'], false, 150, 200);
                    }, 500);
                },
                
                simulateAnnihilation() {
                    this.createAnnihilationFlash();
                    this.generateCollisionProducts(2, ['photon', 'photon'], true);
                    this.addEvent('Particle-antiparticle annihilation');
                },
                
                simulateJetEvent() {
                    this.createJetEvent();
                    this.addEvent('Jet production event');
                },
                
                createCollisionAnimation() {
                    const container = document.getElementById('detectorViz');
                    
                    // Create collision flash
                    const collisionFlash = document.createElement('div');
                    collisionFlash.className = 'collision-animation';
                    container.appendChild(collisionFlash);
                    
                    // Remove after animation completes
                    setTimeout(() => {
                        collisionFlash.remove();
                    }, 500);
                },
                
                createHiggsAnimation() {
                    const container = document.getElementById('detectorViz');
                    
                    // Create Higgs boson visualization
                    const higgsParticle = document.createElement('div');
                    higgsParticle.className = 'collision-particle';
                    higgsParticle.style.background = this.particles.higgs.color;
                    higgsParticle.style.left = '200px';
                    higgsParticle.style.top = '200px';
                    higgsParticle.style.width = '15px';
                    higgsParticle.style.height = '15px';
                    higgsParticle.style.setProperty('--target-x', '200px');
                    higgsParticle.style.setProperty('--target-y', '200px');
                    higgsParticle.style.animation = 'none';
                    
                    // Add spin
                    const spin = document.createElement('div');
                    spin.className = 'particle-spin';
                    spin.style.borderColor = this.particles.higgs.color;
                    spin.style.left = '200px';
                    spin.style.top = '200px';
                    
                    container.appendChild(higgsParticle);
                    container.appendChild(spin);
                    
                    // Add label
                    const label = document.createElement('div');
                    label.className = 'particle-label';
                    label.textContent = 'H';
                    label.style.left = '215px';
                    label.style.top = '200px';
                    container.appendChild(label);
                    
                    // Remove after delay
                    setTimeout(() => {
                        higgsParticle.remove();
                        spin.remove();
                        label.remove();
                    }, 2000);
                },
                
                createAnnihilationFlash() {
                    const container = document.getElementById('detectorViz');
                    
                    const flash = document.createElement('div');
                    flash.className = 'annihilation-flash';
                    container.appendChild(flash);
                    
                    setTimeout(() => {
                        flash.remove();
                    }, 300);
                },
                
                createJetEvent() {
                    const container = document.getElementById('detectorViz');
                    
                    const jet = document.createElement('div');
                    jet.className = 'jet-event';
                    jet.style.left = '200px';
                    jet.style.top = '200px';
                    container.appendChild(jet);
                    
                    // Generate multiple particles in a cone
                    const numParticles = 10 + Math.floor(Math.random() * 10);
                    const angle = Math.random() * 2 * Math.PI;
                    const spread = Math.PI / 4;
                    
                    for (let i = 0; i < numParticles; i++) {
                        const particleAngle = angle + (Math.random() - 0.5) * spread;
                        const distance = 50 + Math.random() * 100;
                        
                        const particle = document.createElement('div');
                        particle.className = 'collision-particle';
                        particle.style.background = this.particles.gluon.color;
                        particle.style.left = '200px';
                        particle.style.top = '200px';
                        particle.style.setProperty('--target-x', `${200 + distance * Math.cos(particleAngle)}px`);
                        particle.style.setProperty('--target-y', `${200 + distance * Math.sin(particleAngle)}px`);
                        
                        container.appendChild(particle);
                    }
                    
                    setTimeout(() => {
                        jet.remove();
                    }, 1000);
                },
                
                generateCollisionProducts(numParticles, particleTypes, isPair = false, centerX = 200, centerY = 200) {
                    const container = document.getElementById('detectorViz');
                    
                    // Clear previous collision particles
                    container.querySelectorAll('.collision-particle, .particle-track, .energy-deposit, .particle-spin, .particle-label, .decay-chain').forEach(el => {
                        if (!el.classList.contains('detector-layer') && !el.classList.contains('magnet')) {
                            el.remove();
                        }
                    });
                    
                    for (let i = 0; i < numParticles; i++) {
                        // Random angle and distance
                        const angle = Math.random() * 2 * Math.PI;
                        const distance = 50 + Math.random() * 120;
                        
                        // Determine particle type
                        let particleType;
                        if (Array.isArray(particleTypes)) {
                            particleType = particleTypes[i % particleTypes.length];
                        } else {
                            particleType = particleTypes;
                        }
                        
                        // Get particle properties
                        const particleProps = this.particles[particleType] || this.particles.photon;
                        
                        // Create particle
                        const particle = document.createElement('div');
                        particle.className = `collision-particle`;
                        particle.style.background = particleProps.color;
                        particle.style.left = `${centerX}px`;
                        particle.style.top = `${centerY}px`;
                        particle.style.setProperty('--target-x', `${centerX + distance * Math.cos(angle)}px`);
                        particle.style.setProperty('--target-y', `${centerY + distance * Math.sin(angle)}px`);
                        
                        container.appendChild(particle);
                        
                        // Add spin for fermions and vector bosons
                        if (particleProps.spin > 0) {
                            const spin = document.createElement('div');
                            spin.className = 'particle-spin';
                            spin.style.borderColor = particleProps.color;
                            spin.style.left = `${centerX}px`;
                            spin.style.top = `${centerY}px`;
                            spin.style.setProperty('--target-x', `${centerX + distance * Math.cos(angle)}px`);
                            spin.style.setProperty('--target-y', `${centerY + distance * Math.sin(angle)}px`);
                            spin.style.animationDuration = `${2 / particleProps.spin}s`;
                            container.appendChild(spin);
                        }
                        
                        // Add label
                        const label = document.createElement('div');
                        label.className = 'particle-label';
                        label.textContent = this.getParticleSymbol(particleType);
                        label.style.left = `${centerX + 10}px`;
                        label.style.top = `${centerY}px`;
                        label.style.setProperty('--target-x', `${centerX + distance * Math.cos(angle) + 10}px`);
                        label.style.setProperty('--target-y', `${centerY + distance * Math.sin(angle)}px`);
                        container.appendChild(label);
                        
                        // Create track for charged particles
                        if (particleProps.charge !== 0) {
                            const track = document.createElement('div');
                            track.className = 'particle-track';
                            track.style.width = `${distance}px`;
                            track.style.left = `${centerX}px`;
                            track.style.top = `${centerY}px`;
                            track.style.transform = `rotate(${angle * 180 / Math.PI}deg)`;
                            container.appendChild(track);
                        }
                        
                        // Create energy deposit in calorimeter for certain particles
                        if (particleType === 'photon' || particleType === 'electron') {
                            const depositRadius = 80 + Math.random() * 40;
                            const depositAngle = angle + (Math.random() - 0.5) * 0.5;
                            const depositX = centerX + depositRadius * Math.cos(depositAngle);
                            const depositY = centerY + depositRadius * Math.sin(depositAngle);
                            
                            const deposit = document.createElement('div');
                            deposit.className = 'energy-deposit';
                            deposit.style.left = `${depositX}px`;
                            deposit.style.top = `${depositY}px`;
                            deposit.style.width = `${20 + Math.random() * 30}px`;
                            deposit.style.height = deposit.style.width;
                            container.appendChild(deposit);
                        }
                    }
                    
                    // If it's a pair, create creation event animation
                    if (isPair) {
                        const creation = document.createElement('div');
                        creation.className = 'creation-event';
                        creation.style.left = `${centerX}px`;
                        creation.style.top = `${centerY}px`;
                        container.appendChild(creation);
                        
                        setTimeout(() => {
                            creation.remove();
                        }, 500);
                    }
                },
                
                getParticleSymbol(particleType) {
                    const symbols = {
                        proton: 'p',
                        antiproton: 'p̄',
                        electron: 'e⁻',
                        positron: 'e⁺',
                        photon: 'γ',
                        higgs: 'H',
                        gluon: 'g',
                        'top-quark': 't',
                        'bottom-quark': 'b',
                        muon: 'μ⁻',
                        'w-boson': 'W',
                        'z-boson': 'Z',
                        pion: 'π⁺',
                        kaon: 'K⁺',
                        neutrino: 'ν'
                    };
                    
                    return symbols[particleType] || particleType.charAt(0).toUpperCase();
                },
                
                updateStatistics() {
                    // Calculate event rate (simplified)
                    this.eventRate = Math.round(this.luminosity * 50 + Math.random() * 20);
                    
                    // Update chart data occasionally
                    if (this.eventsRecorded % 10 === 0) {
                        this.productionChart.data.datasets[0].data = [
                            300 + Math.random() * 50,
                            150 + Math.random() * 60,
                            40 + Math.random() * 20,
                            400 + Math.random() * 50,
                            Math.random() * 3,
                            5 + Math.random() * 6
                        ];
                        this.productionChart.update();
                    }
                },
                
                updateEventRate() {
                    // This would normally be calculated based on actual timing
                    // For simulation, we use a simplified model
                },
                
                addEvent(message) {
                    const timestamp = this.simulationTime.toFixed(1);
                    this.eventLog = `<div class="log-entry"><span class="log-time">t=${timestamp}s:</span> ${message}</div>` + this.eventLog;
                    
                    // Limit log length
                    if (this.eventLog.split('<div class="log-entry">').length > 15) {
                        const events = this.eventLog.split('<div class="log-entry">');
                        this.eventLog = events.slice(0, 15).join('<div class="log-entry">');
                    }
                },
                
                selectDetector(detector) {
                    this.selectedDetector = detector;
                    this.setupDetector();
                    this.addEvent(`Switched to ${detector} detector`);
                },
                
                selectCollisionType(type) {
                    this.selectedCollisionType = type;
                    this.initializeBeams();
                    this.addEvent(`Switched to ${type} collisions`);
                },
                
                updateAccelerator() {
                    this.addEvent(`Accelerator updated: ${this.collisionEnergy} TeV, L=${this.luminosity}×10³⁴ cm⁻²s⁻¹`);
                },
                
                updateProcessRates() {
                    this.addEvent('Physics process rates updated');
                },
                
                exportData() {
                    const data = {
                        simulationTime: this.simulationTime,
                        eventsRecorded: this.eventsRecorded,
                        parameters: {
                            collisionEnergy: this.collisionEnergy,
                            luminosity: this.luminosity,
                            beamType: this.selectedCollisionType
                        },
                        detector: this.selectedDetector,
                        processRates: this.processRates
                    };
                    
                    const dataStr = JSON.stringify(data, null, 2);
                    const dataBlob = new Blob([dataStr], {type: 'application/json'});
                    
                    const link = document.createElement('a');
                    link.href = URL.createObjectURL(dataBlob);
                    link.download = `particle_simulation_${Date.now()}.json`;
                    link.click();
                    
                    this.addEvent('Simulation data exported');
                }
            }));
        });
    </script>
</body>
</html>