<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Advanced PLC Control Panel Designer</title>
    <script src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js" defer></script>
    <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
    <script src="https://unpkg.com/jszip@3.10.1/dist/jszip.min.js"></script>
    <script src="https://unpkg.com/file-saver@2.0.5/dist/FileSaver.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/interactjs@1.10.17/dist/interact.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* ===== GLOBAL STYLES ===== */
        :root {
            --primary-50: #e3f2fd;
            --primary-100: #bbdefb;
            --primary-200: #90caf9;
            --primary-300: #64b5f6;
            --primary-400: #42a5f5;
            --primary-500: #2196f3;
            --primary-600: #1e88e5;
            --primary-700: #1976d2;
            --primary-800: #1565c0;
            --primary-900: #0d47a1;
            
            --secondary-50: #fce4ec;
            --secondary-100: #f8bbd9;
            --secondary-200: #f48fb1;
            --secondary-300: #f06292;
            --secondary-400: #ec407a;
            --secondary-500: #e91e63;
            --secondary-600: #d81b60;
            --secondary-700: #c2185b;
            --secondary-800: #ad1457;
            --secondary-900: #880e4f;
            
            --success-50: #e8f5e9;
            --success-100: #c8e6c9;
            --success-200: #a5d6a7;
            --success-300: #81c784;
            --success-400: #66bb6a;
            --success-500: #4caf50;
            --success-600: #43a047;
            --success-700: #388e3c;
            --success-800: #2e7d32;
            --success-900: #1b5e20;
            
            --warning-50: #fff3e0;
            --warning-100: #ffe0b2;
            --warning-200: #ffcc80;
            --warning-300: #ffb74d;
            --warning-400: #ffa726;
            --warning-500: #ff9800;
            --warning-600: #fb8c00;
            --warning-700: #f57c00;
            --warning-800: #ef6c00;
            --warning-900: #e65100;
            
            --danger-50: #ffebee;
            --danger-100: #ffcdd2;
            --danger-200: #ef9a9a;
            --danger-300: #e57373;
            --danger-400: #ef5350;
            --danger-500: #f44336;
            --danger-600: #e53935;
            --danger-700: #d32f2f;
            --danger-800: #c62828;
            --danger-900: #b71c1c;
            
            --gray-50: #fafafa;
            --gray-100: #f5f5f5;
            --gray-200: #eeeeee;
            --gray-300: #e0e0e0;
            --gray-400: #bdbdbd;
            --gray-500: #9e9e9e;
            --gray-600: #757575;
            --gray-700: #616161;
            --gray-800: #424242;
            --gray-900: #212121;
            
            --plc-color: #2196f3;
            --psu-color: #9c27b0;
            --contactor-color: #4caf50;
            --relay-color: #ff9800;
            --breaker-color: #f44336;
            --inverter-color: #00bcd4;
            --softstarter-color: #795548;
            --hmi-color: #607d8b;
            --terminal-color: #9e9e9e;
            --sensor-color: #673ab7;
            --switch-color: #ff5722;
            --fuse-color: #ffc107;
            --transformer-color: #009688;
            --filter-color: #8bc34a;
            --cable-color: #795548;
            
            --shadow-sm: 0 1px 3px rgba(0,0,0,0.12), 0 1px 2px rgba(0,0,0,0.24);
            --shadow-md: 0 4px 6px rgba(0,0,0,0.1), 0 1px 3px rgba(0,0,0,0.08);
            --shadow-lg: 0 10px 20px rgba(0,0,0,0.1), 0 6px 6px rgba(0,0,0,0.08);
            --shadow-xl: 0 20px 40px rgba(0,0,0,0.1), 0 10px 10px rgba(0,0,0,0.08);
            
            --radius-sm: 4px;
            --radius-md: 8px;
            --radius-lg: 12px;
            --radius-xl: 16px;
            --radius-2xl: 24px;
        }
        
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', 'Roboto', 'Helvetica Neue', Arial, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: var(--gray-900);
            overflow-x: hidden;
        }
        
        /* ===== APP CONTAINER ===== */
        .app-container {
            display: grid;
            grid-template-columns: 280px 1fr;
            grid-template-rows: auto 1fr auto;
            grid-template-areas: 
                "header header"
                "sidebar main"
                "sidebar footer";
            min-height: 100vh;
            background: white;
            box-shadow: var(--shadow-xl);
            max-width: 1920px;
            margin: 0 auto;
            position: relative;
        }
        
        @media (max-width: 1200px) {
            .app-container {
                grid-template-columns: 1fr;
                grid-template-areas: 
                    "header"
                    "main"
                    "footer";
            }
        }
        
        /* ===== HEADER ===== */
        .app-header {
            grid-area: header;
            background: linear-gradient(135deg, var(--primary-900) 0%, var(--primary-700) 100%);
            color: white;
            padding: 1rem 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 4px solid var(--primary-500);
            box-shadow: var(--shadow-md);
            z-index: 100;
        }
        
        .header-left {
            display: flex;
            align-items: center;
            gap: 1rem;
        }
        
        .logo {
            width: 48px;
            height: 48px;
            background: var(--primary-500);
            border-radius: var(--radius-md);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
        }
        
        .app-title h1 {
            font-size: 1.8rem;
            font-weight: 700;
            margin-bottom: 0.25rem;
        }
        
        .app-title .subtitle {
            font-size: 0.9rem;
            opacity: 0.9;
        }
        
        .header-actions {
            display: flex;
            gap: 0.75rem;
        }
        
        /* ===== SIDEBAR ===== */
        .app-sidebar {
            grid-area: sidebar;
            background: linear-gradient(180deg, var(--gray-50) 0%, white 100%);
            border-right: 1px solid var(--gray-200);
            overflow-y: auto;
            padding: 1.5rem;
            box-shadow: var(--shadow-md);
            z-index: 50;
        }
        
        @media (max-width: 1200px) {
            .app-sidebar {
                display: none;
            }
        }
        
        .sidebar-section {
            margin-bottom: 2rem;
            background: white;
            border-radius: var(--radius-lg);
            padding: 1.5rem;
            box-shadow: var(--shadow-sm);
            border: 1px solid var(--gray-200);
        }
        
        .section-title {
            font-size: 1.1rem;
            font-weight: 600;
            color: var(--primary-800);
            margin-bottom: 1rem;
            padding-bottom: 0.5rem;
            border-bottom: 2px solid var(--primary-100);
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }
        
        .section-title i {
            color: var(--primary-500);
        }
        
        /* ===== MAIN CONTENT ===== */
        .app-main {
            grid-area: main;
            padding: 1.5rem;
            overflow-y: auto;
            background: var(--gray-50);
            position: relative;
        }
        
        /* ===== TABS ===== */
        .main-tabs {
            display: flex;
            background: white;
            border-radius: var(--radius-lg);
            padding: 0.5rem;
            margin-bottom: 1.5rem;
            box-shadow: var(--shadow-sm);
            border: 1px solid var(--gray-200);
            overflow-x: auto;
        }
        
        .tab-btn {
            padding: 0.75rem 1.5rem;
            background: none;
            border: none;
            border-radius: var(--radius-md);
            color: var(--gray-600);
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            white-space: nowrap;
        }
        
        .tab-btn:hover {
            background: var(--gray-100);
            color: var(--primary-600);
        }
        
        .tab-btn.active {
            background: var(--primary-500);
            color: white;
            box-shadow: var(--shadow-sm);
        }
        
        .tab-content {
            display: none;
            animation: fadeIn 0.3s;
        }
        
        .tab-content.active {
            display: block;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        /* ===== PANELS ===== */
        .panel {
            background: white;
            border-radius: var(--radius-lg);
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            box-shadow: var(--shadow-sm);
            border: 1px solid var(--gray-200);
        }
        
        .panel-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
            padding-bottom: 1rem;
            border-bottom: 2px solid var(--gray-100);
        }
        
        .panel-title {
            font-size: 1.4rem;
            font-weight: 700;
            color: var(--primary-800);
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }
        
        .panel-actions {
            display: flex;
            gap: 0.5rem;
        }
        
        /* ===== BUTTONS ===== */
        .btn {
            padding: 0.625rem 1.25rem;
            border: none;
            border-radius: var(--radius-md);
            font-weight: 600;
            font-size: 0.95rem;
            cursor: pointer;
            transition: all 0.2s;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            text-decoration: none;
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
        }
        
        .btn:active {
            transform: translateY(0);
        }
        
        .btn-sm {
            padding: 0.375rem 0.75rem;
            font-size: 0.875rem;
        }
        
        .btn-lg {
            padding: 0.875rem 1.75rem;
            font-size: 1.1rem;
        }
        
        .btn-primary {
            background: var(--primary-500);
            color: white;
        }
        
        .btn-primary:hover {
            background: var(--primary-600);
        }
        
        .btn-secondary {
            background: var(--secondary-500);
            color: white;
        }
        
        .btn-secondary:hover {
            background: var(--secondary-600);
        }
        
        .btn-success {
            background: var(--success-500);
            color: white;
        }
        
        .btn-success:hover {
            background: var(--success-600);
        }
        
        .btn-warning {
            background: var(--warning-500);
            color: white;
        }
        
        .btn-warning:hover {
            background: var(--warning-600);
        }
        
        .btn-danger {
            background: var(--danger-500);
            color: white;
        }
        
        .btn-danger:hover {
            background: var(--danger-600);
        }
        
        .btn-light {
            background: var(--gray-100);
            color: var(--gray-800);
        }
        
        .btn-light:hover {
            background: var(--gray-200);
        }
        
        .btn-outline {
            background: transparent;
            border: 2px solid var(--primary-500);
            color: var(--primary-500);
        }
        
        .btn-outline:hover {
            background: var(--primary-50);
        }
        
        /* ===== FORMS ===== */
        .form-group {
            margin-bottom: 1.25rem;
        }
        
        .form-label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 600;
            color: var(--gray-700);
        }
        
        .form-control {
            width: 100%;
            padding: 0.75rem 1rem;
            border: 2px solid var(--gray-300);
            border-radius: var(--radius-md);
            font-size: 1rem;
            transition: all 0.2s;
            background: white;
        }
        
        .form-control:focus {
            outline: none;
            border-color: var(--primary-500);
            box-shadow: 0 0 0 3px rgba(33, 150, 243, 0.1);
        }
        
        .form-control-sm {
            padding: 0.5rem 0.75rem;
            font-size: 0.875rem;
        }
        
        .form-control-lg {
            padding: 1rem 1.25rem;
            font-size: 1.1rem;
        }
        
        .checkbox-group,
        .radio-group {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-bottom: 0.75rem;
        }
        
        .checkbox-group label,
        .radio-group label {
            margin-bottom: 0;
            cursor: pointer;
        }
        
        input[type="checkbox"],
        input[type="radio"] {
            width: 1.25rem;
            height: 1.25rem;
            cursor: pointer;
        }
        
        /* ===== COMPONENT CARDS ===== */
        .component-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
            gap: 1.25rem;
            margin-top: 1.5rem;
        }
        
        .component-card {
            background: white;
            border-radius: var(--radius-lg);
            padding: 1.5rem;
            border: 2px solid var(--gray-200);
            transition: all 0.3s;
            position: relative;
            overflow: hidden;
        }
        
        .component-card:hover {
            border-color: var(--primary-300);
            transform: translateY(-4px);
            box-shadow: var(--shadow-lg);
        }
        
        .component-card.selected {
            border-color: var(--primary-500);
            background: var(--primary-50);
        }
        
        .component-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }
        
        .component-title {
            font-weight: 700;
            font-size: 1.1rem;
            color: var(--gray-900);
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }
        
        .component-badge {
            background: var(--primary-100);
            color: var(--primary-700);
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 600;
        }
        
        .component-details {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
            gap: 1rem;
            margin-bottom: 1rem;
        }
        
        .detail-item {
            display: flex;
            flex-direction: column;
        }
        
        .detail-label {
            font-size: 0.75rem;
            color: var(--gray-600);
            margin-bottom: 0.25rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .detail-value {
            font-weight: 600;
            color: var(--gray-900);
        }
        
        .component-actions {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 1rem;
            padding-top: 1rem;
            border-top: 1px solid var(--gray-200);
        }
        
        .quantity-control {
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }
        
        .qty-btn {
            width: 36px;
            height: 36px;
            border-radius: var(--radius-md);
            border: 2px solid var(--gray-300);
            background: white;
            color: var(--gray-700);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 1.2rem;
            transition: all 0.2s;
        }
        
        .qty-btn:hover {
            border-color: var(--primary-500);
            color: var(--primary-500);
        }
        
        .qty-display {
            min-width: 50px;
            text-align: center;
            font-weight: 700;
            font-size: 1.2rem;
            color: var(--gray-900);
        }
        
        /* ===== LAYOUT DESIGNER ===== */
        .layout-designer {
            background: white;
            border-radius: var(--radius-lg);
            overflow: hidden;
            border: 1px solid var(--gray-300);
            box-shadow: var(--shadow-lg);
            height: 700px;
            display: flex;
            flex-direction: column;
        }
        
        .layout-toolbar {
            padding: 1rem;
            background: var(--gray-50);
            border-bottom: 1px solid var(--gray-300);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .layout-canvas {
            flex: 1;
            background: linear-gradient(45deg, var(--gray-100) 25%, transparent 25%), 
                        linear-gradient(-45deg, var(--gray-100) 25%, transparent 25%), 
                        linear-gradient(45deg, transparent 75%, var(--gray-100) 75%), 
                        linear-gradient(-45deg, transparent 75%, var(--gray-100) 75%);
            background-size: 20px 20px;
            background-position: 0 0, 0 10px, 10px -10px, -10px 0px;
            overflow: auto;
            position: relative;
        }
        
        .layout-grid {
            position: relative;
            width: 1200px;
            height: 800px;
            margin: 2rem auto;
            background: white;
            border: 2px solid var(--gray-300);
            box-shadow: var(--shadow-lg);
        }
        
        .grid-cell {
            position: absolute;
            border: 1px dashed var(--gray-300);
        }
        
        .layout-component {
            position: absolute;
            border: 2px solid;
            border-radius: var(--radius-md);
            background: white;
            cursor: move;
            transition: all 0.2s;
            z-index: 10;
            overflow: hidden;
            user-select: none;
        }
        
        .layout-component:hover {
            z-index: 100;
            box-shadow: var(--shadow-lg);
        }
        
        .layout-component.selected {
            border-width: 3px;
            z-index: 50;
        }
        
        .layout-component.plc {
            background: linear-gradient(135deg, var(--plc-color) 0%, color-mix(in srgb, var(--plc-color) 50%, white) 100%);
            border-color: color-mix(in srgb, var(--plc-color) 70%, black);
        }
        
        .layout-component.psu {
            background: linear-gradient(135deg, var(--psu-color) 0%, color-mix(in srgb, var(--psu-color) 50%, white) 100%);
            border-color: color-mix(in srgb, var(--psu-color) 70%, black);
        }
        
        .layout-component.contactor {
            background: linear-gradient(135deg, var(--contactor-color) 0%, color-mix(in srgb, var(--contactor-color) 50%, white) 100%);
            border-color: color-mix(in srgb, var(--contactor-color) 70%, black);
        }
        
        .layout-component.relay {
            background: linear-gradient(135deg, var(--relay-color) 0%, color-mix(in srgb, var(--relay-color) 50%, white) 100%);
            border-color: color-mix(in srgb, var(--relay-color) 70%, black);
        }
        
        .layout-component.breaker {
            background: linear-gradient(135deg, var(--breaker-color) 0%, color-mix(in srgb, var(--breaker-color) 50%, white) 100%);
            border-color: color-mix(in srgb, var(--breaker-color) 70%, black);
        }
        
        .layout-component.inverter {
            background: linear-gradient(135deg, var(--inverter-color) 0%, color-mix(in srgb, var(--inverter-color) 50%, white) 100%);
            border-color: color-mix(in srgb, var(--inverter-color) 70%, black);
        }
        
        .layout-component.soft-starter {
            background: linear-gradient(135deg, var(--softstarter-color) 0%, color-mix(in srgb, var(--softstarter-color) 50%, white) 100%);
            border-color: color-mix(in srgb, var(--softstarter-color) 70%, black);
        }
        
        .layout-component.hmi {
            background: linear-gradient(135deg, var(--hmi-color) 0%, color-mix(in srgb, var(--hmi-color) 50%, white) 100%);
            border-color: color-mix(in srgb, var(--hmi-color) 70%, black);
        }
        
        .layout-component.terminal {
            background: linear-gradient(135deg, var(--terminal-color) 0%, color-mix(in srgb, var(--terminal-color) 50%, white) 100%);
            border-color: color-mix(in srgb, var(--terminal-color) 70%, black);
        }
        
        .layout-component.sensor {
            background: linear-gradient(135deg, var(--sensor-color) 0%, color-mix(in srgb, var(--sensor-color) 50%, white) 100%);
            border-color: color-mix(in srgb, var(--sensor-color) 70%, black);
        }
        
        .layout-component.switch {
            background: linear-gradient(135deg, var(--switch-color) 0%, color-mix(in srgb, var(--switch-color) 50%, white) 100%);
            border-color: color-mix(in srgb, var(--switch-color) 70%, black);
        }
        
        .layout-component.fuse {
            background: linear-gradient(135deg, var(--fuse-color) 0%, color-mix(in srgb, var(--fuse-color) 50%, white) 100%);
            border-color: color-mix(in srgb, var(--fuse-color) 70%, black);
        }
        
        .layout-component.transformer {
            background: linear-gradient(135deg, var(--transformer-color) 0%, color-mix(in srgb, var(--transformer-color) 50%, white) 100%);
            border-color: color-mix(in srgb, var(--transformer-color) 70%, black);
        }
        
        .layout-component.filter {
            background: linear-gradient(135deg, var(--filter-color) 0%, color-mix(in srgb, var(--filter-color) 50%, white) 100%);
            border-color: color-mix(in srgb, var(--filter-color) 70%, black);
        }
        
        .component-label {
            padding: 0.5rem;
            text-align: center;
            font-weight: 600;
            color: white;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.3);
            font-size: 0.9rem;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        
        .component-details-small {
            font-size: 0.7rem;
            opacity: 0.9;
            margin-top: 0.25rem;
        }
        
        /* ===== BOM TABLE ===== */
        .bom-container {
            background: white;
            border-radius: var(--radius-lg);
            overflow: hidden;
            box-shadow: var(--shadow-sm);
        }
        
        .bom-toolbar {
            padding: 1rem;
            background: var(--gray-50);
            border-bottom: 1px solid var(--gray-300);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .bom-table-wrapper {
            overflow-x: auto;
        }
        
        .bom-table {
            width: 100%;
            border-collapse: collapse;
            min-width: 1200px;
        }
        
        .bom-table th {
            background: linear-gradient(135deg, var(--primary-800) 0%, var(--primary-600) 100%);
            color: white;
            padding: 1rem;
            text-align: left;
            font-weight: 600;
            position: sticky;
            top: 0;
            z-index: 10;
        }
        
        .bom-table th:first-child {
            border-top-left-radius: var(--radius-md);
        }
        
        .bom-table th:last-child {
            border-top-right-radius: var(--radius-md);
        }
        
        .bom-table td {
            padding: 0.875rem 1rem;
            border-bottom: 1px solid var(--gray-200);
            vertical-align: middle;
        }
        
        .bom-table tbody tr:hover {
            background: var(--primary-50);
        }
        
        .bom-table tbody tr:nth-child(even) {
            background: var(--gray-50);
        }
        
        .bom-table tbody tr:nth-child(even):hover {
            background: var(--primary-50);
        }
        
        .tag {
            display: inline-block;
            background: var(--primary-100);
            color: var(--primary-700);
            padding: 0.25rem 0.5rem;
            border-radius: var(--radius-sm);
            font-size: 0.75rem;
            font-weight: 600;
            margin: 0.125rem;
        }
        
        /* ===== WIRING DESIGNER ===== */
        .wiring-designer {
            display: grid;
            grid-template-columns: 300px 1fr;
            gap: 1.5rem;
            height: 700px;
        }
        
        .wiring-sidebar {
            background: white;
            border-radius: var(--radius-lg);
            padding: 1.5rem;
            overflow-y: auto;
            box-shadow: var(--shadow-sm);
            border: 1px solid var(--gray-300);
        }
        
        .wiring-canvas {
            background: white;
            border-radius: var(--radius-lg);
            overflow: hidden;
            box-shadow: var(--shadow-sm);
            border: 1px solid var(--gray-300);
            position: relative;
        }
        
        .wiring-grid {
            width: 100%;
            height: 100%;
            background: repeating-linear-gradient(
                0deg,
                transparent,
                transparent 19px,
                var(--gray-200) 20px
            ),
            repeating-linear-gradient(
                90deg,
                transparent,
                transparent 19px,
                var(--gray-200) 20px
            );
            background-size: 20px 20px;
        }
        
        .wire {
            stroke: #333;
            stroke-width: 2;
            fill: none;
            marker-end: url(#arrowhead);
        }
        
        .wire.selected {
            stroke: var(--primary-500);
            stroke-width: 3;
        }
        
        .connection-point {
            fill: #666;
            stroke: #333;
            stroke-width: 1;
            cursor: pointer;
        }
        
        .connection-point:hover {
            fill: var(--primary-500);
        }
        
        /* ===== CODE EDITOR ===== */
        .code-editor {
            background: #1e1e1e;
            border-radius: var(--radius-lg);
            overflow: hidden;
            box-shadow: var(--shadow-lg);
            height: 500px;
            display: flex;
            flex-direction: column;
        }
        
        .editor-header {
            background: #252526;
            padding: 0.75rem 1rem;
            border-bottom: 1px solid #333;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .editor-title {
            color: #ccc;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }
        
        .editor-content {
            flex: 1;
            overflow: auto;
            padding: 1rem;
        }
        
        .code-block {
            background: #252526;
            border-radius: var(--radius-md);
            padding: 1.5rem;
            font-family: 'Courier New', monospace;
            font-size: 0.95rem;
            line-height: 1.6;
            color: #d4d4d4;
            overflow-x: auto;
            white-space: pre;
        }
        
        .code-comment {
            color: #6a9955;
        }
        
        .code-keyword {
            color: #569cd6;
        }
        
        .code-string {
            color: #ce9178;
        }
        
        .code-number {
            color: #b5cea8;
        }
        
        .code-function {
            color: #dcdcaa;
        }
        
        /* ===== MODALS ===== */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.75);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            backdrop-filter: blur(5px);
            padding: 2rem;
        }
        
        .modal-content {
            background: white;
            border-radius: var(--radius-xl);
            width: 90%;
            max-width: 1000px;
            max-height: 90vh;
            overflow: hidden;
            box-shadow: var(--shadow-xl);
            animation: modalSlideIn 0.3s;
        }
        
        @keyframes modalSlideIn {
            from { opacity: 0; transform: translateY(-20px) scale(0.95); }
            to { opacity: 1; transform: translateY(0) scale(1); }
        }
        
        .modal-header {
            padding: 1.5rem 2rem;
            background: linear-gradient(135deg, var(--primary-800) 0%, var(--primary-600) 100%);
            color: white;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .modal-title {
            font-size: 1.5rem;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }
        
        .modal-close {
            background: none;
            border: none;
            color: white;
            font-size: 1.5rem;
            cursor: pointer;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
        }
        
        .modal-close:hover {
            background: rgba(255, 255, 255, 0.1);
        }
        
        .modal-body {
            padding: 2rem;
            overflow-y: auto;
            max-height: calc(90vh - 80px);
        }
        
        /* ===== FOOTER ===== */
        .app-footer {
            grid-area: footer;
            background: var(--gray-900);
            color: white;
            padding: 1rem 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-top: 4px solid var(--primary-500);
        }
        
        .footer-info {
            display: flex;
            align-items: center;
            gap: 1rem;
            font-size: 0.9rem;
            opacity: 0.9;
        }
        
        .footer-stats {
            display: flex;
            gap: 1.5rem;
        }
        
        .stat-item {
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        
        .stat-value {
            font-size: 1.2rem;
            font-weight: 700;
            color: var(--primary-300);
        }
        
        .stat-label {
            font-size: 0.75rem;
            opacity: 0.7;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        /* ===== UTILITY CLASSES ===== */
        .text-primary { color: var(--primary-500); }
        .text-success { color: var(--success-500); }
        .text-warning { color: var(--warning-500); }
        .text-danger { color: var(--danger-500); }
        
        .bg-primary { background: var(--primary-500); }
        .bg-success { background: var(--success-500); }
        .bg-warning { background: var(--warning-500); }
        .bg-danger { background: var(--danger-500); }
        
        .border-primary { border-color: var(--primary-500); }
        .border-success { border-color: var(--success-500); }
        .border-warning { border-color: var(--warning-500); }
        .border-danger { border-color: var(--danger-500); }
        
        .shadow { box-shadow: var(--shadow-md); }
        .shadow-lg { box-shadow: var(--shadow-lg); }
        .shadow-xl { box-shadow: var(--shadow-xl); }
        
        .rounded-sm { border-radius: var(--radius-sm); }
        .rounded { border-radius: var(--radius-md); }
        .rounded-lg { border-radius: var(--radius-lg); }
        .rounded-xl { border-radius: var(--radius-xl); }
        
        .hidden { display: none; }
        .block { display: block; }
        .flex { display: flex; }
        .grid { display: grid; }
        
        .gap-1 { gap: 0.25rem; }
        .gap-2 { gap: 0.5rem; }
        .gap-3 { gap: 0.75rem; }
        .gap-4 { gap: 1rem; }
        .gap-5 { gap: 1.25rem; }
        .gap-6 { gap: 1.5rem; }
        
        .p-1 { padding: 0.25rem; }
        .p-2 { padding: 0.5rem; }
        .p-3 { padding: 0.75rem; }
        .p-4 { padding: 1rem; }
        .p-5 { padding: 1.25rem; }
        .p-6 { padding: 1.5rem; }
        
        .m-1 { margin: 0.25rem; }
        .m-2 { margin: 0.5rem; }
        .m-3 { margin: 0.75rem; }
        .m-4 { margin: 1rem; }
        .m-5 { margin: 1.25rem; }
        .m-6 { margin: 1.5rem; }
        
        .w-full { width: 100%; }
        .h-full { height: 100%; }
        
        .text-sm { font-size: 0.875rem; }
        .text-base { font-size: 1rem; }
        .text-lg { font-size: 1.125rem; }
        .text-xl { font-size: 1.25rem; }
        .text-2xl { font-size: 1.5rem; }
        .text-3xl { font-size: 1.875rem; }
        
        .font-light { font-weight: 300; }
        .font-normal { font-weight: 400; }
        .font-medium { font-weight: 500; }
        .font-semibold { font-weight: 600; }
        .font-bold { font-weight: 700; }
        
        /* ===== SCROLLBAR STYLING ===== */
        ::-webkit-scrollbar {
            width: 10px;
            height: 10px;
        }
        
        ::-webkit-scrollbar-track {
            background: var(--gray-100);
            border-radius: var(--radius-md);
        }
        
        ::-webkit-scrollbar-thumb {
            background: var(--gray-400);
            border-radius: var(--radius-md);
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: var(--gray-500);
        }
        
        /* ===== RESPONSIVE ADJUSTMENTS ===== */
        @media (max-width: 768px) {
            .app-main {
                padding: 1rem;
            }
            
            .panel {
                padding: 1rem;
            }
            
            .component-grid {
                grid-template-columns: 1fr;
            }
            
            .wiring-designer {
                grid-template-columns: 1fr;
                height: auto;
            }
            
            .main-tabs {
                overflow-x: auto;
                padding: 0.25rem;
            }
            
            .tab-btn {
                padding: 0.5rem 1rem;
                font-size: 0.9rem;
            }
        }
        
        /* ===== PRINT STYLES ===== */
        @media print {
            .app-header,
            .app-sidebar,
            .app-footer,
            .main-tabs,
            .panel-actions,
            .btn,
            .no-print {
                display: none !important;
            }
            
            .app-container {
                grid-template-columns: 1fr;
                grid-template-rows: auto;
                grid-template-areas: "main";
            }
            
            .app-main {
                padding: 0;
            }
            
            .panel {
                box-shadow: none;
                border: 1px solid #000;
                break-inside: avoid;
                page-break-inside: avoid;
            }
            
            .bom-table {
                width: 100%;
                min-width: auto;
            }
            
            .bom-table th {
                background: #ccc !important;
                color: #000 !important;
                -webkit-print-color-adjust: exact;
                print-color-adjust: exact;
            }
        }
    </style>
</head>
<body>
    <div x-data="plcDesigner()" x-init="init()" @keydown.window.escape="closeModals()">
        <!-- Main App Container -->
        <div class="app-container">
            
            <!-- Header -->
            <header class="app-header">
                <div class="header-left">
                    <div class="logo">
                        <i class="fas fa-industry"></i>
                    </div>
                    <div class="app-title">
                        <h1>Advanced PLC Control Panel Designer</h1>
                        <div class="subtitle">Professional Industrial Automation System Design Tool</div>
                    </div>
                </div>
                <div class="header-actions">
                    <button class="btn btn-primary" @click="showModal('saveProject')">
                        <i class="fas fa-save"></i> Save
                    </button>
                    <button class="btn btn-secondary" @click="showModal('loadProject')">
                        <i class="fas fa-folder-open"></i> Load
                    </button>
                    <button class="btn btn-success" @click="showModal('export')">
                        <i class="fas fa-file-export"></i> Export
                    </button>
                    <button class="btn btn-warning" @click="showModal('settings')">
                        <i class="fas fa-cog"></i> Settings
                    </button>
                </div>
            </header>
            
            <!-- Sidebar -->
            <aside class="app-sidebar">
                <!-- Project Info -->
                <div class="sidebar-section">
                    <h3 class="section-title">
                        <i class="fas fa-info-circle"></i> Project Info
                    </h3>
                    <div class="form-group">
                        <label class="form-label">Project Name</label>
                        <input type="text" class="form-control" x-model="projectName" @change="saveProjectState()">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Template</label>
                        <select class="form-control" x-model="selectedTemplate" @change="loadTemplate()">
                            <option value="evap_vent">Evaporative Ventilation</option>
                            <option value="filter_plant">Filter Plant</option>
                            <option value="pumping_station">Pumping Station</option>
                            <option value="conveyor_system">Conveyor System</option>
                            <option value="custom">Custom Design</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Cabinet Size (mm)</label>
                        <input type="text" class="form-control" x-model="cabinetSize" @change="updateLayout()">
                    </div>
                </div>
                
                <!-- Component Library -->
                <div class="sidebar-section">
                    <h3 class="section-title">
                        <i class="fas fa-box-open"></i> Component Library
                    </h3>
                    <div class="form-group">
                        <input type="text" class="form-control" placeholder="Search components..." 
                               x-model="componentSearch" @input="filterComponents()">
                    </div>
                    <div style="max-height: 300px; overflow-y: auto;">
                        <template x-for="comp in filteredComponents" :key="comp.id">
                            <div class="component-card" 
                                 :class="{ 'selected': selectedComponentId === comp.id }"
                                 @click="selectComponent(comp)"
                                 draggable="true"
                                 @dragstart="dragStart($event, comp)">
                                <div class="component-title">
                                    <i :class="comp.icon"></i>
                                    <span x-text="comp.name"></span>
                                </div>
                                <div class="text-sm" style="color: var(--gray-600);" x-text="comp.type"></div>
                                <div class="component-actions">
                                    <button class="btn btn-sm btn-outline" @click.stop="addToBOM(comp)">
                                        <i class="fas fa-plus"></i> Add
                                    </button>
                                </div>
                            </div>
                        </template>
                    </div>
                </div>
                
                <!-- Quick Stats -->
                <div class="sidebar-section">
                    <h3 class="section-title">
                        <i class="fas fa-chart-bar"></i> Project Stats
                    </h3>
                    <div class="grid grid-cols-2 gap-3">
                        <div class="text-center p-3 bg-primary rounded-lg text-white">
                            <div class="text-2xl font-bold" x-text="bom.length"></div>
                            <div class="text-sm">Components</div>
                        </div>
                        <div class="text-center p-3 bg-success rounded-lg text-white">
                            <div class="text-2xl font-bold" x-text="'â‚¬' + totalCost.toLocaleString()"></div>
                            <div class="text-sm">Total Cost</div>
                        </div>
                        <div class="text-center p-3 bg-warning rounded-lg text-white">
                            <div class="text-2xl font-bold" x-text="terminalCount"></div>
                            <div class="text-sm">Terminals</div>
                        </div>
                        <div class="text-center p-3 bg-danger rounded-lg text-white">
                            <div class="text-2xl font-bold" x-text="wireLength + 'm'"></div>
                            <div class="text-sm">Wiring</div>
                        </div>
                    </div>
                </div>
            </aside>
            
            <!-- Main Content -->
            <main class="app-main">
                <!-- Tabs Navigation -->
                <div class="main-tabs">
                    <button class="tab-btn" :class="{ 'active': activeTab === 'design' }" @click="activeTab = 'design'">
                        <i class="fas fa-cogs"></i> Design
                    </button>
                    <button class="tab-btn" :class="{ 'active': activeTab === 'layout' }" @click="activeTab = 'layout'">
                        <i class="fas fa-th-large"></i> Layout
                    </button>
                    <button class="tab-btn" :class="{ 'active': activeTab === 'bom' }" @click="activeTab = 'bom'">
                        <i class="fas fa-clipboard-list"></i> BOM
                    </button>
                    <button class="tab-btn" :class="{ 'active': activeTab === 'wiring' }" @click="activeTab = 'wiring'">
                        <i class="fas fa-network-wired"></i> Wiring
                    </button>
                    <button class="tab-btn" :class="{ 'active': activeTab === 'code' }" @click="activeTab = 'code'">
                        <i class="fas fa-code"></i> PLC Code
                    </button>
                    <button class="tab-btn" :class="{ 'active': activeTab === 'scenario' }" @click="activeTab = 'scenario'">
                        <i class="fas fa-project-diagram"></i> Scenario
                    </button>
                    <button class="tab-btn" :class="{ 'active': activeTab === 'simulation' }" @click="activeTab = 'simulation'">
                        <i class="fas fa-play-circle"></i> Simulation
                    </button>
                    <button class="tab-btn" :class="{ 'active': activeTab === 'documentation' }" @click="activeTab = 'documentation'">
                        <i class="fas fa-file-alt"></i> Documentation
                    </button>
                </div>
                
                <!-- Design Tab -->
                <div class="tab-content" :class="{ 'active': activeTab === 'design' }">
                    <!-- System Configuration -->
                    <div class="panel">
                        <div class="panel-header">
                            <h2 class="panel-title">
                                <i class="fas fa-sliders-h"></i> System Configuration
                            </h2>
                            <div class="panel-actions">
                                <button class="btn btn-primary" @click="calculateBOM()">
                                    <i class="fas fa-calculator"></i> Recalculate
                                </button>
                            </div>
                        </div>
                        
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                            <!-- Power System -->
                            <div>
                                <h3 class="text-lg font-semibold mb-4 text-primary">Power System</h3>
                                <div class="form-group">
                                    <label class="form-label">Main Voltage</label>
                                    <select class="form-control" x-model="systemConfig.mainVoltage">
                                        <option value="400">400V AC 3-Phase</option>
                                        <option value="230">230V AC 1-Phase</option>
                                        <option value="690">690V AC 3-Phase</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Control Voltage</label>
                                    <select class="form-control" x-model="systemConfig.controlVoltage">
                                        <option value="24">24V DC</option>
                                        <option value="120">120V AC</option>
                                        <option value="230">230V AC</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Frequency</label>
                                    <select class="form-control" x-model="systemConfig.frequency">
                                        <option value="50">50 Hz</option>
                                        <option value="60">60 Hz</option>
                                    </select>
                                </div>
                            </div>
                            
                            <!-- Protection -->
                            <div>
                                <h3 class="text-lg font-semibold mb-4 text-primary">Protection System</h3>
                                <div class="checkbox-group">
                                    <input type="checkbox" id="phaseProtection" x-model="systemConfig.phaseProtection">
                                    <label for="phaseProtection">Phase Loss Protection</label>
                                </div>
                                <div class="checkbox-group">
                                    <input type="checkbox" id="overloadProtection" x-model="systemConfig.overloadProtection">
                                    <label for="overloadProtection">Overload Protection</label>
                                </div>
                                <div class="checkbox-group">
                                    <input type="checkbox" id="shortCircuit" x-model="systemConfig.shortCircuitProtection">
                                    <label for="shortCircuit">Short Circuit Protection</label>
                                </div>
                                <div class="checkbox-group">
                                    <input type="checkbox" id="earthFault" x-model="systemConfig.earthFaultProtection">
                                    <label for="earthFault">Earth Fault Protection</label>
                                </div>
                                <div class="checkbox-group">
                                    <input type="checkbox" id="surgeProtection" x-model="systemConfig.surgeProtection">
                                    <label for="surgeProtection">Surge Protection</label>
                                </div>
                            </div>
                            
                            <!-- Standards -->
                            <div>
                                <h3 class="text-lg font-semibold mb-4 text-primary">Standards & Compliance</h3>
                                <div class="checkbox-group">
                                    <input type="checkbox" id="iec61439" x-model="systemConfig.iec61439">
                                    <label for="iec61439">IEC 61439</label>
                                </div>
                                <div class="checkbox-group">
                                    <input type="checkbox" id="iec60204" x-model="systemConfig.iec60204">
                                    <label for="iec60204">IEC 60204</label>
                                </div>
                                <div class="checkbox-group">
                                    <input type="checkbox" id="ul508a" x-model="systemConfig.ul508a">
                                    <label for="ul508a">UL 508A</label>
                                </div>
                                <div class="checkbox-group">
                                    <input type="checkbox" id="ce" x-model="systemConfig.ceMarking">
                                    <label for="ce">CE Marking</label>
                                </div>
                                <div class="form-group">
                                    <label class="form-label">IP Rating</label>
                                    <select class="form-control" x-model="systemConfig.ipRating">
                                        <option value="IP20">IP20</option>
                                        <option value="IP54">IP54</option>
                                        <option value="IP65">IP65</option>
                                        <option value="IP66">IP66</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Component Selection -->
                    <div class="panel">
                        <div class="panel-header">
                            <h2 class="panel-title">
                                <i class="fas fa-boxes"></i> Component Selection
                            </h2>
                            <div class="panel-actions">
                                <button class="btn btn-primary" @click="showModal('componentLibrary')">
                                    <i class="fas fa-plus"></i> Add Component
                                </button>
                            </div>
                        </div>
                        
                        <!-- Motors -->
                        <div class="mb-8">
                            <h3 class="text-lg font-semibold mb-4 border-b pb-2">3-Phase Motors</h3>
                            <div class="component-grid">
                                <template x-for="motor in motors" :key="motor.id">
                                    <div class="component-card">
                                        <div class="component-header">
                                            <div class="component-title">
                                                <i class="fas fa-cog"></i>
                                                <span x-text="motor.name"></span>
                                            </div>
                                            <div class="component-badge" x-text="motor.power + 'kW'"></div>
                                        </div>
                                        <div class="component-details">
                                            <div class="detail-item">
                                                <div class="detail-label">Quantity</div>
                                                <div class="detail-value">
                                                    <div class="quantity-control">
                                                        <button class="qty-btn" @click="motor.quantity = Math.max(0, motor.quantity - 1)">-</button>
                                                        <div class="qty-display" x-text="motor.quantity"></div>
                                                        <button class="qty-btn" @click="motor.quantity++">+</button>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="detail-item">
                                                <div class="detail-label">Power</div>
                                                <input type="text" class="form-control form-control-sm" x-model="motor.power" @change="calculateBOM()">
                                            </div>
                                            <div class="detail-item">
                                                <div class="detail-label">Voltage</div>
                                                <div class="detail-value" x-text="motor.voltage"></div>
                                            </div>
                                        </div>
                                        <div class="component-actions">
                                            <div class="checkbox-group">
                                                <input type="checkbox" :id="'overload_' + motor.id" x-model="motor.hasOverload">
                                                <label :for="'overload_' + motor.id">Overload</label>
                                            </div>
                                            <div class="checkbox-group">
                                                <input type="checkbox" :id="'brake_' + motor.id" x-model="motor.hasBrake">
                                                <label :for="'brake_' + motor.id">Brake</label>
                                            </div>
                                        </div>
                                    </div>
                                </template>
                            </div>
                        </div>
                        
                        <!-- Actuators -->
                        <div class="mb-8">
                            <h3 class="text-lg font-semibold mb-4 border-b pb-2">Actuators & Valves</h3>
                            <div class="component-grid">
                                <template x-for="actuator in actuators" :key="actuator.id">
                                    <div class="component-card">
                                        <div class="component-header">
                                            <div class="component-title">
                                                <i class="fas fa-sliders-h"></i>
                                                <span x-text="actuator.name"></span>
                                            </div>
                                            <div class="component-badge" x-text="actuator.voltage"></div>
                                        </div>
                                        <div class="component-details">
                                            <div class="detail-item">
                                                <div class="detail-label">Quantity</div>
                                                <div class="quantity-control">
                                                    <button class="qty-btn" @click="actuator.quantity = Math.max(0, actuator.quantity - 1)">-</button>
                                                    <div class="qty-display" x-text="actuator.quantity"></div>
                                                    <button class="qty-btn" @click="actuator.quantity++">+</button>
                                                </div>
                                            </div>
                                            <div class="detail-item">
                                                <div class="detail-label">Type</div>
                                                <select class="form-control form-control-sm" x-model="actuator.type">
                                                    <option value="damper">Damper</option>
                                                    <option value="valve">Valve</option>
                                                    <option value="cylinder">Cylinder</option>
                                                    <option value="servo">Servo</option>
                                                </select>
                                            </div>
                                            <div class="detail-item">
                                                <div class="detail-label">Feedback</div>
                                                <select class="form-control form-control-sm" x-model="actuator.feedback">
                                                    <option value="none">None</option>
                                                    <option value="analog">Analog 4-20mA</option>
                                                    <option value="digital">Digital</option>
                                                    <option value="profibus">PROFIBUS</option>
                                                    <option value="profinet">PROFINET</option>
                                                </select>
                                            </div>
                                        </div>
                                    </div>
                                </template>
                            </div>
                        </div>
                        
                        <!-- Sensors -->
                        <div class="mb-8">
                            <h3 class="text-lg font-semibold mb-4 border-b pb-2">Sensors & Instruments</h3>
                            <div class="component-grid">
                                <template x-for="sensor in sensors" :key="sensor.id">
                                    <div class="component-card">
                                        <div class="component-header">
                                            <div class="component-title">
                                                <i class="fas fa-thermometer-half"></i>
                                                <span x-text="sensor.name"></span>
                                            </div>
                                            <div class="component-badge" x-text="sensor.type"></div>
                                        </div>
                                        <div class="component-details">
                                            <div class="detail-item">
                                                <div class="detail-label">Quantity</div>
                                                <div class="quantity-control">
                                                    <button class="qty-btn" @click="sensor.quantity = Math.max(0, sensor.quantity - 1)">-</button>
                                                    <div class="qty-display" x-text="sensor.quantity"></div>
                                                    <button class="qty-btn" @click="sensor.quantity++">+</button>
                                                </div>
                                            </div>
                                            <div class="detail-item">
                                                <div class="detail-label">Signal</div>
                                                <div class="detail-value" x-text="sensor.signal"></div>
                                            </div>
                                            <div class="detail-item">
                                                <div class="detail-label">Range</div>
                                                <div class="detail-value" x-text="sensor.range"></div>
                                            </div>
                                        </div>
                                    </div>
                                </template>
                            </div>
                        </div>
                        
                        <!-- Optional Components -->
                        <div>
                            <h3 class="text-lg font-semibold mb-4 border-b pb-2">Optional Components</h3>
                            <div class="component-grid">
                                <template x-for="optional in optionalComponents" :key="optional.id">
                                    <div class="component-card">
                                        <div class="component-header">
                                            <div class="component-title">
                                                <i :class="optional.icon"></i>
                                                <span x-text="optional.name"></span>
                                            </div>
                                            <div class="component-badge" x-text="optional.status"></div>
                                        </div>
                                        <div class="component-details">
                                            <div class="detail-item">
                                                <div class="detail-label">Quantity</div>
                                                <div class="quantity-control">
                                                    <button class="qty-btn" @click="optional.quantity = Math.max(0, optional.quantity - 1)">-</button>
                                                    <div class="qty-display" x-text="optional.quantity"></div>
                                                    <button class="qty-btn" @click="optional.quantity++">+</button>
                                                </div>
                                            </div>
                                            <div class="detail-item">
                                                <div class="detail-label">Specification</div>
                                                <input type="text" class="form-control form-control-sm" x-model="optional.spec" @change="calculateBOM()">
                                            </div>
                                        </div>
                                        <div class="component-actions">
                                            <button class="btn btn-sm btn-outline" @click="showComponentDetails(optional)">
                                                <i class="fas fa-info-circle"></i> Details
                                            </button>
                                        </div>
                                    </div>
                                </template>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Layout Tab -->
                <div class="tab-content" :class="{ 'active': activeTab === 'layout' }">
                    <div class="layout-designer">
                        <div class="layout-toolbar">
                            <div class="flex gap-2">
                                <button class="btn btn-primary" @click="addComponentToLayout()">
                                    <i class="fas fa-plus"></i> Add Component
                                </button>
                                <button class="btn btn-secondary" @click="arrangeComponents()">
                                    <i class="fas fa-th"></i> Auto Arrange
                                </button>
                                <button class="btn btn-light" @click="clearLayout()">
                                    <i class="fas fa-trash"></i> Clear
                                </button>
                            </div>
                            <div class="flex gap-2">
                                <select class="form-control form-control-sm" x-model="gridSize" @change="updateGrid()">
                                    <option value="10">10mm Grid</option>
                                    <option value="20">20mm Grid</option>
                                    <option value="50">50mm Grid</option>
                                </select>
                                <button class="btn btn-light" @click="showGrid = !showGrid">
                                    <i class="fas fa-border-all"></i> Grid
                                </button>
                                <button class="btn btn-light" @click="exportLayout('png')">
                                    <i class="fas fa-download"></i> Export
                                </button>
                            </div>
                        </div>
                        <div class="layout-canvas" id="layoutCanvas">
                            <div class="layout-grid" id="layoutGrid">
                                <!-- Grid cells will be generated here -->
                                <!-- Components will be positioned here -->
                            </div>
                        </div>
                    </div>
                    
                    <!-- Layout Properties Panel -->
                    <div class="panel mt-4">
                        <h3 class="text-lg font-semibold mb-4">Layout Properties</h3>
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                            <div>
                                <div class="form-group">
                                    <label class="form-label">Cabinet Width (mm)</label>
                                    <input type="number" class="form-control" x-model="cabinetDimensions.width" @change="updateCabinet()">
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Cabinet Height (mm)</label>
                                    <input type="number" class="form-control" x-model="cabinetDimensions.height" @change="updateCabinet()">
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Cabinet Depth (mm)</label>
                                    <input type="number" class="form-control" x-model="cabinetDimensions.depth" @change="updateCabinet()">
                                </div>
                            </div>
                            <div>
                                <div class="form-group">
                                    <label class="form-label">Rail Configuration</label>
                                    <select class="form-control" x-model="layoutConfig.railType">
                                        <option value="top">Top Mount</option>
                                        <option value="vertical">Vertical</option>
                                        <option value="horizontal">Horizontal</option>
                                        <option value="mixed">Mixed</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Spacing (mm)</label>
                                    <input type="number" class="form-control" x-model="layoutConfig.componentSpacing" min="10" max="100">
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Margin (mm)</label>
                                    <input type="number" class="form-control" x-model="layoutConfig.cabinetMargin" min="20" max="100">
                                </div>
                            </div>
                            <div>
                                <div class="form-group">
                                    <label class="form-label">Color Scheme</label>
                                    <select class="form-control" x-model="layoutConfig.colorScheme">
                                        <option value="standard">Standard</option>
                                        <option value="monochrome">Monochrome</option>
                                        <option value="high_contrast">High Contrast</option>
                                    </select>
                                </div>
                                <div class="checkbox-group">
                                    <input type="checkbox" id="showDimensions" x-model="layoutConfig.showDimensions">
                                    <label for="showDimensions">Show Dimensions</label>
                                </div>
                                <div class="checkbox-group">
                                    <input type="checkbox" id="showLabels" x-model="layoutConfig.showLabels">
                                    <label for="showLabels">Show Labels</label>
                                </div>
                                <div class="checkbox-group">
                                    <input type="checkbox" id="snapToGrid" x-model="layoutConfig.snapToGrid">
                                    <label for="snapToGrid">Snap to Grid</label>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- BOM Tab -->
                <div class="tab-content" :class="{ 'active': activeTab === 'bom' }">
                    <div class="bom-container">
                        <div class="bom-toolbar">
                            <div>
                                <h3 class="text-lg font-semibold">Bill of Materials</h3>
                                <div class="text-sm text-gray-600" x-text="bom.length + ' items, Total: â‚¬' + totalCost.toLocaleString()"></div>
                            </div>
                            <div class="flex gap-2">
                                <button class="btn btn-primary" @click="exportBOM('csv')">
                                    <i class="fas fa-file-csv"></i> CSV
                                </button>
                                <button class="btn btn-success" @click="exportBOM('excel')">
                                    <i class="fas fa-file-excel"></i> Excel
                                </button>
                                <button class="btn btn-warning" @click="exportBOM('pdf')">
                                    <i class="fas fa-file-pdf"></i> PDF
                                </button>
                                <button class="btn btn-light" @click="printBOM()">
                                    <i class="fas fa-print"></i> Print
                                </button>
                            </div>
                        </div>
                        <div class="bom-table-wrapper">
                            <table class="bom-table">
                                <thead>
                                    <tr>
                                        <th>#</th>
                                        <th>Component</th>
                                        <th>Part No.</th>
                                        <th>Quantity</th>
                                        <th>Specifications</th>
                                        <th>Standards</th>
                                        <th>Unit Price (â‚¬)</th>
                                        <th>Total (â‚¬)</th>
                                        <th>Tags</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <template x-for="(item, index) in bom" :key="item.id">
                                        <tr>
                                            <td x-text="index + 1"></td>
                                            <td>
                                                <div class="font-semibold" x-text="item.name"></div>
                                                <div class="text-sm text-gray-600" x-text="item.category"></div>
                                            </td>
                                            <td>
                                                <code x-text="item.partNumber"></code>
                                            </td>
                                            <td>
                                                <div class="quantity-control">
                                                    <button class="qty-btn" @click="updateBOMQuantity(item, -1)">-</button>
                                                    <div class="qty-display" x-text="item.quantity"></div>
                                                    <button class="qty-btn" @click="updateBOMQuantity(item, 1)">+</button>
                                                </div>
                                            </td>
                                            <td x-text="item.specifications"></td>
                                            <td x-text="item.standards"></td>
                                            <td class="text-right" x-text="item.unitPrice.toFixed(2)"></td>
                                            <td class="text-right font-semibold" x-text="(item.unitPrice * item.quantity).toFixed(2)"></td>
                                            <td>
                                                <template x-for="tag in item.tags" :key="tag">
                                                    <span class="tag" x-text="tag"></span>
                                                </template>
                                            </td>
                                            <td>
                                                <button class="btn btn-sm btn-light" @click="editBOMItem(item)">
                                                    <i class="fas fa-edit"></i>
                                                </button>
                                                <button class="btn btn-sm btn-danger" @click="removeBOMItem(item)">
                                                    <i class="fas fa-trash"></i>
                                                </button>
                                            </td>
                                        </tr>
                                    </template>
                                </tbody>
                            </table>
                        </div>
                    </div>
                    
                    <!-- BOM Summary -->
                    <div class="panel mt-4">
                        <h3 class="text-lg font-semibold mb-4">BOM Summary</h3>
                        <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                            <div class="text-center p-4 bg-primary rounded-lg text-white">
                                <div class="text-2xl font-bold" x-text="bom.length"></div>
                                <div class="text-sm">Total Items</div>
                            </div>
                            <div class="text-center p-4 bg-success rounded-lg text-white">
                                <div class="text-2xl font-bold" x-text="'â‚¬' + totalCost.toLocaleString()"></div>
                                <div class="text-sm">Total Cost</div>
                            </div>
                            <div class="text-center p-4 bg-warning rounded-lg text-white">
                                <div class="text-2xl font-bold" x-text="uniqueComponents"></div>
                                <div class="text-sm">Unique Components</div>
                            </div>
                            <div class="text-center p-4 bg-danger rounded-lg text-white">
                                <div class="text-2xl font-bold" x-text="heaviestComponent"></div>
                                <div class="text-sm">Heaviest Component</div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Wiring Tab -->
                <div class="tab-content" :class="{ 'active': activeTab === 'wiring' }">
                    <div class="wiring-designer">
                        <div class="wiring-sidebar">
                            <h3 class="text-lg font-semibold mb-4">Wiring Configuration</h3>
                            
                            <div class="form-group">
                                <label class="form-label">Wire Type</label>
                                <select class="form-control" x-model="wiringConfig.wireType">
                                    <option value="control">Control Wire</option>
                                    <option value="power">Power Wire</option>
                                    <option value="signal">Signal Wire</option>
                                    <option value="communication">Communication Cable</option>
                                </select>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Wire Size (mmÂ²)</label>
                                <select class="form-control" x-model="wiringConfig.wireSize">
                                    <option value="0.75">0.75 mmÂ²</option>
                                    <option value="1.0">1.0 mmÂ²</option>
                                    <option value="1.5">1.5 mmÂ²</option>
                                    <option value="2.5">2.5 mmÂ²</option>
                                    <option value="4.0">4.0 mmÂ²</option>
                                    <option value="6.0">6.0 mmÂ²</option>
                                </select>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Color Code</label>
                                <select class="form-control" x-model="wiringConfig.colorCode">
                                    <option value="iec">IEC Standard</option>
                                    <option value="ansi">ANSI Standard</option>
                                    <option value="custom">Custom</option>
                                </select>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Terminal Type</label>
                                <select class="form-control" x-model="wiringConfig.terminalType">
                                    <option value="screw">Screw Terminal</option>
                                    <option value="spring">Spring Terminal</option>
                                    <option value="insulation">Insulation Displacement</option>
                                    <option value="crimp">Crimp Terminal</option>
                                </select>
                            </div>
                            
                            <div class="mt-6">
                                <h4 class="font-semibold mb-2">Wire Length Summary</h4>
                                <div class="space-y-2">
                                    <div class="flex justify-between">
                                        <span>Control Wires:</span>
                                        <span x-text="wireLengths.control + 'm'"></span>
                                    </div>
                                    <div class="flex justify-between">
                                        <span>Power Wires:</span>
                                        <span x-text="wireLengths.power + 'm'"></span>
                                    </div>
                                    <div class="flex justify-between">
                                        <span>Signal Wires:</span>
                                        <span x-text="wireLengths.signal + 'm'"></span>
                                    </div>
                                    <div class="flex justify-between font-semibold border-t pt-2">
                                        <span>Total:</span>
                                        <span x-text="wireLength + 'm'"></span>
                                    </div>
                                </div>
                            </div>
                            
                            <button class="btn btn-primary w-full mt-4" @click="generateWiringDiagram()">
                                <i class="fas fa-bolt"></i> Generate Wiring
                            </button>
                        </div>
                        
                        <div class="wiring-canvas" id="wiringCanvas">
                            <svg width="100%" height="100%">
                                <defs>
                                    <marker id="arrowhead" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
                                        <polygon points="0 0, 10 3.5, 0 7" fill="#666"/>
                                    </marker>
                                </defs>
                                <!-- Wiring diagram will be generated here -->
                            </svg>
                        </div>
                    </div>
                    
                    <!-- Terminal Schedule -->
                    <div class="panel mt-4">
                        <h3 class="text-lg font-semibold mb-4">Terminal Schedule</h3>
                        <div class="overflow-x-auto">
                            <table class="bom-table">
                                <thead>
                                    <tr>
                                        <th>Terminal No.</th>
                                        <th>From</th>
                                        <th>To</th>
                                        <th>Wire Type</th>
                                        <th>Wire Size</th>
                                        <th>Color</th>
                                        <th>Length</th>
                                        <th>Ferrule</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <template x-for="connection in wiringConnections" :key="connection.id">
                                        <tr>
                                            <td x-text="connection.terminal"></td>
                                            <td>
                                                <div class="font-semibold" x-text="connection.from.component"></div>
                                                <div class="text-sm" x-text="connection.from.terminal"></div>
                                            </td>
                                            <td>
                                                <div class="font-semibold" x-text="connection.to.component"></div>
                                                <div class="text-sm" x-text="connection.to.terminal"></div>
                                            </td>
                                            <td x-text="connection.wireType"></td>
                                            <td x-text="connection.wireSize + ' mmÂ²'"></td>
                                            <td>
                                                <div class="inline-block w-4 h-4 rounded-full mr-2" :style="'background-color: ' + connection.color"></div>
                                                <span x-text="connection.colorName"></span>
                                            </td>
                                            <td x-text="connection.length + 'm'"></td>
                                            <td x-text="connection.ferrule"></td>
                                        </tr>
                                    </template>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
                
                <!-- PLC Code Tab -->
                <div class="tab-content" :class="{ 'active': activeTab === 'code' }">
                    <div class="code-editor">
                        <div class="editor-header">
                            <div class="editor-title">
                                <i class="fas fa-code"></i>
                                <span>PLC Control Program</span>
                            </div>
                            <div class="flex gap-2">
                                <select class="form-control form-control-sm" x-model="plcConfig.plcType" @change="generatePLCCode()">
                                    <option value="siemens">Siemens S7-1200/1500</option>
                                    <option value="allen_bradley">Allen-Bradley</option>
                                    <option value="schneider">Schneider Electric</option>
                                    <option value="omron">Omron</option>
                                    <option value="codesys">CODESYS</option>
                                </select>
                                <button class="btn btn-sm btn-primary" @click="generatePLCCode()">
                                    <i class="fas fa-sync"></i> Generate
                                </button>
                                <button class="btn btn-sm btn-success" @click="downloadCode()">
                                    <i class="fas fa-download"></i> Download
                                </button>
                            </div>
                        </div>
                        <div class="editor-content">
                            <pre class="code-block" id="plcCode"></pre>
                        </div>
                    </div>
                    
                    <!-- I/O Mapping -->
                    <div class="panel mt-4">
                        <h3 class="text-lg font-semibold mb-4">PLC I/O Mapping</h3>
                        <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                            <div>
                                <h4 class="font-semibold mb-2 text-primary">Digital Inputs</h4>
                                <div class="space-y-2 max-h-60 overflow-y-auto">
                                    <template x-for="di in digitalInputs" :key="di.address">
                                        <div class="flex justify-between items-center p-2 bg-gray-50 rounded">
                                            <span x-text="di.name"></span>
                                            <code class="tag" x-text="di.address"></code>
                                        </div>
                                    </template>
                                </div>
                            </div>
                            <div>
                                <h4 class="font-semibold mb-2 text-success">Digital Outputs</h4>
                                <div class="space-y-2 max-h-60 overflow-y-auto">
                                    <template x-for="do in digitalOutputs" :key="do.address">
                                        <div class="flex justify-between items-center p-2 bg-gray-50 rounded">
                                            <span x-text="do.name"></span>
                                            <code class="tag" x-text="do.address"></code>
                                        </div>
                                    </template>
                                </div>
                            </div>
                            <div>
                                <h4 class="font-semibold mb-2 text-warning">Analog Inputs</h4>
                                <div class="space-y-2 max-h-60 overflow-y-auto">
                                    <template x-for="ai in analogInputs" :key="ai.address">
                                        <div class="flex justify-between items-center p-2 bg-gray-50 rounded">
                                            <span x-text="ai.name"></span>
                                            <code class="tag" x-text="ai.address"></code>
                                        </div>
                                    </template>
                                </div>
                            </div>
                            <div>
                                <h4 class="font-semibold mb-2 text-danger">Analog Outputs</h4>
                                <div class="space-y-2 max-h-60 overflow-y-auto">
                                    <template x-for="ao in analogOutputs" :key="ao.address">
                                        <div class="flex justify-between items-center p-2 bg-gray-50 rounded">
                                            <span x-text="ao.name"></span>
                                            <code class="tag" x-text="ao.address"></code>
                                        </div>
                                    </template>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Scenario Tab -->
                <div class="tab-content" :class="{ 'active': activeTab === 'scenario' }">
                    <div class="panel">
                        <div class="panel-header">
                            <h2 class="panel-title">
                                <i class="fas fa-project-diagram"></i> Control Scenario
                            </h2>
                            <div class="panel-actions">
                                <button class="btn btn-primary" @click="simulateScenario()">
                                    <i class="fas fa-play"></i> Simulate
                                </button>
                            </div>
                        </div>
                        
                        <!-- Control Logic Diagram -->
                        <div class="mb-6 p-4 bg-gray-50 rounded-lg">
                            <h3 class="text-lg font-semibold mb-4">Control Logic Flow</h3>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                <div>
                                    <h4 class="font-semibold mb-2">Evaporative Ventilation Algorithm</h4>
                                    <pre class="code-block">
// Air Flow Calculation Algorithm
return_air = saloon_air;
exhaust_air = exhaust_damper_percentage * return_air * edeff;
remain_air = return_air - exhaust_air;
remain_percentage = 1 - exhaust_percentage;

// Cycle Air Calculation
if (heater_valve_open) {
    cycle_air = remain_air + heating_constant_wet_bulb;
} else {
    cycle_air = remain_air;
}

// Mixing Air Calculation
mixing_air = psychometric_mix(cycle_air, outdoor_air);

// Feed Air Calculation
if (pump_off) {
    feed_air = mixing_air;
} else {
    feed_air = evaporative_cooling(mixing_air, target_humidity = 85%);
}

// Control Logic
fresh_percentage = exhaust_percentage;
cycle_percentage = 100 - fresh_percentage;
                                    </pre>
                                </div>
                                <div>
                                    <h4 class="font-semibold mb-2">Sequence Control</h4>
                                    <div class="space-y-4">
                                        <div class="p-3 bg-white border rounded">
                                            <div class="font-semibold">Startup Sequence</div>
                                            <ol class="list-decimal pl-5 mt-2 space-y-1">
                                                <li>Close all dampers</li>
                                                <li>Start main fans at 10% speed</li>
                                                <li>Open fresh air damper to 20%</li>
                                                <li>Start water pump</li>
                                                <li>Ramp up fans to operating speed</li>
                                            </ol>
                                        </div>
                                        <div class="p-3 bg-white border rounded">
                                            <div class="font-semibold">Shutdown Sequence</div>
                                            <ol class="list-decimal pl-5 mt-2 space-y-1">
                                                <li>Close fresh air damper</li>
                                                <li>Stop water pump</li>
                                                <li>Ramp down fans to 10%</li>
                                                <li>Close all dampers</li>
                                                <li>Stop all motors</li>
                                            </ol>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Interlocks and Safety -->
                        <div class="mb-6">
                            <h3 class="text-lg font-semibold mb-4">Interlocks and Safety</h3>
                            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                                <div class="p-4 bg-red-50 border border-red-200 rounded">
                                    <div class="font-semibold text-red-700 mb-2">Emergency Stop</div>
                                    <ul class="space-y-1 text-sm">
                                        <li>â€¢ Instant shutdown of all motors</li>
                                        <li>â€¢ Close all dampers</li>
                                        <li>â€¢ Stop water pump</li>
                                        <li>â€¢ Activate alarms</li>
                                    </ul>
                                </div>
                                <div class="p-4 bg-yellow-50 border border-yellow-200 rounded">
                                    <div class="font-semibold text-yellow-700 mb-2">Safety Interlocks</div>
                                    <ul class="space-y-1 text-sm">
                                        <li>â€¢ Door open â†’ System stop</li>
                                        <li>â€¢ Over temperature â†’ Alarm</li>
                                        <li>â€¢ Low water pressure â†’ Pump stop</li>
                                        <li>â€¢ Phase loss â†’ System stop</li>
                                    </ul>
                                </div>
                                <div class="p-4 bg-green-50 border border-green-200 rounded">
                                    <div class="font-semibold text-green-700 mb-2">Normal Operation</div>
                                    <ul class="space-y-1 text-sm">
                                        <li>â€¢ Automatic temperature control</li>
                                        <li>â€¢ Humidity regulation</li>
                                        <li>â€¢ Energy optimization</li>
                                        <li>â€¢ Fault logging</li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Simulation Tab -->
                <div class="tab-content" :class="{ 'active': activeTab === 'simulation' }">
                    <div class="panel">
                        <div class="panel-header">
                            <h2 class="panel-title">
                                <i class="fas fa-play-circle"></i> System Simulation
                            </h2>
                            <div class="panel-actions">
                                <button class="btn btn-success" @click="startSimulation()" :disabled="simulation.running">
                                    <i class="fas fa-play"></i> Start
                                </button>
                                <button class="btn btn-danger" @click="stopSimulation()" :disabled="!simulation.running">
                                    <i class="fas fa-stop"></i> Stop
                                </button>
                                <button class="btn btn-warning" @click="resetSimulation()">
                                    <i class="fas fa-redo"></i> Reset
                                </button>
                            </div>
                        </div>
                        
                        <!-- Simulation Controls -->
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-6">
                            <div class="p-4 bg-gray-50 rounded">
                                <h4 class="font-semibold mb-4">Environmental Conditions</h4>
                                <div class="space-y-4">
                                    <div>
                                        <label class="form-label">Outdoor Temperature (Â°C)</label>
                                        <input type="range" min="-10" max="50" step="0.5" class="w-full" 
                                               x-model="simulation.outdoorTemp" @input="updateSimulation()">
                                        <div class="text-center font-semibold" x-text="simulation.outdoorTemp + 'Â°C'"></div>
                                    </div>
                                    <div>
                                        <label class="form-label">Outdoor Humidity (%)</label>
                                        <input type="range" min="0" max="100" step="1" class="w-full" 
                                               x-model="simulation.outdoorHumidity" @input="updateSimulation()">
                                        <div class="text-center font-semibold" x-text="simulation.outdoorHumidity + '%'"></div>
                                    </div>
                                    <div>
                                        <label class="form-label">Saloon Temperature (Â°C)</label>
                                        <input type="range" min="15" max="35" step="0.5" class="w-full" 
                                               x-model="simulation.saloonTemp" @input="updateSimulation()">
                                        <div class="text-center font-semibold" x-text="simulation.saloonTemp + 'Â°C'"></div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="p-4 bg-gray-50 rounded">
                                <h4 class="font-semibold mb-4">Control Parameters</h4>
                                <div class="space-y-4">
                                    <div>
                                        <label class="form-label">Exhaust Damper (%)</label>
                                        <input type="range" min="0" max="100" step="1" class="w-full" 
                                               x-model="simulation.exhaustDamper" @input="updateSimulation()">
                                        <div class="text-center font-semibold" x-text="simulation.exhaustDamper + '%'"></div>
                                    </div>
                                    <div>
                                        <label class="form-label">Fresh Damper (%)</label>
                                        <input type="range" min="0" max="100" step="1" class="w-full" 
                                               x-model="simulation.freshDamper" @input="updateSimulation()">
                                        <div class="text-center font-semibold" x-text="simulation.freshDamper + '%'"></div>
                                    </div>
                                    <div>
                                        <label class="form-label">Water Pump</label>
                                        <div class="flex justify-center">
                                            <label class="switch">
                                                <input type="checkbox" x-model="simulation.waterPump">
                                                <span class="slider"></span>
                                            </label>
                                        </div>
                                        <div class="text-center font-semibold" x-text="simulation.waterPump ? 'ON' : 'OFF'"></div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="p-4 bg-gray-50 rounded">
                                <h4 class="font-semibold mb-4">System Status</h4>
                                <div class="space-y-3">
                                    <div class="flex justify-between">
                                        <span>Feed Air Temperature:</span>
                                        <span class="font-semibold" x-text="simulationResults.feedTemp + 'Â°C'"></span>
                                    </div>
                                    <div class="flex justify-between">
                                        <span>Feed Air Humidity:</span>
                                        <span class="font-semibold" x-text="simulationResults.feedHumidity + '%'"></span>
                                    </div>
                                    <div class="flex justify-between">
                                        <span>Cycle Air Temperature:</span>
                                        <span class="font-semibold" x-text="simulationResults.cycleTemp + 'Â°C'"></span>
                                    </div>
                                    <div class="flex justify-between">
                                        <span>Mixed Air Temperature:</span>
                                        <span class="font-semibold" x-text="simulationResults.mixedTemp + 'Â°C'"></span>
                                    </div>
                                    <div class="flex justify-between">
                                        <span>System Efficiency:</span>
                                        <span class="font-semibold" x-text="simulationResults.efficiency + '%'"></span>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Real-time Visualization -->
                        <div class="p-4 bg-gray-50 rounded">
                            <h4 class="font-semibold mb-4">Real-time Visualization</h4>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                <div>
                                    <canvas id="simulationChart" width="400" height="200"></canvas>
                                </div>
                                <div>
                                    <div class="space-y-4">
                                        <div>
                                            <div class="flex justify-between mb-1">
                                                <span>Fan Speed</span>
                                                <span x-text="simulationResults.fanSpeed + '%'"></span>
                                            </div>
                                            <div class="w-full bg-gray-200 rounded-full h-2.5">
                                                <div class="bg-blue-600 h-2.5 rounded-full" :style="'width: ' + simulationResults.fanSpeed + '%'"></div>
                                            </div>
                                        </div>
                                        <div>
                                            <div class="flex justify-between mb-1">
                                                <span>Water Flow</span>
                                                <span x-text="simulationResults.waterFlow + ' L/min'"></span>
                                            </div>
                                            <div class="w-full bg-gray-200 rounded-full h-2.5">
                                                <div class="bg-green-600 h-2.5 rounded-full" :style="'width: ' + Math.min(simulationResults.waterFlow * 10, 100) + '%'"></div>
                                            </div>
                                        </div>
                                        <div>
                                            <div class="flex justify-between mb-1">
                                                <span>Power Consumption</span>
                                                <span x-text="simulationResults.power + ' kW'"></span>
                                            </div>
                                            <div class="w-full bg-gray-200 rounded-full h-2.5">
                                                <div class="bg-red-600 h-2.5 rounded-full" :style="'width: ' + Math.min(simulationResults.power * 5, 100) + '%'"></div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Documentation Tab -->
                <div class="tab-content" :class="{ 'active': activeTab === 'documentation' }">
                    <div class="panel">
                        <div class="panel-header">
                            <h2 class="panel-title">
                                <i class="fas fa-file-alt"></i> Project Documentation
                            </h2>
                            <div class="panel-actions">
                                <button class="btn btn-primary" @click="generateDocumentation()">
                                    <i class="fas fa-file-pdf"></i> Generate PDF
                                </button>
                                <button class="btn btn-success" @click="exportDocumentation()">
                                    <i class="fas fa-download"></i> Export All
                                </button>
                            </div>
                        </div>
                        
                        <!-- Documentation Tabs -->
                        <div class="mb-6">
                            <div class="flex border-b">
                                <button class="px-4 py-2 font-semibold border-b-2 border-primary" @click="docTab = 'overview'">
                                    Overview
                                </button>
                                <button class="px-4 py-2 font-semibold" @click="docTab = 'specifications'">
                                    Specifications
                                </button>
                                <button class="px-4 py-2 font-semibold" @click="docTab = 'drawings'">
                                    Drawings
                                </button>
                                <button class="px-4 py-2 font-semibold" @click="docTab = 'manual'">
                                    Operation Manual
                                </button>
                            </div>
                            
                            <div class="mt-4">
                                <div x-show="docTab === 'overview'">
                                    <h3 class="text-lg font-semibold mb-4">Project Overview</h3>
                                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                        <div>
                                            <h4 class="font-semibold mb-2">Project Information</h4>
                                            <table class="w-full">
                                                <tr>
                                                    <td class="py-2 font-semibold">Project Name:</td>
                                                    <td class="py-2" x-text="projectName"></td>
                                                </tr>
                                                <tr>
                                                    <td class="py-2 font-semibold">Template:</td>
                                                    <td class="py-2" x-text="selectedTemplate"></td>
                                                </tr>
                                                <tr>
                                                    <td class="py-2 font-semibold">Created:</td>
                                                    <td class="py-2" x-text="new Date().toLocaleDateString()"></td>
                                                </tr>
                                                <tr>
                                                    <td class="py-2 font-semibold">Last Modified:</td>
                                                    <td class="py-2" x-text="new Date().toLocaleDateString()"></td>
                                                </tr>
                                                <tr>
                                                    <td class="py-2 font-semibold">Cabinet Size:</td>
                                                    <td class="py-2" x-text="cabinetSize"></td>
                                                </tr>
                                            </table>
                                        </div>
                                        <div>
                                            <h4 class="font-semibold mb-2">System Summary</h4>
                                            <div class="space-y-2">
                                                <div class="flex justify-between">
                                                    <span>Total Motors:</span>
                                                    <span x-text="motors.reduce((sum, m) => sum + m.quantity, 0)"></span>
                                                </div>
                                                <div class="flex justify-between">
                                                    <span>Total Actuators:</span>
                                                    <span x-text="actuators.reduce((sum, a) => sum + a.quantity, 0)"></span>
                                                </div>
                                                <div class="flex justify-between">
                                                    <span>Total Sensors:</span>
                                                    <span x-text="sensors.reduce((sum, s) => sum + s.quantity, 0)"></span>
                                                </div>
                                                <div class="flex justify-between">
                                                    <span>PLC I/O Points:</span>
                                                    <span x-text="digitalInputs.length + digitalOutputs.length + analogInputs.length + analogOutputs.length"></span>
                                                </div>
                                                <div class="flex justify-between font-semibold border-t pt-2">
                                                    <span>Total Estimated Cost:</span>
                                                    <span x-text="'â‚¬' + totalCost.toLocaleString()"></span>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <div x-show="docTab === 'specifications'" class="hidden">
                                    <h3 class="text-lg font-semibold mb-4">Technical Specifications</h3>
                                    <!-- Specifications content -->
                                </div>
                                
                                <div x-show="docTab === 'drawings'" class="hidden">
                                    <h3 class="text-lg font-semibold mb-4">Technical Drawings</h3>
                                    <!-- Drawings content -->
                                </div>
                                
                                <div x-show="docTab === 'manual'" class="hidden">
                                    <h3 class="text-lg font-semibold mb-4">Operation Manual</h3>
                                    <!-- Manual content -->
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </main>
            
            <!-- Footer -->
            <footer class="app-footer">
                <div class="footer-info">
                    <div>
                        <div class="font-semibold" x-text="projectName"></div>
                        <div class="text-sm" x-text="'Template: ' + selectedTemplate"></div>
                    </div>
                </div>
                <div class="footer-stats">
                    <div class="stat-item">
                        <div class="stat-value" x-text="bom.length"></div>
                        <div class="stat-label">Components</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" x-text="'â‚¬' + totalCost.toLocaleString()"></div>
                        <div class="stat-label">Cost</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" x-text="terminalCount"></div>
                        <div class="stat-label">Terminals</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" x-text="wireLength + 'm'"></div>
                        <div class="stat-label">Wiring</div>
                    </div>
                </div>
            </footer>
        </div>
        
        <!-- Modal System -->
        <template x-if="activeModal">
            <div class="modal" @click.self="closeModal()">
                <div class="modal-content" :class="'modal-' + activeModal">
                    <!-- Modal content will be inserted here -->
                </div>
            </div>
        </template>
        
        <!-- Hidden file inputs -->
        <input type="file" id="fileInput" accept=".json,.plc" class="hidden" @change="loadProjectFile($event)">
        
        <!-- Custom styles for switches -->
        <style>
            .switch {
                position: relative;
                display: inline-block;
                width: 60px;
                height: 34px;
            }
            
            .switch input {
                opacity: 0;
                width: 0;
                height: 0;
            }
            
            .slider {
                position: absolute;
                cursor: pointer;
                top: 0;
                left: 0;
                right: 0;
                bottom: 0;
                background-color: #ccc;
                transition: .4s;
                border-radius: 34px;
            }
            
            .slider:before {
                position: absolute;
                content: "";
                height: 26px;
                width: 26px;
                left: 4px;
                bottom: 4px;
                background-color: white;
                transition: .4s;
                border-radius: 50%;
            }
            
            input:checked + .slider {
                background-color: #2196F3;
            }
            
            input:checked + .slider:before {
                transform: translateX(26px);
            }
        </style>
    </div>

    <script>
        // Main Alpine.js component
        function plcDesigner() {
            return {
                // Application State
                activeTab: 'design',
                activeModal: null,
                docTab: 'overview',
                projectName: 'Evaporative Ventilation System',
                selectedTemplate: 'evap_vent',
                componentSearch: '',
                
                // System Configuration
                systemConfig: {
                    mainVoltage: '400',
                    controlVoltage: '24',
                    frequency: '50',
                    phaseProtection: true,
                    overloadProtection: true,
                    shortCircuitProtection: true,
                    earthFaultProtection: true,
                    surgeProtection: false,
                    iec61439: true,
                    iec60204: true,
                    ul508a: false,
                    ceMarking: true,
                    ipRating: 'IP54'
                },
                
                // Layout Configuration
                layoutConfig: {
                    railType: 'vertical',
                    componentSpacing: 20,
                    cabinetMargin: 50,
                    colorScheme: 'standard',
                    showDimensions: true,
                    showLabels: true,
                    snapToGrid: true
                },
                
                // Wiring Configuration
                wiringConfig: {
                    wireType: 'control',
                    wireSize: '1.5',
                    colorCode: 'iec',
                    terminalType: 'screw'
                },
                
                // PLC Configuration
                plcConfig: {
                    plcType: 'siemens',
                    cpuType: 'S7-1200',
                    memorySize: '100KB',
                    scanTime: '50ms'
                },
                
                // Cabinet Dimensions
                cabinetDimensions: {
                    width: 800,
                    height: 600,
                    depth: 200
                },
                
                // Grid Settings
                gridSize: 20,
                showGrid: true,
                
                // Component Selection
                selectedComponentId: null,
                filteredComponents: [],
                
                // Simulation State
                simulation: {
                    running: false,
                    interval: null,
                    time: 0,
                    outdoorTemp: 25,
                    outdoorHumidity: 60,
                    saloonTemp: 22,
                    exhaustDamper: 30,
                    freshDamper: 30,
                    waterPump: true,
                    heaterValve: false
                },
                
                simulationResults: {
                    feedTemp: 22,
                    feedHumidity: 65,
                    cycleTemp: 21,
                    mixedTemp: 23,
                    efficiency: 85,
                    fanSpeed: 75,
                    waterFlow: 45,
                    power: 18.5
                },
                
                // Data Arrays
                motors: [],
                actuators: [],
                sensors: [],
                optionalComponents: [],
                bom: [],
                layoutComponents: [],
                wiringConnections: [],
                digitalInputs: [],
                digitalOutputs: [],
                analogInputs: [],
                analogOutputs: [],
                
                // Component Library
                componentLibrary: [
                    // PLC Components
                    { id: 'plc-cpu', name: 'PLC CPU', type: 'PLC', icon: 'fas fa-microchip', category: 'Control', 
                      width: 160, height: 200, color: 'plc', voltage: '24V DC', price: 850 },
                    { id: 'di-module', name: 'Digital Input Module', type: 'Module', icon: 'fas fa-signal', category: 'Control',
                      width: 80, height: 200, color: 'plc', voltage: '24V DC', price: 120 },
                    { id: 'do-module', name: 'Digital Output Module', type: 'Module', icon: 'fas fa-bolt', category: 'Control',
                      width: 80, height: 200, color: 'plc', voltage: '24V DC', price: 135 },
                    { id: 'ai-module', name: 'Analog Input Module', type: 'Module', icon: 'fas fa-wave-square', category: 'Control',
                      width: 80, height: 200, color: 'plc', voltage: '24V DC', price: 185 },
                    
                    // Power Components
                    { id: 'psu-24v', name: '24V Power Supply', type: 'PSU', icon: 'fas fa-plug', category: 'Power',
                      width: 80, height: 160, color: 'psu', voltage: '230V AC/24V DC', price: 85 },
                    { id: 'main-breaker', name: 'Main Circuit Breaker', type: 'Breaker', icon: 'fas fa-power-off', category: 'Power',
                      width: 80, height: 160, color: 'breaker', voltage: '400V AC', price: 120 },
                    { id: 'transformer', name: 'Control Transformer', type: 'Transformer', icon: 'fas fa-bolt', category: 'Power',
                      width: 80, height: 160, color: 'transformer', voltage: '400V/230V', price: 95 },
                    
                    // Motor Control
                    { id: 'contactor-16a', name: 'Contactor 16A', type: 'Contactor', icon: 'fas fa-exchange-alt', category: 'Motor Control',
                      width: 45, height: 90, color: 'contactor', voltage: '400V AC', price: 35 },
                    { id: 'contactor-25a', name: 'Contactor 25A', type: 'Contactor', icon: 'fas fa-exchange-alt', category: 'Motor Control',
                      width: 45, height: 90, color: 'contactor', voltage: '400V AC', price: 45 },
                    { id: 'overload-relay', name: 'Overload Relay', type: 'Protection', icon: 'fas fa-shield-alt', category: 'Motor Control',
                      width: 45, height: 90, color: 'relay', voltage: '400V AC', price: 60 },
                    { id: 'soft-starter', name: 'Soft Starter', type: 'Starter', icon: 'fas fa-tachometer-alt', category: 'Motor Control',
                      width: 160, height: 200, color: 'soft-starter', voltage: '400V AC', price: 450 },
                    { id: 'vfd-inverter', name: 'VFD Inverter', type: 'Inverter', icon: 'fas fa-sliders-h', category: 'Motor Control',
                      width: 200, height: 300, color: 'inverter', voltage: '400V AC', price: 650 },
                    
                    // Relays and Switches
                    { id: 'relay-24v', name: '24V Relay', type: 'Relay', icon: 'fas fa-random', category: 'Control',
                      width: 22, height: 45, color: 'relay', voltage: '24V DC', price: 15 },
                    { id: 'relay-base', name: 'Relay Base', type: 'Accessory', icon: 'fas fa-th-large', category: 'Control',
                      width: 22, height: 45, color: 'relay', voltage: '24V DC', price: 8 },
                    { id: 'emergency-stop', name: 'Emergency Stop', type: 'Switch', icon: 'fas fa-exclamation-triangle', category: 'Safety',
                      width: 45, height: 45, color: 'switch', voltage: '24V DC', price: 25 },
                    { id: 'selector-switch', name: 'Selector Switch', type: 'Switch', icon: 'fas fa-toggle-on', category: 'Control',
                      width: 45, height: 45, color: 'switch', voltage: '24V DC', price: 18 },
                    
                    // Terminals
                    { id: 'terminal-block', name: 'Terminal Block', type: 'Terminal', icon: 'fas fa-plug', category: 'Wiring',
                      width: 45, height: 90, color: 'terminal', voltage: '600V', price: 8 },
                    { id: 'ground-terminal', name: 'Ground Terminal', type: 'Terminal', icon: 'fas fa-anchor', category: 'Wiring',
                      width: 45, height: 45, color: 'terminal', voltage: '600V', price: 12 },
                    { id: 'fuse-terminal', name: 'Fuse Terminal', type: 'Terminal', icon: 'fas fa-burn', category: 'Protection',
                      width: 45, height: 90, color: 'fuse', voltage: '400V', price: 15 },
                    
                    // Sensors
                    { id: 'temp-sensor', name: 'Temperature Sensor', type: 'Sensor', icon: 'fas fa-thermometer-half', category: 'Instrumentation',
                      width: 22, height: 45, color: 'sensor', signal: '4-20mA', price: 95 },
                    { id: 'humidity-sensor', name: 'Humidity Sensor', type: 'Sensor', icon: 'fas fa-tint', category: 'Instrumentation',
                      width: 22, height: 45, color: 'sensor', signal: '4-20mA', price: 110 },
                    { id: 'pressure-sensor', name: 'Pressure Sensor', type: 'Sensor', icon: 'fas fa-tachometer-alt', category: 'Instrumentation',
                      width: 22, height: 45, color: 'sensor', signal: '4-20mA', price: 125 },
                    { id: 'flow-sensor', name: 'Flow Sensor', type: 'Sensor', icon: 'fas fa-water', category: 'Instrumentation',
                      width: 22, height: 45, color: 'sensor', signal: '4-20mA', price: 150 },
                    
                    // HMI and Communication
                    { id: 'hmi-7inch', name: 'HMI 7" Touch', type: 'HMI', icon: 'fas fa-desktop', category: 'Interface',
                      width: 180, height: 120, color: 'hmi', voltage: '24V DC', price: 450 },
                    { id: 'ethernet-switch', name: 'Ethernet Switch', type: 'Communication', icon: 'fas fa-network-wired', category: 'Interface',
                      width: 80, height: 80, color: 'plc', voltage: '24V DC', price: 85 },
                    
                    // Cabinet Accessories
                    { id: 'din-rail', name: 'DIN Rail 35mm', type: 'Accessory', icon: 'fas fa-grip-lines', category: 'Cabinet',
                      width: 1000, height: 10, color: 'terminal', price: 6 },
                    { id: 'cable-duct', name: 'Cable Duct 40x40', type: 'Accessory', icon: 'fas fa-box-open', category: 'Cabinet',
                      width: 1000, height: 40, color: 'terminal', price: 12 },
                    { id: 'fan-24v', name: 'Cooling Fan', type: 'Accessory', icon: 'fas fa-fan', category: 'Cabinet',
                      width: 80, height: 80, color: 'psu', voltage: '24V DC', price: 35 },
                    { id: 'heater-24v', name: 'Cabinet Heater', type: 'Accessory', icon: 'fas fa-fire', category: 'Cabinet',
                      width: 80, height: 80, color: 'switch', voltage: '24V DC', price: 45 }
                ],
                
                // Calculated Values
                totalCost: 0,
                terminalCount: 0,
                wireLength: 0,
                wireLengths: {
                    control: 0,
                    power: 0,
                    signal: 0,
                    total: 0
                },
                uniqueComponents: 0,
                heaviestComponent: '0kg',
                cabinetSize: '800x600x200mm',
                
                // Initialization
                init() {
                    this.loadTemplate();
                    this.calculateBOM();
                    this.generateIOLists();
                    this.setupDragAndDrop();
                    this.filterComponents();
                    this.loadProjectState();
                    
                    // Auto-save every minute
                    setInterval(() => {
                        this.saveProjectState();
                    }, 60000);
                },
                
                // Template Management
                loadTemplate() {
                    if (this.selectedTemplate === 'evap_vent') {
                        this.loadEvapVentTemplate();
                    } else if (this.selectedTemplate === 'filter_plant') {
                        this.loadFilterPlantTemplate();
                    } else if (this.selectedTemplate === 'pumping_station') {
                        this.loadPumpingStationTemplate();
                    } else if (this.selectedTemplate === 'conveyor_system') {
                        this.loadConveyorSystemTemplate();
                    } else {
                        this.loadCustomTemplate();
                    }
                    this.calculateBOM();
                },
                
                loadEvapVentTemplate() {
                    this.motors = [
                        { id: 1, name: 'Fan Feed Motor', quantity: 2, power: '22', voltage: '400V', hasOverload: true, hasBrake: false },
                        { id: 2, name: 'Fan Return Motor', quantity: 2, power: '30', voltage: '400V', hasOverload: true, hasBrake: false },
                        { id: 3, name: 'Dust Fan Motor', quantity: 4, power: '3.3', voltage: '400V', hasOverload: true, hasBrake: false },
                        { id: 4, name: 'Rotary Motor', quantity: 2, power: '1', voltage: '400V', hasOverload: true, hasBrake: false },
                        { id: 5, name: 'Mechanism Motor', quantity: 2, power: '0.25', voltage: '400V', hasOverload: true, hasBrake: false },
                        { id: 6, name: 'Pump Water Motor', quantity: 1, power: '30', voltage: '400V', hasOverload: true, hasBrake: false }
                    ];
                    
                    this.actuators = [
                        { id: 1, name: 'Damper Fresh', quantity: 2, type: 'damper', feedback: 'analog', voltage: '24V DC' },
                        { id: 2, name: 'Damper Exhaust', quantity: 2, type: 'damper', feedback: 'analog', voltage: '24V DC' },
                        { id: 3, name: 'Damper Return', quantity: 2, type: 'damper', feedback: 'none', voltage: '24V DC' },
                        { id: 4, name: 'Steam Valve', quantity: 1, type: 'valve', feedback: 'digital', voltage: '24V DC' }
                    ];
                    
                    this.sensors = [
                        { id: 1, name: 'Temperature Sensor', quantity: 2, type: 'Temperature', signal: '4-20mA', range: '-20..80Â°C' },
                        { id: 2, name: 'Humidity Sensor', quantity: 2, type: 'Humidity', signal: '4-20mA', range: '0..100%' },
                        { id: 3, name: 'Micro Switch', quantity: 5, type: 'Limit', signal: 'Digital', range: 'ON/OFF' },
                        { id: 4, name: 'Pressure Sensor', quantity: 2, type: 'Pressure', signal: '4-20mA', range: '0..10 bar' }
                    ];
                    
                    this.optionalComponents = [
                        { id: 1, name: 'VFD Inverter', quantity: 1, spec: '30kW', icon: 'fas fa-sliders-h', status: 'Optional' },
                        { id: 2, name: 'Soft Starter', quantity: 1, spec: '30kW', icon: 'fas fa-tachometer-alt', status: 'Included' },
                        { id: 3, name: 'HMI Panel', quantity: 1, spec: '7 inch', icon: 'fas fa-desktop', status: 'Included' },
                        { id: 4, name: 'Cabinet Heat Sensor', quantity: 1, spec: 'Thermal', icon: 'fas fa-thermometer-half', status: 'Optional' },
                        { id: 5, name: 'Ethernet Switch', quantity: 1, spec: '8-port', icon: 'fas fa-network-wired', status: 'Optional' }
                    ];
                },
                
                loadFilterPlantTemplate() {
                    // Filter plant template components
                    this.motors = [
                        { id: 1, name: 'Main Fan Motor', quantity: 3, power: '120', voltage: '400V', hasOverload: true, hasBrake: true },
                        { id: 2, name: 'Filter Disk Motor', quantity: 3, power: '1', voltage: '400V', hasOverload: true, hasBrake: false },
                        { id: 3, name: 'Rotary Filter Motor', quantity: 3, power: '1', voltage: '400V', hasOverload: true, hasBrake: false },
                        { id: 4, name: 'Mechanism Motor', quantity: 3, power: '0.3', voltage: '400V', hasOverload: true, hasBrake: false },
                        { id: 5, name: 'Dust Collector Fan', quantity: 6, power: '5', voltage: '400V', hasOverload: true, hasBrake: false }
                    ];
                    
                    this.actuators = [
                        { id: 1, name: 'Air Dampers', quantity: 6, type: 'damper', feedback: 'analog', voltage: '24V DC' },
                        { id: 2, name: 'Water Valves', quantity: 3, type: 'valve', feedback: 'digital', voltage: '24V DC' }
                    ];
                    
                    this.sensors = [
                        { id: 1, name: 'Differential Pressure', quantity: 3, type: 'Pressure', signal: '4-20mA', range: '0..500 Pa' },
                        { id: 2, name: 'Temperature Sensor', quantity: 6, type: 'Temperature', signal: '4-20mA', range: '-20..80Â°C' },
                        { id: 3, name: 'Door Switch', quantity: 6, type: 'Limit', signal: 'Digital', range: 'ON/OFF' },
                        { id: 4, name: 'Flow Sensor', quantity: 3, type: 'Flow', signal: '4-20mA', range: '0..100 mÂ³/h' }
                    ];
                    
                    this.optionalComponents = [
                        { id: 1, name: 'VFD Inverter', quantity: 1, spec: '132kW', icon: 'fas fa-sliders-h', status: 'Recommended' },
                        { id: 2, name: 'HMI Panel', quantity: 1, spec: '10 inch', icon: 'fas fa-desktop', status: 'Included' },
                        { id: 3, name: 'Dust Monitor', quantity: 1, spec: 'Laser', icon: 'fas fa-eye', status: 'Optional' },
                        { id: 4, name: 'Fire Detection', quantity: 1, spec: 'Smoke Sensor', icon: 'fas fa-fire-extinguisher', status: 'Recommended' }
                    ];
                },
                
                loadPumpingStationTemplate() {
                    // Pumping station template
                    this.motors = [
                        { id: 1, name: 'Main Pump Motor', quantity: 2, power: '55', voltage: '400V', hasOverload: true, hasBrake: false },
                        { id: 2, name: 'Booster Pump Motor', quantity: 2, power: '22', voltage: '400V', hasOverload: true, hasBrake: false },
                        { id: 3, name: 'Circulation Pump', quantity: 2, power: '5.5', voltage: '400V', hasOverload: true, hasBrake: false }
                    ];
                    
                    this.actuators = [
                        { id: 1, name: 'Control Valves', quantity: 4, type: 'valve', feedback: 'analog', voltage: '24V DC' },
                        { id: 2, name: 'Butterfly Valves', quantity: 2, type: 'valve', feedback: 'digital', voltage: '24V DC' }
                    ];
                    
                    this.sensors = [
                        { id: 1, name: 'Pressure Transmitter', quantity: 4, type: 'Pressure', signal: '4-20mA', range: '0..16 bar' },
                        { id: 2, name: 'Flow Meter', quantity: 2, type: 'Flow', signal: '4-20mA', range: '0..100 mÂ³/h' },
                        { id: 3, name: 'Level Sensor', quantity: 2, type: 'Level', signal: '4-20mA', range: '0..10 m' },
                        { id: 4, name: 'Temperature Sensor', quantity: 2, type: 'Temperature', signal: '4-20mA', range: '0..100Â°C' }
                    ];
                    
                    this.optionalComponents = [
                        { id: 1, name: 'VFD Inverter', quantity: 2, spec: '55kW', icon: 'fas fa-sliders-h', status: 'Recommended' },
                        { id: 2, name: 'Soft Starter', quantity: 1, spec: '22kW', icon: 'fas fa-tachometer-alt', status: 'Included' },
                        { id: 3, name: 'HMI Panel', quantity: 1, spec: '7 inch', icon: 'fas fa-desktop', status: 'Included' },
                        { id: 4, name: 'SCADA Interface', quantity: 1, spec: 'OPC UA', icon: 'fas fa-server', status: 'Optional' }
                    ];
                },
                
                loadCustomTemplate() {
                    this.motors = [];
                    this.actuators = [];
                    this.sensors = [];
                    this.optionalComponents = [];
                },
                
                // Component Management
                filterComponents() {
                    if (!this.componentSearch) {
                        this.filteredComponents = this.componentLibrary;
                        return;
                    }
                    
                    const search = this.componentSearch.toLowerCase();
                    this.filteredComponents = this.componentLibrary.filter(comp => 
                        comp.name.toLowerCase().includes(search) ||
                        comp.type.toLowerCase().includes(search) ||
                        comp.category.toLowerCase().includes(search)
                    );
                },
                
                selectComponent(component) {
                    this.selectedComponentId = component.id;
                },
                
                addToBOM(component) {
                    // Check if component already exists in BOM
                    const existing = this.bom.find(item => item.partNumber === component.id);
                    if (existing) {
                        existing.quantity++;
                    } else {
                        this.bom.push({
                            id: Date.now() + Math.random(),
                            name: component.name,
                            partNumber: component.id,
                            quantity: 1,
                            specifications: `${component.type}, ${component.voltage || 'N/A'}`,
                            standards: 'IEC 60947',
                            unitPrice: component.price,
                            category: component.category,
                            tags: [component.type, component.category]
                        });
                    }
                    this.calculateBOM();
                },
                
                // BOM Calculations
                calculateBOM() {
                    // Calculate total cost
                    this.totalCost = this.bom.reduce((sum, item) => sum + (item.unitPrice * item.quantity), 0);
                    
                    // Calculate terminal count (simplified)
                    this.terminalCount = Math.ceil(this.bom.length * 1.5);
                    
                    // Calculate unique components
                    this.uniqueComponents = new Set(this.bom.map(item => item.partNumber)).size;
                    
                    // Update cabinet size based on components
                    this.updateCabinetSize();
                    
                    // Save state
                    this.saveProjectState();
                },
                
                updateCabinetSize() {
                    const totalComponents = this.bom.reduce((sum, item) => sum + item.quantity, 0);
                    
                    // Simple cabinet size calculation based on component count
                    if (totalComponents < 20) {
                        this.cabinetSize = '600x400x200mm';
                        this.cabinetDimensions = { width: 600, height: 400, depth: 200 };
                    } else if (totalComponents < 40) {
                        this.cabinetSize = '800x600x200mm';
                        this.cabinetDimensions = { width: 800, height: 600, depth: 200 };
                    } else if (totalComponents < 60) {
                        this.cabinetSize = '1000x800x200mm';
                        this.cabinetDimensions = { width: 1000, height: 800, depth: 200 };
                    } else {
                        this.cabinetSize = '1200x1000x200mm';
                        this.cabinetDimensions = { width: 1200, height: 1000, depth: 200 };
                    }
                },
                
                // I/O Calculations
                generateIOLists() {
                    this.digitalInputs = [
                        { name: 'Emergency Stop 1', address: 'I0.0' },
                        { name: 'Emergency Stop 2', address: 'I0.1' },
                        { name: 'Door Switch 1', address: 'I0.2' },
                        { name: 'Door Switch 2', address: 'I0.3' },
                        { name: 'Door Switch 3', address: 'I0.4' },
                        { name: 'Door Switch 4', address: 'I0.5' },
                        { name: 'Door Switch 5', address: 'I0.6' },
                        { name: 'Start Button', address: 'I0.7' },
                        { name: 'Stop Button', address: 'I1.0' },
                        { name: 'Reset Button', address: 'I1.1' },
                        { name: 'Auto/Manual Switch', address: 'I1.2' },
                        { name: 'Fan 1 Overload', address: 'I1.3' },
                        { name: 'Fan 2 Overload', address: 'I1.4' },
                        { name: 'Pump Overload', address: 'I1.5' },
                        { name: 'Low Water Level', address: 'I1.6' },
                        { name: 'High Water Level', address: 'I1.7' }
                    ];
                    
                    this.digitalOutputs = [
                        { name: 'Fan 1 Contactor', address: 'Q0.0' },
                        { name: 'Fan 2 Contactor', address: 'Q0.1' },
                        { name: 'Pump Contactor', address: 'Q0.2' },
                        { name: 'Dust Fan 1', address: 'Q0.3' },
                        { name: 'Dust Fan 2', address: 'Q0.4' },
                        { name: 'Dust Fan 3', address: 'Q0.5' },
                        { name: 'Dust Fan 4', address: 'Q0.6' },
                        { name: 'Rotary Motor 1', address: 'Q0.7' },
                        { name: 'Rotary Motor 2', address: 'Q1.0' },
                        { name: 'Mechanism Motor 1', address: 'Q1.1' },
                        { name: 'Mechanism Motor 2', address: 'Q1.2' },
                        { name: 'Fresh Damper 1', address: 'Q1.3' },
                        { name: 'Fresh Damper 2', address: 'Q1.4' },
                        { name: 'Exhaust Damper 1', address: 'Q1.5' },
                        { name: 'Exhaust Damper 2', address: 'Q1.6' },
                        { name: 'Return Damper 1', address: 'Q1.7' },
                        { name: 'Power Indicator', address: 'Q2.0' },
                        { name: 'Run Indicator', address: 'Q2.1' },
                        { name: 'Fault Indicator', address: 'Q2.2' },
                        { name: 'Alarm Buzzer', address: 'Q2.3' }
                    ];
                    
                    this.analogInputs = [
                        { name: 'Outdoor Temperature', address: 'IW64' },
                        { name: 'Outdoor Humidity', address: 'IW66' },
                        { name: 'Saloon Temperature', address: 'IW68' },
                        { name: 'Saloon Humidity', address: 'IW70' },
                        { name: 'Fresh Damper Position 1', address: 'IW72' },
                        { name: 'Fresh Damper Position 2', address: 'IW74' },
                        { name: 'Exhaust Damper Position 1', address: 'IW76' },
                        { name: 'Exhaust Damper Position 2', address: 'IW78' }
                    ];
                    
                    this.analogOutputs = [
                        { name: 'Fan 1 Speed Control', address: 'QW80' },
                        { name: 'Fan 2 Speed Control', address: 'QW82' },
                        { name: 'Fresh Damper Control 1', address: 'QW84' },
                        { name: 'Fresh Damper Control 2', address: 'QW86' }
                    ];
                },
                
                // Layout Management
                setupDragAndDrop() {
                    // Setup interact.js for drag and drop
                    const layoutGrid = document.getElementById('layoutGrid');
                    if (!layoutGrid) return;
                    
                    interact('.layout-component').draggable({
                        listeners: {
                            move: event => {
                                const target = event.target;
                                const x = (parseFloat(target.getAttribute('data-x')) || 0) + event.dx;
                                const y = (parseFloat(target.getAttribute('data-y')) || 0) + event.dy;
                                
                                target.style.transform = `translate(${x}px, ${y}px)`;
                                target.setAttribute('data-x', x);
                                target.setAttribute('data-y', y);
                                
                                // Update component position in data
                                const componentId = target.getAttribute('data-id');
                                const component = this.layoutComponents.find(c => c.id == componentId);
                                if (component) {
                                    component.x += event.dx;
                                    component.y += event.dy;
                                }
                            }
                        },
                        modifiers: [
                            interact.modifiers.restrictRect({
                                restriction: 'parent',
                                endOnly: true
                            })
                        ]
                    });
                },
                
                addComponentToLayout() {
                    if (!this.selectedComponentId) return;
                    
                    const component = this.componentLibrary.find(c => c.id === this.selectedComponentId);
                    if (!component) return;
                    
                    const newComponent = {
                        id: Date.now(),
                        name: component.name,
                        type: component.color,
                        width: component.width / 2, // Convert to pixels for display
                        height: component.height / 2,
                        x: 50,
                        y: 50,
                        tag: component.name.substring(0, 3).toUpperCase() + (this.layoutComponents.length + 1),
                        details: component.voltage || component.signal || ''
                    };
                    
                    this.layoutComponents.push(newComponent);
                    this.renderLayout();
                },
                
                renderLayout() {
                    const layoutGrid = document.getElementById('layoutGrid');
                    if (!layoutGrid) return;
                    
                    // Clear existing components
                    layoutGrid.innerHTML = '';
                    
                    // Set grid size
                    layoutGrid.style.width = this.cabinetDimensions.width + 'px';
                    layoutGrid.style.height = this.cabinetDimensions.height + 'px';
                    
                    // Draw grid
                    if (this.showGrid) {
                        const gridSize = parseInt(this.gridSize);
                        for (let x = 0; x < this.cabinetDimensions.width; x += gridSize) {
                            for (let y = 0; y < this.cabinetDimensions.height; y += gridSize) {
                                const cell = document.createElement('div');
                                cell.className = 'grid-cell';
                                cell.style.left = x + 'px';
                                cell.style.top = y + 'px';
                                cell.style.width = gridSize + 'px';
                                cell.style.height = gridSize + 'px';
                                layoutGrid.appendChild(cell);
                            }
                        }
                    }
                    
                    // Draw components
                    this.layoutComponents.forEach(comp => {
                        const element = document.createElement('div');
                        element.className = `layout-component ${comp.type}`;
                        element.style.left = comp.x + 'px';
                        element.style.top = comp.y + 'px';
                        element.style.width = comp.width + 'px';
                        element.style.height = comp.height + 'px';
                        element.setAttribute('data-id', comp.id);
                        element.setAttribute('data-x', 0);
                        element.setAttribute('data-y', 0);
                        
                        const label = document.createElement('div');
                        label.className = 'component-label';
                        label.textContent = comp.tag;
                        
                        const details = document.createElement('div');
                        details.className = 'component-details-small';
                        details.textContent = comp.details;
                        
                        element.appendChild(label);
                        element.appendChild(details);
                        layoutGrid.appendChild(element);
                    });
                    
                    // Re-initialize drag and drop
                    setTimeout(() => this.setupDragAndDrop(), 100);
                },
                
                arrangeComponents() {
                    // Simple auto-arrangement algorithm
                    const margin = 20;
                    let x = margin;
                    let y = margin;
                    let maxHeightInRow = 0;
                    
                    this.layoutComponents.forEach(comp => {
                        if (x + comp.width > this.cabinetDimensions.width - margin) {
                            x = margin;
                            y += maxHeightInRow + margin;
                            maxHeightInRow = 0;
                        }
                        
                        comp.x = x;
                        comp.y = y;
                        
                        x += comp.width + margin;
                        maxHeightInRow = Math.max(maxHeightInRow, comp.height);
                    });
                    
                    this.renderLayout();
                },
                
                clearLayout() {
                    if (confirm('Are you sure you want to clear the layout?')) {
                        this.layoutComponents = [];
                        this.renderLayout();
                    }
                },
                
                updateGrid() {
                    this.renderLayout();
                },
                
                updateCabinet() {
                    this.cabinetSize = `${this.cabinetDimensions.width}x${this.cabinetDimensions.height}x${this.cabinetDimensions.depth}mm`;
                    this.renderLayout();
                },
                
                // Wiring Management
                generateWiringDiagram() {
                    // Calculate wire lengths
                    this.wireLengths.control = Math.ceil(this.bom.length * 2.5);
                    this.wireLengths.power = Math.ceil(this.motors.reduce((sum, m) => sum + m.quantity * parseFloat(m.power) * 0.5, 0));
                    this.wireLengths.signal = Math.ceil(this.sensors.reduce((sum, s) => sum + s.quantity * 3, 0));
                    this.wireLengths.total = this.wireLengths.control + this.wireLengths.power + this.wireLengths.signal;
                    this.wireLength = this.wireLengths.total;
                    
                    // Generate wiring connections
                    this.wiringConnections = [];
                    let terminalCounter = 1;
                    
                    // Generate connections for motors
                    this.motors.forEach(motor => {
                        for (let i = 0; i < motor.quantity; i++) {
                            this.wiringConnections.push({
                                id: Date.now() + i,
                                terminal: `TB${terminalCounter++}`,
                                from: { component: `MCB${motor.id}`, terminal: 'L1,L2,L3' },
                                to: { component: `KM${motor.id}`, terminal: '1,3,5' },
                                wireType: 'Power',
                                wireSize: this.calculateWireSize(parseFloat(motor.power)),
                                color: '#000000',
                                colorName: 'Black',
                                length: Math.ceil(parseFloat(motor.power) * 0.5 + 2),
                                ferrule: '2.5-4mmÂ²'
                            });
                        }
                    });
                    
                    // Generate connections for sensors
                    this.sensors.forEach(sensor => {
                        for (let i = 0; i < sensor.quantity; i++) {
                            this.wiringConnections.push({
                                id: Date.now() + i + 1000,
                                terminal: `TB${terminalCounter++}`,
                                from: { component: sensor.name + ' ' + (i+1), terminal: 'Signal+' },
                                to: { component: 'PLC', terminal: 'AI' + (this.wiringConnections.filter(c => c.wireType === 'Signal').length + 1) },
                                wireType: 'Signal',
                                wireSize: '0.75',
                                color: '#008000',
                                colorName: 'Green',
                                length: 5,
                                ferrule: '0.75mmÂ²'
                            });
                        }
                    });
                },
                
                calculateWireSize(power) {
                    // Simplified wire size calculation
                    const current = power * 1.8; // Approximate current for 400V 3-phase
                    if (current <= 10) return '1.5';
                    if (current <= 16) return '2.5';
                    if (current <= 25) return '4';
                    if (current <= 32) return '6';
                    if (current <= 40) return '10';
                    return '16';
                },
                
                // PLC Code Generation
                generatePLCCode() {
                    const codeElement = document.getElementById('plcCode');
                    if (!codeElement) return;
                    
                    let code = '';
                    
                    if (this.plcConfig.plcType === 'siemens') {
                        code = `// Siemens S7-1200/1500 Control Program
// Project: ${this.projectName}
// Generated: ${new Date().toLocaleString()}
// Template: ${this.selectedTemplate}

PROGRAM Main
VAR
    // System Status
    SystemRunning : BOOL;
    SystemFault : BOOL;
    EmergencyStop : BOOL;
    AutoMode : BOOL;
    
    // Motor Control
    Fan1_Run : BOOL;
    Fan2_Run : BOOL;
    Pump_Run : BOOL;
    DustFans_Run : ARRAY[1..4] OF BOOL;
    
    // Damper Control
    FreshDamper1_Pos : REAL;
    FreshDamper2_Pos : REAL;
    ExhaustDamper1_Pos : REAL;
    ExhaustDamper2_Pos : REAL;
    ReturnDamper_Pos : REAL;
    
    // Sensor Values
    OutdoorTemp : REAL;
    OutdoorHumidity : REAL;
    SaloonTemp : REAL;
    SaloonHumidity : REAL;
    
    // Control Parameters
    TargetTemp : REAL := 22.0;
    TargetHumidity : REAL := 65.0;
    ExhaustPercentage : REAL := 30.0;
    
    // Internal Variables
    CycleAirTemp : REAL;
    MixedAirTemp : REAL;
    FeedAirTemp : REAL;
    FeedAirHumidity : REAL;
    
    // Timers
    StartupTimer : TON;
    FanRampTimer : TON;
    AlarmTimer : TON;
END_VAR

BEGIN
    // Emergency Stop Logic
    EmergencyStop := NOT "EmergencyStop1" OR NOT "EmergencyStop2";
    
    IF EmergencyStop THEN
        SystemRunning := FALSE;
        SystemFault := TRUE;
        // Stop all outputs
        #Fan1_Run := FALSE;
        #Fan2_Run := FALSE;
        #Pump_Run := FALSE;
        FOR i := 1 TO 4 DO
            #DustFans_Run[i] := FALSE;
        END_FOR;
        RETURN;
    END_IF;
    
    // Startup Sequence
    IF NOT SystemRunning AND "StartButton" THEN
        SystemRunning := TRUE;
        SystemFault := FALSE;
        StartupTimer(IN:=TRUE, PT:=T#5S);
    END_IF;
    
    IF StartupTimer.Q THEN
        // Close all dampers initially
        FreshDamper1_Pos := 0.0;
        FreshDamper2_Pos := 0.0;
        ExhaustDamper1_Pos := 0.0;
        ExhaustDamper2_Pos := 0.0;
        ReturnDamper_Pos := 100.0;
        
        // Start fans at 10% speed
        Fan1_Run := TRUE;
        Fan2_Run := TRUE;
        "Fan1_Speed" := 10.0;
        "Fan2_Speed" := 10.0;
        
        // Start ramp up
        FanRampTimer(IN:=TRUE, PT:=T#30S);
    END_IF;
    
    IF FanRampTimer.Q THEN
        // Ramp up to operating speed
        "Fan1_Speed" := 100.0;
        "Fan2_Speed" := 100.0;
        
        // Open fresh air damper
        FreshDamper1_Pos := ExhaustPercentage;
        FreshDamper2_Pos := ExhaustPercentage;
        ExhaustDamper1_Pos := ExhaustPercentage;
        ExhaustDamper2_Pos := ExhaustPercentage;
        
        // Start water pump if needed
        IF SaloonHumidity < TargetHumidity THEN
            Pump_Run := TRUE;
        END_IF;
        
        // Start dust fans
        FOR i := 1 TO 4 DO
            DustFans_Run[i] := TRUE;
        END_FOR;
    END_IF;
    
    // Temperature Control Algorithm
    OutdoorTemp := "OutdoorTemp_AI";
    OutdoorHumidity := "OutdoorHumidity_AI";
    SaloonTemp := "SaloonTemp_AI";
    SaloonHumidity := "SaloonHumidity_AI";
    
    // Calculate cycle air temperature
    IF "HeaterValve" THEN
        CycleAirTemp := SaloonTemp + 5.0; // Heating constant
    ELSE
        CycleAirTemp := SaloonTemp;
    END_IF;
    
    // Calculate mixed air temperature
    MixedAirTemp := (OutdoorTemp * ExhaustPercentage/100.0) + 
                    (CycleAirTemp * (100.0 - ExhaustPercentage)/100.0);
    
    // Calculate feed air conditions
    IF Pump_Run THEN
        // Evaporative cooling effect
        FeedAirTemp := MixedAirTemp - 3.0; // Approximate cooling
        FeedAirHumidity := MIN(SaloonHumidity + 20.0, 85.0);
    ELSE
        FeedAirTemp := MixedAirTemp;
        FeedAirHumidity := SaloonHumidity;
    END_IF;
    
    // Control logic based on temperature difference
    IF SaloonTemp > TargetTemp + 2.0 THEN
        ExhaustPercentage := MIN(ExhaustPercentage + 5.0, 100.0);
    ELSIF SaloonTemp < TargetTemp - 2.0 THEN
        ExhaustPercentage := MAX(ExhaustPercentage - 5.0, 0.0);
    END_IF;
    
    // Humidity control
    IF SaloonHumidity < TargetHumidity - 5.0 THEN
        Pump_Run := TRUE;
    ELSIF SaloonHumidity > TargetHumidity + 5.0 THEN
        Pump_Run := FALSE;
    END_IF;
    
    // Alarm Logic
    IF SaloonTemp > 40.0 OR SaloonTemp < 10.0 THEN
        SystemFault := TRUE;
        AlarmTimer(IN:=TRUE, PT:=T#2S);
    END_IF;
    
    IF AlarmTimer.Q THEN
        "AlarmBuzzer" := SystemFault;
    END_IF;
    
    // Map to physical outputs
    "Fan1_Contactor" := Fan1_Run;
    "Fan2_Contactor" := Fan2_Run;
    "Pump_Contactor" := Pump_Run;
    
    FOR i := 1 TO 4 DO
        "DustFan" + INT_TO_STRING(i) + "_Contactor" := DustFans_Run[i];
    END_FOR;
    
    "FreshDamper1_AO" := FreshDamper1_Pos;
    "FreshDamper2_AO" := FreshDamper2_Pos;
    "ExhaustDamper1_AO" := ExhaustDamper1_Pos;
    "ExhaustDamper2_AO" := ExhaustDamper2_Pos;
    
    "PowerLED" := SystemRunning;
    "RunLED" := SystemRunning AND NOT SystemFault;
    "FaultLED" := SystemFault;
END_PROGRAM`;
                    } else if (this.plcConfig.plcType === 'allen_bradley') {
                        // Allen-Bradley code template
                        code = `// Allen-Bradley ControlLogix/CompactLogix Program
// Project: ${this.projectName}`;
                    } else {
                        // Generic CODESYS code
                        code = `// CODESYS IEC 61131-3 Program
// Project: ${this.projectName}`;
                    }
                    
                    codeElement.textContent = code;
                    
                    // Add syntax highlighting
                    this.highlightCode(codeElement);
                },
                
                highlightCode(element) {
                    const code = element.textContent;
                    let highlighted = code
                        .replace(/\/\/.*$/gm, '<span class="code-comment">$&</span>')
                        .replace(/\b(IF|THEN|ELSE|END_IF|FOR|TO|DO|END_FOR|VAR|END_VAR|PROGRAM|BEGIN|END_PROGRAM|REAL|BOOL|ARRAY|OF|TON|NOT|OR|AND|RETURN)\b/g, '<span class="code-keyword">$1</span>')
                        .replace(/"(.*?)"/g, '<span class="code-string">"$1"</span>')
                        .replace(/\b(\d+\.?\d*)\b/g, '<span class="code-number">$1</span>')
                        .replace(/\b([A-Z][A-Z0-9_]*)\b/g, '<span class="code-function">$1</span>');
                    
                    element.innerHTML = highlighted;
                },
                
                downloadCode() {
                    const codeElement = document.getElementById('plcCode');
                    if (!codeElement) return;
                    
                    const code = codeElement.textContent;
                    const blob = new Blob([code], { type: 'text/plain' });
                    const url = URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = `${this.projectName.replace(/\s+/g, '_')}_PLC_Program.${this.plcConfig.plcType === 'siemens' ? 'sc1' : 'txt'}`;
                    document.body.appendChild(a);
                    a.click();
                    document.body.removeChild(a);
                    URL.revokeObjectURL(url);
                },
                
                // Simulation Functions
                startSimulation() {
                    if (this.simulation.running) return;
                    
                    this.simulation.running = true;
                    this.simulation.time = 0;
                    
                    this.simulation.interval = setInterval(() => {
                        this.simulation.time += 1;
                        this.updateSimulation();
                    }, 1000);
                },
                
                stopSimulation() {
                    if (!this.simulation.running) return;
                    
                    this.simulation.running = false;
                    clearInterval(this.simulation.interval);
                },
                
                resetSimulation() {
                    this.stopSimulation();
                    this.simulation = {
                        running: false,
                        interval: null,
                        time: 0,
                        outdoorTemp: 25,
                        outdoorHumidity: 60,
                        saloonTemp: 22,
                        exhaustDamper: 30,
                        freshDamper: 30,
                        waterPump: true,
                        heaterValve: false
                    };
                    
                    this.updateSimulation();
                },
                
                updateSimulation() {
                    // Calculate simulation results based on inputs
                    const exhaustPercentage = this.simulation.exhaustDamper / 100;
                    const freshPercentage = this.simulation.freshDamper / 100;
                    
                    // Calculate cycle air temperature
                    let cycleTemp = this.simulation.saloonTemp;
                    if (this.simulation.heaterValve) {
                        cycleTemp += 5.0; // Heating effect
                    }
                    
                    // Calculate mixed air temperature
                    const mixedTemp = (this.simulation.outdoorTemp * freshPercentage) + 
                                     (cycleTemp * (1 - freshPercentage));
                    
                    // Calculate feed air conditions
                    let feedTemp = mixedTemp;
                    let feedHumidity = this.simulation.saloonHumidity;
                    
                    if (this.simulation.waterPump) {
                        // Evaporative cooling effect
                        feedTemp = mixedTemp - 3.0;
                        feedHumidity = Math.min(this.simulation.saloonHumidity + 20, 85);
                    }
                    
                    // Calculate system efficiency
                    const tempDiff = Math.abs(this.simulation.saloonTemp - 22); // Target 22Â°C
                    const efficiency = Math.max(0, 100 - tempDiff * 5);
                    
                    // Update results
                    this.simulationResults = {
                        feedTemp: Math.round(feedTemp * 10) / 10,
                        feedHumidity: Math.round(feedHumidity),
                        cycleTemp: Math.round(cycleTemp * 10) / 10,
                        mixedTemp: Math.round(mixedTemp * 10) / 10,
                        efficiency: Math.round(efficiency),
                        fanSpeed: Math.min(100, Math.round(70 + this.simulation.exhaustDamper * 0.3)),
                        waterFlow: this.simulation.waterPump ? 45 : 0,
                        power: Math.round((this.motors.reduce((sum, m) => sum + m.quantity * parseFloat(m.power), 0) * 0.7) * 10) / 10
                    };
                },
                
                simulateScenario() {
                    this.activeTab = 'simulation';
                    this.startSimulation();
                },
                
                // Export Functions
                exportBOM(format) {
                    let content = '';
                    let mimeType = '';
                    let filename = `${this.projectName.replace(/\s+/g, '_')}_BOM`;
                    
                    if (format === 'csv') {
                        mimeType = 'text/csv';
                        filename += '.csv';
                        
                        // CSV header
                        content = 'Item #,Component,Part No.,Quantity,Specifications,Standards,Unit Price (â‚¬),Total (â‚¬),Tags\n';
                        
                        // CSV rows
                        this.bom.forEach((item, index) => {
                            const tags = item.tags.join(';');
                            const total = (item.unitPrice * item.quantity).toFixed(2);
                            content += `${index + 1},"${item.name}","${item.partNumber}",${item.quantity},"${item.specifications}","${item.standards}",${item.unitPrice},${total},"${tags}"\n`;
                        });
                    } else if (format === 'excel') {
                        // Create HTML table for Excel
                        mimeType = 'application/vnd.ms-excel';
                        filename += '.xls';
                        
                        content = `<html xmlns:o="urn:schemas-microsoft-com:office:office" xmlns:x="urn:schemas-microsoft-com:office:excel">
                            <head><meta charset="UTF-8"></head>
                            <body>
                            <table border="1">
                                <tr>
                                    <th>Item #</th><th>Component</th><th>Part No.</th><th>Quantity</th>
                                    <th>Specifications</th><th>Standards</th><th>Unit Price (â‚¬)</th>
                                    <th>Total (â‚¬)</th><th>Tags</th>
                                </tr>`;
                        
                        this.bom.forEach((item, index) => {
                            const tags = item.tags.join(', ');
                            const total = (item.unitPrice * item.quantity).toFixed(2);
                            content += `<tr>
                                <td>${index + 1}</td><td>${item.name}</td><td>${item.partNumber}</td>
                                <td>${item.quantity}</td><td>${item.specifications}</td><td>${item.standards}</td>
                                <td>${item.unitPrice}</td><td>${total}</td><td>${tags}</td>
                            </tr>`;
                        });
                        
                        content += `</table></body></html>`;
                    } else if (format === 'pdf') {
                        // For PDF, we'll use the browser's print function
                        this.printBOM();
                        return;
                    }
                    
                    // Download file
                    const blob = new Blob([content], { type: mimeType });
                    const url = URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = filename;
                    document.body.appendChild(a);
                    a.click();
                    document.body.removeChild(a);
                    URL.revokeObjectURL(url);
                },
                
                printBOM() {
                    const printWindow = window.open('', '_blank');
                    printWindow.document.write(`
                        <html>
                            <head>
                                <title>${this.projectName} - BOM</title>
                                <style>
                                    body { font-family: Arial, sans-serif; margin: 20px; }
                                    table { width: 100%; border-collapse: collapse; margin-top: 20px; }
                                    th, td { border: 1px solid #000; padding: 8px; text-align: left; }
                                    th { background-color: #f2f2f2; }
                                    .total { font-weight: bold; text-align: right; }
                                </style>
                            </head>
                            <body>
                                <h1>${this.projectName}</h1>
                                <h2>Bill of Materials</h2>
                                <p>Generated: ${new Date().toLocaleDateString()}</p>
                                <table>
                                    <thead>
                                        <tr>
                                            <th>Item #</th><th>Component</th><th>Part No.</th><th>Quantity</th>
                                            <th>Specifications</th><th>Standards</th><th>Unit Price (â‚¬)</th>
                                            <th>Total (â‚¬)</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        ${this.bom.map((item, index) => `
                                            <tr>
                                                <td>${index + 1}</td>
                                                <td>${item.name}</td>
                                                <td>${item.partNumber}</td>
                                                <td>${item.quantity}</td>
                                                <td>${item.specifications}</td>
                                                <td>${item.standards}</td>
                                                <td>${item.unitPrice.toFixed(2)}</td>
                                                <td>${(item.unitPrice * item.quantity).toFixed(2)}</td>
                                            </tr>
                                        `).join('')}
                                    </tbody>
                                    <tfoot>
                                        <tr>
                                            <td colspan="7" class="total">Total Cost:</td>
                                            <td class="total">â‚¬${this.totalCost.toLocaleString()}</td>
                                        </tr>
                                    </tfoot>
                                </table>
                            </body>
                        </html>
                    `);
                    printWindow.document.close();
                    printWindow.print();
                },
                
                exportLayout(format) {
                    const layoutCanvas = document.getElementById('layoutCanvas');
                    if (!layoutCanvas) return;
                    
                    if (format === 'png') {
                        html2canvas(layoutCanvas).then(canvas => {
                            const link = document.createElement('a');
                            link.download = `${this.projectName.replace(/\s+/g, '_')}_Layout.png`;
                            link.href = canvas.toDataURL('image/png');
                            link.click();
                        });
                    }
                },
                
                generateDocumentation() {
                    // Generate comprehensive documentation
                    const doc = {
                        project: this.projectName,
                        template: this.selectedTemplate,
                        date: new Date().toLocaleString(),
                        bom: this.bom,
                        iolists: {
                            digitalInputs: this.digitalInputs,
                            digitalOutputs: this.digitalOutputs,
                            analogInputs: this.analogInputs,
                            analogOutputs: this.analogOutputs
                        },
                        systemConfig: this.systemConfig,
                        totalCost: this.totalCost
                    };
                    
                    const content = JSON.stringify(doc, null, 2);
                    const blob = new Blob([content], { type: 'application/json' });
                    const url = URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = `${this.projectName.replace(/\s+/g, '_')}_Documentation.json`;
                    document.body.appendChild(a);
                    a.click();
                    document.body.removeChild(a);
                    URL.revokeObjectURL(url);
                },
                
                exportDocumentation() {
                    // Export all documentation as a zip file
                    const zip = new JSZip();
                    
                    // Add BOM
                    let bomCsv = 'Item #,Component,Part No.,Quantity,Specifications,Standards,Unit Price (â‚¬),Total (â‚¬),Tags\n';
                    this.bom.forEach((item, index) => {
                        const tags = item.tags.join(';');
                        const total = (item.unitPrice * item.quantity).toFixed(2);
                        bomCsv += `${index + 1},"${item.name}","${item.partNumber}",${item.quantity},"${item.specifications}","${item.standards}",${item.unitPrice},${total},"${tags}"\n`;
                    });
                    zip.file('BOM.csv', bomCsv);
                    
                    // Add I/O Lists
                    const ioList = {
                        digitalInputs: this.digitalInputs,
                        digitalOutputs: this.digitalOutputs,
                        analogInputs: this.analogInputs,
                        analogOutputs: this.analogOutputs
                    };
                    zip.file('IO_Lists.json', JSON.stringify(ioList, null, 2));
                    
                    // Add PLC Code
                    const codeElement = document.getElementById('plcCode');
                    if (codeElement) {
                        zip.file('PLC_Program.txt', codeElement.textContent);
                    }
                    
                    // Add Project Summary
                    const summary = {
                        projectName: this.projectName,
                        template: this.selectedTemplate,
                        cabinetSize: this.cabinetSize,
                        totalComponents: this.bom.length,
                        totalCost: this.totalCost,
                        generated: new Date().toLocaleString()
                    };
                    zip.file('Project_Summary.json', JSON.stringify(summary, null, 2));
                    
                    // Generate and download zip
                    zip.generateAsync({ type: 'blob' }).then(content => {
                        saveAs(content, `${this.projectName.replace(/\s+/g, '_')}_Project_Files.zip`);
                    });
                },
                
                // Project Management
                saveProjectState() {
                    const state = {
                        projectName: this.projectName,
                        selectedTemplate: this.selectedTemplate,
                        systemConfig: this.systemConfig,
                        motors: this.motors,
                        actuators: this.actuators,
                        sensors: this.sensors,
                        optionalComponents: this.optionalComponents,
                        bom: this.bom,
                        layoutComponents: this.layoutComponents,
                        totalCost: this.totalCost,
                        lastSaved: new Date().toISOString()
                    };
                    
                    localStorage.setItem('plcDesignerProject', JSON.stringify(state));
                },
                
                loadProjectState() {
                    const saved = localStorage.getItem('plcDesignerProject');
                    if (saved) {
                        try {
                            const state = JSON.parse(saved);
                            Object.assign(this, state);
                            this.filterComponents();
                            this.calculateBOM();
                            this.renderLayout();
                        } catch (e) {
                            console.error('Error loading project:', e);
                        }
                    }
                },
                
                saveProject() {
                    this.showModal('saveProject');
                },
                
                loadProject() {
                    document.getElementById('fileInput').click();
                },
                
                loadProjectFile(event) {
                    const file = event.target.files[0];
                    if (!file) return;
                    
                    const reader = new FileReader();
                    reader.onload = (e) => {
                        try {
                            const state = JSON.parse(e.target.result);
                            Object.assign(this, state);
                            this.filterComponents();
                            this.calculateBOM();
                            this.renderLayout();
                            this.generatePLCCode();
                            alert('Project loaded successfully!');
                        } catch (error) {
                            alert('Error loading project: ' + error.message);
                        }
                    };
                    reader.readAsText(file);
                    event.target.value = '';
                },
                
                // Modal Management
                showModal(modalName) {
                    this.activeModal = modalName;
                },
                
                closeModal() {
                    this.activeModal = null;
                },
                
                closeModals() {
                    this.activeModal = null;
                },
                
                // Drag and Drop
                dragStart(event, component) {
                    event.dataTransfer.setData('text/plain', JSON.stringify(component));
                    event.dataTransfer.effectAllowed = 'copy';
                },
                
                // BOM Item Management
                updateBOMQuantity(item, delta) {
                    const newQuantity = item.quantity + delta;
                    if (newQuantity >= 0) {
                        item.quantity = newQuantity;
                        this.calculateBOM();
                    }
                },
                
                editBOMItem(item) {
                    // Show edit dialog
                    const newName = prompt('Edit component name:', item.name);
                    if (newName !== null) {
                        item.name = newName;
                        this.calculateBOM();
                    }
                },
                
                removeBOMItem(item) {
                    if (confirm(`Remove ${item.name} from BOM?`)) {
                        const index = this.bom.indexOf(item);
                        if (index > -1) {
                            this.bom.splice(index, 1);
                            this.calculateBOM();
                        }
                    }
                },
                
                showComponentDetails(component) {
                    alert(`Component: ${component.name}\nSpecification: ${component.spec}\nStatus: ${component.status}`);
                }
            };
        }
        
        // Initialize the application
        document.addEventListener('alpine:init', () => {
            Alpine.data('plcDesigner', plcDesigner);
        });
    </script>
</body>
</html>