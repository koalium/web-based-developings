<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Advanced Nuclear Reactor Simulator</title>
    <script src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root {
            --primary: #1a365d;
            --secondary: #2d3748;
            --accent: #3182ce;
            --danger: #e53e3e;
            --warning: #dd6b20;
            --success: #38a169;
            --light: #f7fafc;
            --dark: #1a202c;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, var(--dark) 0%, var(--primary) 100%);
            color: var(--light);
            min-height: 100vh;
            padding: 20px;
            line-height: 1.6;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
        }
        
        header {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        }
        
        h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            background: linear-gradient(90deg, var(--accent), var(--success));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        
        .subtitle {
            font-size: 1.2rem;
            opacity: 0.8;
        }
        
        .dashboard {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }
        
        @media (max-width: 1100px) {
            .dashboard {
                grid-template-columns: 1fr;
            }
        }
        
        .panel {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
            margin-bottom: 20px;
        }
        
        .panel-title {
            font-size: 1.5rem;
            margin-bottom: 15px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            padding-bottom: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .status-indicator {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 8px;
        }
        
        .status-critical { background-color: var(--danger); }
        .status-warning { background-color: var(--warning); }
        .status-normal { background-color: var(--success); }
        .status-offline { background-color: #718096; }
        
        .controls {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .control-group {
            margin-bottom: 15px;
        }
        
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
        }
        
        input, select {
            width: 100%;
            padding: 10px;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 5px;
            color: white;
        }
        
        input[type="range"] {
            -webkit-appearance: none;
            height: 8px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 5px;
        }
        
        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 20px;
            height: 20px;
            background: var(--accent);
            border-radius: 50%;
            cursor: pointer;
        }
        
        button {
            padding: 12px 20px;
            background: var(--accent);
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
        }
        
        button:hover {
            background: #2c5aa0;
            transform: translateY(-2px);
        }
        
        button.danger {
            background: var(--danger);
        }
        
        button.danger:hover {
            background: #c53030;
        }
        
        button.success {
            background: var(--success);
        }
        
        button.success:hover {
            background: #2f855a;
        }
        
        .value-display {
            display: flex;
            justify-content: space-between;
            margin-bottom: 15px;
            padding: 10px;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 5px;
        }
        
        .value-label {
            font-weight: 500;
        }
        
        .value {
            font-weight: 700;
            color: var(--accent);
        }
        
        .chart-container {
            position: relative;
            height: 300px;
            margin-bottom: 20px;
        }
        
        .log {
            max-height: 200px;
            overflow-y: auto;
            font-family: monospace;
            font-size: 0.85em;
            background: rgba(0, 0, 0, 0.3);
            padding: 10px;
            border-radius: 5px;
            margin-top: 10px;
        }
        
        .log-entry {
            margin-bottom: 5px;
            padding: 5px;
            border-left: 3px solid var(--accent);
        }
        
        .log-warning {
            border-left-color: var(--warning);
            color: var(--warning);
        }
        
        .log-critical {
            border-left-color: var(--danger);
            color: var(--danger);
            font-weight: bold;
        }
        
        .thermal-map {
            display: grid;
            grid-template-columns: repeat(10, 1fr);
            gap: 2px;
            margin: 15px 0;
        }
        
        .rod-cell {
            width: 30px;
            height: 30px;
            border-radius: 3px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.7rem;
            font-weight: bold;
        }
        
        .tabs {
            display: flex;
            margin-bottom: 20px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            flex-wrap: wrap;
        }
        
        .tab {
            padding: 10px 20px;
            cursor: pointer;
            border-bottom: 3px solid transparent;
            transition: all 0.3s ease;
        }
        
        .tab.active {
            border-bottom: 3px solid var(--accent);
            color: var(--accent);
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        .grid-2 {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }
        
        .grid-3 {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 20px;
        }
        
        .data-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 10px;
            font-size: 0.9rem;
        }
        
        .data-table th, .data-table td {
            padding: 10px;
            text-align: left;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .data-table th {
            background: rgba(0, 0, 0, 0.2);
            font-weight: 600;
        }
        
        .progress-bar {
            height: 10px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 5px;
            overflow: hidden;
            margin-top: 5px;
        }
        
        .progress-fill {
            height: 100%;
            background: var(--accent);
            transition: width 0.5s ease;
        }
        
        @media (max-width: 768px) {
            .grid-2, .grid-3 {
                grid-template-columns: 1fr;
            }
            
            .tabs {
                overflow-x: auto;
            }
            
            h1 {
                font-size: 2rem;
            }
        }
    </style>
</head>
<body>
    <div class="container" x-data="reactorSimulator()" x-init="init()">
        <header>
            <h1>Advanced Nuclear Reactor Simulator</h1>
            <p class="subtitle">High-fidelity simulation with comprehensive physics modeling</p>
        </header>
        
        <div class="dashboard">
            <div class="panel">
                <div class="panel-title">
                    <span>Reactor Core Status</span>
                    <span>
                        <span class="status-indicator" :class="getStatusClass()"></span>
                        <span x-text="getStatusText()"></span>
                    </span>
                </div>
                
                <div class="grid-2">
                    <div class="value-display">
                        <span class="value-label">Power Output</span>
                        <span class="value" x-text="`${power.toFixed(2)} MW`"></span>
                    </div>
                    <div class="value-display">
                        <span class="value-label">Reactivity</span>
                        <span class="value" x-text="`${(rho * 1e5).toFixed(2)} pcm`"></span>
                    </div>
                    <div class="value-display">
                        <span class="value-label">Core Temperature</span>
                        <span class="value" x-text="`${T.toFixed(1)} K`"></span>
                    </div>
                    <div class="value-display">
                        <span class="value-label">Neutron Flux</span>
                        <span class="value" x-text="`${(phi[4] / 1e16).toFixed(2)}×10¹⁶ n/m²/s`"></span>
                    </div>
                </div>
                
                <div class="chart-container">
                    <canvas x-ref="chartPower"></canvas>
                </div>
                
                <div class="controls">
                    <button @click="toggle()" :class="running ? 'danger' : 'success'" x-text="running ? 'SHUTDOWN REACTOR' : 'START REACTOR'"></button>
                    <button @click="reset()">RESET SIMULATION</button>
                    <button @click="addEvent('scram', sim_time + 5, 0, 0)">TEST SCRAM</button>
                </div>
            </div>
            
            <div class="panel">
                <div class="panel-title">
                    <span>Core Thermal Profile</span>
                    <span x-text="`Max: ${Math.max(...T_fuel).toFixed(1)} K`"></span>
                </div>
                
                <div class="thermal-map">
                    <template x-for="(T, index) in T_fuel">
                        <div class="rod-cell" 
                             :style="`background: hsl(${220 - (T-700)/10}, 100%, 50%)`"
                             :title="`Node ${index}: ${T.toFixed(1)} K`">
                            <span x-text="index === 0 ? 'C' : (index === T_fuel.length-1 ? 'S' : '')"></span>
                        </div>
                    </template>
                </div>
                
                <div class="chart-container">
                    <canvas x-ref="chartThermal"></canvas>
                </div>
                
                <div class="value-display">
                    <span class="value-label">Fuel Center Temperature</span>
                    <span class="value" x-text="`${T_fuel[0].toFixed(1)} K`"></span>
                </div>
                <div class="value-display">
                    <span class="value-label">Fuel Surface Temperature</span>
                    <span class="value" x-text="`${T_fuel[T_fuel.length-1].toFixed(1)} K`"></span>
                </div>
                <div class="value-display">
                    <span class="value-label">Coolant ΔT</span>
                    <span class="value" x-text="`${(T_coolant_out - T_coolant_in).toFixed(1)} K`"></span>
                </div>
            </div>
        </div>
        
        <div class="tabs">
            <div class="tab" :class="{ active: activeTab === 'control' }" @click="activeTab = 'control'">Control</div>
            <div class="tab" :class="{ active: activeTab === 'neutronics' }" @click="activeTab = 'neutronics'">Neutronics</div>
            <div class="tab" :class="{ active: activeTab === 'thermal' }" @click="activeTab = 'thermal'">Thermal</div>
            <div class="tab" :class="{ active: activeTab === 'fission' }" @click="activeTab = 'fission'">Fission Products</div>
            <div class="tab" :class="{ active: activeTab === 'actinides' }" @click="activeTab = 'actinides'">Actinides</div>
        </div>
        
        <div class="tab-content" :class="{ active: activeTab === 'control' }">
            <div class="grid-2">
                <div class="panel">
                    <div class="panel-title">Reactor Control</div>
                    
                    <div class="control-group">
                        <label>Target Power (MW)</label>
                        <input type="range" min="0" max="4000" step="10" x-model.number="target_power">
                        <span x-text="`${target_power} MW`"></span>
                    </div>
                    
                    <div class="control-group">
                        <label>Control Rod Insertion</label>
                        <input type="range" min="0" max="1" step="0.01" x-model.number="control_rod_insertion">
                        <span x-text="`${(control_rod_insertion * 100).toFixed(1)}%`"></span>
                    </div>
                    
                    <div class="control-group">
                        <label>Coolant Flow Rate (kg/s)</label>
                        <input type="range" min="5000" max="25000" step="100" x-model.number="coolant_flow_rate">
                        <span x-text="`${coolant_flow_rate} kg/s`"></span>
                    </div>
                    
                    <div class="control-group">
                        <label>Fuel Type</label>
                        <select x-model="fuel_type">
                            <option value="uranium">Uranium Dioxide (UO₂)</option>
                            <option value="mixed_oxide">Mixed Oxide (MOX)</option>
                            <option value="thorium">Thorium (Th)</option>
                        </select>
                    </div>
                </div>
                
                <div class="panel">
                    <div class="panel-title">Transient Events</div>
                    
                    <div class="control-group">
                        <label>Event Type</label>
                        <select x-model="new_event_type">
                            <option value="rod_insert">Control Rod Insertion</option>
                            <option value="rod_withdraw">Control Rod Withdrawal</option>
                            <option value="power_demand">Power Demand Change</option>
                            <option value="coolant_loss">Coolant Flow Reduction</option>
                            <option value="scram">Emergency Shutdown (SCRAM)</option>
                        </select>
                    </div>
                    
                    <div class="control-group">
                        <label>Start Time (s)</label>
                        <input type="number" x-model.number="new_start" min="0" step="1">
                    </div>
                    
                    <div class="control-group">
                        <label>Duration (s)</label>
                        <input type="number" x-model.number="new_duration" min="0" step="0.1">
                    </div>
                    
                    <div class="control-group">
                        <label>Value</label>
                        <input type="number" x-model.number="new_value" step="0.01">
                    </div>
                    
                    <button @click="addEvent(new_event_type, new_start, new_duration, new_value)">Schedule Event</button>
                    
                    <div class="log">
                        <template x-for="event in transient_events">
                            <div class="log-entry" :class="{'log-warning': event.active}">
                                <span x-text="`${event.type} @ t=${event.start.toFixed(1)}s [${event.active ? 'ACTIVE' : 'PENDING'}]`"></span>
                                <button @click="removeEvent(event.id)">Remove</button>
                            </div>
                        </template>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="tab-content" :class="{ active: activeTab === 'neutronics' }">
            <div class="grid-2">
                <div class="panel">
                    <div class="panel-title">Neutron Flux by Energy Group</div>
                    <div class="chart-container">
                        <canvas x-ref="chartFlux"></canvas>
                    </div>
                </div>
                
                <div class="panel">
                    <div class="panel-title">Neutron Kinetics Parameters</div>
                    
                    <div class="value-display">
                        <span class="value-label">Effective Multiplication Factor (k-eff)</span>
                        <span class="value" x-text="k_eff.toFixed(5)"></span>
                    </div>
                    
                    <div class="value-display">
                        <span class="value-label">Neutron Generation Time (Λ)</span>
                        <span class="value" x-text="`${(Lambda * 1e6).toFixed(2)} μs`"></span>
                    </div>
                    
                    <div class="value-display">
                        <span class="value-label">Delayed Neutron Fraction (β)</span>
                        <span class="value" x-text="beta_total.toFixed(5)"></span>
                    </div>
                    
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Energy Group</th>
                                <th>Flux (n/m²/s)</th>
                                <th>Macro Absorption (1/m)</th>
                                <th>Macro Fission (1/m)</th>
                            </tr>
                        </thead>
                        <tbody>
                            <template x-for="(flux, g) in phi">
                                <tr>
                                    <td x-text="g+1"></td>
                                    <td x-text="flux.toExponential(2)"></td>
                                    <td x-text="Sigma_a[g].toExponential(2)"></td>
                                    <td x-text="nu_Sigma_f[g].toExponential(2)"></td>
                                </tr>
                            </template>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
        
        <div class="tab-content" :class="{ active: activeTab === 'fission' }">
            <div class="grid-2">
                <div class="panel">
                    <div class="panel-title">Fission Product Inventory</div>
                    
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Nuclide</th>
                                <th>Mass (kg)</th>
                                <th>Activity (Bq)</th>
                                <th>Decay Heat (W)</th>
                            </tr>
                        </thead>
                        <tbody>
                            <template x-for="(fp, key) in fp_inventory">
                                <tr>
                                    <td x-text="key"></td>
                                    <td x-text="fp.mass.toFixed(6)"></td>
                                    <td x-text="formatSci(fp.activity)"></td>
                                    <td x-text="fp.decay_heat.toFixed(3)"></td>
                                </tr>
                            </template>
                        </tbody>
                    </table>
                </div>
                
                <div class="panel">
                    <div class="panel-title">Xenon-135 & Samarium-149</div>
                    <div class="chart-container">
                        <canvas x-ref="chartPoisons"></canvas>
                    </div>
                    
                    <div class="value-display">
                        <span class="value-label">Xe-135 Reactivity Worth</span>
                        <span class="value" x-text="`${(xe_worth * 1e5).toFixed(2)} pcm`"></span>
                    </div>
                    
                    <div class="value-display">
                        <span class="value-label">Xe-135 Equilibrium Time</span>
                        <span class="value" x-text="`${xe_equilibrium.toFixed(1)} h`"></span>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="tab-content" :class="{ active: activeTab === 'actinides' }">
            <div class="grid-2">
                <div class="panel">
                    <div class="panel-title">Actinide Inventory</div>
                    
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Nuclide</th>
                                <th>Mass (kg)</th>
                                <th>Activity (Bq)</th>
                                <th>Decay Heat (W)</th>
                                <th>Half-Life</th>
                            </tr>
                        </thead>
                        <tbody>
                            <template x-for="(act, key) in actinide_inventory">
                                <tr>
                                    <td x-text="key"></td>
                                    <td x-text="act.mass.toFixed(6)"></td>
                                    <td x-text="formatSci(act.activity)"></td>
                                    <td x-text="act.decay_heat.toFixed(3)"></td>
                                    <td x-text="formatHalfLife(act.half_life)"></td>
                                </tr>
                            </template>
                        </tbody>
                    </table>
                </div>
                
                <div class="panel">
                    <div class="panel-title">Actinide Buildup</div>
                    <div class="chart-container">
                        <canvas x-ref="chartActinides"></canvas>
                    </div>
                    
                    <div class="value-display">
                        <span class="value-label">Fuel Burnup</span>
                        <span class="value" x-text="`${burnup.toFixed(2)} MWd/kgU`"></span>
                    </div>
                    
                    <div class="value-display">
                        <span class="value-label">Plutonium Production</span>
                        <span class="value" x-text="`${actinide_inventory['Pu-239'].mass.toFixed(4)} kg`"></span>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="panel">
            <div class="panel-title">Event Log</div>
            <div class="log" x-ref="log">
                <template x-for="entry in log_entries">
                    <div class="log-entry" :class="{'log-warning': entry.type === 'warning', 'log-critical': entry.type === 'critical'}">
                        <span x-text="entry.text"></span>
                    </div>
                </template>
            </div>
        </div>
    </div>

    <script>
        function reactorSimulator() {
            return {
                // Core state
                sim_time: 0,
                dt: 0.01,
                running: false,
                interval: null,
                activeTab: 'control',
                
                // Reactor parameters
                power: 0,
                target_power: 3000,
                rho: 0,
                k_eff: 1,
                T: 800,
                T_coolant_in: 573,
                T_coolant_out: 600,
                coolant_flow_rate: 15000,
                control_rod_insertion: 0.5,
                fuel_type: 'uranium',
                
                // Neutronics
                phi: Array(6).fill(1e10),
                C: Array.from({length: 6}, () => Array(6).fill(0)),
                Sigma_a: Array(6).fill(0),
                nu_Sigma_f: Array(6).fill(0),
                beta_total: 0.0065,
                beta_groups: [0.000215, 0.001424, 0.001274, 0.002568, 0.000748, 0.000273],
                lambda_groups: [0.0124, 0.0305, 0.111, 0.301, 1.14, 3.01],
                Lambda: 1e-4,
                
                // Thermal model
                fuel_rod_radius: 0.0041,
                cladding_thickness: 0.0006,
                radial_nodes: 12,
                dr: 0,
                r_nodes: [],
                T_fuel: [],
                q_vol: [],
                h_coolant: 45000,
                
                // Fission products
                fp_inventory: {
                    'I-135': { mass: 0, lambda: 2.88e-5, yield: 0.063, parent: null, molar_mass: 135, activity: 0, decay_heat: 0 },
                    'Xe-135': { mass: 0, lambda: 2.09e-5, yield: 0.003, parent: 'I-135', molar_mass: 135, activity: 0, decay_heat: 0 },
                    'Cs-135': { mass: 0, lambda: 7.3e-14, yield: 0, parent: 'Xe-135', molar_mass: 135, activity: 0, decay_heat: 0 },
                    'Pm-149': { mass: 0, lambda: 3.66e-6, yield: 0.011, parent: null, molar_mass: 149, activity: 0, decay_heat: 0 },
                    'Sm-149': { mass: 0, lambda: 0, yield: 0, parent: 'Pm-149', molar_mass: 149, activity: 0, decay_heat: 0 },
                },
                
                // Actinides
                actinide_inventory: {
                    'U-238': { mass: 94.5, lambda: 4.92e-18, half_life: 4.468e9 * 3.15576e7, parent: null, molar_mass: 238.05, Q_alpha: 4.27, activity: 0, decay_heat: 0 },
                    'U-235': { mass: 3.5, lambda: 3.12e-17, half_life: 7.038e8 * 3.15576e7, parent: null, molar_mass: 235.04, Q_alpha: 4.68, activity: 0, decay_heat: 0 },
                    'Th-234': { mass: 0, lambda: 3.35e-7, half_life: 24.10 * 86400, parent: 'U-238', molar_mass: 234.04, Q_beta: 0.2, activity: 0, decay_heat: 0 },
                    'Pa-234m': { mass: 0, lambda: 9.85e-3, half_life: 1.159 * 60, parent: 'Th-234', molar_mass: 234.04, Q_beta: 2.27, activity: 0, decay_heat: 0 },
                    'Pu-239': { mass: 0, lambda: 9.10e-13, half_life: 2.411e4 * 3.15576e7, parent: null, molar_mass: 239.05, Q_alpha: 5.24, activity: 0, decay_heat: 0 },
                },
                
                // Transient events
                transient_events: [],
                event_id: 0,
                new_event_type: 'rod_insert',
                new_start: 10,
                new_duration: 5,
                new_value: 0.5,
                
                // History for charts
                history: {
                    time: [],
                    power: [],
                    rho: [],
                    T_center: [],
                    T_surf: [],
                    Xe: [],
                    Pu239: [],
                    flux: [],
                    decay_heat: []
                },
                
                // Log entries
                log_entries: [],
                
                // Constants
                barn: 1e-28,
                E_f: 3.2e-11,
                N_atoms_per_kg_HM: 2.43e24,
                fuel_mass: 100000,
                core_volume: 200,
                burnup: 0,
                
                // Cross sections (simplified)
                sigma_f_u235: [0.1, 0.05, 0.01, 0.1, 582, 700],
                sigma_a_u235: [0.2, 0.1, 0.02, 0.2, 681, 800],
                sigma_f_u238: [0.01, 0.005, 0, 0, 0, 0],
                sigma_a_u238: [0.05, 0.03, 0.5, 10, 2.7, 3],
                sigma_f_pu239: [0.2, 0.1, 0.05, 0.3, 747, 850],
                sigma_a_pu239: [0.3, 0.2, 0.1, 0.5, 1018, 1200],
                sigma_a_xe135: [0, 0, 0, 1e4, 2.65e6, 3e6],
                sigma_a_sm149: [0, 0, 0, 100, 4e4, 5e4],
                sigma_a_b10: [0.1, 0.1, 1, 100, 3837, 4000],
                
                // Derived values
                xe_worth: 0,
                xe_equilibrium: 0,
                
                // Charts
                charts: {},
                
                // Initialization
                init() {
                    this.setup_thermal_mesh();
                    this.initialize_inventories();
                    this.update_macro_xs();
                    this.calculate_power();
                    this.createCharts();
                    this.addLog('Simulator initialized with high-fidelity reactor model.', 'info');
                },
                
                setup_thermal_mesh() {
                    const r_fuel = this.fuel_rod_radius;
                    const r_clad_in = r_fuel + 0.0001; // Gap
                    const r_clad_out = r_clad_in + this.cladding_thickness;
                    this.dr = r_clad_out / (this.radial_nodes - 1);
                    this.r_nodes = Array.from({length: this.radial_nodes}, (_, i) => i * this.dr);
                    this.T_fuel = Array(this.radial_nodes).fill(800);
                    this.q_vol = Array(this.radial_nodes).fill(0);
                },
                
                initialize_inventories() {
                    // Initialize neutron flux
                    this.phi[4] = 1e13 * 1e4; // Thermal group
                    for (let g = 0; g < 6; g++) {
                        this.phi[g] = this.phi[4] / (g + 1); // Rough spectrum
                    }
                    
                    // Initialize delayed neutron precursors
                    for (let dg = 0; dg < 6; dg++) {
                        for (let g = 0; g < 6; g++) {
                            this.C[dg][g] = this.beta_groups[dg] / this.Lambda * this.nu_Sigma_f[g] * this.phi[g] / this.lambda_groups[dg];
                        }
                    }
                },
                
                // Core physics calculations
                update_macro_xs() {
                    let N_HM = this.N_atoms_per_kg_HM * this.fuel_mass / this.core_volume;
                    let N_u235 = N_HM * (this.actinide_inventory['U-235'].mass / 100);
                    let N_u238 = N_HM * (this.actinide_inventory['U-238'].mass / 100);
                    let N_pu239 = N_HM * (this.actinide_inventory['Pu-239'].mass / 100);
                    
                    for (let g = 0; g < 6; g++) {
                        // Temperature-dependent cross sections
                        const doppler_factor = Math.sqrt(800 / this.T);
                        const sigma_a_u235 = this.sigma_a_u235[g] * doppler_factor;
                        const sigma_f_u235 = this.sigma_f_u235[g] * (1 - 0.0001 * (this.T - 800));
                        const sigma_a_u238 = this.sigma_a_u238[g] * doppler_factor;
                        
                        this.Sigma_a[g] = N_u235 * sigma_a_u235 * this.barn +
                                          N_u238 * sigma_a_u238 * this.barn +
                                          N_pu239 * this.sigma_a_pu239[g] * this.barn +
                                          this.fp_inventory['Xe-135'].mass * this.sigma_a_xe135[g] * this.barn +
                                          this.fp_inventory['Sm-149'].mass * this.sigma_a_sm149[g] * this.barn;
                        
                        this.nu_Sigma_f[g] = (N_u235 * sigma_f_u235 +
                                              N_pu239 * this.sigma_f_pu239[g]) * 2.43 * this.barn;
                    }
                    
                    // Control rod effect
                    let rod_vf = Math.PI * 0.005**2 * 4 / this.core_volume * this.control_rod_insertion;
                    let N_ctrl = 2.5e3 * 6.022e23 / 10.8;
                    for (let g = 0; g < 6; g++) {
                        this.Sigma_a[g] += rod_vf * N_ctrl * this.sigma_a_b10[g] * this.barn;
                    }
                },
                
                calculate_rho() {
                    let prod = this.nu_Sigma_f.reduce((a, b) => a + b, 0);
                    let abs = this.Sigma_a.reduce((a, b) => a + b, 0);
                    let k_inf = prod / abs;
                    let B2 = Math.PI**2 / 4;
                    let leak = 0.1 * B2; // Simplified leakage
                    this.k_eff = k_inf / (1 + leak);
                    this.rho = (this.k_eff - 1) / this.k_eff;
                    
                    // Feedback effects
                    this.rho += -0.00002 * (this.T - 573); // Doppler
                    this.rho += -0.0003 * this.burnup; // Burnup
                    
                    // Xenon worth
                    this.xe_worth = -0.0001 * this.fp_inventory['Xe-135'].mass;
                    this.rho += this.xe_worth;
                },
                
                calculate_power() {
                    this.power = this.E_f / 1e6 * this.core_volume * 
                                this.nu_Sigma_f.reduce((s, nf, g) => s + nf * this.phi[g], 0);
                },
                
                step_kinetics() {
                    this.update_macro_xs();
                    let dphi = Array(6).fill(0);
                    let total_prod = this.nu_Sigma_f.reduce((s, nf, g) => s + nf * this.phi[g], 0);
                    let prompt = (this.rho - this.beta_total) / this.Lambda * total_prod;
                    
                    for (let g = 0; g < 6; g++) {
                        let abs = -this.Sigma_a[g] * this.phi[g];
                        let scatter = 0; // Simplified scattering
                        if (g < 5) scatter = 0.1 * this.phi[g] - 0.1 * this.phi[g+1];
                        
                        dphi[g] = (prompt / 6) + abs + scatter;
                        
                        for (let dg = 0; dg < 6; dg++) {
                            dphi[g] += this.lambda_groups[dg] * this.C[dg][g];
                        }
                        dphi[g] *= this.dt;
                        
                        for (let dg = 0; dg < 6; dg++) {
                            let dC = this.beta_groups[dg] / this.Lambda * this.nu_Sigma_f[g] * this.phi[g] - 
                                      this.lambda_groups[dg] * this.C[dg][g];
                            this.C[dg][g] += dC * this.dt;
                        }
                    }
                    
                    for (let g = 0; g < 6; g++) {
                        this.phi[g] = Math.max(1, this.phi[g] + dphi[g]);
                    }
                },
                
                calculate_q_vol() {
                    const total_fissions = this.power * 1e6 / this.E_f;
                    const vol_per_rod = Math.PI * this.fuel_rod_radius**2 * 4.0; // Assuming 4m length
                    const num_rods = 50000;
                    const total_fuel_vol = vol_per_rod * num_rods;
                    const q_avg = total_fissions * this.E_f / total_fuel_vol;
                    
                    for (let i = 0; i < this.radial_nodes; i++) {
                        const r = this.r_nodes[i];
                        if (r >= this.fuel_rod_radius) {
                            this.q_vol[i] = 0;
                        } else {
                            const radial_factor = Math.cos(Math.PI * r / (2 * this.fuel_rod_radius));
                            this.q_vol[i] = q_avg * 1.2 * radial_factor;
                        }
                    }
                },
                
                calculate_thermal_profile() {
                    this.calculate_q_vol();
                    const T_new = [...this.T_fuel];
                    const r_f = this.fuel_rod_radius;
                    
                    for (let i = 1; i < this.radial_nodes - 1; i++) {
                        const r_i = this.r_nodes[i];
                        const dr = this.dr;
                        
                        let k_i, cp, rho;
                        if (r_i < r_f) {
                            k_i = 2.5 + 0.0005 * (this.T_fuel[i] - 800); // UO2
                            cp = 300;
                            rho = 10900;
                        } else {
                            k_i = 15 + 0.01 * (this.T_fuel[i] - 600); // Zircaloy
                            cp = 300;
                            rho = 6500;
                        }
                        
                        const A_im = 2 * Math.PI * (r_i - dr/2) * 4.0;
                        const A_ip = 2 * Math.PI * (r_i + dr/2) * 4.0;
                        const V_i = Math.PI * ((r_i + dr/2)**2 - (r_i - dr/2)**2) * 4.0;
                        
                        const dTdt = (1 / (rho * cp)) * (
                            (k_i * A_ip * (this.T_fuel[i+1] - this.T_fuel[i]) / dr -
                             k_i * A_im * (this.T_fuel[i] - this.T_fuel[i-1]) / dr) / V_i +
                            this.q_vol[i]
                        );
                        T_new[i] = this.T_fuel[i] + dTdt * this.dt;
                    }
                    
                    // Centerline (symmetry)
                    const k0 = 2.5 + 0.0005 * (this.T_fuel[0] - 800);
                    const V0 = Math.PI * (this.dr/2)**2 * 4.0;
                    const A0 = 2 * Math.PI * (this.dr/2) * 4.0;
                    const dTdt0 = (1 / (10900 * 300)) * (
                        4 * k0 * A0 * (this.T_fuel[1] - this.T_fuel[0]) / this.dr / V0 +
                        this.q_vol[0]
                    );
                    T_new[0] = this.T_fuel[0] + dTdt0 * this.dt;
                    
                    // Outer surface (convection)
                    const i = this.radial_nodes - 1;
                    const r_o = this.r_nodes[i];
                    const A_o = 2 * Math.PI * r_o * 4.0;
                    const V_o = Math.PI * (r_o**2 - (r_o - this.dr/2)**2) * 4.0;
                    const k_o = 15 + 0.01 * (this.T_fuel[i] - 600);
                    const A_im = 2 * Math.PI * (r_o - this.dr/2) * 4.0;
                    const dTdt_o = (1 / (6500 * 300)) * (
                        k_o * A_im * (this.T_fuel[i-1] - this.T_fuel[i]) / this.dr / V_o +
                        this.h_coolant * A_o * (this.T_coolant_out - this.T_fuel[i]) / V_o
                    );
                    T_new[i] = this.T_fuel[i] + dTdt_o * this.dt;
                    
                    this.T_fuel = T_new;
                    this.T = this.T_fuel.reduce((a, b) => a + b, 0) / this.T_fuel.length;
                },
                
                update_coolant_temp() {
                    const total_heat = this.power * 1e6;
                    const cp_water = 4200;
                    const dT_coolant = total_heat / (this.coolant_flow_rate * cp_water);
                    this.T_coolant_out = this.T_coolant_in + dT_coolant;
                },
                
                step_fp() {
                    const fission_rate = this.power * 1e6 / this.E_f;
                    const V = this.core_volume;
                    
                    // I-135 → Xe-135
                    const di135 = 0.061 * fission_rate / V - 2.92e-5 * this.fp_inventory['I-135'].mass;
                    this.fp_inventory['I-135'].mass += di135 * this.dt;
                    
                    // Xe-135 production from fission and I-135 decay, removal by decay and neutron capture
                    const dxe135 = 2.92e-5 * this.fp_inventory['I-135'].mass + 
                                   0.003 * fission_rate / V -
                                   2.09e-5 * this.fp_inventory['Xe-135'].mass -
                                   this.sigma_a_xe135[4] * this.barn * this.phi[4] * this.fp_inventory['Xe-135'].mass;
                    this.fp_inventory['Xe-135'].mass += dxe135 * this.dt;
                    
                    // Pm-149 → Sm-149
                    const dpm149 = 0.011 * fission_rate / V - 3.66e-6 * this.fp_inventory['Pm-149'].mass;
                    this.fp_inventory['Pm-149'].mass += dpm149 * this.dt;
                    
                    const dsm149 = 3.66e-6 * this.fp_inventory['Pm-149'].mass -
                                   this.sigma_a_sm149[4] * this.barn * this.phi[4] * this.fp_inventory['Sm-149'].mass;
                    this.fp_inventory['Sm-149'].mass += dsm149 * this.dt;
                    
                    // Update activities and decay heat
                    for (let key in this.fp_inventory) {
                        const fp = this.fp_inventory[key];
                        fp.activity = fp.lambda * fp.mass * 1000 / fp.molar_mass * 6.022e23;
                        fp.decay_heat = fp.activity * (fp.Q_beta || 0) * 1.602e-13;
                    }
                    
                    // Calculate Xe equilibrium time
                    this.xe_equilibrium = 1 / (2.09e-5 + this.sigma_a_xe135[4] * this.barn * this.phi[4]) / 3600;
                },
                
                step_actinides() {
                    const V = this.core_volume;
                    const N_u238 = this.N_atoms_per_kg_HM * this.fuel_mass * 
                                  (this.actinide_inventory['U-238'].mass / 100) / V;
                    
                    // U-238 capture to Pu-239
                    let capture_u238 = 0;
                    for (let g = 0; g < 6; g++) {
                        capture_u238 += this.phi[g] * this.sigma_a_u238[g] * this.barn * N_u238 * 0.85;
                    }
                    const d_pu239 = capture_u238 * this.dt * 239 / (this.N_atoms_per_kg_HM * this.fuel_mass) * 100;
                    this.actinide_inventory['Pu-239'].mass += d_pu239;
                    this.actinide_inventory['U-238'].mass -= d_pu239 * 238 / 239;
                    
                    // U-235 depletion
                    let depletion_u235 = 0;
                    for (let g = 0; g < 6; g++) {
                        depletion_u235 += this.phi[g] * this.sigma_f_u235[g] * this.barn * 
                                         (this.actinide_inventory['U-235'].mass / 100) * this.N_atoms_per_kg_HM * this.fuel_mass / V;
                    }
                    this.actinide_inventory['U-235'].mass -= depletion_u235 * this.dt * 100 / (this.N_atoms_per_kg_HM * this.fuel_mass);
                    
                    // Decay chains
                    for (let [nuclide, data] of Object.entries(this.actinide_inventory)) {
                        if (data.parent) {
                            const parent = this.actinide_inventory[data.parent];
                            const production = parent.lambda * parent.mass * this.dt;
                            parent.mass -= production;
                            data.mass += production;
                        }
                        
                        if (data.lambda > 0) {
                            const decay = data.lambda * data.mass * this.dt;
                            data.mass -= decay;
                        }
                        
                        // Update activity and decay heat
                        data.activity = data.lambda * data.mass * 1000 / data.molar_mass * 6.022e23;
                        const Q = (data.Q_alpha || 0) * 1.602e-13; // J per decay
                        data.decay_heat = data.activity * Q;
                    }
                },
                
                update_burnup() {
                    this.burnup += this.power * this.dt / (86400 * this.fuel_mass / 1000);
                },
                
                // Control system
                control_power() {
                    if (this.target_power <= 0) {
                        this.control_rod_insertion = Math.min(1, this.control_rod_insertion + 0.01);
                        return;
                    }
                    
                    const error = this.target_power - this.power;
                    const rod_adjust = 0.001 * error * this.dt;
                    this.control_rod_insertion = Math.max(0, Math.min(1, this.control_rod_insertion - rod_adjust));
                },
                
                // Transient events
                addEvent(type, start, duration, value) {
                    this.transient_events.push({
                        id: ++this.event_id,
                        type,
                        start,
                        duration,
                        value,
                        active: false
                    });
                    this.addLog(`Scheduled: ${type} at t=${start}s`, 'info');
                },
                
                removeEvent(id) {
                    this.transient_events = this.transient_events.filter(e => e.id !== id);
                },
                
                apply_transients() {
                    this.transient_events.forEach(event => {
                        const active = this.sim_time >= event.start && this.sim_time < event.start + event.duration;
                        if (active && !event.active) {
                            this.addLog(`ACTIVATED: ${event.type}`, 'warning');
                        }
                        if (!active && event.active) {
                            this.addLog(`DEACTIVATED: ${event.type}`, 'info');
                        }
                        event.active = active;
                        
                        if (active) {
                            switch (event.type) {
                                case 'rod_insert':
                                    this.control_rod_insertion = Math.min(1, this.control_rod_insertion + event.value * this.dt / event.duration);
                                    break;
                                case 'rod_withdraw':
                                    this.control_rod_insertion = Math.max(0, this.control_rod_insertion - event.value * this.dt / event.duration);
                                    break;
                                case 'power_demand':
                                    this.target_power = event.value;
                                    break;
                                case 'coolant_loss':
                                    this.coolant_flow_rate = event.value;
                                    break;
                                case 'scram':
                                    this.control_rod_insertion = 1;
                                    this.target_power = 0;
                                    break;
                            }
                        }
                    });
                },
                
                // Main simulation step
                step() {
                    this.apply_transients();
                    this.control_power();
                    this.calculate_rho();
                    this.step_kinetics();
                    this.calculate_power();
                    this.calculate_thermal_profile();
                    this.update_coolant_temp();
                    this.step_fp();
                    this.step_actinides();
                    this.update_burnup();
                    this.sim_time += this.dt;
                    
                    // Update history for charts
                    if (this.sim_time % 0.1 < this.dt) {
                        this.history.time.push(this.sim_time);
                        this.history.power.push(this.power);
                        this.history.rho.push(this.rho * 1e5);
                        this.history.T_center.push(this.T_fuel[0]);
                        this.history.T_surf.push(this.T_fuel[this.T_fuel.length-1]);
                        this.history.Xe.push(this.fp_inventory['Xe-135'].mass);
                        this.history.Pu239.push(this.actinide_inventory['Pu-239'].mass);
                        this.history.flux.push(this.phi[4] / 1e16);
                        
                        // Keep history length manageable
                        if (this.history.time.length > 500) {
                            for (let key in this.history) {
                                this.history[key].shift();
                            }
                        }
                        
                        this.updateCharts();
                    }
                    
                    // Safety checks
                    if (this.T_fuel[0] > 2800) {
                        this.addLog('CRITICAL: Fuel centerline temperature exceeds melting point!', 'critical');
                    }
                    
                    if (this.power > 3500) {
                        this.addLog('WARNING: Power output above design limit', 'warning');
                    }
                    
                    if (this.rho > 0.01) {
                        this.addLog('WARNING: Positive reactivity insertion detected', 'warning');
                    }
                },
                
                // UI controls
                toggle() {
                    if (this.running) {
                        clearInterval(this.interval);
                        this.running = false;
                        this.addLog('Reactor shutdown initiated', 'info');
                    } else {
                        this.running = true;
                        this.interval = setInterval(() => this.step(), this.dt * 1000);
                        this.addLog('Reactor startup initiated', 'info');
                    }
                },
                
                reset() {
                    clearInterval(this.interval);
                    this.running = false;
                    this.sim_time = 0;
                    this.power = 0;
                    this.rho = 0;
                    this.control_rod_insertion = 0.5;
                    this.target_power = 3000;
                    this.coolant_flow_rate = 15000;
                    this.burnup = 0;
                    this.transient_events = [];
                    this.history = {
                        time: [], power: [], rho: [], T_center: [], T_surf: [], 
                        Xe: [], Pu239: [], flux: [], decay_heat: []
                    };
                    this.initialize_inventories();
                    this.setup_thermal_mesh();
                    this.update_macro_xs();
                    this.addLog('Simulation reset to initial conditions', 'info');
                    this.updateCharts();
                },
                
                // Status indicators
                getStatusClass() {
                    if (!this.running) return 'status-offline';
                    if (this.T_fuel[0] > 2500 || this.power > 3500 || this.rho > 0.005) return 'status-critical';
                    if (this.T_fuel[0] > 2000 || this.power > 3200 || this.rho > 0.001) return 'status-warning';
                    return 'status-normal';
                },
                
                getStatusText() {
                    if (!this.running) return 'OFFLINE';
                    if (this.T_fuel[0] > 2500 || this.power > 3500 || this.rho > 0.005) return 'CRITICAL';
                    if (this.T_fuel[0] > 2000 || this.power > 3200 || this.rho > 0.001) return 'WARNING';
                    return 'NORMAL';
                },
                
                // Chart management
                createCharts() {
                    const ctxPower = this.$refs.chartPower.getContext('2d');
                    this.charts.power = new Chart(ctxPower, {
                        type: 'line',
                        data: {
                            labels: this.history.time,
                            datasets: [
                                {
                                    label: 'Power (MW)',
                                    data: this.history.power,
                                    borderColor: '#3182ce',
                                    backgroundColor: 'rgba(49, 130, 206, 0.1)',
                                    fill: true,
                                    yAxisID: 'y'
                                },
                                {
                                    label: 'Reactivity (pcm)',
                                    data: this.history.rho,
                                    borderColor: '#e53e3e',
                                    borderDash: [5, 5],
                                    yAxisID: 'y1'
                                }
                            ]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            scales: {
                                x: {
                                    title: { display: true, text: 'Time (s)' }
                                },
                                y: {
                                    type: 'linear',
                                    display: true,
                                    position: 'left',
                                    title: { display: true, text: 'Power (MW)' }
                                },
                                y1: {
                                    type: 'linear',
                                    display: true,
                                    position: 'right',
                                    title: { display: true, text: 'Reactivity (pcm)' },
                                    grid: { drawOnChartArea: false }
                                }
                            }
                        }
                    });
                    
                    const ctxThermal = this.$refs.chartThermal.getContext('2d');
                    this.charts.thermal = new Chart(ctxThermal, {
                        type: 'line',
                        data: {
                            labels: this.history.time,
                            datasets: [
                                {
                                    label: 'Centerline Temp (K)',
                                    data: this.history.T_center,
                                    borderColor: '#e53e3e',
                                    backgroundColor: 'rgba(229, 62, 62, 0.1)',
                                    fill: true
                                },
                                {
                                    label: 'Surface Temp (K)',
                                    data: this.history.T_surf,
                                    borderColor: '#3182ce',
                                    backgroundColor: 'rgba(49, 130, 206, 0.1)',
                                    fill: true
                                }
                            ]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            scales: {
                                x: { title: { display: true, text: 'Time (s)' } },
                                y: { title: { display: true, text: 'Temperature (K)' } }
                            }
                        }
                    });
                    
                    const ctxFlux = this.$refs.chartFlux.getContext('2d');
                    this.charts.flux = new Chart(ctxFlux, {
                        type: 'line',
                        data: {
                            labels: ['Group 1', 'Group 2', 'Group 3', 'Group 4', 'Group 5', 'Group 6'],
                            datasets: [{
                                label: 'Neutron Flux',
                                data: this.phi.map(p => p / 1e16),
                                backgroundColor: [
                                    'rgba(255, 99, 132, 0.7)',
                                    'rgba(54, 162, 235, 0.7)',
                                    'rgba(255, 206, 86, 0.7)',
                                    'rgba(75, 192, 192, 0.7)',
                                    'rgba(153, 102, 255, 0.7)',
                                    'rgba(255, 159, 64, 0.7)'
                                ],
                                borderColor: [
                                    'rgb(255, 99, 132)',
                                    'rgb(54, 162, 235)',
                                    'rgb(255, 206, 86)',
                                    'rgb(75, 192, 192)',
                                    'rgb(153, 102, 255)',
                                    'rgb(255, 159, 64)'
                                ],
                                borderWidth: 1
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            scales: {
                                y: {
                                    title: { display: true, text: 'Flux (×10¹⁶ n/m²/s)' },
                                    type: 'logarithmic'
                                }
                            }
                        }
                    });
                    
                    const ctxPoisons = this.$refs.chartPoisons.getContext('2d');
                    this.charts.poisons = new Chart(ctxPoisons, {
                        type: 'line',
                        data: {
                            labels: this.history.time,
                            datasets: [
                                {
                                    label: 'Xe-135 (kg)',
                                    data: this.history.Xe,
                                    borderColor: '#9b59b6',
                                    backgroundColor: 'rgba(155, 89, 182, 0.1)',
                                    fill: true
                                },
                                {
                                    label: 'Pu-239 (kg)',
                                    data: this.history.Pu239,
                                    borderColor: '#38a169',
                                    backgroundColor: 'rgba(56, 161, 105, 0.1)',
                                    fill: true
                                }
                            ]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            scales: {
                                x: { title: { display: true, text: 'Time (s)' } },
                                y: { title: { display: true, text: 'Mass (kg)' } }
                            }
                        }
                    });
                    
                    const ctxActinides = this.$refs.chartActinides.getContext('2d');
                    this.charts.actinides = new Chart(ctxActinides, {
                        type: 'line',
                        data: {
                            labels: this.history.time,
                            datasets: [
                                {
                                    label: 'U-235 (kg)',
                                    data: Array(this.history.time.length).fill(this.actinide_inventory['U-235'].mass),
                                    borderColor: '#3182ce',
                                    backgroundColor: 'rgba(49, 130, 206, 0.1)',
                                    fill: true
                                },
                                {
                                    label: 'Pu-239 (kg)',
                                    data: this.history.Pu239,
                                    borderColor: '#38a169',
                                    backgroundColor: 'rgba(56, 161, 105, 0.1)',
                                    fill: true
                                }
                            ]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            scales: {
                                x: { title: { display: true, text: 'Time (s)' } },
                                y: { title: { display: true, text: 'Mass (kg)' } }
                            }
                        }
                    });
                },
                
                updateCharts() {
                    if (!this.charts.power) return;
                    
                    this.charts.power.data.labels = this.history.time;
                    this.charts.power.data.datasets[0].data = this.history.power;
                    this.charts.power.data.datasets[1].data = this.history.rho;
                    this.charts.power.update('none');
                    
                    this.charts.thermal.data.labels = this.history.time;
                    this.charts.thermal.data.datasets[0].data = this.history.T_center;
                    this.charts.thermal.data.datasets[1].data = this.history.T_surf;
                    this.charts.thermal.update('none');
                    
                    this.charts.flux.data.datasets[0].data = this.phi.map(p => p / 1e16);
                    this.charts.flux.update('none');
                    
                    this.charts.poisons.data.labels = this.history.time;
                    this.charts.poisons.data.datasets[0].data = this.history.Xe;
                    this.charts.poisons.data.datasets[1].data = this.history.Pu239;
                    this.charts.poisons.update('none');
                    
                    this.charts.actinides.data.labels = this.history.time;
                    this.charts.actinides.data.datasets[0].data = Array(this.history.time.length).fill(this.actinide_inventory['U-235'].mass);
                    this.charts.actinides.data.datasets[1].data = this.history.Pu239;
                    this.charts.actinides.update('none');
                },
                
                // Utility functions
                addLog(text, type = 'info') {
                    this.log_entries.unshift({ text: `[${this.sim_time.toFixed(3)}s] ${text}`, type });
                    if (this.log_entries.length > 50) this.log_entries.pop();
                    
                    // Auto-scroll log
                    setTimeout(() => {
                        if (this.$refs.log) this.$refs.log.scrollTop = 0;
                    }, 10);
                },
                
                formatSci(x) {
                    if (x === 0) return '0';
                    if (x < 1e-10) return '<1e-10';
                    return x.toExponential(2);
                },
                
                formatHalfLife(s) {
                    if (s === Infinity) return 'Stable';
                    const y = s / 3.15576e7;
                    if (y > 1e6) return `${(y/1e6).toFixed(1)} My`;
                    if (y > 1e3) return `${(y/1e3).toFixed(1)} ky`;
                    if (y > 1) return `${y.toFixed(1)} y`;
                    const d = s / 86400;
                    if (d > 1) return `${d.toFixed(1)} d`;
                    const h = s / 3600;
                    if (h > 1) return `${h.toFixed(1)} h`;
                    const m = s / 60;
                    if (m > 1) return `${m.toFixed(1)} m`;
                    return `${s.toFixed(1)} s`;
                }
            };
        }
    </script>
</body>
</html>