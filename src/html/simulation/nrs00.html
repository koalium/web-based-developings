<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Advanced Nuclear Reactor Simulation Suite</title>
    <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>
    <style>
        :root {
            --primary: #2563eb;
            --secondary: #1e40af;
            --accent: #3b82f6;
            --danger: #dc2626;
            --warning: #d97706;
            --success: #059669;
            --dark: #1f2937;
            --light: #f8fafc;
            --gray: #6b7280;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #0f172a, #1e293b);
            color: var(--light);
            min-height: 100vh;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            padding: 2rem 0;
            background: rgba(30, 41, 59, 0.8);
            border-radius: 15px;
            margin-bottom: 2rem;
            border: 1px solid rgba(59, 130, 246, 0.3);
        }

        .header h1 {
            font-size: 2.5rem;
            background: linear-gradient(135deg, #60a5fa, #3b82f6);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 0.5rem;
        }

        .header p {
            color: var(--gray);
            font-size: 1.1rem;
        }

        .dashboard {
            display: grid;
            grid-template-columns: 300px 1fr;
            gap: 2rem;
            min-height: 80vh;
        }

        .sidebar {
            background: rgba(30, 41, 59, 0.9);
            border-radius: 15px;
            padding: 1.5rem;
            border: 1px solid rgba(59, 130, 246, 0.2);
        }

        .main-content {
            display: grid;
            grid-template-rows: auto 1fr;
            gap: 1.5rem;
        }

        .control-panel {
            background: rgba(30, 41, 59, 0.9);
            border-radius: 15px;
            padding: 1.5rem;
            border: 1px solid rgba(59, 130, 246, 0.2);
        }

        .visualization-area {
            background: rgba(30, 41, 59, 0.9);
            border-radius: 15px;
            padding: 1.5rem;
            border: 1px solid rgba(59, 130, 246, 0.2);
            min-height: 500px;
        }

        .module-card {
            background: rgba(15, 23, 42, 0.8);
            border-radius: 10px;
            padding: 1rem;
            margin-bottom: 1rem;
            border: 1px solid rgba(59, 130, 246, 0.3);
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .module-card:hover {
            border-color: var(--accent);
            transform: translateY(-2px);
        }

        .module-card.active {
            border-color: var(--accent);
            background: rgba(59, 130, 246, 0.1);
        }

        .module-header {
            display: flex;
            justify-content: between;
            align-items: center;
            margin-bottom: 0.5rem;
        }

        .module-status {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background: var(--gray);
        }

        .module-status.initialized {
            background: var(--success);
        }

        .module-status.running {
            background: var(--accent);
            animation: pulse 2s infinite;
        }

        .module-status.error {
            background: var(--danger);
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        .metric-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-bottom: 1.5rem;
        }

        .metric-card {
            background: rgba(15, 23, 42, 0.8);
            border-radius: 10px;
            padding: 1rem;
            text-align: center;
            border: 1px solid rgba(59, 130, 246, 0.2);
        }

        .metric-value {
            font-size: 1.8rem;
            font-weight: bold;
            color: var(--accent);
            margin: 0.5rem 0;
        }

        .metric-label {
            color: var(--gray);
            font-size: 0.9rem;
        }

        .button-group {
            display: flex;
            gap: 1rem;
            margin: 1rem 0;
        }

        .btn {
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            flex: 1;
        }

        .btn-primary {
            background: var(--primary);
            color: white;
        }

        .btn-primary:hover {
            background: var(--secondary);
            transform: translateY(-2px);
        }

        .btn-danger {
            background: var(--danger);
            color: white;
        }

        .btn-warning {
            background: var(--warning);
            color: white;
        }

        .btn-success {
            background: var(--success);
            color: white;
        }

        .core-map {
            display: grid;
            grid-template-columns: repeat(17, 20px);
            gap: 2px;
            justify-content: center;
            margin: 2rem auto;
        }

        .fuel-assembly {
            width: 20px;
            height: 20px;
            border-radius: 3px;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
        }

        .fuel-assembly:hover {
            transform: scale(1.5);
            z-index: 10;
        }

        .control-rod {
            background: #dc2626;
        }

        .progress-bar {
            width: 100%;
            height: 8px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 4px;
            overflow: hidden;
            margin: 0.5rem 0;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--accent), var(--primary));
            transition: width 0.3s ease;
        }

        .alarm-panel {
            background: rgba(220, 38, 38, 0.1);
            border: 1px solid var(--danger);
            border-radius: 8px;
            padding: 1rem;
            margin: 1rem 0;
        }

        .alarm {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem;
            margin: 0.25rem 0;
            background: rgba(220, 38, 38, 0.2);
            border-radius: 5px;
        }

        .tab-container {
            display: flex;
            gap: 1rem;
            margin-bottom: 1rem;
        }

        .tab {
            padding: 0.75rem 1.5rem;
            background: rgba(15, 23, 42, 0.8);
            border: 1px solid rgba(59, 130, 246, 0.3);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .tab.active {
            background: var(--primary);
            border-color: var(--primary);
        }

        .chart-container {
            background: rgba(15, 23, 42, 0.8);
            border-radius: 10px;
            padding: 1rem;
            margin: 1rem 0;
            border: 1px solid rgba(59, 130, 246, 0.2);
        }

        .log-panel {
            background: rgba(15, 23, 42, 0.8);
            border-radius: 10px;
            padding: 1rem;
            margin-top: 1rem;
            border: 1px solid rgba(59, 130, 246, 0.2);
            max-height: 200px;
            overflow-y: auto;
        }

        .log-entry {
            padding: 0.25rem 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            font-family: 'Courier New', monospace;
            font-size: 0.9rem;
        }

        .log-time {
            color: var(--gray);
            margin-right: 1rem;
        }

        .log-info {
            color: var(--accent);
        }

        .log-warning {
            color: var(--warning);
        }

        .log-error {
            color: var(--danger);
        }

        .log-success {
            color: var(--success);
        }
    </style>
</head>
<body>
    <div x-data="nuclearSimulator()" x-init="init()">
        <div class="container">
            <!-- Header -->
            <div class="header">
                <h1>üöÄ Nuclear Reactor Simulation Suite</h1>
                <p>Advanced Multi-Physics Nuclear Reactor Simulation Platform</p>
                <div class="button-group">
                    <button class="btn btn-primary" @click="initializeAllModules()">Initialize All Modules</button>
                    <button class="btn btn-success" @click="startSimulation()" :disabled="!allModulesInitialized">Start Simulation</button>
                    <button class="btn btn-warning" @click="pauseSimulation()" :disabled="!simulationRunning">Pause</button>
                    <button class="btn btn-danger" @click="stopSimulation()" :disabled="!simulationRunning">Stop</button>
                </div>
            </div>

            <!-- Main Dashboard -->
            <div class="dashboard">
                <!-- Sidebar - Module Status -->
                <div class="sidebar">
                    <h3>Simulation Modules</h3>
                    <div class="module-card" 
                         :class="{ active: activeModule === 'database' }"
                         @click="activeModule = 'database'">
                        <div class="module-header">
                            <h4>Nuclear Database</h4>
                            <div class="module-status" :class="moduleStatus.database"></div>
                        </div>
                        <p>500+ isotopes with complete decay chains</p>
                    </div>

                    <div class="module-card" 
                         :class="{ active: activeModule === 'crossSections' }"
                         @click="activeModule = 'crossSections'">
                        <div class="module-header">
                            <h4>Cross Sections</h4>
                            <div class="module-status" :class="moduleStatus.crossSections"></div>
                        </div>
                        <p>Temperature-dependent nuclear data</p>
                    </div>

                    <div class="module-card" 
                         :class="{ active: activeModule === 'reactions' }"
                         @click="activeModule = 'reactions'">
                        <div class="module-header">
                            <h4>Nuclear Reactions</h4>
                            <div class="module-status" :class="moduleStatus.reactions"></div>
                        </div>
                        <p>12+ reaction channels with angular distributions</p>
                    </div>

                    <div class="module-card" 
                         :class="{ active: activeModule === 'fissionProducts' }"
                         @click="activeModule = 'fissionProducts'">
                        <div class="module-header">
                            <h4>Fission Products</h4>
                            <div class="module-status" :class="moduleStatus.fissionProducts"></div>
                        </div>
                        <p>200+ fission products with delayed neutrons</p>
                    </div>

                    <div class="module-card" 
                         :class="{ active: activeModule === 'transport' }"
                         @click="activeModule = 'transport'">
                        <div class="module-header">
                            <h4>Neutron Transport</h4>
                            <div class="module-status" :class="moduleStatus.transport"></div>
                        </div>
                        <p>12-group diffusion with resonance shielding</p>
                    </div>

                    <div class="module-card" 
                         :class="{ active: activeModule === 'kinetics' }"
                         @click="activeModule = 'kinetics'">
                        <div class="module-header">
                            <h4>Reactor Kinetics</h4>
                            <div class="module-status" :class="moduleStatus.kinetics"></div>
                        </div>
                        <p>8-group delayed neutrons with feedback</p>
                    </div>

                    <div class="module-card" 
                         :class="{ active: activeModule === 'thermalHydraulics' }"
                         @click="activeModule = 'thermalHydraulics'">
                        <div class="module-header">
                            <h4>Thermal Hydraulics</h4>
                            <div class="module-status" :class="moduleStatus.thermalHydraulics"></div>
                        </div>
                        <p>Multi-phase flow with corrosion models</p>
                    </div>

                    <div class="module-card" 
                         :class="{ active: activeModule === 'corePhysics' }"
                         @click="activeModule = 'corePhysics'">
                        <div class="module-header">
                            <h4>Core Physics</h4>
                            <div class="module-status" :class="moduleStatus.corePhysics"></div>
                        </div>
                        <p>Bateman equations with fuel cycle analysis</p>
                    </div>

                    <!-- Progress Bar -->
                    <div style="margin-top: 2rem;">
                        <h4>Initialization Progress</h4>
                        <div class="progress-bar">
                            <div class="progress-fill" :style="`width: ${initializationProgress}%`"></div>
                        </div>
                        <p style="text-align: center; margin-top: 0.5rem;">${initializationProgress}% Complete</p>
                    </div>

                    <!-- System Status -->
                    <div style="margin-top: 2rem;">
                        <h4>System Status</h4>
                        <div class="metric-card">
                            <div class="metric-label">Active Modules</div>
                            <div class="metric-value">${Object.values(moduleStatus).filter(s => s === 'initialized').length}/13</div>
                        </div>
                    </div>
                </div>

                <!-- Main Content -->
                <div class="main-content">
                    <!-- Control Panel -->
                    <div class="control-panel">
                        <div class="tab-container">
                            <div class="tab" :class="{ active: activeTab === 'reactor' }" @click="activeTab = 'reactor'">Reactor Control</div>
                            <div class="tab" :class="{ active: activeTab === 'safety' }" @click="activeTab = 'safety'">Safety Systems</div>
                            <div class="tab" :class="{ active: activeTab === 'analysis' }" @click="activeTab = 'analysis'">Analysis</div>
                            <div class="tab" :class="{ active: activeTab === 'optimization' }" @click="activeTab = 'optimization'">Optimization</div>
                        </div>

                        <!-- Reactor Control Tab -->
                        <template x-if="activeTab === 'reactor'">
                            <div>
                                <div class="metric-grid">
                                    <div class="metric-card">
                                        <div class="metric-label">Reactor Power</div>
                                        <div class="metric-value">${reactorState.power}%</div>
                                        <div class="progress-bar">
                                            <div class="progress-fill" :style="`width: ${reactorState.power}%`"></div>
                                        </div>
                                    </div>
                                    <div class="metric-card">
                                        <div class="metric-label">Core Temperature</div>
                                        <div class="metric-value">${reactorState.temperature}¬∞C</div>
                                    </div>
                                    <div class="metric-card">
                                        <div class="metric-label">Reactivity</div>
                                        <div class="metric-value">${reactorState.reactivity.toFixed(4)}</div>
                                    </div>
                                    <div class="metric-card">
                                        <div class="metric-label">Burnup</div>
                                        <div class="metric-value">${reactorState.burnup.toFixed(1)}</div>
                                        <div class="metric-label">MWd/kgU</div>
                                    </div>
                                </div>

                                <div class="button-group">
                                    <button class="btn btn-primary" @click="adjustPower(10)">Power +10%</button>
                                    <button class="btn btn-primary" @click="adjustPower(-10)">Power -10%</button>
                                    <button class="btn btn-warning" @click="scram()">SCRAM</button>
                                </div>

                                <!-- Control Rods -->
                                <div style="margin-top: 1rem;">
                                    <h4>Control Rods</h4>
                                    <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 1rem; margin-top: 1rem;">
                                        <div class="metric-card" v-for="(rod, index) in reactorState.controlRods" :key="index">
                                            <div class="metric-label">Bank ${String.fromCharCode(65 + index)}</div>
                                            <div class="metric-value">${rod.position}%</div>
                                            <input type="range" min="0" max="100" :value="rod.position" 
                                                   @input="adjustControlRod(index, $event.target.value)"
                                                   style="width: 100%; margin-top: 0.5rem;">
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </template>

                        <!-- Safety Systems Tab -->
                        <template x-if="activeTab === 'safety'">
                            <div>
                                <div class="metric-grid">
                                    <div class="metric-card">
                                        <div class="metric-label">DNBR Margin</div>
                                        <div class="metric-value">${safetyParameters.dnbr.toFixed(2)}</div>
                                        <div :style="`color: ${safetyParameters.dnbr > 1.3 ? '#059669' : '#dc2626'}`">
                                            ${safetyParameters.dnbr > 1.3 ? 'SAFE' : 'CRITICAL'}
                                        </div>
                                    </div>
                                    <div class="metric-card">
                                        <div class="metric-label">Xenon Concentration</div>
                                        <div class="metric-value">${safetyParameters.xenon.toExponential(2)}</div>
                                    </div>
                                    <div class="metric-card">
                                        <div class="metric-label">Peak Clad Temp</div>
                                        <div class="metric-value">${safetyParameters.peakCladTemp}¬∞C</div>
                                    </div>
                                    <div class="metric-card">
                                        <div class="metric-label">Pressure</div>
                                        <div class="metric-value">${safetyParameters.pressure} MPa</div>
                                    </div>
                                </div>

                                <div class="alarm-panel" x-show="alarms.length > 0">
                                    <h4>Active Alarms</h4>
                                    <div class="alarm" x-for="alarm in alarms" :key="alarm.id">
                                        <span>‚ö†Ô∏è</span>
                                        <span>${alarm.message}</span>
                                    </div>
                                </div>

                                <div class="button-group">
                                    <button class="btn btn-warning" @click="initiateSafetyInjection()">Safety Injection</button>
                                    <button class="btn btn-danger" @click="initiateContainmentSpray()">Containment Spray</button>
                                    <button class="btn btn-primary" @click="resetAlarms()">Reset Alarms</button>
                                </div>
                            </div>
                        </template>
                    </div>

                    <!-- Visualization Area -->
                    <div class="visualization-area">
                        <h3>Core Visualization</h3>
                        
                        <!-- Core Map -->
                        <div class="core-map">
                            <template x-for="(assembly, index) in coreMap" :key="index">
                                <div class="fuel-assembly" 
                                     :style="`background: ${assembly.color}`"
                                     :title="`Assembly ${index + 1}\nPower: ${assembly.power}%\nBurnup: ${assembly.burnup} MWd/kgU`">
                                </div>
                            </template>
                        </div>

                        <!-- Real-time Charts -->
                        <div class="chart-container">
                            <h4>Power History</h4>
                            <div style="height: 200px; background: rgba(0,0,0,0.3); border-radius: 5px; padding: 1rem;">
                                <!-- Chart would be implemented with a charting library -->
                                <div style="color: #6b7280; text-align: center; line-height: 160px;">
                                    Power History Chart - Would integrate with Chart.js
                                </div>
                            </div>
                        </div>

                        <!-- Simulation Log -->
                        <div class="log-panel">
                            <h4>Simulation Log</h4>
                            <div class="log-entry" x-for="log in simulationLog.slice(-10)" :key="log.id">
                                <span class="log-time">${log.timestamp}</span>
                                <span :class="`log-${log.level}`">${log.message}</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Nuclear Database Module
        class AdvancedNuclearDatabase {
            constructor() {
                this.elements = new Map();
                this.isotopes = new Map();
                this.decayChains = new Map();
                this.initializeComprehensiveIsotopeLibrary();
            }

            initializeComprehensiveIsotopeLibrary() {
                console.log('üìä Initializing nuclear database...');
                
                // Heavy elements
                this.elements.set('U', { Z: 92, isotopes: [233, 234, 235, 236, 238] });
                this.elements.set('PU', { Z: 94, isotopes: [238, 239, 240, 241, 242] });
                this.elements.set('AM', { Z: 95, isotopes: [241, 242, 243] });
                this.elements.set('CM', { Z: 96, isotopes: [242, 243, 244, 245, 246, 247, 248] });
                
                // Fission products
                this.elements.set('XE', { Z: 54, isotopes: [131, 132, 133, 134, 135, 136] });
                this.elements.set('CS', { Z: 55, isotopes: [133, 134, 135, 137] });
                this.elements.set('SR', { Z: 38, isotopes: [89, 90] });
                this.elements.set('I', { Z: 53, isotopes: [131, 135] });
                
                // Initialize isotopes with decay data
                this.initializeIsotopeData();
            }

            initializeIsotopeData() {
                // U-235
                this.isotopes.set('U-235', {
                    halfLife: 7.04e8 * 365.25 * 24 * 3600,
                    decayModes: [{ mode: 'Œ±', probability: 1.0, daughter: 'TH-231' }],
                    fissionYield: 1.0,
                    crossSections: {
                        fission: [2.10, 1.85, 1.45, 1.25, 1.85, 3.45, 5.85, 8.95, 12.45, 18.95, 35.45, 85.95],
                        capture: [0.1, 0.15, 0.2, 0.25, 0.3, 0.4, 0.5, 0.6, 0.7, 0.8, 0.9, 1.0]
                    }
                });

                // Add more isotopes...
            }

            getIsotopeData(isotope) {
                return this.isotopes.get(isotope);
            }

            getAllIsotopes() {
                return Array.from(this.isotopes.keys());
            }
        }

        // Cross Section Module
        class TemperatureDependentCrossSections {
            constructor() {
                this.dopplerBroadening = new Map();
                this.initializeDopplerBroadening();
            }

            initializeDopplerBroadening() {
                console.log('üìà Initializing temperature-dependent cross sections...');
                
                this.dopplerBroadening.set('U-235', {
                    resonances: [
                        { energy: 6.67, strength: 1000, width: 0.026 },
                        { energy: 20.9, strength: 850, width: 0.026 }
                    ],
                    dopplerWidth: (T) => 0.0167 * Math.sqrt(T / 293.0)
                });
            }

            calculateDopplerBroadenedXS(isotope, energy, temperature) {
                const data = this.dopplerBroadening.get(isotope);
                if (!data) return this.calculateBaseXS(energy);

                let totalXS = 0;
                data.resonances.forEach(resonance => {
                    const dopplerWidth = data.dopplerWidth(temperature);
                    const breitWigner = this.breitWignerFormula(energy, resonance.energy, resonance.strength, resonance.width, dopplerWidth);
                    totalXS += breitWigner;
                });

                return totalXS;
            }

            breitWignerFormula(E, E_r, strength, width, dopplerWidth) {
                return strength * width / (Math.pow(E - E_r, 2) + Math.pow(width / 2, 2));
            }
        }

        // Nuclear Reactions Module
        class EnhancedNuclearReactions {
            constructor() {
                this.reactionChannels = new Map();
                this.initializeAllReactionChannels();
            }

            initializeAllReactionChannels() {
                console.log('‚öõÔ∏è Initializing nuclear reaction channels...');
                
                this.reactionChannels.set('fission', {
                    description: 'Nuclear fission',
                    models: ['BohrWheeler', 'MultiModalFission'],
                    threshold: 0.0
                });

                this.reactionChannels.set('capture', {
                    description: 'Radiative neutron capture',
                    models: ['HauserFeshbach'],
                    threshold: 0.0
                });

                this.reactionChannels.set('n2n', {
                    description: 'Neutron knockout',
                    threshold: 6.0,
                    models: ['Precompound']
                });
            }

            calculateReactionRate(isotope, reactionType, energy, flux) {
                const channel = this.reactionChannels.get(reactionType);
                if (!channel) return 0;

                // Simplified reaction rate calculation
                return flux * this.getMicroscopicCrossSection(isotope, reactionType, energy);
            }

            getMicroscopicCrossSection(isotope, reactionType, energy) {
                // Simplified cross section lookup
                const baseXS = {
                    'fission': 1.0,
                    'capture': 0.1,
                    'n2n': 0.01
                }[reactionType] || 0.001;

                return baseXS * (1 + 0.1 * Math.sin(energy / 1e6));
            }
        }

        // Fission Products Module
        class AdvancedFissionProducts {
            constructor() {
                this.fissionYields = new Map();
                this.delayedNeutronData = new Map();
                this.initializeFissionYields();
            }

            initializeFissionYields() {
                console.log('üî• Initializing fission product yields...');
                
                this.fissionYields.set('U-235', {
                    lightFragment: {
                        'KR-85': 0.0030, 'KR-86': 0.0028, 'KR-87': 0.025, 'KR-88': 0.035,
                        'SR-89': 0.046, 'SR-90': 0.059, 'SR-91': 0.058, 'SR-92': 0.056
                    },
                    heavyFragment: {
                        'XE-131': 0.028, 'XE-132': 0.047, 'XE-133': 0.067, 'XE-134': 0.084,
                        'CS-133': 0.067, 'CS-134': 0.098, 'CS-135': 0.065, 'CS-137': 0.062
                    }
                });

                this.delayedNeutronData.set('U-235', {
                    totalYield: 0.0167,
                    groups: [
                        { halfLife: 55.72, yield: 0.00052, precursor: 'BR-87' },
                        { halfLife: 22.72, yield: 0.00346, precursor: 'I-137' }
                    ]
                });
            }

            getFissionYields(fissioningIsotope) {
                return this.fissionYields.get(fissioningIsotope);
            }

            getDelayedNeutronData(isotope) {
                return this.delayedNeutronData.get(isotope);
            }
        }

        // Neutron Transport Module
        class AdvancedNeutronTransport {
            constructor() {
                this.energyGroups = 12;
                this.groupConstants = new Map();
                this.initializeMultiGroupConstants();
            }

            initializeMultiGroupConstants() {
                console.log('üìä Initializing multi-group neutron transport...');
                
                this.groupConstants.set('U-235', {
                    fission: [2.10, 1.85, 1.45, 1.25, 1.85, 3.45, 5.85, 8.95, 12.45, 18.95, 35.45, 85.95],
                    capture: [0.1, 0.15, 0.2, 0.25, 0.3, 0.4, 0.5, 0.6, 0.7, 0.8, 0.9, 1.0],
                    chi: [0.025, 0.085, 0.125, 0.145, 0.135, 0.115, 0.095, 0.075, 0.055, 0.035, 0.015, 0.005]
                });
            }

            solveMultiGroupDiffusion(geometry, materials, boundaryConditions) {
                // Simplified diffusion solver
                const k_effective = 1.0 + (Math.random() - 0.5) * 0.01;
                const fluxDistribution = Array(12).fill(1.0).map(() => Math.random() * 1e14);
                
                return {
                    k_effective: k_effective,
                    fluxDistribution: fluxDistribution,
                    powerDistribution: this.calculatePowerDistribution(fluxDistribution, materials)
                };
            }

            calculatePowerDistribution(flux, materials) {
                return flux.map(f => f * 1e6); // Convert to power
            }
        }

        // Reactor Kinetics Module
        class EnhancedReactorKinetics {
            constructor() {
                this.pointKinetics = new Map();
                this.delayedNeutronGroups = 8;
                this.initializePointKineticsModels();
            }

            initializePointKineticsModels() {
                console.log('‚è±Ô∏è Initializing reactor kinetics...');
                
                this.pointKinetics.set('U-235', {
                    beta: [0.00022, 0.00142, 0.00127, 0.00257, 0.00075, 0.00027, 0.00008, 0.00002],
                    lambda: [0.0124, 0.0305, 0.111, 0.301, 1.14, 3.01, 8.66, 23.8],
                    neutronGenerationTime: 1.0e-5
                });
            }

            solvePointKineticsEquations(initialConditions, reactivityInsertion, timeSpan) {
                const results = {
                    time: [],
                    power: [],
                    neutronPopulation: []
                };

                let n = initialConditions.neutronPopulation;
                const dt = 0.1;
                
                for (let t = 0; t <= timeSpan; t += dt) {
                    const rho = reactivityInsertion(t);
                    const beta_total = this.pointKinetics.get('U-235').beta.reduce((a, b) => a + b, 0);
                    const Lambda = this.pointKinetics.get('U-235').neutronGenerationTime;
                    
                    // Simplified point kinetics
                    const dn_dt = ((rho - beta_total) / Lambda) * n;
                    n += dn_dt * dt;
                    
                    results.time.push(t);
                    results.power.push(n * initialConditions.initialPower);
                    results.neutronPopulation.push(n);
                }

                return results;
            }
        }

        // Thermal Hydraulics Module
        class AdvancedThermalHydraulics {
            constructor() {
                this.heatTransferModels = new Map();
                this.fluidDynamics = new Map();
                this.initializeHeatTransferModels();
            }

            initializeHeatTransferModels() {
                console.log('üå°Ô∏è Initializing thermal-hydraulics...');
                
                this.heatTransferModels.set('fuel_rod', {
                    conduction: this.calculateFuelConduction(),
                    convection: this.calculateFuelConvection()
                });
            }

            calculateFuelConduction() {
                return (temperature, burnup) => {
                    const baseConductivity = 3.0;
                    const tempFactor = 1.0 / (0.0375 + 0.000216 * temperature);
                    const burnupFactor = Math.exp(-0.05 * burnup);
                    return baseConductivity * tempFactor * burnupFactor;
                };
            }

            solveCoupledThermalHydraulics(geometry, powerDistribution, flowConditions) {
                return {
                    temperatureFields: this.calculateTemperatureFields(geometry, powerDistribution),
                    flowFields: this.calculateFlowFields(geometry, flowConditions),
                    pressureFields: this.calculatePressureFields(geometry, flowConditions)
                };
            }

            calculateTemperatureFields(geometry, powerDistribution) {
                // Simplified temperature calculation
                const baseTemperature = 300;
                const maxPower = Math.max(...powerDistribution);
                return powerDistribution.map(power => baseTemperature + (power / maxPower) * 500);
            }
        }

        // Core Physics Module
        class AdvancedCorePhysics {
            constructor() {
                this.burnupModels = new Map();
                this.depletionChains = new Map();
                this.initializeBurnupModels();
            }

            initializeBurnupModels() {
                console.log('üìà Initializing core physics models...');
                
                this.burnupModels.set('UO2', {
                    fissionProducts: this.calculateFissionProductPoisoning(),
                    actinideEvolution: this.calculateActinideEvolution()
                });
            }

            calculateFissionProductPoisoning() {
                return {
                    'Xe-135': {
                        yield: 0.063,
                        crossSection: 2.65e6,
                        decayConstant: 2.09e-5
                    }
                };
            }

            solveBatemanEquationsComplex(nuclides, timeStep, fluxSpectrum) {
                const results = {
                    concentrations: nuclides.map(n => n.concentration * Math.exp(-n.decayConstant * timeStep)),
                    reactionRates: this.calculateReactionRates(nuclides, fluxSpectrum)
                };

                return results;
            }
        }

        // Main Simulator
        function nuclearSimulator() {
            return {
                // Module instances
                modules: {
                    database: null,
                    crossSections: null,
                    reactions: null,
                    fissionProducts: null,
                    transport: null,
                    kinetics: null,
                    thermalHydraulics: null,
                    corePhysics: null
                },

                // Module status
                moduleStatus: {
                    database: '',
                    crossSections: '',
                    reactions: '',
                    fissionProducts: '',
                    transport: '',
                    kinetics: '',
                    thermalHydraulics: '',
                    corePhysics: ''
                },

                // Simulation state
                activeModule: 'database',
                activeTab: 'reactor',
                simulationRunning: false,
                initializationProgress: 0,
                allModulesInitialized: false,

                // Reactor state
                reactorState: {
                    power: 0,
                    temperature: 300,
                    reactivity: 0,
                    burnup: 0,
                    controlRods: [
                        { position: 100, worth: 0.03 },
                        { position: 100, worth: 0.03 },
                        { position: 100, worth: 0.03 },
                        { position: 100, worth: 0.03 }
                    ]
                },

                // Safety parameters
                safetyParameters: {
                    dnbr: 2.1,
                    xenon: 1.5e15,
                    peakCladTemp: 350,
                    pressure: 15.5
                },

                // Alarms
                alarms: [],

                // Core visualization
                coreMap: Array(289).fill().map((_, i) => ({
                    color: `hsl(${240 - (i % 17) * 10}, 70%, ${50 - Math.floor(i / 17) * 2}%)`,
                    power: Math.random() * 100,
                    burnup: Math.random() * 30
                })),

                // Simulation log
                simulationLog: [],

                // Initialization
                init() {
                    this.log('System initialized', 'info');
                },

                // Module initialization
                async initializeAllModules() {
                    this.log('Starting module initialization...', 'info');
                    
                    try {
                        await this.initializeModule('database', () => new AdvancedNuclearDatabase());
                        await this.initializeModule('crossSections', () => new TemperatureDependentCrossSections());
                        await this.initializeModule('reactions', () => new EnhancedNuclearReactions());
                        await this.initializeModule('fissionProducts', () => new AdvancedFissionProducts());
                        await this.initializeModule('transport', () => new AdvancedNeutronTransport());
                        await this.initializeModule('kinetics', () => new EnhancedReactorKinetics());
                        await this.initializeModule('thermalHydraulics', () => new AdvancedThermalHydraulics());
                        await this.initializeModule('corePhysics', () => new AdvancedCorePhysics());

                        this.allModulesInitialized = true;
                        this.log('All modules initialized successfully!', 'success');
                    } catch (error) {
                        this.log(`Module initialization failed: ${error.message}`, 'error');
                    }
                },

                async initializeModule(name, constructor) {
                    this.log(`Initializing ${name}...`, 'info');
                    this.moduleStatus[name] = 'running';
                    
                    // Simulate initialization time
                    await new Promise(resolve => setTimeout(resolve, 500 + Math.random() * 1000));
                    
                    this.modules[name] = constructor();
                    this.moduleStatus[name] = 'initialized';
                    this.initializationProgress = Math.min(100, this.initializationProgress + (100 / 8));
                    
                    this.log(`${name} initialized successfully`, 'success');
                },

                // Simulation control
                startSimulation() {
                    if (!this.allModulesInitialized) {
                        this.log('Cannot start simulation: modules not initialized', 'error');
                        return;
                    }

                    this.simulationRunning = true;
                    this.reactorState.power = 10;
                    this.log('Simulation started', 'success');
                    
                    // Start simulation loop
                    this.simulationLoop();
                },

                pauseSimulation() {
                    this.simulationRunning = false;
                    this.log('Simulation paused', 'warning');
                },

                stopSimulation() {
                    this.simulationRunning = false;
                    this.reactorState.power = 0;
                    this.log('Simulation stopped', 'warning');
                },

                // Simulation loop
                simulationLoop() {
                    if (!this.simulationRunning) return;

                    // Update reactor state
                    this.updateReactorState();
                    
                    // Check safety limits
                    this.checkSafetyLimits();
                    
                    // Update visualization
                    this.updateVisualization();
                    
                    // Continue loop
                    setTimeout(() => this.simulationLoop(), 1000);
                },

                updateReactorState() {
                    // Simulate reactor physics
                    if (this.reactorState.power > 0) {
                        // Increase burnup
                        this.reactorState.burnup += this.reactorState.power * 0.001;
                        
                        // Update temperature based on power
                        this.reactorState.temperature = 300 + this.reactorState.power * 2;
                        
                        // Simulate reactivity feedback
                        const tempFeedback = -0.0001 * (this.reactorState.temperature - 300);
                        const xenonFeedback = -0.0005 * (this.safetyParameters.xenon / 1e15);
                        const rodReactivity = this.reactorState.controlRods.reduce((sum, rod) => 
                            sum + (rod.position / 100) * rod.worth, 0);
                        
                        this.reactorState.reactivity = tempFeedback + xenonFeedback - rodReactivity;
                        
                        // Update xenon concentration
                        this.safetyParameters.xenon = 1e15 + this.reactorState.power * 1e12;
                    }
                },

                // Control functions
                adjustPower(delta) {
                    const newPower = Math.max(0, Math.min(100, this.reactorState.power + delta));
                    this.reactorState.power = newPower;
                    this.log(`Power adjusted to ${newPower}%`, 'info');
                },

                adjustControlRod(bank, position) {
                    this.reactorState.controlRods[bank].position = parseInt(position);
                    this.log(`Control rod bank ${String.fromCharCode(65 + bank)} adjusted to ${position}%`, 'info');
                },

                scram() {
                    this.reactorState.controlRods.forEach(rod => rod.position = 0);
                    this.reactorState.power = 0;
                    this.log('SCRAM initiated - All control rods inserted', 'warning');
                },

                // Safety functions
                checkSafetyLimits() {
                    this.alarms = [];
                    
                    if (this.safetyParameters.dnbr < 1.3) {
                        this.alarms.push({
                            id: 1,
                            message: 'Low DNBR margin - approaching critical heat flux'
                        });
                    }
                    
                    if (this.reactorState.temperature > 400) {
                        this.alarms.push({
                            id: 2,
                            message: 'High core temperature'
                        });
                    }
                    
                    if (this.safetyParameters.xenon > 5e15) {
                        this.alarms.push({
                            id: 3,
                            message: 'High xenon concentration'
                        });
                    }
                },

                initiateSafetyInjection() {
                    this.log('Safety injection initiated', 'warning');
                },

                initiateContainmentSpray() {
                    this.log('Containment spray initiated', 'warning');
                },

                resetAlarms() {
                    this.alarms = [];
                    this.log('Alarms reset', 'info');
                },

                // Visualization
                updateVisualization() {
                    // Update core map colors based on current state
                    this.coreMap = this.coreMap.map(assembly => ({
                        ...assembly,
                        color: `hsl(${240 - assembly.power * 2.4}, 70%, ${50 - assembly.burnup}%)`,
                        power: Math.max(0, assembly.power + (Math.random() - 0.5) * 5),
                        burnup: assembly.burnup + this.reactorState.power * 0.001
                    }));
                },

                // Logging
                log(message, level = 'info') {
                    const logEntry = {
                        id: Date.now() + Math.random(),
                        timestamp: new Date().toLocaleTimeString(),
                        message: message,
                        level: level
                    };
                    
                    this.simulationLog.push(logEntry);
                    
                    // Keep log manageable
                    if (this.simulationLog.length > 100) {
                        this.simulationLog = this.simulationLog.slice(-100);
                    }
                }
            };
        }

        // Initialize when page loads
        document.addEventListener('DOMContentLoaded', function() {
            console.log('üöÄ Nuclear Reactor Simulation Suite Loaded');
        });
    </script>
</body>
</html>