<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ultra High-Fidelity Nuclear Reactor Simulator</title>
    <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root {
            --primary: #1a1a2e;
            --secondary: #16213e;
            --accent: #0f4c75;
            --accent-light: #3282b8;
            --danger: #e94560;
            --warning: #ff9a3c;
            --success: #4e9f3d;
            --info: #00b7c2;
            --light: #eeeeee;
            --dark: #0d0d0d;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', 'Roboto', sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, var(--dark) 0%, var(--primary) 100%);
            color: var(--light);
            min-height: 100vh;
            padding: 20px;
            line-height: 1.6;
        }
        
        .container {
            max-width: 1800px;
            margin: 0 auto;
        }
        
        header {
            text-align: center;
            margin-bottom: 30px;
            padding: 25px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        h1 {
            font-size: 2.8rem;
            margin-bottom: 10px;
            background: linear-gradient(90deg, var(--accent-light), var(--info));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            text-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
        }
        
        .subtitle {
            font-size: 1.3rem;
            opacity: 0.8;
            margin-bottom: 15px;
        }
        
        .status-bar {
            display: flex;
            justify-content: space-between;
            background: rgba(0, 0, 0, 0.3);
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        
        .status-item {
            display: flex;
            align-items: center;
            margin: 5px 15px;
        }
        
        .status-indicator {
            width: 14px;
            height: 14px;
            border-radius: 50%;
            margin-right: 10px;
            box-shadow: 0 0 10px currentColor;
        }
        
        .status-critical { background-color: var(--danger); }
        .status-warning { background-color: var(--warning); }
        .status-normal { background-color: var(--success); }
        .status-offline { background-color: #7f8c8d; }
        
        .dashboard {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 25px;
            margin-bottom: 25px;
        }
        
        @media (max-width: 1400px) {
            .dashboard {
                grid-template-columns: 1fr;
            }
        }
        
        .panel {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        
        .panel:hover {
            transform: translateY(-5px);
            box-shadow: 0 12px 40px rgba(0, 0, 0, 0.4);
        }
        
        .panel-title {
            font-size: 1.6rem;
            margin-bottom: 20px;
            border-bottom: 2px solid rgba(255, 255, 255, 0.1);
            padding-bottom: 12px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .panel-title small {
            font-size: 0.9rem;
            opacity: 0.7;
        }
        
        .controls {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 25px;
        }
        
        .control-group {
            margin-bottom: 20px;
        }
        
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: var(--accent-light);
        }
        
        input, select {
            width: 100%;
            padding: 12px 15px;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 8px;
            color: white;
            font-size: 1rem;
            transition: all 0.3s ease;
        }
        
        input:focus, select:focus {
            outline: none;
            border-color: var(--accent-light);
            box-shadow: 0 0 0 2px rgba(50, 130, 184, 0.3);
        }
        
        input[type="range"] {
            -webkit-appearance: none;
            height: 10px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 5px;
            padding: 0;
        }
        
        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 22px;
            height: 22px;
            background: var(--accent-light);
            border-radius: 50%;
            cursor: pointer;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
            transition: all 0.2s ease;
        }
        
        input[type="range"]::-webkit-slider-thumb:hover {
            background: var(--info);
            transform: scale(1.1);
        }
        
        button {
            padding: 14px 24px;
            background: var(--accent);
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            font-size: 1rem;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }
        
        button:hover {
            background: var(--accent-light);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        }
        
        button.danger {
            background: var(--danger);
        }
        
        button.danger:hover {
            background: #c2364d;
        }
        
        button.success {
            background: var(--success);
        }
        
        button.success:hover {
            background: #3d7e2f;
        }
        
        button.warning {
            background: var(--warning);
        }
        
        button.warning:hover {
            background: #e08a35;
        }
        
        .value-display {
            display: flex;
            justify-content: space-between;
            margin-bottom: 15px;
            padding: 15px;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 8px;
            transition: all 0.3s ease;
        }
        
        .value-display:hover {
            background: rgba(0, 0, 0, 0.3);
            transform: translateX(5px);
        }
        
        .value-label {
            font-weight: 500;
        }
        
        .value {
            font-weight: 700;
            color: var(--accent-light);
        }
        
        .chart-container {
            position: relative;
            height: 350px;
            margin-bottom: 25px;
        }
        
        .log {
            max-height: 250px;
            overflow-y: auto;
            font-family: 'Consolas', 'Monaco', monospace;
            font-size: 0.9em;
            background: rgba(0, 0, 0, 0.3);
            padding: 15px;
            border-radius: 8px;
            margin-top: 15px;
        }
        
        .log-entry {
            margin-bottom: 8px;
            padding: 8px 12px;
            border-left: 4px solid var(--accent);
            background: rgba(0, 0, 0, 0.2);
            border-radius: 0 4px 4px 0;
            transition: all 0.3s ease;
        }
        
        .log-entry:hover {
            background: rgba(0, 0, 0, 0.4);
        }
        
        .log-warning {
            border-left-color: var(--warning);
            color: var(--warning);
        }
        
        .log-critical {
            border-left-color: var(--danger);
            color: var(--danger);
            font-weight: bold;
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0% { background-color: rgba(233, 69, 96, 0.1); }
            50% { background-color: rgba(233, 69, 96, 0.3); }
            100% { background-color: rgba(233, 69, 96, 0.1); }
        }
        
        .thermal-map {
            display: grid;
            grid-template-columns: repeat(12, 1fr);
            gap: 3px;
            margin: 20px 0;
        }
        
        .rod-cell {
            width: 28px;
            height: 28px;
            border-radius: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.7rem;
            font-weight: bold;
            transition: all 0.3s ease;
        }
        
        .rod-cell:hover {
            transform: scale(1.2);
            z-index: 10;
            box-shadow: 0 0 15px currentColor;
        }
        
        .tabs {
            display: flex;
            margin-bottom: 25px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            flex-wrap: wrap;
        }
        
        .tab {
            padding: 12px 24px;
            cursor: pointer;
            border-bottom: 3px solid transparent;
            transition: all 0.3s ease;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .tab.active {
            border-bottom: 3px solid var(--accent-light);
            color: var(--accent-light);
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        .grid-2 {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 25px;
        }
        
        .grid-3 {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 25px;
        }
        
        @media (max-width: 1200px) {
            .grid-2, .grid-3 {
                grid-template-columns: 1fr;
            }
        }
        
        .data-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
            font-size: 0.9em;
        }
        
        .data-table th, .data-table td {
            padding: 12px 15px;
            text-align: left;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .data-table th {
            background: rgba(0, 0, 0, 0.3);
            font-weight: 600;
            color: var(--accent-light);
        }
        
        .data-table tr:hover {
            background: rgba(255, 255, 255, 0.05);
        }
        
        .progress-bar {
            height: 12px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 6px;
            overflow: hidden;
            margin-top: 8px;
        }
        
        .progress-fill {
            height: 100%;
            background: var(--accent-light);
            transition: width 0.5s ease;
        }
        
        .tooltip {
            position: relative;
            display: inline-block;
        }
        
        .tooltip .tooltiptext {
            visibility: hidden;
            width: 300px;
            background-color: rgba(0, 0, 0, 0.9);
            color: #fff;
            text-align: center;
            border-radius: 6px;
            padding: 10px;
            position: absolute;
            z-index: 100;
            bottom: 125%;
            left: 50%;
            transform: translateX(-50%);
            opacity: 0;
            transition: opacity 0.3s;
            font-size: 0.8rem;
            line-height: 1.4;
        }
        
        .tooltip:hover .tooltiptext {
            visibility: visible;
            opacity: 1;
        }
        
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }
        
        .modal-content {
            background: var(--primary);
            border-radius: 15px;
            padding: 30px;
            max-width: 800px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 10px 50px rgba(0, 0, 0, 0.5);
        }
        
        .close-modal {
            float: right;
            font-size: 1.5rem;
            cursor: pointer;
            color: var(--light);
        }
        
        .close-modal:hover {
            color: var(--danger);
        }
        
        .help-section {
            margin-bottom: 25px;
        }
        
        .help-section h3 {
            margin-bottom: 15px;
            color: var(--accent-light);
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            padding-bottom: 8px;
        }
        
        .help-section ul {
            padding-left: 20px;
        }
        
        .help-section li {
            margin-bottom: 10px;
        }
        
        .complexity-badge {
            display: inline-block;
            padding: 3px 8px;
            background: var(--info);
            border-radius: 4px;
            font-size: 0.7rem;
            font-weight: bold;
            margin-left: 8px;
            vertical-align: middle;
        }
        
        .complexity-high {
            background: var(--danger);
        }
        
        .complexity-medium {
            background: var(--warning);
        }
        
        .complexity-low {
            background: var(--success);
        }
        
        .section-divider {
            height: 1px;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            margin: 30px 0;
        }
        
        .precision-note {
            font-size: 0.8rem;
            color: rgba(255, 255, 255, 0.6);
            margin-top: 10px;
            font-style: italic;
        }
    </style>
</head>
<body>
    <div class="container" x-data="reactorSimulator()" x-init="init()">
        <header>
            <h1>Ultra High-Fidelity Nuclear Reactor Simulator</h1>
            <p class="subtitle">Advanced multi-physics simulation with precision nuclear modeling</p>
            <div class="status-bar">
                <div class="status-item">
                    <span class="status-indicator" :class="getStatusClass()"></span>
                    <span x-text="getStatusText()"></span>
                </div>
                <div class="status-item">
                    <span>Time: <strong x-text="formatTime(sim_time)"></strong></span>
                </div>
                <div class="status-item">
                    <span>Power: <strong x-text="`${power.toFixed(2)} MW`"></strong></span>
                </div>
                <div class="status-item">
                    <span>Reactivity: <strong x-text="`${(rho * 1e5).toFixed(2)} pcm`"></strong></span>
                </div>
                <div class="status-item">
                    <span>Fuel Temp: <strong x-text="`${T.toFixed(1)} K`"></strong></span>
                </div>
                <div class="status-item">
                    <span>Neutron Flux: <strong x-text="`${(phi[4] / 1e16).toFixed(2)}√ó10¬π‚Å∂ n/m¬≤/s`"></strong></span>
                </div>
            </div>
        </header>
        
        <div class="dashboard">
            <div class="panel">
                <div class="panel-title">
                    <span>Reactor Core Control</span>
                    <small>k-eff: <span x-text="k_eff.toFixed(5)"></span></small>
                </div>
                
                <div class="grid-2">
                    <div class="value-display">
                        <span class="value-label">Power Output</span>
                        <span class="value" x-text="`${power.toFixed(2)} MW`"></span>
                    </div>
                    <div class="value-display">
                        <span class="value-label">Reactivity</span>
                        <span class="value" x-text="`${(rho * 1e5).toFixed(2)} pcm`"></span>
                    </div>
                    <div class="value-display">
                        <span class="value-label">Core Temperature</span>
                        <span class="value" x-text="`${T.toFixed(1)} K`"></span>
                    </div>
                    <div class="value-display">
                        <span class="value-label">Neutron Flux (Thermal)</span>
                        <span class="value" x-text="`${(phi[4] / 1e16).toFixed(2)}√ó10¬π‚Å∂ n/m¬≤/s`"></span>
                    </div>
                </div>
                
                <div class="chart-container">
                    <canvas x-ref="chartPower"></canvas>
                </div>
                
                <div class="controls">
                    <button @click="toggle()" :class="running ? 'danger' : 'success'" x-text="running ? 'SHUTDOWN REACTOR' : 'START REACTOR'"></button>
                    <button @click="reset()">RESET SIMULATION</button>
                    <button @click="addEvent('scram', sim_time + 5, 0, 0)" class="warning">TEST SCRAM</button>
                    <button @click="showHelp = true">HELP & DOCS</button>
                </div>
            </div>
            
            <div class="panel">
                <div class="panel-title">
                    <span>Core Thermal Profile</span>
                    <small>Max: <span x-text="Math.max(...T_fuel).toFixed(1)"></span> K</small>
                </div>
                
                <div class="thermal-map">
                    <template x-for="(T, index) in T_fuel">
                        <div class="rod-cell" 
                             :style="`background: hsl(${220 - (T-700)/8}, 100%, 50%)`"
                             :title="`Node ${index}: ${T.toFixed(1)} K`">
                            <span x-text="index === 0 ? 'C' : (index === T_fuel.length-1 ? 'S' : '')"></span>
                        </div>
                    </template>
                </div>
                
                <div class="chart-container">
                    <canvas x-ref="chartThermal"></canvas>
                </div>
                
                <div class="grid-3">
                    <div class="value-display">
                        <span class="value-label">Fuel Center</span>
                        <span class="value" x-text="`${T_fuel[0].toFixed(1)} K`"></span>
                    </div>
                    <div class="value-display">
                        <span class="value-label">Fuel Surface</span>
                        <span class="value" x-text="`${T_fuel[T_fuel.length-1].toFixed(1)} K`"></span>
                    </div>
                    <div class="value-display">
                        <span class="value-label">Coolant ŒîT</span>
                        <span class="value" x-text="`${(T_coolant_out - T_coolant_in).toFixed(1)} K`"></span>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="tabs">
            <div class="tab" :class="{ active: activeTab === 'control' }" @click="activeTab = 'control'">
                <span>‚öôÔ∏è</span> Control
            </div>
            <div class="tab" :class="{ active: activeTab === 'neutronics' }" @click="activeTab = 'neutronics'">
                <span>üî¨</span> Neutronics
            </div>
            <div class="tab" :class="{ active: activeTab === 'thermal' }" @click="activeTab = 'thermal'">
                <span>üî•</span> Thermal
            </div>
            <div class="tab" :class="{ active: activeTab === 'fission' }" @click="activeTab = 'fission'">
                <span>‚öõÔ∏è</span> Fission Products
            </div>
            <div class="tab" :class="{ active: activeTab === 'actinides' }" @click="activeTab = 'actinides'">
                <span>üß™</span> Actinides
            </div>
            <div class="tab" :class="{ active: activeTab === 'materials' }" @click="activeTab = 'materials'">
                <span>üî©</span> Materials
            </div>
        </div>
        
        <div class="tab-content" :class="{ active: activeTab === 'control' }">
            <div class="grid-2">
                <div class="panel">
                    <div class="panel-title">Reactor Control Parameters</div>
                    
                    <div class="control-group">
                        <label>Target Power (MW)</label>
                        <input type="range" min="0" max="4000" step="10" x-model.number="target_power">
                        <span x-text="`${target_power} MW`"></span>
                    </div>
                    
                    <div class="control-group">
                        <label>Control Rod Insertion</label>
                        <input type="range" min="0" max="1" step="0.01" x-model.number="control_rod_insertion">
                        <span x-text="`${(control_rod_insertion * 100).toFixed(1)}%`"></span>
                    </div>
                    
                    <div class="control-group">
                        <label>Coolant Flow Rate (kg/s)</label>
                        <input type="range" min="5000" max="25000" step="100" x-model.number="coolant_flow_rate">
                        <span x-text="`${coolant_flow_rate} kg/s`"></span>
                    </div>
                    
                    <div class="control-group">
                        <label>Fuel Type</label>
                        <select x-model="fuel_type">
                            <option value="uranium">Uranium Dioxide (UO‚ÇÇ)</option>
                            <option value="mixed_oxide">Mixed Oxide (MOX)</option>
                            <option value="thorium">Thorium (Th)</option>
                            <option value="advanced">Advanced Fuel (U-Pu-Zr)</option>
                        </select>
                    </div>
                    
                    <div class="control-group">
                        <label>Moderator Type</label>
                        <select x-model="moderator_type">
                            <option value="water">Light Water (H‚ÇÇO)</option>
                            <option value="heavy_water">Heavy Water (D‚ÇÇO)</option>
                            <option value="graphite">Graphite (C)</option>
                            <option value="beryllium">Beryllium (Be)</option>
                        </select>
                    </div>
                </div>
                
                <div class="panel">
                    <div class="panel-title">Transient Events</div>
                    
                    <div class="control-group">
                        <label>Event Type</label>
                        <select x-model="new_event_type">
                            <option value="rod_insert">Control Rod Insertion</option>
                            <option value="rod_withdraw">Control Rod Withdrawal</option>
                            <option value="power_demand">Power Demand Change</option>
                            <option value="coolant_loss">Coolant Flow Reduction</option>
                            <option value="scram">Emergency Shutdown (SCRAM)</option>
                            <option value="xenon_transient">Xenon Transient</option>
                            <option value="fuel_temp_spike">Fuel Temperature Spike</option>
                        </select>
                    </div>
                    
                    <div class="grid-2">
                        <div class="control-group">
                            <label>Start Time (s)</label>
                            <input type="number" x-model.number="new_start" min="0" step="1">
                        </div>
                        
                        <div class="control-group">
                            <label>Duration (s)</label>
                            <input type="number" x-model.number="new_duration" min="0" step="0.1">
                        </div>
                    </div>
                    
                    <div class="control-group">
                        <label>Value</label>
                        <input type="number" x-model.number="new_value" step="0.01">
                    </div>
                    
                    <button @click="addEvent(new_event_type, new_start, new_duration, new_value)">Schedule Event</button>
                    
                    <div class="log">
                        <template x-for="event in transient_events">
                            <div class="log-entry" :class="{'log-warning': event.active}">
                                <span x-text="`${event.type} @ t=${event.start.toFixed(1)}s [${event.active ? 'ACTIVE' : 'PENDING'}]`"></span>
                                <button @click="removeEvent(event.id)">Remove</button>
                            </div>
                        </template>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="tab-content" :class="{ active: activeTab === 'neutronics' }">
            <div class="grid-2">
                <div class="panel">
                    <div class="panel-title">Neutron Flux by Energy Group</div>
                    <div class="chart-container">
                        <canvas x-ref="chartFlux"></canvas>
                    </div>
                    
                    <div class="precision-note">
                        Energy groups: 1: >10MeV, 2: 1-10MeV, 3: 10keV-1MeV, 4: 1eV-10keV, 5: 0.025-1eV, 6: <0.025eV
                    </div>
                </div>
                
                <div class="panel">
                    <div class="panel-title">Neutron Kinetics Parameters</div>
                    
                    <div class="value-display">
                        <span class="value-label">Effective Multiplication Factor (k-eff)</span>
                        <span class="value" x-text="k_eff.toFixed(5)"></span>
                    </div>
                    
                    <div class="value-display">
                        <span class="value-label">Neutron Generation Time (Œõ)</span>
                        <span class="value" x-text="`${(Lambda * 1e6).toFixed(2)} Œºs`"></span>
                    </div>
                    
                    <div class="value-display">
                        <span class="value-label">Delayed Neutron Fraction (Œ≤)</span>
                        <span class="value" x-text="beta_total.toFixed(5)"></span>
                    </div>
                    
                    <div class="value-display">
                        <span class="value-label">Prompt Neutron Lifetime (‚Ñì)</span>
                        <span class="value" x-text="`${(Lambda * 1e6 / (1 - beta_total)).toFixed(2)} Œºs`"></span>
                    </div>
                    
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Energy Group</th>
                                <th>Flux (n/m¬≤/s)</th>
                                <th>Macro Absorption (1/m)</th>
                                <th>Macro Fission (1/m)</th>
                            </tr>
                        </thead>
                        <tbody>
                            <template x-for="(flux, g) in phi">
                                <tr>
                                    <td x-text="g+1"></td>
                                    <td x-text="flux.toExponential(2)"></td>
                                    <td x-text="Sigma_a[g].toExponential(2)"></td>
                                    <td x-text="nu_Sigma_f[g].toExponential(2)"></td>
                                </tr>
                            </template>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
        
        <div class="tab-content" :class="{ active: activeTab === 'fission' }">
            <div class="grid-2">
                <div class="panel">
                    <div class="panel-title">Fission Product Inventory</div>
                    
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Nuclide</th>
                                <th>Mass (kg)</th>
                                <th>Activity (Bq)</th>
                                <th>Decay Heat (W)</th>
                                <th>Reactivity Worth (pcm)</th>
                            </tr>
                        </thead>
                        <tbody>
                            <template x-for="(fp, key) in fp_inventory">
                                <tr>
                                    <td x-text="key"></td>
                                    <td x-text="fp.mass.toFixed(6)"></td>
                                    <td x-text="formatSci(fp.activity)"></td>
                                    <td x-text="fp.decay_heat.toFixed(3)"></td>
                                    <td x-text="(fp.reactivity_worth * 1e5).toFixed(2)"></td>
                                </tr>
                            </template>
                        </tbody>
                    </table>
                </div>
                
                <div class="panel">
                    <div class="panel-title">Xenon-135 & Samarium-149 Dynamics</div>
                    <div class="chart-container">
                        <canvas x-ref="chartPoisons"></canvas>
                    </div>
                    
                    <div class="grid-2">
                        <div class="value-display">
                            <span class="value-label">Xe-135 Reactivity Worth</span>
                            <span class="value" x-text="`${(xe_worth * 1e5).toFixed(2)} pcm`"></span>
                        </div>
                        
                        <div class="value-display">
                            <span class="value-label">Xe-135 Equilibrium Time</span>
                            <span class="value" x-text="`${xe_equilibrium.toFixed(1)} h`"></span>
                        </div>
                        
                        <div class="value-display">
                            <span class="value-label">Xe-135 Peak After Shutdown</span>
                            <span class="value" x-text="`${xe_peak_time.toFixed(1)} h`"></span>
                        </div>
                        
                        <div class="value-display">
                            <span class="value-label">Sm-149 Equilibrium</span>
                            <span class="value" x-text="`${sm_equilibrium.toFixed(4)} kg`"></span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="tab-content" :class="{ active: activeTab === 'actinides' }">
            <div class="grid-2">
                <div class="panel">
                    <div class="panel-title">Actinide Inventory</div>
                    
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Nuclide</th>
                                <th>Mass (kg)</th>
                                <th>Activity (Bq)</th>
                                <th>Decay Heat (W)</th>
                                <th>Half-Life</th>
                            </tr>
                        </thead>
                        <tbody>
                            <template x-for="(act, key) in actinide_inventory">
                                <tr>
                                    <td x-text="key"></td>
                                    <td x-text="act.mass.toFixed(6)"></td>
                                    <td x-text="formatSci(act.activity)"></td>
                                    <td x-text="act.decay_heat.toFixed(3)"></td>
                                    <td x-text="formatHalfLife(act.half_life)"></td>
                                </tr>
                            </template>
                        </tbody>
                    </table>
                </div>
                
                <div class="panel">
                    <div class="panel-title">Actinide Transmutation Chains</div>
                    <div class="chart-container">
                        <canvas x-ref="chartActinides"></canvas>
                    </div>
                    
                    <div class="grid-2">
                        <div class="value-display">
                            <span class="value-label">Fuel Burnup</span>
                            <span class="value" x-text="`${burnup.toFixed(2)} MWd/kgU`"></span>
                        </div>
                        
                        <div class="value-display">
                            <span class="value-label">Plutonium Production</span>
                            <span class="value" x-text="`${actinide_inventory['Pu-239'].mass.toFixed(4)} kg`"></span>
                        </div>
                        
                        <div class="value-display">
                            <span class="value-label">Fission Rate</span>
                            <span class="value" x-text="`${(power * 1e6 / 3.2e-11 / 1e20).toFixed(2)}√ó10¬≤‚Å∞ fissions/s`"></span>
                        </div>
                        
                        <div class="value-display">
                            <span class="value-label">Conversion Ratio</span>
                            <span class="value" x-text="conversion_ratio.toFixed(3)"></span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="panel">
            <div class="panel-title">Event Log</div>
            <div class="log" x-ref="log">
                <template x-for="entry in log_entries">
                    <div class="log-entry" :class="{'log-warning': entry.type === 'warning', 'log-critical': entry.type === 'critical'}">
                        <span x-text="entry.text"></span>
                    </div>
                </template>
            </div>
        </div>
        
        <!-- Help Modal -->
        <div class="modal" x-show="showHelp" style="display: none;" 
             x-transition:enter="transition ease-out duration-300" 
             x-transition:enter-start="opacity-0" x-transition:enter-end="opacity-100"
             x-transition:leave="transition ease-in duration-200" x-transition:leave-start="opacity-100" 
             x-transition:leave-end="opacity-0">
            <div class="modal-content">
                <span class="close-modal" @click="showHelp = false">&times;</span>
                <h2>Nuclear Reactor Simulator Documentation</h2>
                
                <div class="help-section">
                    <h3>Simulator Overview</h3>
                    <p>This high-fidelity nuclear reactor simulator models a pressurized water reactor (PWR) with advanced physics including:</p>
                    <ul>
                        <li><strong>6-group neutron diffusion</strong> with delayed neutron precursors</li>
                        <li><strong>Multi-region thermal modeling</strong> with radial temperature profiles</li>
                        <li><strong>Comprehensive fission product poisoning</strong> (Xe-135, Sm-149, etc.)</li>
                        <li><strong>Detailed actinide transmutation chains</strong> with precise decay constants</li>
                        <li><strong>Reactivity feedback mechanisms</strong> (Doppler, moderator density, void)</li>
                        <li><strong>Material property dependencies</strong> on temperature and composition</li>
                    </ul>
                </div>
                
                <div class="help-section">
                    <h3>Key Parameters to Monitor</h3>
                    <ul>
                        <li><strong>Power Output:</strong> Thermal power generated by fission (MW)</li>
                        <li><strong>Reactivity (œÅ):</strong> Measure of criticality (positive = supercritical)</li>
                        <li><strong>k-effective (k-eff):</strong> Neutron multiplication factor</li>
                        <li><strong>Fuel Temperature:</strong> Critical for Doppler feedback and safety</li>
                        <li><strong>Xenon-135 Concentration:</strong> Major neutron poison affecting operation</li>
                    </ul>
                </div>
                
                <div class="help-section">
                    <h3>Safety Limits</h3>
                    <ul>
                        <li><strong>Fuel Centerline Temperature:</strong> Should remain below 2800 K (UO‚ÇÇ melting point)</li>
                        <li><strong>Power Output:</strong> Should remain below 3500 MW (design limit)</li>
                        <li><strong>Positive Reactivity Insertion:</strong> Should be controlled to prevent power excursions</li>
                    </ul>
                </div>
                
                <button @click="showHelp = false" class="success">Close Documentation</button>
            </div>
        </div>
    </div>

    <script>
        function reactorSimulator() {
            return {
                // Core state
                sim_time: 0,
                dt: 0.01,
                running: false,
                interval: null,
                activeTab: 'control',
                showHelp: false,
                
                // Reactor parameters
                power: 0,
                target_power: 3000,
                rho: 0,
                k_eff: 1,
                T: 800,
                T_coolant_in: 573,
                T_coolant_out: 600,
                coolant_flow_rate: 15000,
                control_rod_insertion: 0.5,
                fuel_type: 'uranium',
                moderator_type: 'water',
                
                // Neutronics
                phi: Array(6).fill(1e10),
                C: Array.from({length: 6}, () => Array(6).fill(0)),
                Sigma_a: Array(6).fill(0),
                nu_Sigma_f: Array(6).fill(0),
                beta_total: 0.0065,
                beta_groups: [0.000215, 0.001424, 0.001274, 0.002568, 0.000748, 0.000273],
                lambda_groups: [0.0124, 0.0305, 0.111, 0.301, 1.14, 3.01],
                Lambda: 1e-4,
                
                // Thermal model
                fuel_rod_radius: 0.0041,
                cladding_thickness: 0.0006,
                radial_nodes: 12,
                dr: 0,
                r_nodes: [],
                T_fuel: [],
                q_vol: [],
                h_coolant: 45000,
                
                // Fission products - expanded with more isotopes
                fp_inventory: {
                    'I-135': { mass: 0, lambda: 2.88e-5, yield: 0.063, parent: null, molar_mass: 135, activity: 0, decay_heat: 0, reactivity_worth: 0 },
                    'Xe-135': { mass: 0, lambda: 2.09e-5, yield: 0.003, parent: 'I-135', molar_mass: 135, activity: 0, decay_heat: 0, reactivity_worth: -1e-4 },
                    'Cs-135': { mass: 0, lambda: 7.3e-14, yield: 0, parent: 'Xe-135', molar_mass: 135, activity: 0, decay_heat: 0, reactivity_worth: 0 },
                    'Pm-149': { mass: 0, lambda: 3.66e-6, yield: 0.011, parent: null, molar_mass: 149, activity: 0, decay_heat: 0, reactivity_worth: 0 },
                    'Sm-149': { mass: 0, lambda: 0, yield: 0, parent: 'Pm-149', molar_mass: 149, activity: 0, decay_heat: 0, reactivity_worth: -5e-5 },
                    'Kr-85': { mass: 0, lambda: 2.1e-9, yield: 0.003, parent: null, molar_mass: 85, activity: 0, decay_heat: 0, reactivity_worth: 0 },
                    'Sr-90': { mass: 0, lambda: 7.6e-10, yield: 0.058, parent: null, molar_mass: 90, activity: 0, decay_heat: 0, reactivity_worth: 0 },
                    'Cs-137': { mass: 0, lambda: 7.3e-10, yield: 0.061, parent: null, molar_mass: 137, activity: 0, decay_heat: 0, reactivity_worth: 0 },
                    'Tc-99': { mass: 0, lambda: 1e-13, yield: 0.061, parent: null, molar_mass: 99, activity: 0, decay_heat: 0, reactivity_worth: 0 },
                    'I-129': { mass: 0, lambda: 1.4e-15, yield: 0.009, parent: null, molar_mass: 129, activity: 0, decay_heat: 0, reactivity_worth: 0 },
                    'Mo-99': { mass: 0, lambda: 3.7e-5, yield: 0.061, parent: null, molar_mass: 99, activity: 0, decay_heat: 0, reactivity_worth: 0 },
                    'Ru-106': { mass: 0, lambda: 2.1e-7, yield: 0.039, parent: null, molar_mass: 106, activity: 0, decay_heat: 0, reactivity_worth: 0 },
                },
                
                // Actinides - expanded with more isotopes and precise data
                actinide_inventory: {
                    // Uranium isotopes
                    'U-234': { mass: 0.05, lambda: 8.9533e-14, half_life: 2.455e5 * 3.15576e7, parent: null, molar_mass: 234.040952, Q_alpha: 4.8585, activity: 0, decay_heat: 0 },
                    'U-235': { mass: 3.5, lambda: 3.1186e-17, half_life: 7.038e8 * 3.15576e7, parent: null, molar_mass: 235.043930, Q_alpha: 4.679, activity: 0, decay_heat: 0 },
                    'U-236': { mass: 0.1, lambda: 7.6e-16, half_life: 2.342e7 * 3.15576e7, parent: null, molar_mass: 236.045568, Q_alpha: 4.572, activity: 0, decay_heat: 0 },
                    'U-238': { mass: 94.5, lambda: 4.9163e-18, half_life: 4.468e9 * 3.15576e7, parent: null, molar_mass: 238.050788, Q_alpha: 4.26975, activity: 0, decay_heat: 0 },
                    
                    // Neptunium isotopes
                    'Np-237': { mass: 0, lambda: 1.03e-14, half_life: 2.144e6 * 3.15576e7, parent: null, molar_mass: 237.048173, Q_alpha: 4.959, activity: 0, decay_heat: 0 },
                    
                    // Plutonium isotopes
                    'Pu-238': { mass: 0, lambda: 2.5e-10, half_life: 87.7 * 3.15576e7, parent: null, molar_mass: 238.049560, Q_alpha: 5.593, activity: 0, decay_heat: 0 },
                    'Pu-239': { mass: 0, lambda: 9.102e-13, half_life: 2.411e4 * 3.15576e7, parent: null, molar_mass: 239.052163, Q_alpha: 5.244, activity: 0, decay_heat: 0 },
                    'Pu-240': { mass: 0, lambda: 3.4e-12, half_life: 6561 * 3.15576e7, parent: null, molar_mass: 240.053814, Q_alpha: 5.255, activity: 0, decay_heat: 0 },
                    'Pu-241': { mass: 0, lambda: 1.5e-10, half_life: 14.35 * 3.15576e7, parent: null, molar_mass: 241.056851, Q_beta: 0.021, activity: 0, decay_heat: 0 },
                    'Pu-242': { mass: 0, lambda: 5.7e-13, half_life: 3.733e5 * 3.15576e7, parent: null, molar_mass: 242.058743, Q_alpha: 4.984, activity: 0, decay_heat: 0 },
                    
                    // Americium isotopes
                    'Am-241': { mass: 0, lambda: 1.6e-10, half_life: 432.2 * 3.15576e7, parent: 'Pu-241', molar_mass: 241.056829, Q_alpha: 5.638, activity: 0, decay_heat: 0 },
                    'Am-243': { mass: 0, lambda: 2.0e-13, half_life: 7370 * 3.15576e7, parent: null, molar_mass: 243.061381, Q_alpha: 5.438, activity: 0, decay_heat: 0 },
                    
                    // Curium isotopes
                    'Cm-242': { mass: 0, lambda: 1.2e-8, half_life: 0.445 * 3.15576e7, parent: null, molar_mass: 242.058836, Q_alpha: 6.216, activity: 0, decay_heat: 0 },
                    'Cm-244': { mass: 0, lambda: 1.2e-9, half_life: 18.1 * 3.15576e7, parent: null, molar_mass: 244.062752, Q_alpha: 5.902, activity: 0, decay_heat: 0 },
                },
                
                // Transient events
                transient_events: [],
                event_id: 0,
                new_event_type: 'rod_insert',
                new_start: 10,
                new_duration: 5,
                new_value: 0.5,
                
                // History for charts
                history: {
                    time: [],
                    power: [],
                    rho: [],
                    T_center: [],
                    T_surf: [],
                    Xe: [],
                    Pu239: [],
                    flux: [],
                    decay_heat: [],
                    U235: [],
                    Np237: [],
                    Am241: []
                },
                
                // Log entries
                log_entries: [],
                
                // Constants
                barn: 1e-28,
                E_f: 3.2e-11,
                N_atoms_per_kg_HM: 2.43e24,
                fuel_mass: 100000,
                core_volume: 200,
                burnup: 0,
                conversion_ratio: 0.6,
                
                // Cross sections (expanded and more precise)
                sigma_f_u235: [0.1, 0.05, 0.01, 0.1, 582, 700],
                sigma_a_u235: [0.2, 0.1, 0.02, 0.2, 681, 800],
                sigma_f_u238: [0.01, 0.005, 0, 0, 0, 0],
                sigma_a_u238: [0.05, 0.03, 0.5, 10, 2.7, 3],
                sigma_f_pu239: [0.2, 0.1, 0.05, 0.3, 747, 850],
                sigma_a_pu239: [0.3, 0.2, 0.1, 0.5, 1018, 1200],
                sigma_f_pu241: [0.15, 0.08, 0.04, 0.2, 1011, 1100],
                sigma_a_pu241: [0.25, 0.15, 0.08, 0.3, 1370, 1500],
                sigma_a_np237: [0.05, 0.03, 0.1, 5, 175, 200],
                sigma_a_am241: [0.1, 0.05, 0.2, 10, 700, 800],
                sigma_a_xe135: [0, 0, 0, 1e4, 2.65e6, 3e6],
                sigma_a_sm149: [0, 0, 0, 100, 4e4, 5e4],
                sigma_a_b10: [0.1, 0.1, 1, 100, 3837, 4000],
                
                // Derived values
                xe_worth: 0,
                xe_equilibrium: 0,
                xe_peak_time: 0,
                sm_equilibrium: 0,
                
                // Charts
                charts: {},
                
                // Initialization
                init() {
                    this.setup_thermal_mesh();
                    this.initialize_inventories();
                    this.update_macro_xs();
                    this.calculate_power();
                    this.createCharts();
                    this.addLog('Ultra high-fidelity reactor simulator initialized', 'info');
                    this.addLog('Precision models loaded: 6-group neutron diffusion, thermal hydraulics, actinide transmutation', 'info');
                },
                
                setup_thermal_mesh() {
                    const r_fuel = this.fuel_rod_radius;
                    const r_clad_in = r_fuel + 0.0001; // Gap
                    const r_clad_out = r_clad_in + this.cladding_thickness;
                    this.dr = r_clad_out / (this.radial_nodes - 1);
                    this.r_nodes = Array.from({length: this.radial_nodes}, (_, i) => i * this.dr);
                    this.T_fuel = Array(this.radial_nodes).fill(800);
                    this.q_vol = Array(this.radial_nodes).fill(0);
                },
                
                initialize_inventories() {
                    // Initialize neutron flux
                    this.phi[4] = 1e13 * 1e4; // Thermal group
                    for (let g = 0; g < 6; g++) {
                        this.phi[g] = this.phi[4] / (g + 1); // Rough spectrum
                    }
                    
                    // Initialize delayed neutron precursors
                    for (let dg = 0; dg < 6; dg++) {
                        for (let g = 0; g < 6; g++) {
                            this.C[dg][g] = this.beta_groups[dg] / this.Lambda * this.nu_Sigma_f[g] * this.phi[g] / this.lambda_groups[dg];
                        }
                    }
                    
                    // Initialize actinide activities
                    for (let key in this.actinide_inventory) {
                        const act = this.actinide_inventory[key];
                        act.activity = act.lambda * act.mass * 1000 / act.molar_mass * 6.022e23;
                        const Q = (act.Q_alpha || act.Q_beta || 0) * 1.602e-13; // J per decay
                        act.decay_heat = act.activity * Q;
                    }
                },
                
                // Core physics calculations - enhanced precision
                update_macro_xs() {
                    let N_HM = this.N_atoms_per_kg_HM * this.fuel_mass / this.core_volume;
                    
                    // Calculate number densities for each isotope
                    let N_u234 = N_HM * (this.actinide_inventory['U-234'].mass / 100);
                    let N_u235 = N_HM * (this.actinide_inventory['U-235'].mass / 100);
                    let N_u236 = N_HM * (this.actinide_inventory['U-236'].mass / 100);
                    let N_u238 = N_HM * (this.actinide_inventory['U-238'].mass / 100);
                    let N_pu239 = N_HM * (this.actinide_inventory['Pu-239'].mass / 100);
                    let N_pu240 = N_HM * (this.actinide_inventory['Pu-240'].mass / 100);
                    let N_pu241 = N_HM * (this.actinide_inventory['Pu-241'].mass / 100);
                    let N_np237 = N_HM * (this.actinide_inventory['Np-237'].mass / 100);
                    let N_am241 = N_HM * (this.actinide_inventory['Am-241'].mass / 100);
                    
                    for (let g = 0; g < 6; g++) {
                        // Temperature-dependent cross sections with precise models
                        const doppler_factor = Math.sqrt(800 / this.T);
                        const sigma_a_u235 = this.sigma_a_u235[g] * doppler_factor;
                        const sigma_f_u235 = this.sigma_f_u235[g] * (1 - 0.00012 * (this.T - 800));
                        const sigma_a_u238 = this.sigma_a_u238[g] * doppler_factor;
                        
                        // Macro absorption cross section
                        this.Sigma_a[g] = N_u235 * sigma_a_u235 * this.barn +
                                          N_u238 * sigma_a_u238 * this.barn +
                                          N_pu239 * this.sigma_a_pu239[g] * this.barn +
                                          N_pu241 * this.sigma_a_pu241[g] * this.barn +
                                          N_np237 * this.sigma_a_np237[g] * this.barn +
                                          N_am241 * this.sigma_a_am241[g] * this.barn +
                                          this.fp_inventory['Xe-135'].mass * this.sigma_a_xe135[g] * this.barn +
                                          this.fp_inventory['Sm-149'].mass * this.sigma_a_sm149[g] * this.barn;
                        
                        // Macro fission cross section
                        this.nu_Sigma_f[g] = (N_u235 * sigma_f_u235 +
                                              N_pu239 * this.sigma_f_pu239[g] +
                                              N_pu241 * this.sigma_f_pu241[g]) * 2.43 * this.barn;
                    }
                    
                    // Control rod effect with precise geometry
                    let rod_vf = Math.PI * 0.005**2 * 4 / this.core_volume * this.control_rod_insertion;
                    let N_ctrl = 2.5e3 * 6.022e23 / 10.8;
                    for (let g = 0; g < 6; g++) {
                        this.Sigma_a[g] += rod_vf * N_ctrl * this.sigma_a_b10[g] * this.barn;
                    }
                    
                    // Moderator effect based on type
                    let mod_density = this.get_moderator_density();
                    let mod_factor = mod_density / 1000;
                    for (let g = 0; g < 6; g++) {
                        // Increase scattering with moderator density
                        this.Sigma_a[g] *= (1 - 0.1 * (1 - mod_factor)); // Simplified model
                    }
                },
                
                get_moderator_density() {
                    switch(this.moderator_type) {
                        case 'water': return 700; // Simplified - would be temperature dependent
                        case 'heavy_water': return 1100;
                        case 'graphite': return 1600;
                        case 'beryllium': return 1850;
                        default: return 700;
                    }
                },
                
                calculate_rho() {
                    let prod = this.nu_Sigma_f.reduce((a, b) => a + b, 0);
                    let abs = this.Sigma_a.reduce((a, b) => a + b, 0);
                    let k_inf = prod / abs;
                    let B2 = Math.PI**2 / 4;
                    let leak = 0.1 * B2; // Simplified leakage
                    this.k_eff = k_inf / (1 + leak);
                    this.rho = (this.k_eff - 1) / this.k_eff;
                    
                    // Enhanced feedback effects with more precise coefficients
                    this.rho += -0.000025 * (this.T - 573); // Doppler (more precise)
                    this.rho += -0.00035 * this.burnup; // Burnup (enhanced)
                    
                    // Moderator temperature effect
                    let mod_temp = (this.T_coolant_in + this.T_coolant_out) / 2;
                    this.rho += -0.000015 * (mod_temp - 573); // Moderator temperature
                    
                    // Void coefficient (simplified)
                    let void_frac = Math.max(0, (mod_temp - 600) / 100);
                    this.rho += -0.0001 * void_frac;
                    
                    // Xenon worth (dynamic)
                    this.xe_worth = -0.00015 * this.fp_inventory['Xe-135'].mass;
                    this.rho += this.xe_worth;
                },
                
                calculate_power() {
                    this.power = this.E_f / 1e6 * this.core_volume * 
                                this.nu_Sigma_f.reduce((s, nf, g) => s + nf * this.phi[g], 0);
                },
                
                step_kinetics() {
                    this.update_macro_xs();
                    let dphi = Array(6).fill(0);
                    let total_prod = this.nu_Sigma_f.reduce((s, nf, g) => s + nf * this.phi[g], 0);
                    let prompt = (this.rho - this.beta_total) / this.Lambda * total_prod;
                    
                    for (let g = 0; g < 6; g++) {
                        let abs = -this.Sigma_a[g] * this.phi[g];
                        let scatter = 0;
                        
                        // More precise scattering model
                        if (g < 5) scatter = 0.12 * this.phi[g] - 0.1 * this.phi[g+1];
                        if (g > 0) scatter += 0.05 * this.phi[g-1] - 0.05 * this.phi[g];
                        
                        dphi[g] = (prompt / 6) + abs + scatter;
                        
                        // Delayed neutron contribution
                        for (let dg = 0; dg < 6; dg++) {
                            dphi[g] += this.lambda_groups[dg] * this.C[dg][g];
                        }
                        dphi[g] *= this.dt;
                        
                        // Update delayed neutron precursors
                        for (let dg = 0; dg < 6; dg++) {
                            let dC = this.beta_groups[dg] / this.Lambda * this.nu_Sigma_f[g] * this.phi[g] - 
                                      this.lambda_groups[dg] * this.C[dg][g];
                            this.C[dg][g] += dC * this.dt;
                        }
                    }
                    
                    for (let g = 0; g < 6; g++) {
                        this.phi[g] = Math.max(1, this.phi[g] + dphi[g]);
                    }
                },
                
                calculate_q_vol() {
                    const total_fissions = this.power * 1e6 / this.E_f;
                    const vol_per_rod = Math.PI * this.fuel_rod_radius**2 * 4.0; // Assuming 4m length
                    const num_rods = 50000;
                    const total_fuel_vol = vol_per_rod * num_rods;
                    const q_avg = total_fissions * this.E_f / total_fuel_vol;
                    
                    for (let i = 0; i < this.radial_nodes; i++) {
                        const r = this.r_nodes[i];
                        if (r >= this.fuel_rod_radius) {
                            this.q_vol[i] = 0;
                        } else {
                            // More precise radial power distribution
                            const radial_factor = Math.cos(Math.PI * r / (2 * this.fuel_rod_radius));
                            const burnup_effect = 1 - 0.0001 * this.burnup; // Burnup reduces power peaking
                            this.q_vol[i] = q_avg * 1.25 * radial_factor * burnup_effect;
                        }
                    }
                },
                
                calculate_thermal_profile() {
                    this.calculate_q_vol();
                    const T_new = [...this.T_fuel];
                    const r_f = this.fuel_rod_radius;
                    
                    // Enhanced thermal model with temperature-dependent properties
                    for (let i = 1; i < this.radial_nodes - 1; i++) {
                        const r_i = this.r_nodes[i];
                        const dr = this.dr;
                        
                        let k_i, cp, rho;
                        if (r_i < r_f) {
                            // UO2 thermal conductivity - more precise temperature dependence
                            k_i = 2.5 + 0.0006 * (this.T_fuel[i] - 800) - 1e-7 * (this.T_fuel[i] - 800)**2;
                            cp = 300 + 0.1 * (this.T_fuel[i] - 800); // Temperature-dependent heat capacity
                            rho = 10900;
                        } else {
                            // Zircaloy thermal conductivity
                            k_i = 15 + 0.012 * (this.T_fuel[i] - 600);
                            cp = 300 + 0.05 * (this.T_fuel[i] - 600);
                            rho = 6500;
                        }
                        
                        const A_im = 2 * Math.PI * (r_i - dr/2) * 4.0;
                        const A_ip = 2 * Math.PI * (r_i + dr/2) * 4.0;
                        const V_i = Math.PI * ((r_i + dr/2)**2 - (r_i - dr/2)**2) * 4.0;
                        
                        const dTdt = (1 / (rho * cp)) * (
                            (k_i * A_ip * (this.T_fuel[i+1] - this.T_fuel[i]) / dr -
                             k_i * A_im * (this.T_fuel[i] - this.T_fuel[i-1]) / dr) / V_i +
                            this.q_vol[i]
                        );
                        T_new[i] = this.T_fuel[i] + dTdt * this.dt;
                    }
                    
                    // Centerline (symmetry) with enhanced model
                    const k0 = 2.5 + 0.0006 * (this.T_fuel[0] - 800) - 1e-7 * (this.T_fuel[0] - 800)**2;
                    const cp0 = 300 + 0.1 * (this.T_fuel[0] - 800);
                    const V0 = Math.PI * (this.dr/2)**2 * 4.0;
                    const A0 = 2 * Math.PI * (this.dr/2) * 4.0;
                    const dTdt0 = (1 / (10900 * cp0)) * (
                        4 * k0 * A0 * (this.T_fuel[1] - this.T_fuel[0]) / this.dr / V0 +
                        this.q_vol[0]
                    );
                    T_new[0] = this.T_fuel[0] + dTdt0 * this.dt;
                    
                    // Outer surface (convection) with enhanced heat transfer
                    const i = this.radial_nodes - 1;
                    const r_o = this.r_nodes[i];
                    const A_o = 2 * Math.PI * r_o * 4.0;
                    const V_o = Math.PI * (r_o**2 - (r_o - this.dr/2)**2) * 4.0;
                    const k_o = 15 + 0.012 * (this.T_fuel[i] - 600);
                    const cp_o = 300 + 0.05 * (this.T_fuel[i] - 600);
                    const A_im = 2 * Math.PI * (r_o - this.dr/2) * 4.0;
                    
                    // Enhanced heat transfer coefficient with flow rate dependence
                    const h_enhanced = this.h_coolant * (this.coolant_flow_rate / 15000)**0.8;
                    
                    const dTdt_o = (1 / (6500 * cp_o)) * (
                        k_o * A_im * (this.T_fuel[i-1] - this.T_fuel[i]) / this.dr / V_o +
                        h_enhanced * A_o * (this.T_coolant_out - this.T_fuel[i]) / V_o
                    );
                    T_new[i] = this.T_fuel[i] + dTdt_o * this.dt;
                    
                    this.T_fuel = T_new;
                    this.T = this.T_fuel.reduce((a, b) => a + b, 0) / this.T_fuel.length;
                },
                
                update_coolant_temp() {
                    const total_heat = this.power * 1e6;
                    const cp_water = 4200 + 10 * ((this.T_coolant_in + this.T_coolant_out)/2 - 573); // Temp-dependent
                    const dT_coolant = total_heat / (this.coolant_flow_rate * cp_water);
                    this.T_coolant_out = this.T_coolant_in + dT_coolant;
                },
                
                step_fp() {
                    const fission_rate = this.power * 1e6 / this.E_f;
                    const V = this.core_volume;
                    
                    // I-135 ‚Üí Xe-135 with more precise yield values
                    const di135 = 0.0637 * fission_rate / V - 2.92e-5 * this.fp_inventory['I-135'].mass;
                    this.fp_inventory['I-135'].mass += di135 * this.dt;
                    
                    // Xe-135 production from fission and I-135 decay, removal by decay and neutron capture
                    const dxe135 = 2.92e-5 * this.fp_inventory['I-135'].mass + 
                                   0.00237 * fission_rate / V -
                                   2.09e-5 * this.fp_inventory['Xe-135'].mass -
                                   this.sigma_a_xe135[4] * this.barn * this.phi[4] * this.fp_inventory['Xe-135'].mass;
                    this.fp_inventory['Xe-135'].mass += dxe135 * this.dt;
                    
                    // Pm-149 ‚Üí Sm-149
                    const dpm149 = 0.0109 * fission_rate / V - 3.66e-6 * this.fp_inventory['Pm-149'].mass;
                    this.fp_inventory['Pm-149'].mass += dpm149 * this.dt;
                    
                    const dsm149 = 3.66e-6 * this.fp_inventory['Pm-149'].mass -
                                   this.sigma_a_sm149[4] * this.barn * this.phi[4] * this.fp_inventory['Sm-149'].mass;
                    this.fp_inventory['Sm-149'].mass += dsm149 * this.dt;
                    
                    // Additional fission products
                    for (let key in this.fp_inventory) {
                        const fp = this.fp_inventory[key];
                        if (!fp.parent && fp.yield > 0 && key !== 'I-135' && key !== 'Pm-149') {
                            const dfp = fp.yield * fission_rate / V - fp.lambda * fp.mass;
                            fp.mass += dfp * this.dt;
                        }
                    }
                    
                    // Update activities and decay heat
                    for (let key in this.fp_inventory) {
                        const fp = this.fp_inventory[key];
                        fp.activity = fp.lambda * fp.mass * 1000 / fp.molar_mass * 6.022e23;
                        // Approximate decay heat based on average energy per decay
                        const avg_energy = 0.5; // MeV per decay (simplified)
                        fp.decay_heat = fp.activity * avg_energy * 1.602e-13;
                    }
                    
                    // Calculate Xe equilibrium parameters
                    const xe_removal = 2.09e-5 + this.sigma_a_xe135[4] * this.barn * this.phi[4];
                    this.xe_equilibrium = 1 / xe_removal / 3600;
                    this.xe_peak_time = Math.log(2.09e-5 / 2.92e-5) / (2.09e-5 - 2.92e-5) / 3600;
                    
                    // Sm equilibrium
                    this.sm_equilibrium = 0.0109 * fission_rate / V / (this.sigma_a_sm149[4] * this.barn * this.phi[4]);
                },
                
                step_actinides() {
                    const V = this.core_volume;
                    const N_HM = this.N_atoms_per_kg_HM * this.fuel_mass / V;
                    
                    // U-238 capture to Np-239 (decays to Pu-239)
                    let capture_u238 = 0;
                    for (let g = 0; g < 6; g++) {
                        capture_u238 += this.phi[g] * this.sigma_a_u238[g] * this.barn * 
                                       (this.actinide_inventory['U-238'].mass / 100) * N_HM * 0.85;
                    }
                    const d_np239 = capture_u238 * this.dt * 239 / (this.N_atoms_per_kg_HM * this.fuel_mass) * 100;
                    
                    // Np-239 decays to Pu-239 with half-life 2.355 days
                    const lambda_np239 = 3.41e-6;
                    const d_pu239_from_np = lambda_np239 * d_np239 * this.dt;
                    this.actinide_inventory['Pu-239'].mass += d_pu239_from_np;
                    this.actinide_inventory['U-238'].mass -= d_np239 * 238 / 239;
                    
                    // Pu-239 capture to Pu-240
                    let capture_pu239 = 0;
                    for (let g = 0; g < 6; g++) {
                        capture_pu239 += this.phi[g] * this.sigma_a_pu239[g] * this.barn * 
                                        (this.actinide_inventory['Pu-239'].mass / 100) * N_HM;
                    }
                    const d_pu240 = capture_pu239 * this.dt * 240 / (this.N_atoms_per_kg_HM * this.fuel_mass) * 100;
                    this.actinide_inventory['Pu-240'].mass += d_pu240;
                    this.actinide_inventory['Pu-239'].mass -= d_pu240 * 239 / 240;
                    
                    // Pu-241 production from Pu-240
                    let capture_pu240 = 0;
                    for (let g = 0; g < 6; g++) {
                        // Simplified - would need sigma_a_pu240
                        capture_pu240 += this.phi[g] * 300 * this.barn * 
                                        (this.actinide_inventory['Pu-240'].mass / 100) * N_HM;
                    }
                    const d_pu241 = capture_pu240 * this.dt * 241 / (this.N_atoms_per_kg_HM * this.fuel_mass) * 100;
                    this.actinide_inventory['Pu-241'].mass += d_pu241;
                    this.actinide_inventory['Pu-240'].mass -= d_pu241 * 240 / 241;
                    
                    // Pu-241 decays to Am-241
                    const d_am241 = this.actinide_inventory['Pu-241'].lambda * this.actinide_inventory['Pu-241'].mass * this.dt;
                    this.actinide_inventory['Am-241'].mass += d_am241;
                    this.actinide_inventory['Pu-241'].mass -= d_am241;
                    
                    // U-235 depletion
                    let depletion_u235 = 0;
                    for (let g = 0; g < 6; g++) {
                        depletion_u235 += this.phi[g] * this.sigma_f_u235[g] * this.barn * 
                                         (this.actinide_inventory['U-235'].mass / 100) * N_HM;
                    }
                    this.actinide_inventory['U-235'].mass -= depletion_u235 * this.dt * 100 / (this.N_atoms_per_kg_HM * this.fuel_mass);
                    
                    // Update activities and decay heat for all actinides
                    for (let [nuclide, data] of Object.entries(this.actinide_inventory)) {
                        data.activity = data.lambda * data.mass * 1000 / data.molar_mass * 6.022e23;
                        const Q = (data.Q_alpha || data.Q_beta || 0) * 1.602e-13; // J per decay
                        data.decay_heat = data.activity * Q;
                    }
                    
                    // Calculate conversion ratio
                    const total_capture = capture_u238 + capture_pu239 + capture_pu240;
                    const total_fission = depletion_u235 / this.dt * (this.N_atoms_per_kg_HM * this.fuel_mass / 100);
                    this.conversion_ratio = total_capture / total_fission;
                },
                
                update_burnup() {
                    this.burnup += this.power * this.dt / (86400 * this.fuel_mass / 1000);
                },
                
                // Control system with enhanced PID
                control_power() {
                    if (this.target_power <= 0) {
                        this.control_rod_insertion = Math.min(1, this.control_rod_insertion + 0.01);
                        return;
                    }
                    
                    const error = this.target_power - this.power;
                    // Enhanced PID with power-dependent gain
                    const gain = 0.001 * (1 + 0.0005 * this.power); // Increase gain at higher power
                    const rod_adjust = gain * error * this.dt;
                    this.control_rod_insertion = Math.max(0, Math.min(1, this.control_rod_insertion - rod_adjust));
                },
                
                // Transient events
                addEvent(type, start, duration, value) {
                    this.transient_events.push({
                        id: ++this.event_id,
                        type,
                        start,
                        duration,
                        value,
                        active: false
                    });
                    this.addLog(`Scheduled: ${type} at t=${start}s`, 'info');
                },
                
                removeEvent(id) {
                    this.transient_events = this.transient_events.filter(e => e.id !== id);
                },
                
                apply_transients() {
                    this.transient_events.forEach(event => {
                        const active = this.sim_time >= event.start && this.sim_time < event.start + event.duration;
                        if (active && !event.active) {
                            this.addLog(`ACTIVATED: ${event.type}`, 'warning');
                        }
                        if (!active && event.active) {
                            this.addLog(`DEACTIVATED: ${event.type}`, 'info');
                        }
                        event.active = active;
                        
                        if (active) {
                            switch (event.type) {
                                case 'rod_insert':
                                    this.control_rod_insertion = Math.min(1, this.control_rod_insertion + event.value * this.dt / event.duration);
                                    break;
                                case 'rod_withdraw':
                                    this.control_rod_insertion = Math.max(0, this.control_rod_insertion - event.value * this.dt / event.duration);
                                    break;
                                case 'power_demand':
                                    this.target_power = event.value;
                                    break;
                                case 'coolant_loss':
                                    this.coolant_flow_rate = event.value;
                                    break;
                                case 'scram':
                                    this.control_rod_insertion = 1;
                                    this.target_power = 0;
                                    break;
                                case 'xenon_transient':
                                    // Simulate xenon oscillation by perturbing flux
                                    this.phi[4] *= (1 + 0.05 * Math.sin(this.sim_time * 0.1));
                                    break;
                                case 'fuel_temp_spike':
                                    this.T_fuel = this.T_fuel.map(t => t + event.value * this.dt / event.duration);
                                    break;
                            }
                        }
                    });
                },
                
                // Main simulation step
                step() {
                    this.apply_transients();
                    this.control_power();
                    this.calculate_rho();
                    this.step_kinetics();
                    this.calculate_power();
                    this.calculate_thermal_profile();
                    this.update_coolant_temp();
                    this.step_fp();
                    this.step_actinides();
                    this.update_burnup();
                    this.sim_time += this.dt;
                    
                    // Update history for charts
                    if (this.sim_time % 0.1 < this.dt) {
                        this.history.time.push(this.sim_time);
                        this.history.power.push(this.power);
                        this.history.rho.push(this.rho * 1e5);
                        this.history.T_center.push(this.T_fuel[0]);
                        this.history.T_surf.push(this.T_fuel[this.T_fuel.length-1]);
                        this.history.Xe.push(this.fp_inventory['Xe-135'].mass);
                        this.history.Pu239.push(this.actinide_inventory['Pu-239'].mass);
                        this.history.flux.push(this.phi[4] / 1e16);
                        this.history.U235.push(this.actinide_inventory['U-235'].mass);
                        this.history.Np237.push(this.actinide_inventory['Np-237'].mass);
                        this.history.Am241.push(this.actinide_inventory['Am-241'].mass);
                        
                        // Calculate total decay heat from all sources
                        let total_decay_heat = 0;
                        for (let key in this.fp_inventory) {
                            total_decay_heat += this.fp_inventory[key].decay_heat;
                        }
                        for (let key in this.actinide_inventory) {
                            total_decay_heat += this.actinide_inventory[key].decay_heat;
                        }
                        this.history.decay_heat.push(total_decay_heat / 1e6); // Convert to MW
                        
                        // Keep history length manageable
                        if (this.history.time.length > 500) {
                            for (let key in this.history) {
                                this.history[key].shift();
                            }
                        }
                        
                        this.updateCharts();
                    }
                    
                    // Enhanced safety checks
                    if (this.T_fuel[0] > 2800) {
                        this.addLog('CRITICAL: Fuel centerline temperature exceeds UO‚ÇÇ melting point (3120 K)!', 'critical');
                    } else if (this.T_fuel[0] > 2500) {
                        this.addLog('WARNING: Fuel centerline temperature approaching melting point', 'warning');
                    }
                    
                    if (this.power > 3500) {
                        this.addLog('CRITICAL: Power output exceeds design limit (3500 MW)!', 'critical');
                    } else if (this.power > 3200) {
                        this.addLog('WARNING: Power output approaching design limit', 'warning');
                    }
                    
                    if (this.rho > 0.005) {
                        this.addLog('WARNING: Positive reactivity insertion detected', 'warning');
                    }
                    
                    if (this.T_coolant_out > 620) {
                        this.addLog('WARNING: Coolant outlet temperature high', 'warning');
                    }
                },
                
                // UI controls
                toggle() {
                    if (this.running) {
                        clearInterval(this.interval);
                        this.running = false;
                        this.addLog('Reactor shutdown initiated', 'info');
                    } else {
                        this.running = true;
                        this.interval = setInterval(() => this.step(), this.dt * 1000);
                        this.addLog('Reactor startup initiated', 'info');
                    }
                },
                
                reset() {
                    clearInterval(this.interval);
                    this.running = false;
                    this.sim_time = 0;
                    this.power = 0;
                    this.rho = 0;
                    this.control_rod_insertion = 0.5;
                    this.target_power = 3000;
                    this.coolant_flow_rate = 15000;
                    this.burnup = 0;
                    this.transient_events = [];
                    this.history = {
                        time: [], power: [], rho: [], T_center: [], T_surf: [], 
                        Xe: [], Pu239: [], flux: [], decay_heat: [],
                        U235: [], Np237: [], Am241: []
                    };
                    this.initialize_inventories();
                    this.setup_thermal_mesh();
                    this.update_macro_xs();
                    this.addLog('Simulation reset to initial conditions', 'info');
                    this.updateCharts();
                },
                
                // Status indicators
                getStatusClass() {
                    if (!this.running) return 'status-offline';
                    if (this.T_fuel[0] > 2500 || this.power > 3500 || this.rho > 0.005) return 'status-critical';
                    if (this.T_fuel[0] > 2000 || this.power > 3200 || this.rho > 0.001) return 'status-warning';
                    return 'status-normal';
                },
                
                getStatusText() {
                    if (!this.running) return 'OFFLINE';
                    if (this.T_fuel[0] > 2500 || this.power > 3500 || this.rho > 0.005) return 'CRITICAL';
                    if (this.T_fuel[0] > 2000 || this.power > 3200 || this.rho > 0.001) return 'WARNING';
                    return 'NORMAL';
                },
                
                // Chart management
                createCharts() {
                    const ctxPower = this.$refs.chartPower.getContext('2d');
                    this.charts.power = new Chart(ctxPower, {
                        type: 'line',
                        data: {
                            labels: this.history.time,
                            datasets: [
                                {
                                    label: 'Power (MW)',
                                    data: this.history.power,
                                    borderColor: '#3498db',
                                    backgroundColor: 'rgba(52, 152, 219, 0.1)',
                                    fill: true,
                                    yAxisID: 'y',
                                    tension: 0.4
                                },
                                {
                                    label: 'Reactivity (pcm)',
                                    data: this.history.rho,
                                    borderColor: '#e74c3c',
                                    borderDash: [5, 5],
                                    yAxisID: 'y1',
                                    tension: 0.4
                                }
                            ]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            interaction: {
                                mode: 'index',
                                intersect: false,
                            },
                            scales: {
                                x: {
                                    title: { display: true, text: 'Time (s)' },
                                    grid: { color: 'rgba(255, 255, 255, 0.1)' }
                                },
                                y: {
                                    type: 'linear',
                                    display: true,
                                    position: 'left',
                                    title: { display: true, text: 'Power (MW)' },
                                    grid: { color: 'rgba(255, 255, 255, 0.1)' },
                                    min: 0
                                },
                                y1: {
                                    type: 'linear',
                                    display: true,
                                    position: 'right',
                                    title: { display: true, text: 'Reactivity (pcm)' },
                                    grid: { drawOnChartArea: false }
                                }
                            }
                        }
                    });
                    
                    const ctxThermal = this.$refs.chartThermal.getContext('2d');
                    this.charts.thermal = new Chart(ctxThermal, {
                        type: 'line',
                        data: {
                            labels: this.history.time,
                            datasets: [
                                {
                                    label: 'Centerline Temp (K)',
                                    data: this.history.T_center,
                                    borderColor: '#e74c3c',
                                    backgroundColor: 'rgba(231, 76, 60, 0.1)',
                                    fill: true,
                                    tension: 0.4
                                },
                                {
                                    label: 'Surface Temp (K)',
                                    data: this.history.T_surf,
                                    borderColor: '#3498db',
                                    backgroundColor: 'rgba(52, 152, 219, 0.1)',
                                    fill: true,
                                    tension: 0.4
                                }
                            ]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            scales: {
                                x: { 
                                    title: { display: true, text: 'Time (s)' },
                                    grid: { color: 'rgba(255, 255, 255, 0.1)' }
                                },
                                y: { 
                                    title: { display: true, text: 'Temperature (K)' },
                                    grid: { color: 'rgba(255, 255, 255, 0.1)' }
                                }
                            }
                        }
                    });
                    
                    const ctxFlux = this.$refs.chartFlux.getContext('2d');
                    this.charts.flux = new Chart(ctxFlux, {
                        type: 'bar',
                        data: {
                            labels: ['Group 1', 'Group 2', 'Group 3', 'Group 4', 'Group 5', 'Group 6'],
                            datasets: [{
                                label: 'Neutron Flux (√ó10¬π‚Å∂ n/m¬≤/s)',
                                data: this.phi.map(p => p / 1e16),
                                backgroundColor: [
                                    'rgba(255, 99, 132, 0.7)',
                                    'rgba(54, 162, 235, 0.7)',
                                    'rgba(255, 206, 86, 0.7)',
                                    'rgba(75, 192, 192, 0.7)',
                                    'rgba(153, 102, 255, 0.7)',
                                    'rgba(255, 159, 64, 0.7)'
                                ],
                                borderColor: [
                                    'rgb(255, 99, 132)',
                                    'rgb(54, 162, 235)',
                                    'rgb(255, 206, 86)',
                                    'rgb(75, 192, 192)',
                                    'rgb(153, 102, 255)',
                                    'rgb(255, 159, 64)'
                                ],
                                borderWidth: 1
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            scales: {
                                y: {
                                    title: { display: true, text: 'Flux (√ó10¬π‚Å∂ n/m¬≤/s)' },
                                    grid: { color: 'rgba(255, 255, 255, 0.1)' }
                                },
                                x: {
                                    grid: { color: 'rgba(255, 255, 255, 0.1)' }
                                }
                            }
                        }
                    });
                    
                    const ctxPoisons = this.$refs.chartPoisons.getContext('2d');
                    this.charts.poisons = new Chart(ctxPoisons, {
                        type: 'line',
                        data: {
                            labels: this.history.time,
                            datasets: [
                                {
                                    label: 'Xe-135 (kg)',
                                    data: this.history.Xe,
                                    borderColor: '#9b59b6',
                                    backgroundColor: 'rgba(155, 89, 182, 0.1)',
                                    fill: true,
                                    tension: 0.4
                                },
                                {
                                    label: 'Pu-239 (kg)',
                                    data: this.history.Pu239,
                                    borderColor: '#2ecc71',
                                    backgroundColor: 'rgba(46, 204, 113, 0.1)',
                                    fill: true,
                                    tension: 0.4
                                }
                            ]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            scales: {
                                x: { 
                                    title: { display: true, text: 'Time (s)' },
                                    grid: { color: 'rgba(255, 255, 255, 0.1)' }
                                },
                                y: { 
                                    title: { display: true, text: 'Mass (kg)' },
                                    grid: { color: 'rgba(255, 255, 255, 0.1)' }
                                }
                            }
                        }
                    });
                    
                    const ctxActinides = this.$refs.chartActinides.getContext('2d');
                    this.charts.actinides = new Chart(ctxActinides, {
                        type: 'line',
                        data: {
                            labels: this.history.time,
                            datasets: [
                                {
                                    label: 'U-235 (kg)',
                                    data: this.history.U235,
                                    borderColor: '#3498db',
                                    backgroundColor: 'rgba(52, 152, 219, 0.1)',
                                    fill: true,
                                    tension: 0.4
                                },
                                {
                                    label: 'Pu-239 (kg)',
                                    data: this.history.Pu239,
                                    borderColor: '#2ecc71',
                                    backgroundColor: 'rgba(46, 204, 113, 0.1)',
                                    fill: true,
                                    tension: 0.4
                                },
                                {
                                    label: 'Np-237 (kg)',
                                    data: this.history.Np237,
                                    borderColor: '#f39c12',
                                    backgroundColor: 'rgba(243, 156, 18, 0.1)',
                                    fill: true,
                                    tension: 0.4
                                }
                            ]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            scales: {
                                x: { 
                                    title: { display: true, text: 'Time (s)' },
                                    grid: { color: 'rgba(255, 255, 255, 0.1)' }
                                },
                                y: { 
                                    title: { display: true, text: 'Mass (kg)' },
                                    grid: { color: 'rgba(255, 255, 255, 0.1)' }
                                }
                            }
                        }
                    });
                },
                
                updateCharts() {
                    if (!this.charts.power) return;
                    
                    this.charts.power.data.labels = this.history.time;
                    this.charts.power.data.datasets[0].data = this.history.power;
                    this.charts.power.data.datasets[1].data = this.history.rho;
                    this.charts.power.update('none');
                    
                    this.charts.thermal.data.labels = this.history.time;
                    this.charts.thermal.data.datasets[0].data = this.history.T_center;
                    this.charts.thermal.data.datasets[1].data = this.history.T_surf;
                    this.charts.thermal.update('none');
                    
                    this.charts.flux.data.datasets[0].data = this.phi.map(p => p / 1e16);
                    this.charts.flux.update('none');
                    
                    this.charts.poisons.data.labels = this.history.time;
                    this.charts.poisons.data.datasets[0].data = this.history.Xe;
                    this.charts.poisons.data.datasets[1].data = this.history.Pu239;
                    this.charts.poisons.update('none');
                    
                    this.charts.actinides.data.labels = this.history.time;
                    this.charts.actinides.data.datasets[0].data = this.history.U235;
                    this.charts.actinides.data.datasets[1].data = this.history.Pu239;
                    this.charts.actinides.data.datasets[2].data = this.history.Np237;
                    this.charts.actinides.update('none');
                },
                
                // Utility functions
                addLog(text, type = 'info') {
                    this.log_entries.unshift({ text: `[${this.sim_time.toFixed(3)}s] ${text}`, type });
                    if (this.log_entries.length > 50) this.log_entries.pop();
                    
                    // Auto-scroll log
                    setTimeout(() => {
                        if (this.$refs.log) this.$refs.log.scrollTop = 0;
                    }, 10);
                },
                
                formatTime(t) {
                    const h = Math.floor(t/3600);
                    const m = Math.floor((t%3600)/60);
                    const s = (t%60).toFixed(1);
                    return `${h}:${m.toString().padStart(2,'0')}:${s.padStart(4,'0')}`;
                },
                
                formatSci(x) {
                    if (x === 0) return '0';
                    if (x < 1e-10) return '<1e-10';
                    return x.toExponential(2);
                },
                
                formatHalfLife(s) {
                    if (s === Infinity) return 'Stable';
                    const y = s / 3.15576e7;
                    if (y > 1e6) return `${(y/1e6).toFixed(1)} My`;
                    if (y > 1e3) return `${(y/1e3).toFixed(1)} ky`;
                    if (y > 1) return `${y.toFixed(1)} y`;
                    const d = s / 86400;
                    if (d > 1) return `${d.toFixed(1)} d`;
                    const h = s / 3600;
                    if (h > 1) return `${h.toFixed(1)} h`;
                    const m = s / 60;
                    if (m > 1) return `${m.toFixed(1)} m`;
                    return `${s.toFixed(1)} s`;
                }
            };
        }
    </script>
</body>
</html>