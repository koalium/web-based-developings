<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PLC Control Panel Designer - Evaporative Ventilation</title>
    <script src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js" defer></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            margin: 0;
            padding: 0;
            background-color: #f5f7fa;
            color: #333;
            line-height: 1.6;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }
        
        header {
            background: linear-gradient(135deg, #2c3e50 0%, #4a6491 100%);
            color: white;
            padding: 25px 0;
            border-radius: 10px 10px 0 0;
            margin-bottom: 20px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }
        
        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 20px;
        }
        
        h1 {
            margin: 0;
            font-size: 1.8rem;
        }
        
        .subtitle {
            font-size: 1rem;
            opacity: 0.8;
            margin-top: 5px;
        }
        
        .control-buttons {
            display: flex;
            gap: 10px;
        }
        
        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: all 0.3s ease;
        }
        
        .btn-primary {
            background-color: #3498db;
            color: white;
        }
        
        .btn-primary:hover {
            background-color: #2980b9;
            transform: translateY(-2px);
        }
        
        .btn-secondary {
            background-color: #2ecc71;
            color: white;
        }
        
        .btn-secondary:hover {
            background-color: #27ae60;
            transform: translateY(-2px);
        }
        
        .btn-danger {
            background-color: #e74c3c;
            color: white;
        }
        
        .btn-danger:hover {
            background-color: #c0392b;
            transform: translateY(-2px);
        }
        
        .main-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 25px;
            margin-bottom: 30px;
        }
        
        @media (max-width: 1100px) {
            .main-content {
                grid-template-columns: 1fr;
            }
        }
        
        .card {
            background-color: white;
            border-radius: 10px;
            padding: 25px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
            margin-bottom: 20px;
        }
        
        .card-title {
            font-size: 1.4rem;
            margin-top: 0;
            margin-bottom: 20px;
            padding-bottom: 12px;
            border-bottom: 2px solid #f0f0f0;
            color: #2c3e50;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .component-list {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }
        
        .component-item {
            background-color: #f8f9fa;
            border-radius: 8px;
            padding: 15px;
            border-left: 4px solid #3498db;
            transition: all 0.3s ease;
        }
        
        .component-item:hover {
            background-color: #edf2f7;
            transform: translateX(5px);
        }
        
        .component-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }
        
        .component-name {
            font-weight: 600;
            font-size: 1.1rem;
            color: #2c3e50;
        }
        
        .component-controls {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .quantity-control {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .qty-btn {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            border: none;
            background-color: #3498db;
            color: white;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
        }
        
        .qty-btn:hover {
            background-color: #2980b9;
        }
        
        .qty-display {
            min-width: 40px;
            text-align: center;
            font-weight: bold;
            font-size: 1.1rem;
        }
        
        .component-details {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            margin-top: 10px;
        }
        
        .detail-item {
            display: flex;
            flex-direction: column;
            min-width: 120px;
        }
        
        .detail-label {
            font-size: 0.85rem;
            color: #7f8c8d;
            margin-bottom: 5px;
        }
        
        .detail-value {
            font-weight: 500;
        }
        
        .detail-input {
            padding: 8px 12px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 0.95rem;
            width: 100%;
        }
        
        .checkbox-group {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-top: 10px;
        }
        
        .checkbox-label {
            font-size: 0.9rem;
            color: #555;
        }
        
        .layout-container {
            background-color: #2c3e50;
            border-radius: 8px;
            padding: 15px;
            min-height: 600px;
            position: relative;
            overflow: auto;
        }
        
        .layout-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, 80px);
            grid-auto-rows: 100px;
            gap: 5px;
            width: 100%;
            min-height: 600px;
            background-color: #34495e;
            padding: 15px;
            border-radius: 5px;
        }
        
        .layout-component {
            border-radius: 4px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            font-size: 0.7rem;
            text-align: center;
            padding: 5px;
            overflow: hidden;
            position: relative;
            color: white;
            font-weight: 500;
            word-break: break-word;
        }
        
        .layout-component.plc {
            background-color: #3498db;
        }
        
        .layout-component.psu {
            background-color: #9b59b6;
        }
        
        .layout-component.breaker {
            background-color: #e74c3c;
        }
        
        .layout-component.contactor {
            background-color: #2ecc71;
        }
        
        .layout-component.relay {
            background-color: #f39c12;
        }
        
        .layout-component.inverter {
            background-color: #1abc9c;
        }
        
        .layout-component.soft-starter {
            background-color: #d35400;
        }
        
        .layout-component.hmi {
            background-color: #34495e;
        }
        
        .layout-component.terminal {
            background-color: #7f8c8d;
        }
        
        .bom-container {
            grid-column: 1 / -1;
            margin-top: 20px;
        }
        
        .bom-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
        }
        
        .bom-table th {
            background-color: #2c3e50;
            color: white;
            text-align: left;
            padding: 12px 15px;
            font-weight: 600;
        }
        
        .bom-table td {
            padding: 12px 15px;
            border-bottom: 1px solid #eee;
        }
        
        .bom-table tr:hover {
            background-color: #f9f9f9;
        }
        
        .tag {
            display: inline-block;
            background-color: #ecf0f1;
            padding: 3px 8px;
            border-radius: 4px;
            font-size: 0.85rem;
            margin: 2px;
            font-family: monospace;
        }
        
        .status-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background-color: white;
            padding: 15px 25px;
            border-radius: 10px;
            margin-top: 20px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
        }
        
        .total-cost {
            font-size: 1.5rem;
            font-weight: bold;
            color: #2c3e50;
        }
        
        .component-count {
            font-size: 1.1rem;
            color: #7f8c8d;
        }
        
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }
        
        .modal-content {
            background-color: white;
            border-radius: 10px;
            padding: 30px;
            width: 90%;
            max-width: 800px;
            max-height: 90vh;
            overflow-y: auto;
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .modal-title {
            font-size: 1.5rem;
            margin: 0;
        }
        
        .close-modal {
            background: none;
            border: none;
            font-size: 1.8rem;
            cursor: pointer;
            color: #7f8c8d;
        }
        
        .tabs {
            display: flex;
            border-bottom: 1px solid #eee;
            margin-bottom: 20px;
        }
        
        .tab {
            padding: 12px 24px;
            background: none;
            border: none;
            cursor: pointer;
            font-size: 1rem;
            color: #7f8c8d;
            border-bottom: 3px solid transparent;
            transition: all 0.3s ease;
        }
        
        .tab.active {
            color: #3498db;
            border-bottom: 3px solid #3498db;
            font-weight: 600;
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        .json-editor {
            width: 100%;
            height: 400px;
            font-family: monospace;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 0.9rem;
        }
        
        .connection-list {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        
        .connection-item {
            background-color: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            border-left: 4px solid #3498db;
        }
        
        .control-scenario {
            background-color: #f0f7ff;
            border-radius: 8px;
            padding: 20px;
            margin-top: 25px;
            border-left: 5px solid #3498db;
        }
        
        .scenario-title {
            font-size: 1.2rem;
            margin-top: 0;
            color: #2c3e50;
        }
        
        .scenario-text {
            font-family: monospace;
            background-color: #f8f9fa;
            padding: 15px;
            border-radius: 5px;
            overflow-x: auto;
            white-space: pre-wrap;
            line-height: 1.5;
        }
        
        .color-legend {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            margin-top: 15px;
            padding: 15px;
            background-color: #f8f9fa;
            border-radius: 8px;
        }
        
        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .legend-color {
            width: 20px;
            height: 20px;
            border-radius: 4px;
        }
        
        .no-print {
            display: block;
        }
        
        @media print {
            .no-print, .control-buttons, .status-bar, .btn {
                display: none !important;
            }
            
            .card {
                box-shadow: none;
                border: 1px solid #ddd;
            }
        }
    </style>
</head>
<body>
    <div x-data="plcDesigner()" x-init="init()">
        <header>
            <div class="container">
                <div class="header-content">
                    <div>
                        <h1><i class="fas fa-industry"></i> PLC Control Panel Designer</h1>
                        <div class="subtitle">Evaporative Ventilation Station for Textile Industry</div>
                    </div>
                    <div class="control-buttons">
                        <button class="btn btn-primary" @click="saveProject()">
                            <i class="fas fa-save"></i> Save Project
                        </button>
                        <button class="btn btn-secondary" @click="loadProject()">
                            <i class="fas fa-folder-open"></i> Load Project
                        </button>
                        <button class="btn btn-primary" @click="exportBOM()">
                            <i class="fas fa-file-export"></i> Export BOM
                        </button>
                        <button class="btn btn-danger" @click="showModal = 'print'">
                            <i class="fas fa-print"></i> Print/Export
                        </button>
                    </div>
                </div>
            </div>
        </header>
        
        <div class="container">
            <div class="main-content">
                <!-- Left Column: Component Configuration -->
                <div>
                    <!-- 3-Phase Motors -->
                    <div class="card">
                        <h2 class="card-title"><i class="fas fa-cogs"></i> 3-Phase Motors</h2>
                        <div class="component-list">
                            <template x-for="(motor, index) in motors" :key="index">
                                <div class="component-item">
                                    <div class="component-header">
                                        <div class="component-name" x-text="motor.name"></div>
                                        <div class="component-controls">
                                            <div class="quantity-control">
                                                <button class="qty-btn" @click="decrementQuantity(motor)">-</button>
                                                <div class="qty-display" x-text="motor.quantity"></div>
                                                <button class="qty-btn" @click="incrementQuantity(motor)">+</button>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="component-details">
                                        <div class="detail-item">
                                            <div class="detail-label">Default Quantity</div>
                                            <div class="detail-value" x-text="motor.defaultQuantity"></div>
                                        </div>
                                        <div class="detail-item">
                                            <div class="detail-label">Power (kW)</div>
                                            <input type="text" class="detail-input" x-model="motor.power" @change="calculateBOM()">
                                        </div>
                                        <div class="detail-item">
                                            <div class="detail-label">Voltage</div>
                                            <div class="detail-value">400V AC</div>
                                        </div>
                                    </div>
                                    <div class="checkbox-group" x-show="motor.hasOver5kw">
                                        <input type="checkbox" id="softstarter" x-model="useSoftStarter">
                                        <label class="checkbox-label" for="softstarter">Use Soft Starter (for motors > 5kW)</label>
                                    </div>
                                </div>
                            </template>
                        </div>
                    </div>
                    
                    <!-- Actuators -->
                    <div class="card">
                        <h2 class="card-title"><i class="fas fa-sliders-h"></i> Actuators</h2>
                        <div class="component-list">
                            <template x-for="(actuator, index) in actuators" :key="index">
                                <div class="component-item">
                                    <div class="component-header">
                                        <div class="component-name" x-text="actuator.name"></div>
                                        <div class="component-controls">
                                            <div class="quantity-control">
                                                <button class="qty-btn" @click="decrementQuantity(actuator)">-</button>
                                                <div class="qty-display" x-text="actuator.quantity"></div>
                                                <button class="qty-btn" @click="incrementQuantity(actuator)">+</button>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="component-details">
                                        <div class="detail-item">
                                            <div class="detail-label">Default Quantity</div>
                                            <div class="detail-value" x-text="actuator.defaultQuantity"></div>
                                        </div>
                                        <div class="detail-item">
                                            <div class="detail-label">Voltage</div>
                                            <input type="text" class="detail-input" x-model="actuator.voltage" @change="calculateBOM()">
                                        </div>
                                    </div>
                                    <div class="checkbox-group">
                                        <input type="checkbox" :id="'hasPositioner' + index" x-model="actuator.hasPositioner">
                                        <label class="checkbox-label" :for="'hasPositioner' + index">Has Positioner</label>
                                    </div>
                                    <div class="checkbox-group" x-show="actuator.hasPositioner">
                                        <input type="checkbox" :id="'readPosition' + index" x-model="actuator.readPosition">
                                        <label class="checkbox-label" :for="'readPosition' + index">Read Position</label>
                                    </div>
                                </div>
                            </template>
                        </div>
                    </div>
                </div>
                
                <!-- Right Column: Sensors, Optional, Layout -->
                <div>
                    <!-- Sensors -->
                    <div class="card">
                        <h2 class="card-title"><i class="fas fa-thermometer-half"></i> Sensors</h2>
                        <div class="component-list">
                            <template x-for="(sensor, index) in sensors" :key="index">
                                <div class="component-item">
                                    <div class="component-header">
                                        <div class="component-name" x-text="sensor.name"></div>
                                        <div class="component-controls">
                                            <div class="quantity-control">
                                                <button class="qty-btn" @click="decrementQuantity(sensor)">-</button>
                                                <div class="qty-display" x-text="sensor.quantity"></div>
                                                <button class="qty-btn" @click="incrementQuantity(sensor)">+</button>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="component-details">
                                        <div class="detail-item">
                                            <div class="detail-label">Default Quantity</div>
                                            <div class="detail-value" x-text="sensor.defaultQuantity"></div>
                                        </div>
                                        <div class="detail-item">
                                            <div class="detail-label">Type</div>
                                            <div class="detail-value" x-text="sensor.type"></div>
                                        </div>
                                    </div>
                                </div>
                            </template>
                        </div>
                    </div>
                    
                    <!-- Optional Components -->
                    <div class="card">
                        <h2 class="card-title"><i class="fas fa-plus-circle"></i> Optional Components</h2>
                        <div class="component-list">
                            <template x-for="(optional, index) in optionalComponents" :key="index">
                                <div class="component-item">
                                    <div class="component-header">
                                        <div class="component-name" x-text="optional.name"></div>
                                        <div class="component-controls">
                                            <div class="quantity-control">
                                                <button class="qty-btn" @click="decrementQuantity(optional)">-</button>
                                                <div class="qty-display" x-text="optional.quantity"></div>
                                                <button class="qty-btn" @click="incrementQuantity(optional)">+</button>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="component-details">
                                        <div class="detail-item">
                                            <div class="detail-label">Default Quantity</div>
                                            <div class="detail-value" x-text="optional.defaultQuantity"></div>
                                        </div>
                                        <div class="detail-item">
                                            <div class="detail-label">Specification</div>
                                            <input type="text" class="detail-input" x-model="optional.spec" @change="calculateBOM()">
                                        </div>
                                    </div>
                                    <div class="checkbox-group" x-show="optional.name === 'VFD Inverter'">
                                        <input type="checkbox" id="useInverter" x-model="useInverter">
                                        <label class="checkbox-label" for="useInverter">Use VFD for largest motor</label>
                                    </div>
                                </div>
                            </template>
                        </div>
                    </div>
                </div>
                
                <!-- Cabinet Layout Visualization -->
                <div class="card" style="grid-column: 1 / -1;">
                    <h2 class="card-title"><i class="fas fa-th-large"></i> Cabinet Layout</h2>
                    <div class="color-legend">
                        <div class="legend-item">
                            <div class="legend-color" style="background-color: #3498db;"></div>
                            <span>PLC & Modules</span>
                        </div>
                        <div class="legend-item">
                            <div class="legend-color" style="background-color: #9b59b6;"></div>
                            <span>Power Supply</span>
                        </div>
                        <div class="legend-item">
                            <div class="legend-color" style="background-color: #e74c3c;"></div>
                            <span>Breakers</span>
                        </div>
                        <div class="legend-item">
                            <div class="legend-color" style="background-color: #2ecc71;"></div>
                            <span>Contactors</span>
                        </div>
                        <div class="legend-item">
                            <div class="legend-color" style="background-color: #f39c12;"></div>
                            <span>Relays</span>
                        </div>
                        <div class="legend-item">
                            <div class="legend-color" style="background-color: #1abc9c;"></div>
                            <span>VFD Inverter</span>
                        </div>
                        <div class="legend-item">
                            <div class="legend-color" style="background-color: #d35400;"></div>
                            <span>Soft Starter</span>
                        </div>
                    </div>
                    <div class="layout-container">
                        <div class="layout-grid" id="layoutGrid">
                            <template x-for="(component, index) in layoutComponents" :key="index">
                                <div class="layout-component" 
                                     :class="component.type"
                                     :style="`grid-column: span ${component.width / 16}; grid-row: span ${component.height / 20};`">
                                    <div x-text="component.tag"></div>
                                    <div style="font-size: 0.6rem; margin-top: 3px;" x-text="component.details"></div>
                                </div>
                            </template>
                        </div>
                    </div>
                </div>
                
                <!-- Bill of Materials -->
                <div class="card bom-container">
                    <h2 class="card-title"><i class="fas fa-clipboard-list"></i> Bill of Materials (BOM)</h2>
                    <div class="component-count">Total Components: <span x-text="bom.length"></span></div>
                    <table class="bom-table">
                        <thead>
                            <tr>
                                <th>#</th>
                                <th>Component</th>
                                <th>Quantity</th>
                                <th>Specifications</th>
                                <th>Standards</th>
                                <th>Tags</th>
                            </tr>
                        </thead>
                        <tbody>
                            <template x-for="(item, index) in bom" :key="index">
                                <tr>
                                    <td x-text="index + 1"></td>
                                    <td x-text="item.name"></td>
                                    <td x-text="item.quantity"></td>
                                    <td x-text="item.specifications"></td>
                                    <td x-text="item.standards"></td>
                                    <td>
                                        <template x-for="tag in item.tags" :key="tag">
                                            <span class="tag" x-text="tag"></span>
                                        </template>
                                    </td>
                                </tr>
                            </template>
                        </tbody>
                    </table>
                </div>
                
                <!-- Control Scenario -->
                <div class="control-scenario">
                    <h3 class="scenario-title">Control Scenario</h3>
                    <div class="scenario-text">
Return air comes from saloon with saloon temp as RT, and saloon humidity as RH;
Exhaust air exhausted inside air with saloon; outdoor temp as OT, and humidity as OH;
Cycle air temp as CT, humidity as CH;
Cycle air properties depend on if heater valve on or off to just heating air with flow on coils and calc using psychometric air constant wet bulb temperature heating;
Mixing air temp as MT, humidity as HT calculated by mixing percentage of cycle air with outdoor air with psychometric of air using its HVAC approach of mixing airs;
Feed air is mixed air that can use water to humidify it if needed and result calc using psychometric with evaporative constant wet bulb;

Feed = fresh percentage + cycle percentage;
Fresh percentage = exhaust percentage;
Cycle percentage = 100 - fresh percentage;
Cycle can heat if needed;
Feed can humidify if needed;
Controlling done with close loop and dampers controls and steam valve and water pump;
                    </div>
                </div>
                
                <!-- Connection List -->
                <div class="card">
                    <h2 class="card-title"><i class="fas fa-plug"></i> Connection List</h2>
                    <div class="connection-list">
                        <template x-for="(connection, index) in connections" :key="index">
                            <div class="connection-item">
                                <div style="font-weight: 600; margin-bottom: 5px;" x-text="connection.from + ' → ' + connection.to"></div>
                                <div style="font-size: 0.9rem; color: #555;" x-text="connection.type"></div>
                                <div style="display: flex; gap: 10px; margin-top: 8px;">
                                    <span class="tag" x-text="connection.wireSize"></span>
                                    <span class="tag" x-text="connection.terminal"></span>
                                </div>
                            </div>
                        </template>
                    </div>
                </div>
            </div>
            
            <!-- Status Bar -->
            <div class="status-bar">
                <div class="total-cost">Estimated Components: <span x-text="bom.length"></span></div>
                <div class="component-count">Relays: <span x-text="relayCount"></span> | Contactors: <span x-text="contactorCount"></span> | Terminals: <span x-text="terminalCount"></span></div>
                <div>
                    <button class="btn btn-primary" @click="showModal = 'connections'">
                        <i class="fas fa-network-wired"></i> Wiring Details
                    </button>
                    <button class="btn btn-secondary" @click="showModal = 'json'">
                        <i class="fas fa-code"></i> JSON Data
                    </button>
                </div>
            </div>
        </div>
        
        <!-- Modals -->
        <template x-if="showModal === 'json'">
            <div class="modal">
                <div class="modal-content">
                    <div class="modal-header">
                        <h3 class="modal-title">Project JSON Data</h3>
                        <button class="close-modal" @click="showModal = null">&times;</button>
                    </div>
                    <p>Copy this JSON data to save your project, or paste JSON data to load a project.</p>
                    <textarea class="json-editor" x-text="getProjectJSON()"></textarea>
                    <div style="display: flex; gap: 10px; margin-top: 20px;">
                        <button class="btn btn-primary" @click="copyJSON()">
                            <i class="fas fa-copy"></i> Copy JSON
                        </button>
                        <button class="btn btn-secondary" @click="importJSON()">
                            <i class="fas fa-file-import"></i> Import from JSON
                        </button>
                        <button class="btn btn-danger" @click="showModal = null">
                            Close
                        </button>
                    </div>
                </div>
            </div>
        </template>
        
        <template x-if="showModal === 'connections'">
            <div class="modal">
                <div class="modal-content">
                    <div class="modal-header">
                        <h3 class="modal-title">Wiring and Connection Details</h3>
                        <button class="close-modal" @click="showModal = null">&times;</button>
                    </div>
                    <div class="tabs">
                        <button class="tab" :class="{ active: activeConnectionTab === 'terminals' }" @click="activeConnectionTab = 'terminals'">Terminal Plan</button>
                        <button class="tab" :class="{ active: activeConnectionTab === 'wirelist' }" @click="activeConnectionTab = 'wirelist'">Wire List</button>
                        <button class="tab" :class="{ active: activeConnectionTab === 'io' }" @click="activeConnectionTab = 'io'">PLC I/O List</button>
                    </div>
                    
                    <div class="tab-content" :class="{ active: activeConnectionTab === 'terminals' }">
                        <h4>Terminal Plan</h4>
                        <p>Total terminal blocks needed: <strong x-text="terminalCount"></strong></p>
                        <div style="background-color: #f8f9fa; padding: 15px; border-radius: 5px; margin-top: 15px;">
                            <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 15px;">
                                <template x-for="(terminal, index) in terminalPlan" :key="index">
                                    <div style="background-color: white; padding: 10px; border-radius: 5px; border-left: 4px solid #3498db;">
                                        <div style="font-weight: 600;" x-text="terminal.name"></div>
                                        <div style="font-size: 0.9rem; color: #555;">Type: <span x-text="terminal.type"></span></div>
                                        <div style="font-size: 0.9rem; color: #555;">Points: <span x-text="terminal.points"></span></div>
                                    </div>
                                </template>
                            </div>
                        </div>
                    </div>
                    
                    <div class="tab-content" :class="{ active: activeConnectionTab === 'wirelist' }">
                        <h4>Wire List</h4>
                        <table class="bom-table" style="margin-top: 15px;">
                            <thead>
                                <tr>
                                    <th>From</th>
                                    <th>To</th>
                                    <th>Wire Type</th>
                                    <th>Size (mm²)</th>
                                    <th>Length (m)</th>
                                    <th>Color</th>
                                </tr>
                            </thead>
                            <tbody>
                                <template x-for="(wire, index) in wireList" :key="index">
                                    <tr>
                                        <td x-text="wire.from"></td>
                                        <td x-text="wire.to"></td>
                                        <td x-text="wire.type"></td>
                                        <td x-text="wire.size"></td>
                                        <td x-text="wire.length"></td>
                                        <td x-text="wire.color"></td>
                                    </tr>
                                </template>
                            </tbody>
                        </table>
                    </div>
                    
                    <div class="tab-content" :class="{ active: activeConnectionTab === 'io' }">
                        <h4>PLC I/O List</h4>
                        <div style="display: flex; gap: 20px; margin-top: 15px;">
                            <div style="flex: 1;">
                                <h5>Digital Inputs</h5>
                                <div style="background-color: #f8f9fa; padding: 15px; border-radius: 5px; max-height: 300px; overflow-y: auto;">
                                    <template x-for="(di, index) in digitalInputs" :key="index">
                                        <div style="background-color: white; padding: 8px 12px; margin-bottom: 8px; border-radius: 4px; display: flex; justify-content: space-between;">
                                            <span x-text="di.name"></span>
                                            <span class="tag" x-text="di.address"></span>
                                        </div>
                                    </template>
                                </div>
                            </div>
                            <div style="flex: 1;">
                                <h5>Digital Outputs</h5>
                                <div style="background-color: #f8f9fa; padding: 15px; border-radius: 5px; max-height: 300px; overflow-y: auto;">
                                    <template x-for="(do, index) in digitalOutputs" :key="index">
                                        <div style="background-color: white; padding: 8px 12px; margin-bottom: 8px; border-radius: 4px; display: flex; justify-content: space-between;">
                                            <span x-text="do.name"></span>
                                            <span class="tag" x-text="do.address"></span>
                                        </div>
                                    </template>
                                </div>
                            </div>
                            <div style="flex: 1;">
                                <h5>Analog Inputs</h5>
                                <div style="background-color: #f8f9fa; padding: 15px; border-radius: 5px; max-height: 300px; overflow-y: auto;">
                                    <template x-for="(ai, index) in analogInputs" :key="index">
                                        <div style="background-color: white; padding: 8px 12px; margin-bottom: 8px; border-radius: 4px; display: flex; justify-content: space-between;">
                                            <span x-text="ai.name"></span>
                                            <span class="tag" x-text="ai.address"></span>
                                        </div>
                                    </template>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div style="margin-top: 20px; text-align: right;">
                        <button class="btn btn-danger" @click="showModal = null">
                            Close
                        </button>
                    </div>
                </div>
            </div>
        </template>
        
        <template x-if="showModal === 'print'">
            <div class="modal">
                <div class="modal-content">
                    <div class="modal-header">
                        <h3 class="modal-title">Print / Export Options</h3>
                        <button class="close-modal" @click="showModal = null">&times;</button>
                    </div>
                    <p>Choose an export option for your PLC panel design:</p>
                    <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 15px; margin-top: 20px;">
                        <button class="btn btn-primary" style="flex-direction: column; height: auto; padding: 20px;" @click="printDocument()">
                            <i class="fas fa-print fa-2x"></i>
                            <span style="margin-top: 10px;">Print Document</span>
                        </button>
                        <button class="btn btn-secondary" style="flex-direction: column; height: auto; padding: 20px;" @click="exportAsPNG()">
                            <i class="fas fa-image fa-2x"></i>
                            <span style="margin-top: 10px;">Export as PNG</span>
                        </button>
                        <button class="btn btn-primary" style="flex-direction: column; height: auto; padding: 20px;" @click="exportBOM()">
                            <i class="fas fa-file-csv fa-2x"></i>
                            <span style="margin-top: 10px;">Export BOM as CSV</span>
                        </button>
                        <button class="btn btn-secondary" style="flex-direction: column; height: auto; padding: 20px;" @click="saveProject()">
                            <i class="fas fa-save fa-2x"></i>
                            <span style="margin-top: 10px;">Save as JSON File</span>
                        </button>
                    </div>
                    <div style="margin-top: 20px; text-align: right;">
                        <button class="btn btn-danger" @click="showModal = null">
                            Cancel
                        </button>
                    </div>
                </div>
            </div>
        </template>
        
        <!-- Hidden file input for loading project -->
        <input type="file" id="fileInput" accept=".json" style="display: none;" @change="loadProjectFromFile($event)">
    </div>

    <script>
        function plcDesigner() {
            return {
                // Application state
                showModal: null,
                activeConnectionTab: 'terminals',
                
                // Component arrays
                motors: [
                    { id: 1, name: 'Fan Feed Motor', quantity: 2, defaultQuantity: 2, power: '22', voltage: '400V', hasOver5kw: true },
                    { id: 2, name: 'Fan Return Motor', quantity: 2, defaultQuantity: 2, power: '30', voltage: '400V', hasOver5kw: true },
                    { id: 3, name: 'Dust Fan Motor', quantity: 4, defaultQuantity: 4, power: '3.3', voltage: '400V', hasOver5kw: false },
                    { id: 4, name: 'Rotary Motor', quantity: 2, defaultQuantity: 2, power: '1', voltage: '400V', hasOver5kw: false },
                    { id: 5, name: 'Mechanism Motor', quantity: 2, defaultQuantity: 2, power: '0.25', voltage: '400V', hasOver5kw: false },
                    { id: 6, name: 'Pump Water Motor', quantity: 1, defaultQuantity: 1, power: '30', voltage: '400V', hasOver5kw: true }
                ],
                
                actuators: [
                    { id: 1, name: 'Damper Fresh', quantity: 2, defaultQuantity: 2, voltage: '24V DC', hasPositioner: true, readPosition: true },
                    { id: 2, name: 'Damper Exhaust', quantity: 2, defaultQuantity: 2, voltage: '24V DC', hasPositioner: true, readPosition: true },
                    { id: 3, name: 'Damper Return', quantity: 2, defaultQuantity: 2, voltage: '24V DC', hasPositioner: false, readPosition: false },
                    { id: 4, name: 'Steam Valve', quantity: 1, defaultQuantity: 1, voltage: '24V DC', hasPositioner: true, readPosition: false }
                ],
                
                sensors: [
                    { id: 1, name: 'Temperature Sensor', quantity: 2, defaultQuantity: 2, type: 'Analog 4-20mA' },
                    { id: 2, name: 'Humidity Sensor', quantity: 2, defaultQuantity: 2, type: 'Analog 4-20mA' },
                    { id: 3, name: 'Micro Switch', quantity: 5, defaultQuantity: 5, type: 'Digital ON/OFF' }
                ],
                
                optionalComponents: [
                    { id: 1, name: 'VFD Inverter', quantity: 0, defaultQuantity: 0, spec: '30kW' },
                    { id: 2, name: 'Soft Starter', quantity: 0, defaultQuantity: 0, spec: '30kW' },
                    { id: 3, name: 'HMI Panel', quantity: 1, defaultQuantity: 1, spec: '7 inch' },
                    { id: 4, name: 'Cabinet Heat Sensor', quantity: 0, defaultQuantity: 0, spec: 'Thermal' }
                ],
                
                // Settings
                useSoftStarter: true,
                useInverter: false,
                
                // Calculated data
                bom: [],
                layoutComponents: [],
                connections: [],
                relayCount: 0,
                contactorCount: 0,
                terminalCount: 0,
                terminalPlan: [],
                wireList: [],
                digitalInputs: [],
                digitalOutputs: [],
                analogInputs: [],
                
                // Initialize the application
                init() {
                    this.calculateBOM();
                    this.generateLayout();
                    this.generateConnections();
                    this.generateIOLists();
                },
                
                // Component quantity controls
                incrementQuantity(component) {
                    component.quantity++;
                    this.calculateBOM();
                    this.generateLayout();
                    this.generateConnections();
                    this.generateIOLists();
                },
                
                decrementQuantity(component) {
                    if (component.quantity > 0) {
                        component.quantity--;
                        this.calculateBOM();
                        this.generateLayout();
                        this.generateConnections();
                        this.generateIOLists();
                    }
                },
                
                // Calculate the Bill of Materials
                calculateBOM() {
                    let bom = [];
                    
                    // Calculate largest motor power for VFD/Soft Starter
                    let largestMotorPower = 0;
                    this.motors.forEach(motor => {
                        let power = parseFloat(motor.power) || 0;
                        if (power > largestMotorPower) largestMotorPower = power;
                    });
                    
                    // Add motors to BOM
                    this.motors.forEach(motor => {
                        if (motor.quantity > 0) {
                            bom.push({
                                name: motor.name,
                                quantity: motor.quantity,
                                specifications: `${motor.power}kW, ${motor.voltage}`,
                                standards: 'IEC 60034, IP55',
                                tags: [`M${motor.id}`, `${motor.power}kW`]
                            });
                            
                            // Add contactor for each motor
                            let power = parseFloat(motor.power) || 0;
                            let contactorSize = 'Size 1';
                            if (power > 15) contactorSize = 'Size 3';
                            else if (power > 5) contactorSize = 'Size 2';
                            
                            bom.push({
                                name: 'Contactor',
                                quantity: motor.quantity,
                                specifications: `${contactorSize}, ${motor.power}kW, 400V AC`,
                                standards: 'IEC 60947-4-1',
                                tags: [`KM${motor.id}`, contactorSize]
                            });
                            
                            // Add overload relay for motors > 5kW
                            if (power > 5) {
                                bom.push({
                                    name: 'Overload Relay',
                                    quantity: motor.quantity,
                                    specifications: `For ${motor.power}kW motor`,
                                    standards: 'IEC 60947-4-1',
                                    tags: [`F${motor.id}`]
                                });
                            }
                            
                            // Add circuit breaker for each motor
                            let breakerSize = '16A';
                            if (power > 22) breakerSize = '63A';
                            else if (power > 11) breakerSize = '32A';
                            else if (power > 5.5) breakerSize = '16A';
                            else breakerSize = '10A';
                            
                            bom.push({
                                name: 'Circuit Breaker',
                                quantity: motor.quantity,
                                specifications: `MCB ${breakerSize}, 3P`,
                                standards: 'IEC 60898',
                                tags: [`Q${motor.id}`]
                            });
                        }
                    });
                    
                    // Add actuators to BOM
                    this.actuators.forEach(actuator => {
                        if (actuator.quantity > 0) {
                            bom.push({
                                name: actuator.name,
                                quantity: actuator.quantity,
                                specifications: `${actuator.voltage}`,
                                standards: 'IEC 60534',
                                tags: [`A${actuator.id}`]
                            });
                            
                            // Add relay for each actuator
                            bom.push({
                                name: 'Relay',
                                quantity: actuator.quantity,
                                specifications: `24V DC Coil, 2NO+2NC`,
                                standards: 'IEC 61810',
                                tags: [`K${actuator.id}`]
                            });
                            
                            // Add positioner if needed
                            if (actuator.hasPositioner) {
                                bom.push({
                                    name: 'Positioner',
                                    quantity: actuator.quantity,
                                    specifications: `Analog ${actuator.readPosition ? 'Input/Output' : 'Output'}`,
                                    standards: 'IEC 60534',
                                    tags: [`P${actuator.id}`]
                                });
                            }
                        }
                    });
                    
                    // Add sensors to BOM
                    this.sensors.forEach(sensor => {
                        if (sensor.quantity > 0) {
                            bom.push({
                                name: sensor.name,
                                quantity: sensor.quantity,
                                specifications: `${sensor.type}`,
                                standards: 'IEC 60751 (Temp), IEC 60770 (Pressure)',
                                tags: [`S${sensor.id}`]
                            });
                        }
                    });
                    
                    // Add optional components to BOM
                    this.optionalComponents.forEach(optional => {
                        if (optional.quantity > 0) {
                            let spec = optional.spec;
                            if (optional.name === 'VFD Inverter' && this.useInverter) {
                                spec = `${largestMotorPower}kW, 400V AC`;
                            } else if (optional.name === 'Soft Starter' && this.useSoftStarter) {
                                spec = `${largestMotorPower}kW, 400V AC`;
                            }
                            
                            bom.push({
                                name: optional.name,
                                quantity: optional.quantity,
                                specifications: spec,
                                standards: optional.name === 'HMI Panel' ? 'IP65' : 'IEC 61800',
                                tags: optional.name === 'HMI Panel' ? ['HMI1'] : [optional.name === 'VFD Inverter' ? 'VFD1' : 'SS1']
                            });
                        }
                    });
                    
                    // Add PLC system
                    let diCount = 0;
                    let doCount = 0;
                    let aiCount = 0;
                    
                    // Calculate I/O requirements
                    this.sensors.forEach(sensor => {
                        if (sensor.type === 'Digital ON/OFF') diCount += sensor.quantity;
                        else aiCount += sensor.quantity;
                    });
                    
                    this.actuators.forEach(actuator => {
                        doCount += actuator.quantity;
                        if (actuator.hasPositioner && actuator.readPosition) aiCount += actuator.quantity;
                    });
                    
                    // Add micro switches
                    let microSwitchSensor = this.sensors.find(s => s.name === 'Micro Switch');
                    if (microSwitchSensor) diCount += microSwitchSensor.quantity;
                    
                    // Add PLC CPU
                    bom.push({
                        name: 'PLC CPU',
                        quantity: 1,
                        specifications: `Siemens S7-1200, 24DI/16DO/4AI`,
                        standards: 'IEC 61131',
                        tags: ['CPU1214C']
                    });
                    
                    // Add digital input module if needed
                    if (diCount > 24) {
                        let diModules = Math.ceil((diCount - 24) / 16);
                        bom.push({
                            name: 'Digital Input Module',
                            quantity: diModules,
                            specifications: '16DI, 24V DC',
                            standards: 'IEC 61131',
                            tags: ['SM1221']
                        });
                    }
                    
                    // Add digital output module if needed
                    if (doCount > 16) {
                        let doModules = Math.ceil((doCount - 16) / 16);
                        bom.push({
                            name: 'Digital Output Module',
                            quantity: doModules,
                            specifications: '16DO, Relay',
                            standards: 'IEC 61131',
                            tags: ['SM1222']
                        });
                    }
                    
                    // Add analog input module if needed
                    if (aiCount > 4) {
                        let aiModules = Math.ceil((aiCount - 4) / 4);
                        bom.push({
                            name: 'Analog Input Module',
                            quantity: aiModules,
                            specifications: '4AI, 4-20mA',
                            standards: 'IEC 61131',
                            tags: ['SM1231']
                        });
                    }
                    
                    // Add power supply
                    bom.push({
                        name: 'Power Supply',
                        quantity: 1,
                        specifications: '24V DC, 5A',
                        standards: 'IEC 61010',
                        tags: ['PS1']
                    });
                    
                    // Add main circuit breaker
                    bom.push({
                        name: 'Main Circuit Breaker',
                        quantity: 1,
                        specifications: '100A, 4P',
                        standards: 'IEC 60947-2',
                        tags: ['Q0']
                    });
                    
                    // Add terminal blocks
                    let terminalPoints = diCount + doCount + aiCount + 20; // 20 for power distribution
                    let terminalBlocks = Math.ceil(terminalPoints / 12);
                    bom.push({
                        name: 'Terminal Block',
                        quantity: terminalBlocks,
                        specifications: '12 positions, 600V',
                        standards: 'IEC 60947',
                        tags: ['TB1']
                    });
                    
                    // Add cabinet
                    bom.push({
                        name: 'Control Cabinet',
                        quantity: 1,
                        specifications: '800x600x200mm, IP54',
                        standards: 'IEC 60529',
                        tags: ['CAB1']
                    });
                    
                    // Add wiring
                    let wireLength = 50 + (diCount + doCount) * 2 + aiCount * 3;
                    bom.push({
                        name: 'Control Wire',
                        quantity: Math.ceil(wireLength / 100),
                        specifications: '1.5mm², Black',
                        standards: 'IEC 60228',
                        tags: ['W1']
                    });
                    
                    bom.push({
                        name: 'Power Wire',
                        quantity: 3,
                        specifications: '4mm², Black/Blue/Brown',
                        standards: 'IEC 60228',
                        tags: ['W2']
                    });
                    
                    // Add cable ducts
                    bom.push({
                        name: 'Cable Duct',
                        quantity: 4,
                        specifications: '40x40mm, PVC',
                        standards: 'IEC 61084',
                        tags: ['CD1']
                    });
                    
                    // Add DIN rails
                    bom.push({
                        name: 'DIN Rail',
                        quantity: 6,
                        specifications: '35mm, 1m length',
                        standards: 'IEC 60715',
                        tags: ['DR1']
                    });
                    
                    this.bom = bom;
                    
                    // Update component counts
                    this.relayCount = this.actuators.reduce((sum, actuator) => sum + actuator.quantity, 0);
                    this.contactorCount = this.motors.reduce((sum, motor) => sum + motor.quantity, 0);
                    this.terminalCount = terminalBlocks;
                },
                
                // Generate cabinet layout
                generateLayout() {
                    let layout = [];
                    let gridX = 1;
                    let gridY = 1;
                    
                    // Add PLC
                    layout.push({
                        type: 'plc',
                        tag: 'PLC',
                        details: 'S7-1200',
                        width: 32, // 2 columns (2 * 16cm)
                        height: 40, // 2 rows (2 * 20cm)
                        x: gridX,
                        y: gridY
                    });
                    
                    gridX += 2;
                    
                    // Add power supply
                    layout.push({
                        type: 'psu',
                        tag: 'PSU',
                        details: '24V/5A',
                        width: 32,
                        height: 40,
                        x: gridX,
                        y: gridY
                    });
                    
                    gridX = 1;
                    gridY += 2;
                    
                    // Add main breaker
                    layout.push({
                        type: 'breaker',
                        tag: 'Q0',
                        details: '100A 4P',
                        width: 32,
                        height: 40,
                        x: gridX,
                        y: gridY
                    });
                    
                    gridX += 2;
                    
                    // Add contactors
                    let contactorIndex = 1;
                    this.motors.forEach(motor => {
                        for (let i = 0; i < motor.quantity; i++) {
                            layout.push({
                                type: 'contactor',
                                tag: `KM${contactorIndex}`,
                                details: `${motor.power}kW`,
                                width: 32,
                                height: 40,
                                x: gridX,
                                y: gridY
                            });
                            
                            gridX += 2;
                            if (gridX > 10) {
                                gridX = 1;
                                gridY += 2;
                            }
                            contactorIndex++;
                        }
                    });
                    
                    // Add relays
                    if (gridX > 1) {
                        gridY += 2;
                        gridX = 1;
                    }
                    
                    let relayIndex = 1;
                    this.actuators.forEach(actuator => {
                        for (let i = 0; i < actuator.quantity; i++) {
                            layout.push({
                                type: 'relay',
                                tag: `K${relayIndex}`,
                                details: '24V DC',
                                width: 16,
                                height: 20,
                                x: gridX,
                                y: gridY
                            });
                            
                            gridX += 1;
                            if (gridX > 12) {
                                gridX = 1;
                                gridY += 1;
                            }
                            relayIndex++;
                        }
                    });
                    
                    // Add optional components
                    let vfd = this.optionalComponents.find(c => c.name === 'VFD Inverter');
                    let softStarter = this.optionalComponents.find(c => c.name === 'Soft Starter');
                    
                    if (gridX > 1) {
                        gridY += 1;
                        gridX = 1;
                    }
                    
                    if (vfd && vfd.quantity > 0 && this.useInverter) {
                        layout.push({
                            type: 'inverter',
                            tag: 'VFD1',
                            details: `${vfd.spec}`,
                            width: 80, // 5 columns
                            height: 80, // 4 rows
                            x: gridX,
                            y: gridY
                        });
                        
                        gridX += 5;
                    }
                    
                    if (softStarter && softStarter.quantity > 0 && this.useSoftStarter) {
                        layout.push({
                            type: 'soft-starter',
                            tag: 'SS1',
                            details: `${softStarter.spec}`,
                            width: 80, // 5 columns
                            height: 40, // 2 rows
                            x: gridX,
                            y: gridY
                        });
                        
                        gridX += 5;
                    }
                    
                    // Add HMI if present
                    let hmi = this.optionalComponents.find(c => c.name === 'HMI Panel');
                    if (hmi && hmi.quantity > 0) {
                        if (gridX > 1) {
                            gridY += 4;
                            gridX = 1;
                        }
                        
                        layout.push({
                            type: 'hmi',
                            tag: 'HMI',
                            details: `${hmi.spec}`,
                            width: 32,
                            height: 40,
                            x: gridX,
                            y: gridY
                        });
                    }
                    
                    // Add terminal blocks area
                    gridY += 2;
                    gridX = 1;
                    
                    layout.push({
                        type: 'terminal',
                        tag: 'Terminals',
                        details: `${this.terminalCount} blocks`,
                        width: 96, // 6 columns
                        height: 40, // 2 rows
                        x: gridX,
                        y: gridY
                    });
                    
                    this.layoutComponents = layout;
                },
                
                // Generate connection list
                generateConnections() {
                    let connections = [];
                    let connectionId = 1;
                    
                    // Motor connections
                    this.motors.forEach((motor, index) => {
                        for (let i = 0; i < motor.quantity; i++) {
                            connections.push({
                                id: connectionId++,
                                from: `Q${motor.id}.${i+1}`,
                                to: `KM${motor.id}.${i+1}`,
                                type: 'Power',
                                wireSize: '4mm²',
                                terminal: `TB${Math.floor(connectionId/10)+1}`
                            });
                            
                            connections.push({
                                id: connectionId++,
                                from: `PLC Q${index}.${i+1}`,
                                to: `KM${motor.id}.${i+1} A1`,
                                type: 'Control',
                                wireSize: '1.5mm²',
                                terminal: `TB${Math.floor(connectionId/10)+1}`
                            });
                        }
                    });
                    
                    // Actuator connections
                    this.actuators.forEach((actuator, index) => {
                        for (let i = 0; i < actuator.quantity; i++) {
                            connections.push({
                                id: connectionId++,
                                from: `PLC Q${this.motors.length + index}.${i+1}`,
                                to: `K${actuator.id}.${i+1} A1`,
                                type: 'Control',
                                wireSize: '1.5mm²',
                                terminal: `TB${Math.floor(connectionId/10)+1}`
                            });
                            
                            connections.push({
                                id: connectionId++,
                                from: `K${actuator.id}.${i+1} 13`,
                                to: `A${actuator.id}.${i+1}`,
                                type: 'Actuator',
                                wireSize: '1.5mm²',
                                terminal: `TB${Math.floor(connectionId/10)+1}`
                            });
                            
                            if (actuator.hasPositioner && actuator.readPosition) {
                                connections.push({
                                    id: connectionId++,
                                    from: `P${actuator.id}.${i+1}`,
                                    to: `PLC I${index}.${i+1}`,
                                    type: 'Analog',
                                    wireSize: '1.5mm² shielded',
                                    terminal: `TB${Math.floor(connectionId/10)+1}`
                                });
                            }
                        }
                    });
                    
                    // Sensor connections
                    this.sensors.forEach((sensor, index) => {
                        for (let i = 0; i < sensor.quantity; i++) {
                            let type = sensor.type.includes('Analog') ? 'Analog' : 'Digital';
                            connections.push({
                                id: connectionId++,
                                from: `S${sensor.id}.${i+1}`,
                                to: type === 'Analog' ? `PLC AI${index}.${i+1}` : `PLC I${this.actuators.length + index}.${i+1}`,
                                type: type,
                                wireSize: type === 'Analog' ? '1.5mm² shielded' : '1.5mm²',
                                terminal: `TB${Math.floor(connectionId/10)+1}`
                            });
                        }
                    });
                    
                    this.connections = connections;
                    
                    // Generate terminal plan
                    this.generateTerminalPlan();
                    
                    // Generate wire list
                    this.generateWireList();
                },
                
                // Generate terminal plan
                generateTerminalPlan() {
                    this.terminalPlan = [
                        { name: 'Power Distribution', type: 'Power', points: 24 },
                        { name: 'PLC Digital Inputs', type: 'DI', points: 24 },
                        { name: 'PLC Digital Outputs', type: 'DO', points: 16 },
                        { name: 'PLC Analog Inputs', type: 'AI', points: 8 },
                        { name: 'Motor Control', type: 'Control', points: 20 },
                        { name: 'Sensor Connections', type: 'Sensor', points: 16 },
                        { name: 'Actuator Connections', type: 'Actuator', points: 16 },
                        { name: 'Shield Connections', type: 'Ground', points: 12 }
                    ];
                },
                
                // Generate wire list
                generateWireList() {
                    this.wireList = [
                        { from: 'Main Breaker', to: 'Power Distribution', type: 'Power', size: '16mm²', length: 1.5, color: 'Black' },
                        { from: 'Power Distribution', to: 'PSU', type: 'Power', size: '2.5mm²', length: 1.0, color: 'Black' },
                        { from: 'Power Distribution', to: 'Contactor 1', type: 'Power', size: '4mm²', length: 1.2, color: 'Black' },
                        { from: 'PSU', to: 'PLC', type: 'Control', size: '1.5mm²', length: 0.8, color: 'Blue' },
                        { from: 'PLC', to: 'Terminal Block 1', type: 'Control', size: '1.5mm²', length: 0.5, color: 'White' },
                        { from: 'Terminal Block 1', to: 'Sensor 1', type: 'Signal', size: '1.5mm²', length: 5.0, color: 'Gray' },
                        { from: 'Terminal Block 2', to: 'Actuator 1', type: 'Control', size: '1.5mm²', length: 4.0, color: 'Gray' }
                    ];
                },
                
                // Generate PLC I/O lists
                generateIOLists() {
                    this.digitalInputs = [];
                    this.digitalOutputs = [];
                    this.analogInputs = [];
                    
                    let diIndex = 0;
                    let doIndex = 0;
                    let aiIndex = 0;
                    
                    // Add micro switches as digital inputs
                    let microSwitchSensor = this.sensors.find(s => s.name === 'Micro Switch');
                    if (microSwitchSensor) {
                        for (let i = 0; i < microSwitchSensor.quantity; i++) {
                            this.digitalInputs.push({
                                name: `Door Switch ${i+1}`,
                                address: `I${diIndex}.${i}`
                            });
                        }
                        diIndex++;
                    }
                    
                    // Add actuators with position feedback as analog inputs
                    this.actuators.forEach(actuator => {
                        if (actuator.hasPositioner && actuator.readPosition) {
                            for (let i = 0; i < actuator.quantity; i++) {
                                this.analogInputs.push({
                                    name: `${actuator.name} ${i+1} Position`,
                                    address: `AI${aiIndex}.${i}`
                                });
                            }
                            aiIndex++;
                        }
                        
                        // All actuators as digital outputs
                        for (let i = 0; i < actuator.quantity; i++) {
                            this.digitalOutputs.push({
                                name: `${actuator.name} ${i+1} Control`,
                                address: `Q${doIndex}.${i}`
                            });
                        }
                        doIndex++;
                    });
                    
                    // Add temperature and humidity sensors as analog inputs
                    this.sensors.forEach(sensor => {
                        if (sensor.name.includes('Temperature') || sensor.name.includes('Humidity')) {
                            for (let i = 0; i < sensor.quantity; i++) {
                                this.analogInputs.push({
                                    name: `${sensor.name} ${i+1}`,
                                    address: `AI${aiIndex}.${i}`
                                });
                            }
                            aiIndex++;
                        }
                    });
                    
                    // Add motor control as digital outputs
                    this.motors.forEach((motor, index) => {
                        for (let i = 0; i < motor.quantity; i++) {
                            this.digitalOutputs.push({
                                name: `${motor.name} ${i+1}`,
                                address: `Q${doIndex}.${i}`
                            });
                        }
                        doIndex++;
                    });
                },
                
                // Project management functions
                getProjectJSON() {
                    const project = {
                        motors: this.motors,
                        actuators: this.actuators,
                        sensors: this.sensors,
                        optionalComponents: this.optionalComponents,
                        useSoftStarter: this.useSoftStarter,
                        useInverter: this.useInverter,
                        bom: this.bom,
                        layoutComponents: this.layoutComponents,
                        connections: this.connections,
                        generatedAt: new Date().toISOString()
                    };
                    return JSON.stringify(project, null, 2);
                },
                
                copyJSON() {
                    const json = this.getProjectJSON();
                    navigator.clipboard.writeText(json).then(() => {
                        alert('JSON copied to clipboard!');
                    });
                },
                
                importJSON() {
                    const jsonText = document.querySelector('.json-editor').value;
                    try {
                        const project = JSON.parse(jsonText);
                        
                        // Update all component arrays
                        this.motors = project.motors || this.motors;
                        this.actuators = project.actuators || this.actuators;
                        this.sensors = project.sensors || this.sensors;
                        this.optionalComponents = project.optionalComponents || this.optionalComponents;
                        this.useSoftStarter = project.useSoftStarter || false;
                        this.useInverter = project.useInverter || false;
                        
                        // Recalculate everything
                        this.calculateBOM();
                        this.generateLayout();
                        this.generateConnections();
                        this.generateIOLists();
                        
                        this.showModal = null;
                        alert('Project loaded successfully!');
                    } catch (error) {
                        alert('Error parsing JSON: ' + error.message);
                    }
                },
                
                saveProject() {
                    const json = this.getProjectJSON();
                    const blob = new Blob([json], { type: 'application/json' });
                    const url = URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = `plc-panel-design-${new Date().toISOString().slice(0, 10)}.json`;
                    document.body.appendChild(a);
                    a.click();
                    document.body.removeChild(a);
                    URL.revokeObjectURL(url);
                },
                
                loadProject() {
                    document.getElementById('fileInput').click();
                },
                
                loadProjectFromFile(event) {
                    const file = event.target.files[0];
                    if (!file) return;
                    
                    const reader = new FileReader();
                    reader.onload = (e) => {
                        try {
                            const project = JSON.parse(e.target.result);
                            
                            // Update all component arrays
                            this.motors = project.motors || this.motors;
                            this.actuators = project.actuators || this.actuators;
                            this.sensors = project.sensors || this.sensors;
                            this.optionalComponents = project.optionalComponents || this.optionalComponents;
                            this.useSoftStarter = project.useSoftStarter || false;
                            this.useInverter = project.useInverter || false;
                            
                            // Recalculate everything
                            this.calculateBOM();
                            this.generateLayout();
                            this.generateConnections();
                            this.generateIOLists();
                            
                            alert('Project loaded successfully!');
                        } catch (error) {
                            alert('Error parsing JSON file: ' + error.message);
                        }
                    };
                    reader.readAsText(file);
                    
                    // Reset file input
                    event.target.value = '';
                },
                
                exportBOM() {
                    // Convert BOM to CSV
                    let csv = 'Component,Quantity,Specifications,Standards,Tags\n';
                    this.bom.forEach(item => {
                        const tags = item.tags ? item.tags.join(';') : '';
                        csv += `"${item.name}",${item.quantity},"${item.specifications}","${item.standards}","${tags}"\n`;
                    });
                    
                    const blob = new Blob([csv], { type: 'text/csv' });
                    const url = URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = `plc-bom-${new Date().toISOString().slice(0, 10)}.csv`;
                    document.body.appendChild(a);
                    a.click();
                    document.body.removeChild(a);
                    URL.revokeObjectURL(url);
                },
                
                printDocument() {
                    window.print();
                },
                
                exportAsPNG() {
                    const layoutElement = document.getElementById('layoutGrid');
                    html2canvas(layoutElement).then(canvas => {
                        const link = document.createElement('a');
                        link.download = `plc-layout-${new Date().toISOString().slice(0, 10)}.png`;
                        link.href = canvas.toDataURL();
                        link.click();
                    });
                }
            };
        }
    </script>
</body>
</html>