<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Complete PLC Control Panel Designer - Evaporative Ventilation System</title>
    <script src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js" defer></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.5/codemirror.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.5/theme/dracula.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.5/codemirror.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.5/mode/javascript/javascript.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.5/mode/python/python.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.5/mode/stex/stex.min.js"></script>
    <style>
        :root {
            --primary-color: #2c3e50;
            --secondary-color: #3498db;
            --success-color: #2ecc71;
            --warning-color: #f39c12;
            --danger-color: #e74c3c;
            --info-color: #1abc9c;
            --light-color: #ecf0f1;
            --dark-color: #34495e;
        }
        
        * {
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 0;
        }
        
        body {
            background-color: #f5f7fa;
            color: #333;
            line-height: 1.6;
            overflow-x: hidden;
        }
        
        .container {
            max-width: 1800px;
            margin: 0 auto;
            padding: 20px;
        }
        
        /* Header Styles */
        header {
            background: linear-gradient(135deg, var(--primary-color) 0%, #4a6491 100%);
            color: white;
            padding: 25px 0;
            border-radius: 10px 10px 0 0;
            margin-bottom: 20px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            position: sticky;
            top: 0;
            z-index: 100;
        }
        
        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 20px;
            flex-wrap: wrap;
            gap: 20px;
        }
        
        .logo {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .logo-icon {
            font-size: 2.5rem;
            color: var(--secondary-color);
        }
        
        .logo-text h1 {
            margin: 0;
            font-size: 1.8rem;
            font-weight: 700;
        }
        
        .logo-text .subtitle {
            font-size: 1rem;
            opacity: 0.9;
            margin-top: 5px;
            color: var(--light-color);
        }
        
        .control-buttons {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }
        
        /* Button Styles */
        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: all 0.3s ease;
            font-size: 0.95rem;
            white-space: nowrap;
        }
        
        .btn-sm {
            padding: 6px 12px;
            font-size: 0.85rem;
        }
        
        .btn-primary {
            background-color: var(--secondary-color);
            color: white;
        }
        
        .btn-primary:hover {
            background-color: #2980b9;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(52, 152, 219, 0.3);
        }
        
        .btn-secondary {
            background-color: var(--success-color);
            color: white;
        }
        
        .btn-secondary:hover {
            background-color: #27ae60;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(46, 204, 113, 0.3);
        }
        
        .btn-danger {
            background-color: var(--danger-color);
            color: white;
        }
        
        .btn-danger:hover {
            background-color: #c0392b;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(231, 76, 60, 0.3);
        }
        
        .btn-warning {
            background-color: var(--warning-color);
            color: white;
        }
        
        .btn-warning:hover {
            background-color: #d68910;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(243, 156, 18, 0.3);
        }
        
        .btn-info {
            background-color: var(--info-color);
            color: white;
        }
        
        .btn-info:hover {
            background-color: #16a085;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(26, 188, 156, 0.3);
        }
        
        .btn-dark {
            background-color: var(--dark-color);
            color: white;
        }
        
        .btn-dark:hover {
            background-color: #2c3e50;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(52, 73, 94, 0.3);
        }
        
        /* Main Content Grid */
        .main-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 25px;
            margin-bottom: 30px;
        }
        
        @media (max-width: 1400px) {
            .main-content {
                grid-template-columns: 1fr;
            }
        }
        
        /* Card Styles */
        .card {
            background-color: white;
            border-radius: 10px;
            padding: 25px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
            margin-bottom: 20px;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            border: 1px solid #eaeaea;
        }
        
        .card:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
        }
        
        .card-title {
            font-size: 1.4rem;
            margin-top: 0;
            margin-bottom: 20px;
            padding-bottom: 12px;
            border-bottom: 2px solid #f0f0f0;
            color: var(--primary-color);
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .card-title i {
            color: var(--secondary-color);
        }
        
        /* Component List Styles */
        .component-list {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }
        
        .component-item {
            background-color: #f8f9fa;
            border-radius: 8px;
            padding: 15px;
            border-left: 4px solid var(--secondary-color);
            transition: all 0.3s ease;
        }
        
        .component-item:hover {
            background-color: #edf2f7;
            transform: translateX(5px);
        }
        
        .component-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
            flex-wrap: wrap;
            gap: 10px;
        }
        
        .component-name {
            font-weight: 600;
            font-size: 1.1rem;
            color: var(--primary-color);
        }
        
        .component-controls {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .quantity-control {
            display: flex;
            align-items: center;
            gap: 10px;
            background: white;
            padding: 5px 10px;
            border-radius: 20px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        
        .qty-btn {
            width: 28px;
            height: 28px;
            border-radius: 50%;
            border: none;
            background-color: var(--secondary-color);
            color: white;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            transition: all 0.2s;
        }
        
        .qty-btn:hover {
            background-color: #2980b9;
            transform: scale(1.1);
        }
        
        .qty-display {
            min-width: 40px;
            text-align: center;
            font-weight: bold;
            font-size: 1.1rem;
            color: var(--primary-color);
        }
        
        .component-details {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            margin-top: 10px;
        }
        
        .detail-item {
            display: flex;
            flex-direction: column;
            min-width: 120px;
            flex: 1;
        }
        
        .detail-label {
            font-size: 0.85rem;
            color: #7f8c8d;
            margin-bottom: 5px;
            font-weight: 500;
        }
        
        .detail-value {
            font-weight: 500;
            color: var(--dark-color);
        }
        
        .detail-input {
            padding: 8px 12px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 0.95rem;
            width: 100%;
            transition: border 0.3s;
        }
        
        .detail-input:focus {
            outline: none;
            border-color: var(--secondary-color);
            box-shadow: 0 0 0 2px rgba(52, 152, 219, 0.2);
        }
        
        /* Checkbox and Switch Styles */
        .checkbox-group {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-top: 10px;
        }
        
        .checkbox-label {
            font-size: 0.9rem;
            color: #555;
            cursor: pointer;
        }
        
        .switch {
            position: relative;
            display: inline-block;
            width: 50px;
            height: 24px;
        }
        
        .switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }
        
        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: .4s;
            border-radius: 24px;
        }
        
        .slider:before {
            position: absolute;
            content: "";
            height: 16px;
            width: 16px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }
        
        input:checked + .slider {
            background-color: var(--success-color);
        }
        
        input:checked + .slider:before {
            transform: translateX(26px);
        }
        
        /* Layout Container */
        .layout-container {
            background-color: var(--primary-color);
            border-radius: 8px;
            padding: 15px;
            min-height: 600px;
            position: relative;
            overflow: auto;
        }
        
        .layout-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, 80px);
            grid-auto-rows: 100px;
            gap: 5px;
            width: 100%;
            min-height: 600px;
            background-color: var(--dark-color);
            padding: 15px;
            border-radius: 5px;
        }
        
        .layout-component {
            border-radius: 4px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            font-size: 0.7rem;
            text-align: center;
            padding: 5px;
            overflow: hidden;
            position: relative;
            color: white;
            font-weight: 500;
            word-break: break-word;
            border: 1px solid rgba(255,255,255,0.1);
        }
        
        .layout-component.plc {
            background-color: var(--secondary-color);
        }
        
        .layout-component.psu {
            background-color: #9b59b6;
        }
        
        .layout-component.breaker {
            background-color: var(--danger-color);
        }
        
        .layout-component.contactor {
            background-color: var(--success-color);
        }
        
        .layout-component.relay {
            background-color: var(--warning-color);
        }
        
        .layout-component.inverter {
            background-color: var(--info-color);
        }
        
        .layout-component.soft-starter {
            background-color: #d35400;
        }
        
        .layout-component.hmi {
            background-color: #34495e;
        }
        
        .layout-component.terminal {
            background-color: #7f8c8d;
        }
        
        /* BOM Table Styles */
        .bom-container {
            grid-column: 1 / -1;
            margin-top: 20px;
        }
        
        .bom-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
            font-size: 0.9rem;
        }
        
        .bom-table th {
            background-color: var(--primary-color);
            color: white;
            text-align: left;
            padding: 12px 15px;
            font-weight: 600;
            position: sticky;
            top: 0;
        }
        
        .bom-table td {
            padding: 12px 15px;
            border-bottom: 1px solid #eee;
        }
        
        .bom-table tr:hover {
            background-color: #f9f9f9;
        }
        
        /* Tag Styles */
        .tag {
            display: inline-block;
            background-color: #ecf0f1;
            padding: 3px 8px;
            border-radius: 4px;
            font-size: 0.85rem;
            margin: 2px;
            font-family: 'Courier New', monospace;
            color: var(--dark-color);
        }
        
        .tag-primary {
            background-color: #d6eaf8;
            color: var(--secondary-color);
        }
        
        .tag-success {
            background-color: #d5f4e6;
            color: var(--success-color);
        }
        
        .tag-warning {
            background-color: #fdebd0;
            color: var(--warning-color);
        }
        
        .tag-danger {
            background-color: #fadbd8;
            color: var(--danger-color);
        }
        
        /* Status Bar */
        .status-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background-color: white;
            padding: 15px 25px;
            border-radius: 10px;
            margin-top: 20px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
            flex-wrap: wrap;
            gap: 15px;
        }
        
        .total-cost {
            font-size: 1.5rem;
            font-weight: bold;
            color: var(--primary-color);
        }
        
        .component-count {
            font-size: 1.1rem;
            color: #7f8c8d;
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
        }
        
        /* Modal Styles */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 2000;
            padding: 20px;
        }
        
        .modal-content {
            background-color: white;
            border-radius: 10px;
            padding: 30px;
            width: 90%;
            max-width: 1200px;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 10px 40px rgba(0,0,0,0.3);
            animation: modalFadeIn 0.3s ease;
        }
        
        @keyframes modalFadeIn {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid #eee;
        }
        
        .modal-title {
            font-size: 1.5rem;
            margin: 0;
            color: var(--primary-color);
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .close-modal {
            background: none;
            border: none;
            font-size: 1.8rem;
            cursor: pointer;
            color: #7f8c8d;
            transition: color 0.3s;
            line-height: 1;
        }
        
        .close-modal:hover {
            color: var(--danger-color);
        }
        
        /* Tab Styles */
        .tabs {
            display: flex;
            border-bottom: 1px solid #eee;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        
        .tab {
            padding: 12px 24px;
            background: none;
            border: none;
            cursor: pointer;
            font-size: 1rem;
            color: #7f8c8d;
            border-bottom: 3px solid transparent;
            transition: all 0.3s ease;
            position: relative;
            white-space: nowrap;
        }
        
        .tab:hover {
            color: var(--secondary-color);
        }
        
        .tab.active {
            color: var(--secondary-color);
            border-bottom: 3px solid var(--secondary-color);
            font-weight: 600;
        }
        
        .tab-content {
            display: none;
            animation: fadeIn 0.3s ease;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        .tab-content.active {
            display: block;
        }
        
        /* Code Editor Styles */
        .code-editor-container {
            border: 1px solid #ddd;
            border-radius: 5px;
            overflow: hidden;
            margin-bottom: 15px;
            box-shadow: 0 3px 10px rgba(0,0,0,0.1);
        }
        
        .code-header {
            background-color: var(--primary-color);
            color: white;
            padding: 10px 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .code-title {
            font-size: 1rem;
            margin: 0;
            font-weight: 600;
        }
        
        .code-actions {
            display: flex;
            gap: 10px;
        }
        
        .code-btn {
            background: rgba(255,255,255,0.1);
            border: 1px solid rgba(255,255,255,0.2);
            color: white;
            cursor: pointer;
            font-size: 0.9rem;
            display: flex;
            align-items: center;
            gap: 5px;
            padding: 5px 10px;
            border-radius: 4px;
            transition: all 0.3s;
        }
        
        .code-btn:hover {
            background: rgba(255,255,255,0.2);
        }
        
        .CodeMirror {
            height: 400px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
        }
        
        /* Scenario Visualization */
        .scenario-visualization {
            background-color: white;
            border-radius: 8px;
            padding: 20px;
            margin-top: 20px;
            border: 1px solid #eaeaea;
        }
        
        .visualization-canvas {
            width: 100%;
            height: 300px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 5px;
            position: relative;
            overflow: hidden;
            margin-bottom: 20px;
        }
        
        .air-flow {
            position: absolute;
            width: 80px;
            height: 40px;
            background-color: rgba(52, 152, 219, 0.9);
            border-radius: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 600;
            font-size: 0.8rem;
            box-shadow: 0 3px 10px rgba(0,0,0,0.2);
            border: 2px solid white;
        }
        
        .damper {
            position: absolute;
            width: 60px;
            height: 60px;
            background-color: rgba(46, 204, 113, 0.9);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 600;
            cursor: pointer;
            box-shadow: 0 3px 10px rgba(0,0,0,0.2);
            border: 2px solid white;
            transition: transform 0.3s;
        }
        
        .damper:hover {
            transform: scale(1.1);
        }
        
        .sensor {
            position: absolute;
            width: 50px;
            height: 50px;
            background-color: rgba(231, 76, 60, 0.9);
            border-radius: 5px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 600;
            box-shadow: 0 3px 10px rgba(0,0,0,0.2);
            border: 2px solid white;
        }
        
        .motor {
            position: absolute;
            width: 70px;
            height: 70px;
            background-color: rgba(243, 156, 18, 0.9);
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 600;
            box-shadow: 0 3px 10px rgba(0,0,0,0.2);
            border: 2px solid white;
        }
        
        .valve {
            position: absolute;
            width: 60px;
            height: 60px;
            background-color: rgba(155, 89, 182, 0.9);
            border-radius: 5px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 600;
            box-shadow: 0 3px 10px rgba(0,0,0,0.2);
            border: 2px solid white;
        }
        
        /* Parameter Grid */
        .parameter-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .parameter-item {
            background-color: white;
            padding: 15px;
            border-radius: 5px;
            border-left: 4px solid var(--secondary-color);
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }
        
        .parameter-label {
            font-weight: 600;
            margin-bottom: 8px;
            color: var(--primary-color);
            font-size: 0.95rem;
        }
        
        .parameter-input {
            width: 100%;
            padding: 8px 12px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 0.95rem;
        }
        
        /* Simulation Grid */
        .simulation-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }
        
        .simulation-item {
            background-color: white;
            padding: 15px;
            border-radius: 5px;
            text-align: center;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            border: 1px solid #eaeaea;
            transition: transform 0.3s;
        }
        
        .simulation-item:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        
        .simulation-label {
            font-weight: 600;
            margin-bottom: 8px;
            color: var(--dark-color);
            font-size: 0.9rem;
        }
        
        .simulation-value {
            font-size: 1.2rem;
            font-weight: bold;
            color: var(--secondary-color);
        }
        
        .simulation-status {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            margin: 0 auto;
            margin-top: 8px;
            transition: background-color 0.3s;
        }
        
        .status-on {
            background-color: var(--success-color);
            box-shadow: 0 0 10px rgba(46, 204, 113, 0.5);
        }
        
        .status-off {
            background-color: var(--danger-color);
        }
        
        /* Control Algorithm */
        .control-algorithm {
            background-color: #fff8e1;
            border-radius: 8px;
            padding: 20px;
            margin-top: 25px;
            border-left: 5px solid var(--warning-color);
        }
        
        .algorithm-title {
            font-size: 1.2rem;
            margin-top: 0;
            color: var(--warning-color);
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .algorithm-step {
            margin-bottom: 15px;
            padding-left: 20px;
            position: relative;
            color: #5d4037;
        }
        
        .algorithm-step:before {
            content: 'â†’';
            position: absolute;
            left: 0;
            color: var(--secondary-color);
            font-weight: bold;
        }
        
        /* Sequence Table */
        .sequence-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
            font-size: 0.9rem;
        }
        
        .sequence-table th, .sequence-table td {
            border: 1px solid #ddd;
            padding: 10px;
            text-align: center;
        }
        
        .sequence-table th {
            background-color: var(--primary-color);
            color: white;
        }
        
        .sequence-table tr:nth-child(even) {
            background-color: #f9f9f9;
        }
        
        .sequence-table tr:hover {
            background-color: #f5f5f5;
        }
        
        /* Alarm Panel */
        .alarm-panel {
            background-color: #ffebee;
            border-radius: 8px;
            padding: 20px;
            margin-top: 20px;
            border-left: 5px solid var(--danger-color);
        }
        
        .alarm-title {
            font-size: 1.2rem;
            margin-top: 0;
            color: var(--danger-color);
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .alarm-list {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        
        .alarm-item {
            background-color: white;
            padding: 12px 15px;
            border-radius: 5px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-left: 4px solid var(--danger-color);
            transition: all 0.3s;
        }
        
        .alarm-item:hover {
            transform: translateX(5px);
        }
        
        .alarm-active {
            border-left-color: var(--success-color);
            background-color: #e8f5e9;
        }
        
        .alarm-name {
            font-weight: 600;
            color: var(--dark-color);
        }
        
        .alarm-status {
            padding: 5px 10px;
            border-radius: 4px;
            font-size: 0.85rem;
            font-weight: 600;
        }
        
        .status-active {
            background-color: #d4edda;
            color: #155724;
        }
        
        .status-inactive {
            background-color: #f8d7da;
            color: #721c24;
        }
        
        /* Control Loop */
        .control-loop {
            background-color: #e3f2fd;
            border-radius: 8px;
            padding: 20px;
            margin-top: 20px;
            border-left: 5px solid var(--secondary-color);
        }
        
        .loop-title {
            font-size: 1.2rem;
            margin-top: 0;
            color: var(--secondary-color);
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .loop-diagram {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 20px;
            flex-wrap: wrap;
        }
        
        .loop-step {
            text-align: center;
            flex: 1;
            min-width: 150px;
            margin: 10px;
        }
        
        .loop-icon {
            width: 60px;
            height: 60px;
            background-color: var(--secondary-color);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 10px;
            color: white;
            font-size: 1.5rem;
            box-shadow: 0 3px 10px rgba(52, 152, 219, 0.3);
        }
        
        .loop-arrow {
            flex: 0 0 40px;
            text-align: center;
            font-size: 1.5rem;
            color: var(--secondary-color);
        }
        
        /* Connection List */
        .connection-list {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        
        .connection-item {
            background-color: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            border-left: 4px solid var(--secondary-color);
            transition: all 0.3s;
        }
        
        .connection-item:hover {
            background-color: #edf2f7;
            transform: translateX(5px);
        }
        
        /* Color Legend */
        .color-legend {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            margin-top: 15px;
            padding: 15px;
            background-color: #f8f9fa;
            border-radius: 8px;
        }
        
        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .legend-color {
            width: 20px;
            height: 20px;
            border-radius: 4px;
        }
        
        /* Responsive Design */
        @media (max-width: 768px) {
            .header-content {
                flex-direction: column;
                text-align: center;
            }
            
            .control-buttons {
                justify-content: center;
            }
            
            .btn {
                padding: 8px 15px;
                font-size: 0.9rem;
            }
            
            .main-content {
                grid-template-columns: 1fr;
                gap: 15px;
            }
            
            .card {
                padding: 20px;
            }
            
            .component-header {
                flex-direction: column;
                align-items: flex-start;
            }
            
            .component-controls {
                width: 100%;
                justify-content: space-between;
            }
            
            .parameter-grid {
                grid-template-columns: 1fr;
            }
            
            .simulation-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .status-bar {
                flex-direction: column;
                gap: 15px;
                text-align: center;
            }
            
            .tabs {
                overflow-x: auto;
            }
            
            .tab {
                padding: 10px 15px;
                font-size: 0.9rem;
            }
        }
        
        /* Print Styles */
        @media print {
            .no-print, .control-buttons, .status-bar, .btn {
                display: none !important;
            }
            
            .card {
                box-shadow: none;
                border: 1px solid #ddd;
                break-inside: avoid;
            }
            
            header {
                background: white !important;
                color: black !important;
            }
        }
        
        /* Custom Scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }
        
        ::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 4px;
        }
        
        ::-webkit-scrollbar-thumb {
            background: #c1c1c1;
            border-radius: 4px;
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: #a8a8a8;
        }
    </style>
</head>
<body>
    <div x-data="plcDesigner()" x-init="init()" class="container">
        <!-- Header -->
        <header>
            <div class="header-content">
                <div class="logo">
                    <div class="logo-icon">
                        <i class="fas fa-industry"></i>
                    </div>
                    <div class="logo-text">
                        <h1>PLC Control Panel Designer</h1>
                        <div class="subtitle">Evaporative Ventilation System for Textile Industry</div>
                    </div>
                </div>
                <div class="control-buttons">
                    <button class="btn btn-primary" @click="saveProject()" title="Save project to JSON file">
                        <i class="fas fa-save"></i> Save
                    </button>
                    <button class="btn btn-secondary" @click="loadProject()" title="Load project from JSON file">
                        <i class="fas fa-folder-open"></i> Load
                    </button>
                    <button class="btn btn-warning" @click="showModal = 'scenarios'" title="Control scenarios and operating modes">
                        <i class="fas fa-cogs"></i> Scenarios
                    </button>
                    <button class="btn btn-info" @click="showModal = 'code'" title="PLC code generator">
                        <i class="fas fa-code"></i> Code Gen
                    </button>
                    <button class="btn btn-danger" @click="showModal = 'print'" title="Export and print options">
                        <i class="fas fa-print"></i> Export
                    </button>
                </div>
            </div>
        </header>

        <!-- Main Content -->
        <div class="main-content">
            <!-- Left Column: Component Configuration -->
            <div>
                <!-- 3-Phase Motors -->
                <div class="card">
                    <h2 class="card-title"><i class="fas fa-cogs"></i> 3-Phase Motors</h2>
                    <div class="component-list">
                        <template x-for="(motor, index) in motors" :key="index">
                            <div class="component-item">
                                <div class="component-header">
                                    <div class="component-name" x-text="motor.name"></div>
                                    <div class="component-controls">
                                        <div class="quantity-control">
                                            <button class="qty-btn" @click="decrementQuantity(motor)">-</button>
                                            <div class="qty-display" x-text="motor.quantity"></div>
                                            <button class="qty-btn" @click="incrementQuantity(motor)">+</button>
                                        </div>
                                    </div>
                                </div>
                                <div class="component-details">
                                    <div class="detail-item">
                                        <div class="detail-label">Default Quantity</div>
                                        <div class="detail-value" x-text="motor.defaultQuantity"></div>
                                    </div>
                                    <div class="detail-item">
                                        <div class="detail-label">Power (kW)</div>
                                        <input type="text" class="detail-input" x-model="motor.power" @change="calculateBOM()">
                                    </div>
                                    <div class="detail-item">
                                        <div class="detail-label">Voltage</div>
                                        <div class="detail-value">400V AC</div>
                                    </div>
                                </div>
                                <div class="checkbox-group" x-show="motor.hasOver5kw">
                                    <label class="switch">
                                        <input type="checkbox" x-model="useSoftStarter">
                                        <span class="slider"></span>
                                    </label>
                                    <label class="checkbox-label">Use Soft Starter (for motors > 5kW)</label>
                                </div>
                            </div>
                        </template>
                    </div>
                </div>

                <!-- Actuators -->
                <div class="card">
                    <h2 class="card-title"><i class="fas fa-sliders-h"></i> Actuators</h2>
                    <div class="component-list">
                        <template x-for="(actuator, index) in actuators" :key="index">
                            <div class="component-item">
                                <div class="component-header">
                                    <div class="component-name" x-text="actuator.name"></div>
                                    <div class="component-controls">
                                        <div class="quantity-control">
                                            <button class="qty-btn" @click="decrementQuantity(actuator)">-</button>
                                            <div class="qty-display" x-text="actuator.quantity"></div>
                                            <button class="qty-btn" @click="incrementQuantity(actuator)">+</button>
                                        </div>
                                    </div>
                                </div>
                                <div class="component-details">
                                    <div class="detail-item">
                                        <div class="detail-label">Default Quantity</div>
                                        <div class="detail-value" x-text="actuator.defaultQuantity"></div>
                                    </div>
                                    <div class="detail-item">
                                        <div class="detail-label">Voltage</div>
                                        <input type="text" class="detail-input" x-model="actuator.voltage" @change="calculateBOM()">
                                    </div>
                                </div>
                                <div class="checkbox-group">
                                    <label class="switch">
                                        <input type="checkbox" :id="'hasPositioner' + index" x-model="actuator.hasPositioner">
                                        <span class="slider"></span>
                                    </label>
                                    <label class="checkbox-label" :for="'hasPositioner' + index">Has Positioner</label>
                                </div>
                                <div class="checkbox-group" x-show="actuator.hasPositioner">
                                    <label class="switch">
                                        <input type="checkbox" :id="'readPosition' + index" x-model="actuator.readPosition">
                                        <span class="slider"></span>
                                    </label>
                                    <label class="checkbox-label" :for="'readPosition' + index">Read Position</label>
                                </div>
                            </div>
                        </template>
                    </div>
                </div>
            </div>

            <!-- Right Column: Sensors, Optional, Layout -->
            <div>
                <!-- Sensors -->
                <div class="card">
                    <h2 class="card-title"><i class="fas fa-thermometer-half"></i> Sensors</h2>
                    <div class="component-list">
                        <template x-for="(sensor, index) in sensors" :key="index">
                            <div class="component-item">
                                <div class="component-header">
                                    <div class="component-name" x-text="sensor.name"></div>
                                    <div class="component-controls">
                                        <div class="quantity-control">
                                            <button class="qty-btn" @click="decrementQuantity(sensor)">-</button>
                                            <div class="qty-display" x-text="sensor.quantity"></div>
                                            <button class="qty-btn" @click="incrementQuantity(sensor)">+</button>
                                        </div>
                                    </div>
                                </div>
                                <div class="component-details">
                                    <div class="detail-item">
                                        <div class="detail-label">Default Quantity</div>
                                        <div class="detail-value" x-text="sensor.defaultQuantity"></div>
                                    </div>
                                    <div class="detail-item">
                                        <div class="detail-label">Type</div>
                                        <div class="detail-value" x-text="sensor.type"></div>
                                    </div>
                                </div>
                            </div>
                        </template>
                    </div>
                </div>

                <!-- Optional Components -->
                <div class="card">
                    <h2 class="card-title"><i class="fas fa-plus-circle"></i> Optional Components</h2>
                    <div class="component-list">
                        <template x-for="(optional, index) in optionalComponents" :key="index">
                            <div class="component-item">
                                <div class="component-header">
                                    <div class="component-name" x-text="optional.name"></div>
                                    <div class="component-controls">
                                        <div class="quantity-control">
                                            <button class="qty-btn" @click="decrementQuantity(optional)">-</button>
                                            <div class="qty-display" x-text="optional.quantity"></div>
                                            <button class="qty-btn" @click="incrementQuantity(optional)">+</button>
                                        </div>
                                    </div>
                                </div>
                                <div class="component-details">
                                    <div class="detail-item">
                                        <div class="detail-label">Default Quantity</div>
                                        <div class="detail-value" x-text="optional.defaultQuantity"></div>
                                    </div>
                                    <div class="detail-item">
                                        <div class="detail-label">Specification</div>
                                        <input type="text" class="detail-input" x-model="optional.spec" @change="calculateBOM()">
                                    </div>
                                </div>
                                <div class="checkbox-group" x-show="optional.name === 'VFD Inverter'">
                                    <label class="switch">
                                        <input type="checkbox" id="useInverter" x-model="useInverter">
                                        <span class="slider"></span>
                                    </label>
                                    <label class="checkbox-label" for="useInverter">Use VFD for largest motor</label>
                                </div>
                            </div>
                        </template>
                    </div>
                </div>
            </div>

            <!-- Full Width Sections -->
            <!-- Cabinet Layout -->
            <div class="card" style="grid-column: 1 / -1;">
                <h2 class="card-title"><i class="fas fa-th-large"></i> Cabinet Layout</h2>
                <div class="color-legend">
                    <div class="legend-item">
                        <div class="legend-color" style="background-color: var(--secondary-color);"></div>
                        <span>PLC & Modules</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color" style="background-color: #9b59b6;"></div>
                        <span>Power Supply</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color" style="background-color: var(--danger-color);"></div>
                        <span>Breakers</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color" style="background-color: var(--success-color);"></div>
                        <span>Contactors</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color" style="background-color: var(--warning-color);"></div>
                        <span>Relays</span>
                    </div>
                </div>
                <div class="layout-container">
                    <div class="layout-grid" id="layoutGrid">
                        <template x-for="(component, index) in layoutComponents" :key="index">
                            <div class="layout-component" 
                                 :class="component.type"
                                 :style="`grid-column: span ${component.width / 16}; grid-row: span ${component.height / 20};`">
                                <div x-text="component.tag"></div>
                                <div style="font-size: 0.6rem; margin-top: 3px;" x-text="component.details"></div>
                            </div>
                        </template>
                    </div>
                </div>
            </div>

            <!-- Control Scenario Visualization -->
            <div class="card" style="grid-column: 1 / -1;">
                <h2 class="card-title"><i class="fas fa-project-diagram"></i> Control Scenario Visualization</h2>
                <div class="scenario-visualization">
                    <div class="visualization-canvas">
                        <div class="air-flow" style="top: 50px; left: 50px;">Fresh Air</div>
                        <div class="air-flow" style="top: 50px; left: 300px;">Return Air</div>
                        <div class="air-flow" style="top: 50px; left: 550px;">Exhaust Air</div>
                        <div class="air-flow" style="top: 200px; left: 200px;">Mixed Air</div>
                        <div class="air-flow" style="top: 200px; left: 400px;">Cycle Air</div>
                        <div class="air-flow" style="top: 350px; left: 300px;">Feed Air</div>
                        
                        <div class="damper" style="top: 120px; left: 150px;" @click="toggleDamper('fresh')">D1</div>
                        <div class="damper" style="top: 120px; left: 400px;" @click="toggleDamper('return')">D2</div>
                        <div class="damper" style="top: 120px; left: 650px;" @click="toggleDamper('exhaust')">D3</div>
                        
                        <div class="sensor" style="top: 250px; left: 50px;">T1</div>
                        <div class="sensor" style="top: 250px; left: 700px;">T2</div>
                        <div class="sensor" style="top: 250px; left: 200px;">H1</div>
                        <div class="sensor" style="top: 250px; left: 600px;">H2</div>
                        
                        <div class="motor" style="top: 400px; left: 100px;">M1</div>
                        <div class="motor" style="top: 400px; left: 500px;">M2</div>
                        
                        <div class="valve" style="top: 400px; left: 300px;">V1</div>
                    </div>
                    
                    <div class="parameter-grid">
                        <div class="parameter-item">
                            <div class="parameter-label">Fresh Air Percentage</div>
                            <input type="range" class="parameter-input" min="0" max="100" x-model="scenario.freshAirPercent" @input="updateScenario()">
                            <div style="text-align: center; margin-top: 5px;" x-text="scenario.freshAirPercent + '%'"></div>
                        </div>
                        <div class="parameter-item">
                            <div class="parameter-label">Target Temperature</div>
                            <input type="range" class="parameter-input" min="15" max="35" x-model="scenario.targetTemp" @input="updateScenario()">
                            <div style="text-align: center; margin-top: 5px;" x-text="scenario.targetTemp + 'Â°C'"></div>
                        </div>
                        <div class="parameter-item">
                            <div class="parameter-label">Target Humidity</div>
                            <input type="range" class="parameter-input" min="30" max="80" x-model="scenario.targetHumidity" @input="updateScenario()">
                            <div style="text-align: center; margin-top: 5px;" x-text="scenario.targetHumidity + '%'"></div>
                        </div>
                    </div>
                    
                    <div class="simulation-grid">
                        <div class="simulation-item">
                            <div class="simulation-label">Outside Temp</div>
                            <div class="simulation-value" x-text="scenario.outsideTemp + 'Â°C'"></div>
                        </div>
                        <div class="simulation-item">
                            <div class="simulation-label">Outside Humidity</div>
                            <div class="simulation-value" x-text="scenario.outsideHumidity + '%'"></div>
                        </div>
                        <div class="simulation-item">
                            <div class="simulation-label">Inside Temp</div>
                            <div class="simulation-value" x-text="scenario.insideTemp + 'Â°C'"></div>
                        </div>
                        <div class="simulation-item">
                            <div class="simulation-label">Inside Humidity</div>
                            <div class="simulation-value" x-text="scenario.insideHumidity + '%'"></div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Bill of Materials -->
            <div class="card bom-container">
                <h2 class="card-title"><i class="fas fa-clipboard-list"></i> Bill of Materials (BOM)</h2>
                <div class="component-count">Total Components: <span x-text="bom.length"></span></div>
                <table class="bom-table">
                    <thead>
                        <tr>
                            <th>#</th>
                            <th>Component</th>
                            <th>Quantity</th>
                            <th>Specifications</th>
                            <th>Standards</th>
                            <th>Tags</th>
                        </tr>
                    </thead>
                    <tbody>
                        <template x-for="(item, index) in bom" :key="index">
                            <tr>
                                <td x-text="index + 1"></td>
                                <td x-text="item.name"></td>
                                <td x-text="item.quantity"></td>
                                <td x-text="item.specifications"></td>
                                <td x-text="item.standards"></td>
                                <td>
                                    <template x-for="tag in item.tags" :key="tag">
                                        <span class="tag" x-text="tag"></span>
                                    </template>
                                </td>
                            </tr>
                        </template>
                    </tbody>
                </table>
            </div>

            <!-- Control Algorithm -->
            <div class="control-algorithm">
                <h3 class="algorithm-title"><i class="fas fa-brain"></i> Control Algorithm</h3>
                <div class="algorithm-step">Measure outside temperature (OT) and humidity (OH)</div>
                <div class="algorithm-step">Measure return air temperature (RT) and humidity (RH)</div>
                <div class="algorithm-step">Calculate mixing ratio based on fresh air percentage</div>
                <div class="algorithm-step">Calculate feed air conditions after evaporative cooling</div>
                <div class="algorithm-step">Adjust dampers to achieve target mixing ratio</div>
                <div class="algorithm-step">Control water pump based on humidity requirement</div>
                
                <table class="sequence-table">
                    <thead>
                        <tr>
                            <th>Condition</th>
                            <th>Action</th>
                            <th>Parameter</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>RT > Target Temp + 2Â°C</td>
                            <td>Increase fresh air %</td>
                            <td>+10%</td>
                        </tr>
                        <tr>
                            <td>RT < Target Temp - 2Â°C</td>
                            <td>Decrease fresh air %</td>
                            <td>-10%</td>
                        </tr>
                        <tr>
                            <td>RH > Target Humidity + 5%</td>
                            <td>Stop humidification</td>
                            <td>Valve 0%</td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <!-- I/O Simulation -->
            <div class="card">
                <h2 class="card-title"><i class="fas fa-microchip"></i> I/O Simulation</h2>
                <div class="simulation-grid">
                    <template x-for="(io, index) in simulationIO" :key="index">
                        <div class="simulation-item">
                            <div class="simulation-label" x-text="io.name"></div>
                            <div class="simulation-value" x-text="io.value"></div>
                            <div class="simulation-status" :class="io.status ? 'status-on' : 'status-off'"></div>
                        </div>
                    </template>
                </div>
            </div>

            <!-- Alarm Panel -->
            <div class="alarm-panel">
                <h3 class="alarm-title"><i class="fas fa-exclamation-triangle"></i> Alarm Monitoring</h3>
                <div class="alarm-list">
                    <template x-for="(alarm, index) in alarms" :key="index">
                        <div class="alarm-item" :class="alarm.active ? 'alarm-active' : ''">
                            <div class="alarm-name" x-text="alarm.name"></div>
                            <div class="alarm-status" :class="alarm.active ? 'status-active' : 'status-inactive'">
                                <span x-text="alarm.active ? 'ACTIVE' : 'INACTIVE'"></span>
                            </div>
                        </div>
                    </template>
                </div>
            </div>
        </div>

        <!-- Status Bar -->
        <div class="status-bar">
            <div class="total-cost">Total Components: <span x-text="bom.length"></span> | I/O Points: <span x-text="totalIO"></span></div>
            <div class="component-count">
                <span>Relays: <span x-text="relayCount"></span></span>
                <span>Contactors: <span x-text="contactorCount"></span></span>
                <span>Alarms: <span x-text="activeAlarms"></span></span>
                <span>Mode: <span x-text="activeScenario"></span></span>
            </div>
            <div>
                <button class="btn btn-primary" @click="showModal = 'connections'">
                    <i class="fas fa-network-wired"></i> Wiring
                </button>
                <button class="btn btn-warning" @click="runSimulation()">
                    <i class="fas fa-play"></i> Simulate
                </button>
                <button class="btn btn-info" @click="generateAllCode()">
                    <i class="fas fa-file-code"></i> Generate Code
                </button>
            </div>
        </div>

        <!-- Modals -->
        <!-- Code Generator Modal -->
        <template x-if="showModal === 'code'">
            <div class="modal" @click.self="showModal = null">
                <div class="modal-content">
                    <div class="modal-header">
                        <h3 class="modal-title"><i class="fas fa-code"></i> PLC Code Generator</h3>
                        <button class="close-modal" @click="showModal = null">&times;</button>
                    </div>
                    <div class="tabs">
                        <button class="tab" :class="{ active: activeCodeTab === 'ladder' }" @click="activeCodeTab = 'ladder'">Ladder Logic</button>
                        <button class="tab" :class="{ active: activeCodeTab === 'st' }" @click="activeCodeTab = 'st'">Structured Text</button>
                        <button class="tab" :class="{ active: activeCodeTab === 'fbd' }" @click="activeCodeTab = 'fbd'">Function Block</button>
                        <button class="tab" :class="{ active: activeCodeTab === 'python' }" @click="activeCodeTab = 'python'">Python Sim</button>
                    </div>
                    
                    <div class="tab-content" :class="{ active: activeCodeTab === 'ladder' }">
                        <div class="code-editor-container">
                            <div class="code-header">
                                <h4 class="code-title">Ladder Logic (Siemens/Allen-Bradley)</h4>
                                <div class="code-actions">
                                    <button class="code-btn" @click="copyCode('ladder')">
                                        <i class="fas fa-copy"></i> Copy
                                    </button>
                                    <button class="code-btn" @click="downloadCode('ladder', 'ld')">
                                        <i class="fas fa-download"></i> Download
                                    </button>
                                </div>
                            </div>
                            <textarea id="ladderEditor" style="display: none;" x-text="generatedCode.ladder"></textarea>
                        </div>
                    </div>
                    
                    <div class="tab-content" :class="{ active: activeCodeTab === 'st' }">
                        <div class="code-editor-container">
                            <div class="code-header">
                                <h4 class="code-title">Structured Text (IEC 61131-3)</h4>
                                <div class="code-actions">
                                    <button class="code-btn" @click="copyCode('st')">
                                        <i class="fas fa-copy"></i> Copy
                                    </button>
                                    <button class="code-btn" @click="downloadCode('st', 'st')">
                                        <i class="fas fa-download"></i> Download
                                    </button>
                                </div>
                            </div>
                            <textarea id="stEditor" style="display: none;" x-text="generatedCode.st"></textarea>
                        </div>
                    </div>
                    
                    <div class="tab-content" :class="{ active: activeCodeTab === 'fbd' }">
                        <div class="code-editor-container">
                            <div class="code-header">
                                <h4 class="code-title">Function Block Diagram</h4>
                                <div class="code-actions">
                                    <button class="code-btn" @click="copyCode('fbd')">
                                        <i class="fas fa-copy"></i> Copy
                                    </button>
                                    <button class="code-btn" @click="downloadCode('fbd', 'xml')">
                                        <i class="fas fa-download"></i> Download
                                    </button>
                                </div>
                            </div>
                            <textarea id="fbdEditor" style="display: none;" x-text="generatedCode.fbd"></textarea>
                        </div>
                    </div>
                    
                    <div class="tab-content" :class="{ active: activeCodeTab === 'python' }">
                        <div class="code-editor-container">
                            <div class="code-header">
                                <h4 class="code-title">Python Simulation Code</h4>
                                <div class="code-actions">
                                    <button class="code-btn" @click="copyCode('python')">
                                        <i class="fas fa-copy"></i> Copy
                                    </button>
                                    <button class="code-btn" @click="downloadCode('python', 'py')">
                                        <i class="fas fa-download"></i> Download
                                    </button>
                                </div>
                            </div>
                            <textarea id="pythonEditor" style="display: none;" x-text="generatedCode.python"></textarea>
                        </div>
                    </div>
                    
                    <div style="margin-top: 20px; text-align: right;">
                        <button class="btn btn-danger" @click="showModal = null">
                            Close
                        </button>
                    </div>
                </div>
            </div>
        </template>

        <!-- Scenarios Modal -->
        <template x-if="showModal === 'scenarios'">
            <div class="modal" @click.self="showModal = null">
                <div class="modal-content">
                    <div class="modal-header">
                        <h3 class="modal-title"><i class="fas fa-cogs"></i> Control Scenarios</h3>
                        <button class="close-modal" @click="showModal = null">&times;</button>
                    </div>
                    <div class="tabs">
                        <button class="tab" :class="{ active: activeScenarioTab === 'modes' }" @click="activeScenarioTab = 'modes'">Operating Modes</button>
                        <button class="tab" :class="{ active: activeScenarioTab === 'sequences' }" @click="activeScenarioTab = 'sequences'">Sequences</button>
                        <button class="tab" :class="{ active: activeScenarioTab === 'faults' }" @click="activeScenarioTab = 'faults'">Fault Handling</button>
                        <button class="tab" :class="{ active: activeScenarioTab === 'optimization' }" @click="activeScenarioTab = 'optimization'">Optimization</button>
                    </div>
                    
                    <div class="tab-content" :class="{ active: activeScenarioTab === 'modes' }">
                        <h4>Operating Modes</h4>
                        <div class="scenario-builder">
                            <div class="scenario-controls">
                                <select class="scenario-select" x-model="selectedMode" @change="loadScenarioMode()">
                                    <option value="auto">Automatic Mode</option>
                                    <option value="manual">Manual Mode</option>
                                    <option value="economy">Economy Mode</option>
                                    <option value="summer">Summer Mode</option>
                                    <option value="winter">Winter Mode</option>
                                </select>
                                <button class="btn btn-primary" @click="applyScenarioMode()">
                                    <i class="fas fa-play-circle"></i> Apply
                                </button>
                            </div>
                            
                            <div class="parameter-grid">
                                <template x-for="(param, index) in modeParameters" :key="index">
                                    <div class="parameter-item">
                                        <div class="parameter-label" x-text="param.label"></div>
                                        <input type="range" class="parameter-input" 
                                               :min="param.min" :max="param.max" :step="param.step"
                                               x-model="param.value" @input="updateModeParameters()">
                                        <div style="text-align: center; margin-top: 5px;" x-text="param.value + (param.unit || '')"></div>
                                    </div>
                                </template>
                            </div>
                        </div>
                    </div>
                    
                    <div class="tab-content" :class="{ active: activeScenarioTab === 'sequences' }">
                        <h4>Startup & Shutdown Sequences</h4>
                        <div class="scenario-builder">
                            <div class="scenario-controls">
                                <button class="btn btn-primary" @click="executeSequence('startup')">
                                    <i class="fas fa-power-off"></i> Startup
                                </button>
                                <button class="btn btn-danger" @click="executeSequence('shutdown')">
                                    <i class="fas fa-stop-circle"></i> Shutdown
                                </button>
                                <button class="btn btn-warning" @click="executeSequence('emergency')">
                                    <i class="fas fa-exclamation-triangle"></i> Emergency Stop
                                </button>
                            </div>
                            
                            <table class="sequence-table">
                                <thead>
                                    <tr>
                                        <th>Step</th>
                                        <th>Action</th>
                                        <th>Duration</th>
                                        <th>Interlock</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td>1</td>
                                        <td>System Check</td>
                                        <td>5s</td>
                                        <td>All safety OK</td>
                                    </tr>
                                    <tr>
                                        <td>2</td>
                                        <td>Dampers Open</td>
                                        <td>10s</td>
                                        <td>Position feedback</td>
                                    </tr>
                                    <tr>
                                        <td>3</td>
                                        <td>Fans Start</td>
                                        <td>15s</td>
                                        <td>Current limit</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                    
                    <div class="tab-content" :class="{ active: activeScenarioTab === 'faults' }">
                        <h4>Fault Handling Scenarios</h4>
                        <div class="scenario-builder">
                            <div class="scenario-controls">
                                <select class="scenario-select" x-model="selectedFault" @change="simulateFault()">
                                    <option value="">Select Fault</option>
                                    <option value="sensor_fail">Sensor Failure</option>
                                    <option value="motor_overload">Motor Overload</option>
                                    <option value="damper_stuck">Damper Stuck</option>
                                </select>
                                <button class="btn btn-danger" @click="clearFaults()">
                                    <i class="fas fa-broom"></i> Clear Faults
                                </button>
                            </div>
                        </div>
                    </div>
                    
                    <div class="tab-content" :class="{ active: activeScenarioTab === 'optimization' }">
                        <h4>Energy Optimization</h4>
                        <div class="scenario-builder">
                            <div class="scenario-controls">
                                <button class="btn btn-primary" @click="enableOptimization()">
                                    <i class="fas fa-leaf"></i> Enable
                                </button>
                            </div>
                            
                            <div class="parameter-grid">
                                <div class="parameter-item">
                                    <div class="parameter-label">Energy Savings</div>
                                    <div style="text-align: center; font-size: 1.5rem; color: var(--success-color); font-weight: bold;">
                                        25-35%
                                    </div>
                                </div>
                                <div class="parameter-item">
                                    <div class="parameter-label">Payback Period</div>
                                    <div style="text-align: center; font-size: 1.5rem; color: var(--warning-color); font-weight: bold;">
                                        2.5 years
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div style="margin-top: 20px; text-align: right;">
                        <button class="btn btn-danger" @click="showModal = null">
                            Close
                        </button>
                    </div>
                </div>
            </div>
        </template>

        <!-- Print/Export Modal -->
        <template x-if="showModal === 'print'">
            <div class="modal" @click.self="showModal = null">
                <div class="modal-content">
                    <div class="modal-header">
                        <h3 class="modal-title"><i class="fas fa-print"></i> Export Options</h3>
                        <button class="close-modal" @click="showModal = null">&times;</button>
                    </div>
                    <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 15px; margin-top: 20px;">
                        <button class="btn btn-primary" style="flex-direction: column; height: auto; padding: 20px;" @click="printDocument()">
                            <i class="fas fa-print fa-2x"></i>
                            <span style="margin-top: 10px;">Print Document</span>
                        </button>
                        <button class="btn btn-secondary" style="flex-direction: column; height: auto; padding: 20px;" @click="exportAsPNG()">
                            <i class="fas fa-image fa-2x"></i>
                            <span style="margin-top: 10px;">Export as PNG</span>
                        </button>
                        <button class="btn btn-primary" style="flex-direction: column; height: auto; padding: 20px;" @click="exportBOM()">
                            <i class="fas fa-file-csv fa-2x"></i>
                            <span style="margin-top: 10px;">Export BOM CSV</span>
                        </button>
                        <button class="btn btn-secondary" style="flex-direction: column; height: auto; padding: 20px;" @click="exportPDF()">
                            <i class="fas fa-file-pdf fa-2x"></i>
                            <span style="margin-top: 10px;">Export PDF</span>
                        </button>
                    </div>
                    <div style="margin-top: 20px; text-align: right;">
                        <button class="btn btn-danger" @click="showModal = null">
                            Cancel
                        </button>
                    </div>
                </div>
            </div>
        </template>

        <!-- Hidden file input -->
        <input type="file" id="fileInput" accept=".json" style="display: none;" @change="loadProjectFromFile($event)">
    </div>

    <script>
        document.addEventListener('alpine:init', () => {
            // CodeMirror will be initialized when modal opens
        });

        function plcDesigner() {
            return {
                // Application state
                showModal: null,
                activeCodeTab: 'ladder',
                activeScenarioTab: 'modes',
                
                // Component data
                motors: [
                    { id: 1, name: 'Fan Feed Motor', quantity: 2, defaultQuantity: 2, power: '22', voltage: '400V', hasOver5kw: true },
                    { id: 2, name: 'Fan Return Motor', quantity: 2, defaultQuantity: 2, power: '30', voltage: '400V', hasOver5kw: true },
                    { id: 3, name: 'Dust Fan Motor', quantity: 4, defaultQuantity: 4, power: '3.3', voltage: '400V', hasOver5kw: false },
                    { id: 4, name: 'Rotary Motor', quantity: 2, defaultQuantity: 2, power: '1', voltage: '400V', hasOver5kw: false },
                    { id: 5, name: 'Mechanism Motor', quantity: 2, defaultQuantity: 2, power: '0.25', voltage: '400V', hasOver5kw: false },
                    { id: 6, name: 'Pump Water Motor', quantity: 1, defaultQuantity: 1, power: '30', voltage: '400V', hasOver5kw: true }
                ],
                
                actuators: [
                    { id: 1, name: 'Damper Fresh', quantity: 2, defaultQuantity: 2, voltage: '24V DC', hasPositioner: true, readPosition: true },
                    { id: 2, name: 'Damper Exhaust', quantity: 2, defaultQuantity: 2, voltage: '24V DC', hasPositioner: true, readPosition: true },
                    { id: 3, name: 'Damper Return', quantity: 2, defaultQuantity: 2, voltage: '24V DC', hasPositioner: false, readPosition: false },
                    { id: 4, name: 'Steam Valve', quantity: 1, defaultQuantity: 1, voltage: '24V DC', hasPositioner: true, readPosition: false }
                ],
                
                sensors: [
                    { id: 1, name: 'Temperature Sensor', quantity: 2, defaultQuantity: 2, type: 'Analog 4-20mA' },
                    { id: 2, name: 'Humidity Sensor', quantity: 2, defaultQuantity: 2, type: 'Analog 4-20mA' },
                    { id: 3, name: 'Micro Switch', quantity: 5, defaultQuantity: 5, type: 'Digital ON/OFF' }
                ],
                
                optionalComponents: [
                    { id: 1, name: 'VFD Inverter', quantity: 0, defaultQuantity: 0, spec: '30kW' },
                    { id: 2, name: 'Soft Starter', quantity: 0, defaultQuantity: 0, spec: '30kW' },
                    { id: 3, name: 'HMI Panel', quantity: 1, defaultQuantity: 1, spec: '7 inch' },
                    { id: 4, name: 'Cabinet Heat Sensor', quantity: 0, defaultQuantity: 0, spec: 'Thermal' }
                ],
                
                // Settings
                useSoftStarter: true,
                useInverter: false,
                
                // Control scenario
                scenario: {
                    freshAirPercent: 30,
                    targetTemp: 24,
                    targetHumidity: 55,
                    heatingEnabled: true,
                    outsideTemp: 28,
                    outsideHumidity: 40,
                    insideTemp: 26,
                    insideHumidity: 60,
                    feedTemp: 23.5,
                    feedHumidity: 58,
                    pidKp: 1.5,
                    pidKi: 0.1,
                    pidKd: 0.05
                },
                
                selectedMode: 'auto',
                selectedFault: '',
                
                modeParameters: [
                    { label: 'Temperature Setpoint', min: 18, max: 30, step: 0.5, value: 24, unit: 'Â°C' },
                    { label: 'Humidity Setpoint', min: 30, max: 70, step: 1, value: 55, unit: '%' },
                    { label: 'Fresh Air Minimum', min: 10, max: 100, step: 5, value: 20, unit: '%' }
                ],
                
                // Generated code
                generatedCode: {
                    ladder: '',
                    st: '',
                    fbd: '',
                    python: ''
                },
                
                // Simulation
                simulationIO: [
                    { name: 'Fan Feed Motor', value: '75%', status: true },
                    { name: 'Fan Return Motor', value: '80%', status: true },
                    { name: 'Fresh Damper', value: '30%', status: true },
                    { name: 'Return Damper', value: '70%', status: true },
                    { name: 'Water Pump', value: 'ON', status: true },
                    { name: 'Steam Valve', value: 'OFF', status: false }
                ],
                
                alarms: [
                    { name: 'High Temperature', active: false },
                    { name: 'Low Humidity', active: false },
                    { name: 'Motor Overload', active: false },
                    { name: 'Filter Clogged', active: true }
                ],
                
                // Calculated data
                bom: [],
                layoutComponents: [],
                relayCount: 0,
                contactorCount: 0,
                terminalCount: 0,
                totalIO: 0,
                activeAlarms: 0,
                activeScenario: 'Auto',
                
                // Initialize the application
                init() {
                    this.calculateBOM();
                    this.generateLayout();
                    this.generateAllCode();
                    this.updateActiveAlarms();
                    
                    // Watch for modal opening to initialize CodeMirror
                    this.$watch('showModal', (value) => {
                        if (value === 'code') {
                            this.$nextTick(() => {
                                this.initCodeEditors();
                            });
                        }
                    });
                },
                
                // Component quantity controls
                incrementQuantity(component) {
                    component.quantity++;
                    this.calculateBOM();
                    this.generateLayout();
                    this.generateAllCode();
                },
                
                decrementQuantity(component) {
                    if (component.quantity > 0) {
                        component.quantity--;
                        this.calculateBOM();
                        this.generateLayout();
                        this.generateAllCode();
                    }
                },
                
                // Calculate the Bill of Materials
                calculateBOM() {
                    let bom = [];
                    let largestMotorPower = 0;
                    
                    // Find largest motor power
                    this.motors.forEach(motor => {
                        let power = parseFloat(motor.power) || 0;
                        if (power > largestMotorPower) largestMotorPower = power;
                    });
                    
                    // Add motors
                    this.motors.forEach(motor => {
                        if (motor.quantity > 0) {
                            bom.push({
                                name: motor.name,
                                quantity: motor.quantity,
                                specifications: `${motor.power}kW, ${motor.voltage}`,
                                standards: 'IEC 60034, IP55',
                                tags: [`M${motor.id}`, `${motor.power}kW`]
                            });
                            
                            // Add contactor for each motor
                            let contactorSize = 'Size 1';
                            let power = parseFloat(motor.power) || 0;
                            if (power > 15) contactorSize = 'Size 3';
                            else if (power > 5) contactorSize = 'Size 2';
                            
                            bom.push({
                                name: 'Contactor',
                                quantity: motor.quantity,
                                specifications: `${contactorSize}, ${motor.power}kW, 400V AC`,
                                standards: 'IEC 60947-4-1',
                                tags: [`KM${motor.id}`, contactorSize]
                            });
                            
                            // Add overload relay for motors > 5kW
                            if (power > 5) {
                                bom.push({
                                    name: 'Overload Relay',
                                    quantity: motor.quantity,
                                    specifications: `For ${motor.power}kW motor`,
                                    standards: 'IEC 60947-4-1',
                                    tags: [`F${motor.id}`]
                                });
                            }
                        }
                    });
                    
                    // Add actuators
                    this.actuators.forEach(actuator => {
                        if (actuator.quantity > 0) {
                            bom.push({
                                name: actuator.name,
                                quantity: actuator.quantity,
                                specifications: `${actuator.voltage}`,
                                standards: 'IEC 60534',
                                tags: [`A${actuator.id}`]
                            });
                            
                            bom.push({
                                name: 'Relay',
                                quantity: actuator.quantity,
                                specifications: `24V DC Coil, 2NO+2NC`,
                                standards: 'IEC 61810',
                                tags: [`K${actuator.id}`]
                            });
                        }
                    });
                    
                    // Add sensors
                    this.sensors.forEach(sensor => {
                        if (sensor.quantity > 0) {
                            bom.push({
                                name: sensor.name,
                                quantity: sensor.quantity,
                                specifications: `${sensor.type}`,
                                standards: 'IEC 60751',
                                tags: [`S${sensor.id}`]
                            });
                        }
                    });
                    
                    // Add optional components
                    this.optionalComponents.forEach(optional => {
                        if (optional.quantity > 0) {
                            bom.push({
                                name: optional.name,
                                quantity: optional.quantity,
                                specifications: optional.spec,
                                standards: optional.name === 'HMI Panel' ? 'IP65' : 'IEC 61800',
                                tags: [optional.name === 'HMI Panel' ? 'HMI1' : 'OPT1']
                            });
                        }
                    });
                    
                    // Add PLC system
                    let diCount = 0, doCount = 0, aiCount = 0;
                    
                    // Calculate I/O requirements
                    this.sensors.forEach(sensor => {
                        if (sensor.type === 'Digital ON/OFF') diCount += sensor.quantity;
                        else aiCount += sensor.quantity;
                    });
                    
                    this.actuators.forEach(actuator => {
                        doCount += actuator.quantity;
                        if (actuator.hasPositioner && actuator.readPosition) aiCount += actuator.quantity;
                    });
                    
                    // Add PLC CPU
                    bom.push({
                        name: 'PLC CPU',
                        quantity: 1,
                        specifications: 'Siemens S7-1200, 24DI/16DO/4AI',
                        standards: 'IEC 61131',
                        tags: ['CPU1214C']
                    });
                    
                    // Add power supply
                    bom.push({
                        name: 'Power Supply',
                        quantity: 1,
                        specifications: '24V DC, 5A',
                        standards: 'IEC 61010',
                        tags: ['PS1']
                    });
                    
                    // Add main circuit breaker
                    bom.push({
                        name: 'Main Circuit Breaker',
                        quantity: 1,
                        specifications: '100A, 4P',
                        standards: 'IEC 60947-2',
                        tags: ['Q0']
                    });
                    
                    // Add terminal blocks
                    let terminalBlocks = Math.ceil((diCount + doCount + aiCount + 20) / 12);
                    bom.push({
                        name: 'Terminal Block',
                        quantity: terminalBlocks,
                        specifications: '12 positions, 600V',
                        standards: 'IEC 60947',
                        tags: ['TB1']
                    });
                    
                    // Add cabinet
                    bom.push({
                        name: 'Control Cabinet',
                        quantity: 1,
                        specifications: '800x600x200mm, IP54',
                        standards: 'IEC 60529',
                        tags: ['CAB1']
                    });
                    
                    // Add wiring
                    bom.push({
                        name: 'Control Wire',
                        quantity: 3,
                        specifications: '1.5mmÂ², Black',
                        standards: 'IEC 60228',
                        tags: ['W1']
                    });
                    
                    this.bom = bom;
                    
                    // Update component counts
                    this.relayCount = this.actuators.reduce((sum, actuator) => sum + actuator.quantity, 0);
                    this.contactorCount = this.motors.reduce((sum, motor) => sum + motor.quantity, 0);
                    this.terminalCount = terminalBlocks;
                    this.totalIO = diCount + doCount + aiCount;
                },
                
                // Generate cabinet layout
                generateLayout() {
                    let layout = [];
                    let gridX = 1, gridY = 1;
                    
                    // Add PLC
                    layout.push({
                        type: 'plc',
                        tag: 'PLC',
                        details: 'S7-1200',
                        width: 32,
                        height: 40,
                        x: gridX,
                        y: gridY
                    });
                    
                    gridX += 2;
                    
                    // Add power supply
                    layout.push({
                        type: 'psu',
                        tag: 'PSU',
                        details: '24V/5A',
                        width: 32,
                        height: 40,
                        x: gridX,
                        y: gridY
                    });
                    
                    gridX = 1;
                    gridY += 2;
                    
                    // Add main breaker
                    layout.push({
                        type: 'breaker',
                        tag: 'Q0',
                        details: '100A 4P',
                        width: 32,
                        height: 40,
                        x: gridX,
                        y: gridY
                    });
                    
                    gridX += 2;
                    
                    // Add contactors
                    let contactorIndex = 1;
                    this.motors.forEach(motor => {
                        for (let i = 0; i < motor.quantity; i++) {
                            layout.push({
                                type: 'contactor',
                                tag: `KM${contactorIndex}`,
                                details: `${motor.power}kW`,
                                width: 32,
                                height: 40,
                                x: gridX,
                                y: gridY
                            });
                            
                            gridX += 2;
                            if (gridX > 10) {
                                gridX = 1;
                                gridY += 2;
                            }
                            contactorIndex++;
                        }
                    });
                    
                    this.layoutComponents = layout;
                },
                
                // Generate all code types
                generateAllCode() {
                    this.generateLadderLogic();
                    this.generateStructuredText();
                    this.generateFunctionBlock();
                    this.generatePythonCode();
                },
                
                // Ladder Logic Generation
                generateLadderLogic() {
                    this.generatedCode.ladder = `// PLC Ladder Logic for Evaporative Ventilation System
// Generated: ${new Date().toISOString().split('T')[0]}

NETWORK 1: System Enable
|   I0.0         I0.1         I0.2         Q0.0
|----| |---------| |----------|/|----------( )----|
|   START       STOP        EMERGENCY    SYS_ENABLE

NETWORK 2: Fan Feed Motor Control
|   Q0.0         I0.3         I0.4         Q0.1
|----| |---------| |----------|/|----------( )----|
| SYS_ENABLE   TEMP_OK     OVERLOAD    FAN_FEED

NETWORK 3: Damper Control
|   Q0.0         I1.0         Q1.0
|----| |---------| |----------( )----|
| SYS_ENABLE   AUTO_MODE   DMP_FRESH

NETWORK 4: Temperature PID
|   Q0.0        AIW2        MD0         PID0
|----| |---------[SUB_R]-----[PID]-------( )----|
| SYS_ENABLE   ACT_TEMP   SET_TEMP    TEMP_CTRL

// Tag Definitions:
// I0.0 - Start Button
// I0.1 - Stop Button
// I0.2 - Emergency Stop
// I0.3 - Temperature OK
// I0.4 - Motor Overload
// Q0.0 - System Enable
// Q0.1 - Fan Feed Motor
// AIW2 - Actual Temperature
// MD0 - Temperature Setpoint`;
                },
                
                // Structured Text Generation
                generateStructuredText() {
                    this.generatedCode.st = `(*
    PLC Structured Text Program
    Evaporative Ventilation Control
*)

PROGRAM MainControl
VAR
    SystemEnable : BOOL := FALSE;
    AutoMode : BOOL := TRUE;
    FanFeedMotor : BOOL := FALSE;
    FreshDamper : REAL := 0.0;
    OutsideTemp : REAL := 25.0;
    OutsideHumidity : REAL := 40.0;
    TempSetpoint : REAL := 24.0;
    HumSetpoint : REAL := 55.0;
    FreshAirPercentage : REAL := 30.0;
END_VAR

// Main Control Logic
IF NOT EmergencyStop THEN
    SystemEnable := StartButton AND NOT StopButton;
    
    IF SystemEnable THEN
        // Calculate mixing
        FreshDamper := FreshAirPercentage / 100.0;
        
        // Motor control
        FanFeedMotor := TemperatureOK AND NOT MotorOverload;
        
        // Temperature control
        IF ReturnTemp > (TempSetpoint + 2.0) THEN
            FreshAirPercentage := FreshAirPercentage + 10.0;
        ELSIF ReturnTemp < (TempSetpoint - 2.0) THEN
            FreshAirPercentage := FreshAirPercentage - 10.0;
        END_IF;
        
        // Limit fresh air percentage
        FreshAirPercentage := LIMIT(0.0, FreshAirPercentage, 100.0);
    END_IF;
END_IF;`;
                },
                
                // Function Block Diagram
                generateFunctionBlock() {
                    this.generatedCode.fbd = `<?xml version="1.0" encoding="UTF-8"?>
<FBDProject>
    <fileHeader company="PLC Designer" productName="Evaporative Ventilation"/>
    
    <pous>
        <pou name="MainControl" pouType="program">
            <interface>
                <localVars>
                    <variable name="SystemEnable">
                        <type><BOOL /></type>
                    </variable>
                </localVars>
            </interface>
            
            <body>
                <FBD>
                    <block localId="1" typeName="AND">
                        <inputVariables>
                            <variable formalParameter="IN1" localId="2"/>
                            <variable formalParameter="IN2" localId="3"/>
                        </inputVariables>
                        <outputVariables>
                            <variable formalParameter="OUT" localId="4"/>
                        </outputVariables>
                    </block>
                </FBD>
            </body>
        </pou>
    </pous>
</FBDProject>`;
                },
                
                // Python Simulation Code
                generatePythonCode() {
                    this.generatedCode.python = `#!/usr/bin/env python3
"""
PLC Simulation for Evaporative Ventilation System
"""

import time

class EvaporativeVentilationSystem:
    def __init__(self):
        self.system_enable = False
        self.outside_temp = 28.0
        self.outside_humidity = 40.0
        self.return_temp = 26.0
        self.return_humidity = 60.0
        self.fresh_air_percentage = 30.0
        
    def calculate_mixing(self):
        fresh_ratio = self.fresh_air_percentage / 100.0
        cycle_ratio = 1.0 - fresh_ratio
        
        feed_temp = (self.outside_temp * fresh_ratio) + \
                    (self.return_temp * cycle_ratio)
        feed_humidity = (self.outside_humidity * fresh_ratio) + \
                        (self.return_humidity * cycle_ratio)
        
        return feed_temp, feed_humidity
    
    def control_loop(self):
        if not self.system_enable:
            return
        
        feed_temp, feed_humidity = self.calculate_mixing()
        
        # Simple control logic
        if self.return_temp > 26.0:
            self.fresh_air_percentage = min(100.0, self.fresh_air_percentage + 10.0)
        elif self.return_temp < 22.0:
            self.fresh_air_percentage = max(0.0, self.fresh_air_percentage - 10.0)
        
        print(f"Feed Temp: {feed_temp:.1f}Â°C, Humidity: {feed_humidity:.1f}%")
        print(f"Fresh Air: {self.fresh_air_percentage:.1f}%")

# Main execution
if __name__ == "__main__":
    system = EvaporativeVentilationSystem()
    system.system_enable = True
    
    for i in range(10):
        print(f"\\nCycle {i+1}:")
        system.control_loop()
        time.sleep(1)`;
                },
                
                // Initialize CodeMirror editors
                initCodeEditors() {
                    // Ladder Logic Editor
                    if (document.getElementById('ladderEditor')) {
                        this.ladderEditor = CodeMirror.fromTextArea(
                            document.getElementById('ladderEditor'),
                            {
                                mode: 'text/x-stex',
                                theme: 'dracula',
                                lineNumbers: true,
                                readOnly: true,
                                lineWrapping: true
                            }
                        );
                    }
                    
                    // Structured Text Editor
                    if (document.getElementById('stEditor')) {
                        this.stEditor = CodeMirror.fromTextArea(
                            document.getElementById('stEditor'),
                            {
                                mode: 'text/x-stsrc',
                                theme: 'dracula',
                                lineNumbers: true,
                                readOnly: true,
                                lineWrapping: true
                            }
                        );
                    }
                    
                    // Python Editor
                    if (document.getElementById('pythonEditor')) {
                        this.pythonEditor = CodeMirror.fromTextArea(
                            document.getElementById('pythonEditor'),
                            {
                                mode: 'python',
                                theme: 'dracula',
                                lineNumbers: true,
                                readOnly: false,
                                lineWrapping: true
                            }
                        );
                    }
                },
                
                // Copy code to clipboard
                copyCode(type) {
                    const code = this.generatedCode[type];
                    navigator.clipboard.writeText(code).then(() => {
                        alert(`${type.toUpperCase()} code copied to clipboard!`);
                    });
                },
                
                // Download code as file
                downloadCode(type, extension) {
                    const code = this.generatedCode[type];
                    const blob = new Blob([code], { type: 'text/plain' });
                    const url = URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = `plc_${type}_code.${extension}`;
                    document.body.appendChild(a);
                    a.click();
                    document.body.removeChild(a);
                    URL.revokeObjectURL(url);
                },
                
                // Scenario control functions
                toggleDamper(damper) {
                    alert(`Toggling ${damper} damper`);
                },
                
                updateScenario() {
                    console.log('Scenario updated:', this.scenario);
                },
                
                loadScenarioMode() {
                    const modeConfigs = {
                        auto: { freshAirPercent: 30, targetTemp: 24, targetHumidity: 55 },
                        manual: { freshAirPercent: 50, targetTemp: 22, targetHumidity: 50 },
                        economy: { freshAirPercent: 20, targetTemp: 25, targetHumidity: 60 }
                    };
                    
                    const config = modeConfigs[this.selectedMode] || modeConfigs.auto;
                    Object.assign(this.scenario, config);
                    this.activeScenario = this.selectedMode.charAt(0).toUpperCase() + this.selectedMode.slice(1);
                },
                
                applyScenarioMode() {
                    alert(`Applying ${this.selectedMode} mode`);
                },
                
                updateModeParameters() {
                    this.scenario.targetTemp = this.modeParameters[0].value;
                    this.scenario.targetHumidity = this.modeParameters[1].value;
                    this.scenario.freshAirPercent = this.modeParameters[2].value;
                },
                
                executeSequence(sequence) {
                    alert(`Executing ${sequence} sequence`);
                },
                
                simulateFault() {
                    if (!this.selectedFault) return;
                    
                    const faultMessages = {
                        sensor_fail: "Temperature sensor failure simulated",
                        motor_overload: "Motor overload condition simulated",
                        damper_stuck: "Damper stuck fault simulated"
                    };
                    
                    alert(faultMessages[this.selectedFault] || "Fault simulated");
                    
                    if (this.selectedFault === 'motor_overload') {
                        this.alarms[2].active = true;
                        this.updateActiveAlarms();
                    }
                },
                
                clearFaults() {
                    this.alarms.forEach(alarm => alarm.active = false);
                    this.updateActiveAlarms();
                    alert("All faults cleared");
                },
                
                updateActiveAlarms() {
                    this.activeAlarms = this.alarms.filter(a => a.active).length;
                },
                
                enableOptimization() {
                    alert("Energy optimization enabled");
                },
                
                runSimulation() {
                    alert("Running system simulation...");
                    // Simulate some changes
                    this.scenario.insideTemp += 0.5;
                    this.scenario.insideHumidity -= 2;
                },
                
                // Export functions
                printDocument() {
                    window.print();
                },
                
                exportAsPNG() {
                    const element = document.querySelector('.container');
                    html2canvas(element).then(canvas => {
                        const link = document.createElement('a');
                        link.download = `plc-design-${new Date().toISOString().slice(0, 10)}.png`;
                        link.href = canvas.toDataURL();
                        link.click();
                    });
                },
                
                exportBOM() {
                    let csv = 'Component,Quantity,Specifications,Standards,Tags\n';
                    this.bom.forEach(item => {
                        const tags = item.tags ? item.tags.join(';') : '';
                        csv += `"${item.name}",${item.quantity},"${item.specifications}","${item.standards}","${tags}"\n`;
                    });
                    
                    const blob = new Blob([csv], { type: 'text/csv' });
                    const url = URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = `plc-bom-${new Date().toISOString().slice(0, 10)}.csv`;
                    document.body.appendChild(a);
                    a.click();
                    document.body.removeChild(a);
                    URL.revokeObjectURL(url);
                },
                
                exportPDF() {
                    alert("PDF export would be implemented with jsPDF library");
                    // Actual implementation would use jsPDF
                },
                
                // Project management
                getProjectJSON() {
                    const project = {
                        motors: this.motors,
                        actuators: this.actuators,
                        sensors: this.sensors,
                        optionalComponents: this.optionalComponents,
                        scenario: this.scenario,
                        generatedAt: new Date().toISOString()
                    };
                    return JSON.stringify(project, null, 2);
                },
                
                saveProject() {
                    const json = this.getProjectJSON();
                    const blob = new Blob([json], { type: 'application/json' });
                    const url = URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = `plc-project-${new Date().toISOString().slice(0, 10)}.json`;
                    document.body.appendChild(a);
                    a.click();
                    document.body.removeChild(a);
                    URL.revokeObjectURL(url);
                },
                
                loadProject() {
                    document.getElementById('fileInput').click();
                },
                
                loadProjectFromFile(event) {
                    const file = event.target.files[0];
                    if (!file) return;
                    
                    const reader = new FileReader();
                    reader.onload = (e) => {
                        try {
                            const project = JSON.parse(e.target.result);
                            
                            this.motors = project.motors || this.motors;
                            this.actuators = project.actuators || this.actuators;
                            this.sensors = project.sensors || this.sensors;
                            this.optionalComponents = project.optionalComponents || this.optionalComponents;
                            this.scenario = project.scenario || this.scenario;
                            
                            this.calculateBOM();
                            this.generateLayout();
                            this.generateAllCode();
                            
                            alert('Project loaded successfully!');
                        } catch (error) {
                            alert('Error loading project: ' + error.message);
                        }
                    };
                    reader.readAsText(file);
                    event.target.value = '';
                }
            };
        }
    </script>
</body>
</html>