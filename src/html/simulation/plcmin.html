<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø·Ø±Ø§Ø­ ØªØ§Ø¨Ù„Ùˆ PLC - Ø³ÛŒØ³ØªÙ… ØªÙ‡ÙˆÛŒÙ‡ ØªØ¨Ø®ÛŒØ±ÛŒ Ù†Ø³Ø§Ø¬ÛŒ</title>
    <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>
    <style>
        :root {
            --primary-color: #1e3a8a;
            --secondary-color: #3b82f6;
            --accent-color: #10b981;
            --danger-color: #ef4444;
            --warning-color: #f59e0b;
            --light-bg: #f8fafc;
            --dark-text: #1e293b;
            --light-text: #64748b;
            --border-color: #e2e8f0;
            --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
        }
        
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background-color: #f1f5f9;
            color: var(--dark-text);
            line-height: 1.6;
            padding: 20px;
            max-width: 1800px;
            margin: 0 auto;
        }
        
        header {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            padding: 1.5rem;
            border-radius: 12px;
            margin-bottom: 1.5rem;
            box-shadow: var(--shadow);
        }
        
        h1 {
            font-size: 2rem;
            margin-bottom: 0.5rem;
        }
        
        .subtitle {
            font-size: 1.1rem;
            opacity: 0.9;
        }
        
        .container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1.5rem;
        }
        
        @media (max-width: 1200px) {
            .container {
                grid-template-columns: 1fr;
            }
        }
        
        .panel {
            background: white;
            border-radius: 12px;
            padding: 1.5rem;
            box-shadow: var(--shadow);
            margin-bottom: 1.5rem;
        }
        
        .panel-title {
            font-size: 1.4rem;
            color: var(--primary-color);
            margin-bottom: 1.2rem;
            padding-bottom: 0.5rem;
            border-bottom: 2px solid var(--border-color);
        }
        
        .component-section {
            margin-bottom: 2rem;
        }
        
        .component-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 1rem;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            margin-bottom: 0.8rem;
            transition: all 0.3s ease;
            background-color: var(--light-bg);
        }
        
        .component-item:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow);
        }
        
        .component-info {
            flex-grow: 1;
        }
        
        .component-name {
            font-weight: 600;
            font-size: 1.1rem;
        }
        
        .component-spec {
            font-size: 0.9rem;
            color: var(--light-text);
            margin-top: 0.3rem;
        }
        
        .controls {
            display: flex;
            align-items: center;
            gap: 1rem;
        }
        
        .counter {
            display: flex;
            align-items: center;
            background: white;
            border-radius: 6px;
            overflow: hidden;
            border: 1px solid var(--border-color);
        }
        
        .counter-btn {
            background: var(--light-bg);
            border: none;
            width: 36px;
            height: 36px;
            font-size: 1.2rem;
            cursor: pointer;
            transition: background 0.2s;
        }
        
        .counter-btn:hover {
            background: var(--secondary-color);
            color: white;
        }
        
        .counter-value {
            width: 40px;
            text-align: center;
            font-weight: 600;
        }
        
        .input-spec {
            padding: 0.5rem;
            border: 1px solid var(--border-color);
            border-radius: 6px;
            width: 120px;
        }
        
        .checkbox-container {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-top: 0.5rem;
        }
        
        .checkbox-label {
            font-size: 0.9rem;
            color: var(--light-text);
        }
        
        .layout-container {
            min-height: 600px;
            border: 2px dashed var(--border-color);
            border-radius: 8px;
            position: relative;
            background-color: #f8fafc;
            overflow: auto;
        }
        
        .layout-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, 80px);
            grid-auto-rows: 100px;
            gap: 4px;
            padding: 20px;
            width: fit-content;
        }
        
        .component-box {
            border-radius: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.7rem;
            text-align: center;
            padding: 4px;
            font-weight: 600;
            overflow: hidden;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            cursor: pointer;
            position: relative;
        }
        
        .component-box:hover::after {
            content: attr(data-tooltip);
            position: absolute;
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%);
            background: var(--dark-text);
            color: white;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 0.8rem;
            white-space: nowrap;
            z-index: 10;
        }
        
        .bom-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 1rem;
        }
        
        .bom-table th, .bom-table td {
            border: 1px solid var(--border-color);
            padding: 0.8rem;
            text-align: right;
        }
        
        .bom-table th {
            background-color: var(--primary-color);
            color: white;
            font-weight: 600;
        }
        
        .bom-table tr:nth-child(even) {
            background-color: var(--light-bg);
        }
        
        .bom-table tr:hover {
            background-color: #e0f2fe;
        }
        
        .tag-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 1rem;
            font-size: 0.9rem;
        }
        
        .tag-table th, .tag-table td {
            border: 1px solid var(--border-color);
            padding: 0.6rem;
            text-align: right;
        }
        
        .tag-table th {
            background-color: #475569;
            color: white;
            font-weight: 600;
        }
        
        .buttons-container {
            display: flex;
            gap: 1rem;
            margin-top: 1.5rem;
            flex-wrap: wrap;
        }
        
        .btn {
            padding: 0.8rem 1.5rem;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
        }
        
        .btn-primary {
            background-color: var(--primary-color);
            color: white;
        }
        
        .btn-primary:hover {
            background-color: #1e40af;
        }
        
        .btn-secondary {
            background-color: var(--secondary-color);
            color: white;
        }
        
        .btn-secondary:hover {
            background-color: #2563eb;
        }
        
        .btn-success {
            background-color: var(--accent-color);
            color: white;
        }
        
        .btn-success:hover {
            background-color: #0d9668;
        }
        
        .btn-warning {
            background-color: var(--warning-color);
            color: white;
        }
        
        .btn-warning:hover {
            background-color: #d97706;
        }
        
        .totals-panel {
            background: linear-gradient(135deg, #dbeafe, #e0f2fe);
            border-left: 5px solid var(--secondary-color);
            padding: 1.2rem;
            border-radius: 8px;
            margin-top: 1.5rem;
        }
        
        .total-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 0.8rem;
            font-size: 1.1rem;
        }
        
        .total-label {
            font-weight: 600;
            color: var(--primary-color);
        }
        
        .total-value {
            font-weight: 700;
            color: var(--dark-text);
        }
        
        .control-logic {
            background-color: #fef3c7;
            border-radius: 8px;
            padding: 1.2rem;
            margin-top: 1.5rem;
            border-left: 5px solid var(--warning-color);
        }
        
        .control-logic-title {
            font-weight: 700;
            color: #92400e;
            margin-bottom: 0.8rem;
        }
        
        .control-logic-text {
            font-size: 0.95rem;
            line-height: 1.7;
        }
        
        .status-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background-color: white;
            padding: 1rem 1.5rem;
            border-radius: 8px;
            margin-bottom: 1.5rem;
            box-shadow: var(--shadow);
        }
        
        .save-load-section {
            display: flex;
            gap: 1rem;
        }
        
        .file-input {
            display: none;
        }
        
        .file-label {
            padding: 0.6rem 1.2rem;
            background-color: #64748b;
            color: white;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.9rem;
            transition: background 0.2s;
        }
        
        .file-label:hover {
            background-color: #475569;
        }
        
        @media (max-width: 768px) {
            body {
                padding: 10px;
            }
            
            .container {
                grid-template-columns: 1fr;
            }
            
            .buttons-container {
                flex-direction: column;
            }
            
            .btn {
                width: 100%;
            }
            
            .status-bar {
                flex-direction: column;
                gap: 1rem;
                align-items: flex-start;
            }
            
            .save-load-section {
                width: 100%;
            }
        }
        
        .color-plc { background-color: #bfdbfe; color: #1e3a8a; }
        .color-psu { background-color: #bbf7d0; color: #065f46; }
        .color-contactor { background-color: #fde68a; color: #92400e; }
        .color-relay { background-color: #fbcfe8; color: #9d174d; }
        .color-breaker { background-color: #ddd6fe; color: #5b21b6; }
        .color-vfd { background-color: #fecaca; color: #991b1b; }
        .color-soft { background-color: #fed7aa; color: #9a3412; }
        .color-hmi { background-color: #a7f3d0; color: #064e3b; }
        .color-io { background-color: #c7d2fe; color: #3730a3; }
        .color-terminal { background-color: #fef3c7; color: #92400e; }
        .color-other { background-color: #e5e7eb; color: #4b5563; }
    </style>
</head>
<body x-data="plcDesigner()" x-init="init()">
    <header>
        <h1>Ø·Ø±Ø§Ø­ ØªØ§Ø¨Ù„Ùˆ PLC - Ø³ÛŒØ³ØªÙ… ØªÙ‡ÙˆÛŒÙ‡ ØªØ¨Ø®ÛŒØ±ÛŒ Ù†Ø³Ø§Ø¬ÛŒ</h1>
        <div class="subtitle">Ø·Ø±Ø§Ø­ÛŒØŒ Ù…Ø­Ø§Ø³Ø¨Ù‡ Ùˆ Ú†ÛŒØ¯Ù…Ø§Ù† Ù‚Ø·Ø¹Ø§Øª ØªØ§Ø¨Ù„Ùˆ Ú©Ù†ØªØ±Ù„ Ø¨Ø§ Ù‚Ø§Ø¨Ù„ÛŒØª Ø°Ø®ÛŒØ±Ù‡ Ùˆ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø·Ø±Ø­</div>
    </header>
    
    <div class="status-bar">
        <div>
            <strong>Ù¾Ø±ÙˆÚ˜Ù‡:</strong> Ø§ÛŒØ³ØªÚ¯Ø§Ù‡ ØªÙ‡ÙˆÛŒÙ‡ ØªØ¨Ø®ÛŒØ±ÛŒ Ù†Ø³Ø§Ø¬ÛŒ
        </div>
        <div class="save-load-section">
            <button class="btn btn-secondary" @click="saveProject()">
                <span>ğŸ’¾</span> Ø°Ø®ÛŒØ±Ù‡ Ø·Ø±Ø­
            </button>
            <label class="file-label">
                ğŸ“‚ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø·Ø±Ø­
                <input type="file" class="file-input" @change="loadProject($event)" accept=".json">
            </label>
            <button class="btn btn-warning" @click="exportToJSON()">
                <span>ğŸ“¥</span> Ø®Ø±ÙˆØ¬ÛŒ JSON
            </button>
        </div>
    </div>
    
    <div class="container">
        <!-- Ù¾Ù†Ù„ Ø³Ù…Øª Ú†Ù¾: Ø§Ù†ØªØ®Ø§Ø¨ Ù‚Ø·Ø¹Ø§Øª -->
        <div>
            <div class="panel">
                <h2 class="panel-title">Ø§Ù†ØªØ®Ø§Ø¨ Ù‚Ø·Ø¹Ø§Øª Ø³ÛŒØ³ØªÙ…</h2>
                
                <!-- Ù…ÙˆØªÙˆØ±Ù‡Ø§ÛŒ Ø³Ù‡ ÙØ§Ø² -->
                <div class="component-section">
                    <h3 style="color: var(--primary-color); margin-bottom: 0.8rem;">Ù…ÙˆØªÙˆØ±Ù‡Ø§ÛŒ Ø³Ù‡ ÙØ§Ø²</h3>
                    
                    <template x-for="(motor, index) in components.motors" :key="index">
                        <div class="component-item">
                            <div class="component-info">
                                <div class="component-name" x-text="motor.name"></div>
                                <div class="component-spec" x-text="`Ù‚Ø¯Ø±Øª: ${motor.defaultPower}, ØªØ¹Ø¯Ø§Ø¯ Ù¾ÛŒØ´â€ŒÙØ±Ø¶: ${motor.defaultCount}`"></div>
                                <div class="checkbox-container" x-show="motor.hasPositioner !== undefined">
                                    <input type="checkbox" :id="'pos-' + index" x-model="motor.hasPositioner">
                                    <label class="checkbox-label" :for="'pos-' + index" x-text="motor.positionerLabel"></label>
                                </div>
                            </div>
                            <div class="controls">
                                <input type="text" class="input-spec" placeholder="Ù‚Ø¯Ø±Øª (kW)" x-model="motor.power">
                                <div class="counter">
                                    <button class="counter-btn" @click="motor.count > 0 ? motor.count-- : 0">-</button>
                                    <div class="counter-value" x-text="motor.count"></div>
                                    <button class="counter-btn" @click="motor.count++">+</button>
                                </div>
                            </div>
                        </div>
                    </template>
                </div>
                
                <!-- Ø§Ú©Ú†ÙˆÛŒØªÙˆØ±Ù‡Ø§ -->
                <div class="component-section">
                    <h3 style="color: var(--primary-color); margin-bottom: 0.8rem;">Ø§Ú©Ú†ÙˆÛŒØªÙˆØ±Ù‡Ø§</h3>
                    
                    <template x-for="(actuator, index) in components.actuators" :key="index">
                        <div class="component-item">
                            <div class="component-info">
                                <div class="component-name" x-text="actuator.name"></div>
                                <div class="component-spec" x-text="`ÙˆÙ„ØªØ§Ú˜: ${actuator.voltage}, ØªØ¹Ø¯Ø§Ø¯ Ù¾ÛŒØ´â€ŒÙØ±Ø¶: ${actuator.defaultCount}`"></div>
                                <div class="checkbox-container" x-show="actuator.hasPositioner !== undefined">
                                    <input type="checkbox" :id="'act-pos-' + index" x-model="actuator.hasPositioner">
                                    <label class="checkbox-label" :for="'act-pos-' + index" x-text="actuator.positionerLabel"></label>
                                </div>
                                <div class="checkbox-container" x-show="actuator.hasInput !== undefined">
                                    <input type="checkbox" :id="'act-input-' + index" x-model="actuator.hasInput">
                                    <label class="checkbox-label" :for="'act-input-' + index">ÙˆØ±ÙˆØ¯ÛŒ Ø§Ø² Ø§Ú©Ú†ÙˆÛŒØªÙˆØ±</label>
                                </div>
                            </div>
                            <div class="controls">
                                <div class="counter">
                                    <button class="counter-btn" @click="actuator.count > 0 ? actuator.count-- : 0">-</button>
                                    <div class="counter-value" x-text="actuator.count"></div>
                                    <button class="counter-btn" @click="actuator.count++">+</button>
                                </div>
                            </div>
                        </div>
                    </template>
                </div>
                
                <!-- Ø³Ù†Ø³ÙˆØ±Ù‡Ø§ -->
                <div class="component-section">
                    <h3 style="color: var(--primary-color); margin-bottom: 0.8rem;">Ø³Ù†Ø³ÙˆØ±Ù‡Ø§</h3>
                    
                    <template x-for="(sensor, index) in components.sensors" :key="index">
                        <div class="component-item">
                            <div class="component-info">
                                <div class="component-name" x-text="sensor.name"></div>
                                <div class="component-spec" x-text="`Ù†ÙˆØ¹: ${sensor.type}, ØªØ¹Ø¯Ø§Ø¯ Ù¾ÛŒØ´â€ŒÙØ±Ø¶: ${sensor.defaultCount}`"></div>
                            </div>
                            <div class="controls">
                                <div class="counter">
                                    <button class="counter-btn" @click="sensor.count > 0 ? sensor.count-- : 0">-</button>
                                    <div class="counter-value" x-text="sensor.count"></div>
                                    <button class="counter-btn" @click="sensor.count++">+</button>
                                </div>
                            </div>
                        </div>
                    </template>
                </div>
                
                <!-- ØªØ¬Ù‡ÛŒØ²Ø§Øª Ø§Ø®ØªÛŒØ§Ø±ÛŒ -->
                <div class="component-section">
                    <h3 style="color: var(--primary-color); margin-bottom: 0.8rem;">ØªØ¬Ù‡ÛŒØ²Ø§Øª Ø§Ø®ØªÛŒØ§Ø±ÛŒ</h3>
                    
                    <template x-for="(optional, index) in components.optionals" :key="index">
                        <div class="component-item">
                            <div class="component-info">
                                <div class="component-name" x-text="optional.name"></div>
                                <div class="component-spec" x-text="`Ù…Ø´Ø®ØµØ§Øª: ${optional.spec}, ØªØ¹Ø¯Ø§Ø¯ Ù¾ÛŒØ´â€ŒÙØ±Ø¶: ${optional.defaultCount}`"></div>
                                <div class="checkbox-container" x-show="optional.hasThermalSensor !== undefined">
                                    <input type="checkbox" :id="'thermal-' + index" x-model="optional.hasThermalSensor">
                                    <label class="checkbox-label" :for="'thermal-' + index">Ø³Ù†Ø³ÙˆØ± ØªØ´Ø®ÛŒØµ Ø­Ø±Ø§Ø±Øª Ø¯Ø§Ø®Ù„ ØªØ§Ø¨Ù„Ùˆ</label>
                                </div>
                            </div>
                            <div class="controls">
                                <input type="text" class="input-spec" :placeholder="optional.inputPlaceholder" x-model="optional.value">
                                <div class="counter">
                                    <button class="counter-btn" @click="optional.count > 0 ? optional.count-- : 0">-</button>
                                    <div class="counter-value" x-text="optional.count"></div>
                                    <button class="counter-btn" @click="optional.count++">+</button>
                                </div>
                            </div>
                        </div>
                    </template>
                </div>
                
                <!-- Ø¯Ú©Ù…Ù‡â€ŒÙ‡Ø§ÛŒ Ú©Ù†ØªØ±Ù„ -->
                <div class="buttons-container">
                    <button class="btn btn-primary" @click="calculateBOM()">
                        <span>ğŸ§®</span> Ù…Ø­Ø§Ø³Ø¨Ù‡ Ù„ÛŒØ³Øª Ù‚Ø·Ø¹Ø§Øª
                    </button>
                    <button class="btn btn-secondary" @click="generateLayout()">
                        <span>ğŸ“</span> Ø§ÛŒØ¬Ø§Ø¯ Ú†ÛŒØ¯Ù…Ø§Ù†
                    </button>
                    <button class="btn btn-success" @click="generateTags()">
                        <span>ğŸ·ï¸</span> ØªÙˆÙ„ÛŒØ¯ ØªÚ¯â€ŒÙ‡Ø§
                    </button>
                    <button class="btn btn-warning" @click="resetToDefaults()">
                        <span>ğŸ”„</span> Ø¨Ø§Ø²Ù†Ø´Ø§Ù†ÛŒ Ø¨Ù‡ Ù¾ÛŒØ´â€ŒÙØ±Ø¶
                    </button>
                </div>
            </div>
            
            <!-- Ù…Ù†Ø·Ù‚ Ú©Ù†ØªØ±Ù„ÛŒ -->
            <div class="control-logic">
                <div class="control-logic-title">Ù…Ù†Ø·Ù‚ Ú©Ù†ØªØ±Ù„ Ø³ÛŒØ³ØªÙ… ØªÙ‡ÙˆÛŒÙ‡</div>
                <div class="control-logic-text">
                    Ù‡ÙˆØ§ÛŒ Ø¨Ø±Ú¯Ø´ØªÛŒ Ø§Ø² Ø³Ø§Ù„Ù† Ø¨Ø§ Ø¯Ù…Ø§ÛŒ RT Ùˆ Ø±Ø·ÙˆØ¨Øª RH Ø¯Ø±ÛŒØ§ÙØª Ù…ÛŒâ€ŒØ´ÙˆØ¯. Ù‡ÙˆØ§ÛŒ Ø®Ø±ÙˆØ¬ÛŒ Ø§Ø² Ø¯Ø§Ø®Ù„ Ø³Ø§Ù„Ù† Ø¨Ø§ Ø¯Ù…Ø§ÛŒ OT Ùˆ Ø±Ø·ÙˆØ¨Øª OH Ø®Ø§Ø±Ø¬ Ù…ÛŒâ€ŒØ´ÙˆØ¯. 
                    Ø¯Ù…Ø§ÛŒ Ù‡ÙˆØ§ÛŒ Ø³ÛŒÚ©Ù„ CT Ùˆ Ø±Ø·ÙˆØ¨Øª CH Ù…ÛŒâ€ŒØ¨Ø§Ø´Ø¯. Ø®ÙˆØ§Øµ Ù‡ÙˆØ§ÛŒ Ø³ÛŒÚ©Ù„ Ø¨Ø³ØªÚ¯ÛŒ Ø¨Ù‡ ÙˆØ¶Ø¹ÛŒØª Ø´ÛŒØ± Ø¨Ø®Ø§Ø± Ø¯Ø§Ø±Ø¯. 
                    Ø¯Ù…Ø§ÛŒ Ù‡ÙˆØ§ÛŒ ØªØ±Ú©ÛŒØ¨ÛŒ MT Ùˆ Ø±Ø·ÙˆØ¨Øª HT Ø§Ø² ØªØ±Ú©ÛŒØ¨ Ø¯Ø±ØµØ¯ÛŒ Ù‡ÙˆØ§ÛŒ Ø³ÛŒÚ©Ù„ Ø¨Ø§ Ù‡ÙˆØ§ÛŒ Ø¨ÛŒØ±ÙˆÙ† Ù…Ø­Ø§Ø³Ø¨Ù‡ Ù…ÛŒâ€ŒØ´ÙˆØ¯.
                    Ù‡ÙˆØ§ÛŒ ØªØºØ°ÛŒÙ‡ØŒ Ù‡ÙˆØ§ÛŒ ØªØ±Ú©ÛŒØ¨ÛŒ Ø§Ø³Øª Ú©Ù‡ Ø¯Ø± ØµÙˆØ±Øª Ù†ÛŒØ§Ø² Ø¨Ø§ Ø¢Ø¨ Ù…Ø±Ø·ÙˆØ¨ Ù…ÛŒâ€ŒØ´ÙˆØ¯. 
                    Ø¯Ø±ØµØ¯ Ù‡ÙˆØ§ÛŒ ØªØ§Ø²Ù‡ = Ø¯Ø±ØµØ¯ Ù‡ÙˆØ§ÛŒ Ø®Ø±ÙˆØ¬ÛŒ. Ø¯Ø±ØµØ¯ Ù‡ÙˆØ§ÛŒ Ø³ÛŒÚ©Ù„ = Û±Û°Û° - Ø¯Ø±ØµØ¯ Ù‡ÙˆØ§ÛŒ ØªØ§Ø²Ù‡.
                    Ú©Ù†ØªØ±Ù„ Ø¨Ø§ Ø­Ù„Ù‚Ù‡ Ø¨Ø³ØªÙ‡ Ùˆ ØªÙˆØ³Ø· Ø¯Ù…Ù¾Ø±Ù‡Ø§ØŒ Ø´ÛŒØ± Ø¨Ø®Ø§Ø± Ùˆ Ù¾Ù…Ù¾ Ø¢Ø¨ Ø§Ù†Ø¬Ø§Ù… Ù…ÛŒâ€ŒØ´ÙˆØ¯.
                </div>
            </div>
        </div>
        
        <!-- Ù¾Ù†Ù„ Ø³Ù…Øª Ø±Ø§Ø³Øª: Ù†ØªØ§ÛŒØ¬ -->
        <div>
            <!-- Ú†ÛŒØ¯Ù…Ø§Ù† ØªØ§Ø¨Ù„Ùˆ -->
            <div class="panel">
                <h2 class="panel-title">Ú†ÛŒØ¯Ù…Ø§Ù† ØªØ§Ø¨Ù„Ùˆ Ø¨Ø±Ù‚</h2>
                <div class="layout-container">
                    <div class="layout-grid" id="layoutGrid">
                        <!-- Ú†ÛŒØ¯Ù…Ø§Ù† Ø¨Ù‡ ØµÙˆØ±Øª Ø¯Ø§ÛŒÙ†Ø§Ù…ÛŒÚ© Ø§ÛŒØ¬Ø§Ø¯ Ù…ÛŒâ€ŒØ´ÙˆØ¯ -->
                        <template x-for="(item, index) in layoutItems" :key="index">
                            <div 
                                class="component-box" 
                                :class="'color-' + item.type"
                                :style="`grid-column: span ${item.cols}; grid-row: span ${item.rows};`"
                                :data-tooltip="item.tooltip"
                                x-text="item.label"
                            ></div>
                        </template>
                    </div>
                </div>
            </div>
            
            <!-- Ù„ÛŒØ³Øª Ù‚Ø·Ø¹Ø§Øª (BOM) -->
            <div class="panel">
                <h2 class="panel-title">Ù„ÛŒØ³Øª Ù‚Ø·Ø¹Ø§Øª (BOM)</h2>
                <table class="bom-table">
                    <thead>
                        <tr>
                            <th>Ø±Ø¯ÛŒÙ</th>
                            <th>Ù†Ø§Ù… Ù‚Ø·Ø¹Ù‡</th>
                            <th>Ù…Ø´Ø®ØµØ§Øª ÙÙ†ÛŒ</th>
                            <th>ØªØ¹Ø¯Ø§Ø¯</th>
                            <th>ÙˆØ§Ø­Ø¯</th>
                            <th>ÛŒØ§Ø¯Ø¯Ø§Ø´Øª</th>
                        </tr>
                    </thead>
                    <tbody>
                        <template x-for="(item, index) in bomList" :key="index">
                            <tr>
                                <td x-text="index + 1"></td>
                                <td x-text="item.name"></td>
                                <td x-text="item.spec"></td>
                                <td x-text="item.qty"></td>
                                <td x-text="item.unit"></td>
                                <td x-text="item.note"></td>
                            </tr>
                        </template>
                    </tbody>
                </table>
                
                <div class="totals-panel">
                    <div class="total-item">
                        <span class="total-label">ØªØ¹Ø¯Ø§Ø¯ Ú©Ù„ Ù‚Ø·Ø¹Ø§Øª:</span>
                        <span class="total-value" x-text="totalComponents"></span>
                    </div>
                    <div class="total-item">
                        <span class="total-label">ØªØ¹Ø¯Ø§Ø¯ Ø±Ù„Ù‡â€ŒÙ‡Ø§ÛŒ Ù…ÙˆØ±Ø¯ Ù†ÛŒØ§Ø²:</span>
                        <span class="total-value" x-text="totalRelays"></span>
                    </div>
                    <div class="total-item">
                        <span class="total-label">ØªØ¹Ø¯Ø§Ø¯ Ú©Ù†ØªØ§Ú©ØªÙˆØ±Ù‡Ø§:</span>
                        <span class="total-value" x-text="totalContactors"></span>
                    </div>
                    <div class="total-item">
                        <span class="total-label">ÙØ¶Ø§ÛŒ Ø§Ø´ØºØ§Ù„ÛŒ Ø¯Ø± ØªØ§Ø¨Ù„Ùˆ:</span>
                        <span class="total-value" x-text="`${totalSpace} ÙˆØ§Ø­Ø¯ Ú¯Ø±ÛŒØ¯`"></span>
                    </div>
                </div>
            </div>
            
            <!-- Ø¬Ø¯ÙˆÙ„ ØªÚ¯â€ŒÙ‡Ø§ -->
            <div class="panel" x-show="tagsList.length > 0">
                <h2 class="panel-title">ØªÚ¯â€ŒÙ‡Ø§ÛŒ Ø§ØªØµØ§Ù„Ø§Øª</h2>
                <table class="tag-table">
                    <thead>
                        <tr>
                            <th>ØªÚ¯</th>
                            <th>ØªÙˆØ¶ÛŒØ­Ø§Øª</th>
                            <th>Ù†ÙˆØ¹</th>
                            <th>Ø§ØªØµØ§Ù„ Ø¨Ù‡</th>
                        </tr>
                    </thead>
                    <tbody>
                        <template x-for="(tag, index) in tagsList" :key="index">
                            <tr>
                                <td x-text="tag.id"></td>
                                <td x-text="tag.description"></td>
                                <td x-text="tag.type"></td>
                                <td x-text="tag.connection"></td>
                            </tr>
                        </template>
                    </tbody>
                </table>
            </div>
        </div>
    </div>
    
    <script>
        function plcDesigner() {
            return {
                // Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ Ø§ØµÙ„ÛŒ Ø¨Ø±Ù†Ø§Ù…Ù‡
                components: {
                    motors: [
                        { id: 1, name: 'ÙÙ† Ø±ÙØª (Fan feed)', defaultCount: 2, count: 2, defaultPower: '22kW', power: '22', over5kw: true },
                        { id: 2, name: 'ÙÙ† Ø¨Ø±Ú¯Ø´Øª (Fan return)', defaultCount: 2, count: 2, defaultPower: '30kW', power: '30', over5kw: true },
                        { id: 3, name: 'ÙÙ† Ú¯Ø±Ø¯ Ùˆ ØºØ¨Ø§Ø± (Dust Fan)', defaultCount: 4, count: 4, defaultPower: '3.3kW', power: '3.3', over5kw: false },
                        { id: 4, name: 'Ù…ÙˆØªÙˆØ± Ø±ÙˆØªØ§Ø±ÛŒ (Rotary motor)', defaultCount: 2, count: 2, defaultPower: '1kW', power: '1', over5kw: false },
                        { id: 5, name: 'Ù…ÙˆØªÙˆØ± Ù…Ú©Ø§Ù†ÛŒØ²Ù… (Mechanism motor)', defaultCount: 2, count: 2, defaultPower: '0.25kW', power: '0.25', over5kw: false },
                        { id: 6, name: 'Ù¾Ù…Ù¾ Ø¢Ø¨ (Pump water motor)', defaultCount: 1, count: 1, defaultPower: '30kW', power: '30', over5kw: true }
                    ],
                    actuators: [
                        { id: 1, name: 'Ø¯Ù…Ù¾Ø± Ù‡ÙˆØ§ÛŒ ØªØ§Ø²Ù‡ (Damper fresh)', defaultCount: 2, count: 2, voltage: '24V', hasPositioner: true, positionerLabel: 'Ù¾ÙˆØ²ÛŒØ´Ù†Ø± Ø¯Ø§Ø±Ø¯', hasInput: true },
                        { id: 2, name: 'Ø¯Ù…Ù¾Ø± Ù‡ÙˆØ§ÛŒ Ø®Ø±ÙˆØ¬ÛŒ (Damper exhaust)', defaultCount: 2, count: 2, voltage: '24VDC', hasPositioner: true, positionerLabel: 'Ù¾ÙˆØ²ÛŒØ´Ù†Ø± Ø¯Ø§Ø±Ø¯', hasInput: false },
                        { id: 3, name: 'Ø¯Ù…Ù¾Ø± Ù‡ÙˆØ§ÛŒ Ø¨Ø±Ú¯Ø´ØªÛŒ (Damper return)', defaultCount: 2, count: 2, voltage: '24VDC', hasPositioner: true, positionerLabel: 'Ù¾ÙˆØ²ÛŒØ´Ù†Ø± Ø¯Ø§Ø±Ø¯', hasInput: true },
                        { id: 4, name: 'Ø´ÛŒØ± Ø¨Ø®Ø§Ø± (Steam valve)', defaultCount: 1, count: 1, voltage: '24VDC', hasPositioner: false, positionerLabel: 'Ú©Ù†ØªØ±Ù„ Ù…ÙˆÙ‚Ø¹ÛŒØª', hasInput: false }
                    ],
                    sensors: [
                        { id: 1, name: 'Ø¯Ù…Ø§Ø³Ù†Ø¬ (Temperature)', defaultCount: 2, count: 2, type: 'Ø¢Ù†Ø§Ù„ÙˆÚ¯ 4-20 mA' },
                        { id: 2, name: 'Ø±Ø·ÙˆØ¨Øªâ€ŒØ³Ù†Ø¬ (Humidity)', defaultCount: 2, count: 2, type: 'Ø¢Ù†Ø§Ù„ÙˆÚ¯ 4-20 mA' },
                        { id: 3, name: 'Ù…ÛŒÚ©Ø±ÙˆØ³ÙˆÛŒÛŒÚ† (Micro switch)', defaultCount: 5, count: 5, type: 'ON-OFF' }
                    ],
                    optionals: [
                        { id: 1, name: 'Ø§ÛŒÙ†ÙˆØ±ØªØ± (VFD)', defaultCount: 0, count: 0, spec: '30kW', value: '30', inputPlaceholder: 'ØªÙˆØ§Ù† (kW)', hasThermalSensor: false },
                        { id: 2, name: 'Ø³Ø§ÙØª Ø§Ø³ØªØ§Ø±ØªØ± (Soft starter)', defaultCount: 1, count: 1, spec: '30kW', value: '30', inputPlaceholder: 'ØªÙˆØ§Ù† (kW)', hasThermalSensor: false },
                        { id: 3, name: 'Ù¾Ù†Ù„ HMI', defaultCount: 1, count: 1, spec: '7 Ø§ÛŒÙ†Ú†', value: '7', inputPlaceholder: 'Ø§Ù†Ø¯Ø§Ø²Ù‡ (Ø§ÛŒÙ†Ú†)', hasThermalSensor: undefined },
                        { id: 4, name: 'Ø³Ù†Ø³ÙˆØ± ØªØ´Ø®ÛŒØµ Ø­Ø±Ø§Ø±Øª', defaultCount: 0, count: 0, spec: '--', value: '', inputPlaceholder: 'ØªØ¹Ø¯Ø§Ø¯', hasThermalSensor: undefined }
                    ]
                },
                
                // Ù„ÛŒØ³Øª Ù‚Ø·Ø¹Ø§Øª Ù…Ø­Ø§Ø³Ø¨Ù‡ Ø´Ø¯Ù‡
                bomList: [],
                
                // Ø¢ÛŒØªÙ…â€ŒÙ‡Ø§ÛŒ Ú†ÛŒØ¯Ù…Ø§Ù†
                layoutItems: [],
                
                // Ù„ÛŒØ³Øª ØªÚ¯â€ŒÙ‡Ø§
                tagsList: [],
                
                // Ù…Ø¬Ù…ÙˆØ¹â€ŒÙ‡Ø§ÛŒ Ù…Ø­Ø§Ø³Ø¨Ø§ØªÛŒ
                totalComponents: 0,
                totalRelays: 0,
                totalContactors: 0,
                totalSpace: 0,
                
                // ØªØ§Ø¨Ø¹ Ø§ÙˆÙ„ÛŒÙ‡â€ŒØ³Ø§Ø²ÛŒ
                init() {
                    this.calculateBOM();
                    this.generateLayout();
                    this.generateTags();
                },
                
                // Ù…Ø­Ø§Ø³Ø¨Ù‡ Ù„ÛŒØ³Øª Ù‚Ø·Ø¹Ø§Øª
                calculateBOM() {
                    const bom = [];
                    
                    // 1. Ù…ÙˆØªÙˆØ±Ù‡Ø§
                    this.components.motors.forEach(motor => {
                        if (motor.count > 0) {
                            bom.push({
                                name: motor.name,
                                spec: `Ù…ÙˆØªÙˆØ± Ø³Ù‡ ÙØ§Ø² ${motor.power}kW`,
                                qty: motor.count,
                                unit: 'Ø¹Ø¯Ø¯',
                                note: motor.over5kw ? 'Ù†ÛŒØ§Ø² Ø¨Ù‡ Ø³Ø§ÙØª Ø§Ø³ØªØ§Ø±ØªØ± Ø¯Ø§Ø±Ø¯' : ''
                            });
                            
                            // Ø§Ú¯Ø± Ù…ÙˆØªÙˆØ± Ø¨Ø§Ù„Ø§ÛŒ 5kW Ø¨Ø§Ø´Ø¯ØŒ Ú©Ù†ØªØ§Ú©ØªÙˆØ± Ù†ÛŒØ§Ø² Ø¯Ø§Ø±Ø¯
                            if (motor.over5kw && parseFloat(motor.power) > 5) {
                                bom.push({
                                    name: 'Ú©Ù†ØªØ§Ú©ØªÙˆØ± Ù…ÙˆØªÙˆØ±',
                                    spec: `Ø¨Ø±Ø§ÛŒ Ù…ÙˆØªÙˆØ± ${motor.power}kW`,
                                    qty: motor.count,
                                    unit: 'Ø¹Ø¯Ø¯',
                                    note: 'Ø¨Ø±Ø§ÛŒ Ù…ÙˆØªÙˆØ±Ù‡Ø§ÛŒ Ø¨Ø§Ù„Ø§ 5kW'
                                });
                            }
                        }
                    });
                    
                    // 2. Ø§Ú©Ú†ÙˆÛŒØªÙˆØ±Ù‡Ø§
                    this.components.actuators.forEach(actuator => {
                        if (actuator.count > 0) {
                            bom.push({
                                name: actuator.name,
                                spec: `Ø§Ú©Ú†ÙˆÛŒØªÙˆØ± ${actuator.voltage}`,
                                qty: actuator.count,
                                unit: 'Ø¹Ø¯Ø¯',
                                note: actuator.hasPositioner ? 'Ø¨Ø§ Ù¾ÙˆØ²ÛŒØ´Ù†Ø±' : 'Ø¨Ø¯ÙˆÙ† Ù¾ÙˆØ²ÛŒØ´Ù†Ø±'
                            });
                            
                            // Ø±Ù„Ù‡ Ø¨Ø±Ø§ÛŒ Ù‡Ø± Ø§Ú©Ú†ÙˆÛŒØªÙˆØ±
                            bom.push({
                                name: 'Ø±Ù„Ù‡ Ú©Ù†ØªØ±Ù„ Ø§Ú©Ú†ÙˆÛŒØªÙˆØ±',
                                spec: `Ø±Ù„Ù‡ ${actuator.voltage}`,
                                qty: actuator.count,
                                unit: 'Ø¹Ø¯Ø¯',
                                note: ''
                            });
                            
                            // Ø§Ú¯Ø± ÙˆØ±ÙˆØ¯ÛŒ Ø§Ø² Ø§Ú©Ú†ÙˆÛŒØªÙˆØ± Ø¨Ø§Ø´Ø¯
                            if (actuator.hasInput) {
                                bom.push({
                                    name: 'Ù…Ø§Ú˜ÙˆÙ„ ÙˆØ±ÙˆØ¯ÛŒ Ø¯ÛŒØ¬ÛŒØªØ§Ù„',
                                    spec: 'Ø¨Ø±Ø§ÛŒ Ø®ÙˆØ§Ù†Ø¯Ù† ÙˆØ¶Ø¹ÛŒØª Ø§Ú©Ú†ÙˆÛŒØªÙˆØ±',
                                    qty: Math.ceil(actuator.count / 8), // Ù‡Ø± Ù…Ø§Ú˜ÙˆÙ„ 8 Ú©Ø§Ù†Ø§Ù„Ù‡
                                    unit: 'Ø¹Ø¯Ø¯',
                                    note: ''
                                });
                            }
                        }
                    });
                    
                    // 3. Ø³Ù†Ø³ÙˆØ±Ù‡Ø§
                    this.components.sensors.forEach(sensor => {
                        if (sensor.count > 0) {
                            bom.push({
                                name: sensor.name,
                                spec: `Ø³Ù†Ø³ÙˆØ± ${sensor.type}`,
                                qty: sensor.count,
                                unit: 'Ø¹Ø¯Ø¯',
                                note: ''
                            });
                            
                            // Ù…Ø§Ú˜ÙˆÙ„ ÙˆØ±ÙˆØ¯ÛŒ Ù…Ù†Ø§Ø³Ø¨
                            if (sensor.type.includes('Ø¢Ù†Ø§Ù„ÙˆÚ¯')) {
                                bom.push({
                                    name: 'Ù…Ø§Ú˜ÙˆÙ„ ÙˆØ±ÙˆØ¯ÛŒ Ø¢Ù†Ø§Ù„ÙˆÚ¯',
                                    spec: '4-20 mA',
                                    qty: Math.ceil(sensor.count / 4), // Ù‡Ø± Ù…Ø§Ú˜ÙˆÙ„ 4 Ú©Ø§Ù†Ø§Ù„Ù‡
                                    unit: 'Ø¹Ø¯Ø¯',
                                    note: ''
                                });
                            } else {
                                bom.push({
                                    name: 'Ù…Ø§Ú˜ÙˆÙ„ ÙˆØ±ÙˆØ¯ÛŒ Ø¯ÛŒØ¬ÛŒØªØ§Ù„',
                                    spec: '24VDC',
                                    qty: Math.ceil(sensor.count / 8), // Ù‡Ø± Ù…Ø§Ú˜ÙˆÙ„ 8 Ú©Ø§Ù†Ø§Ù„Ù‡
                                    unit: 'Ø¹Ø¯Ø¯',
                                    note: ''
                                });
                            }
                        }
                    });
                    
                    // 4. ØªØ¬Ù‡ÛŒØ²Ø§Øª Ø§Ø®ØªÛŒØ§Ø±ÛŒ
                    this.components.optionals.forEach(optional => {
                        if (optional.count > 0) {
                            bom.push({
                                name: optional.name,
                                spec: optional.value ? `${optional.spec} (${optional.value})` : optional.spec,
                                qty: optional.count,
                                unit: 'Ø¹Ø¯Ø¯',
                                note: ''
                            });
                            
                            // Ø§Ú¯Ø± Ø§ÛŒÙ†ÙˆØ±ØªØ± ÛŒØ§ Ø³Ø§ÙØª Ø§Ø³ØªØ§Ø±ØªØ± ÙˆØ¬ÙˆØ¯ Ø¯Ø§Ø±Ø¯
                            if ((optional.id === 1 || optional.id === 2) && optional.count > 0) {
                                // ØªØ¹Ø¯Ø§Ø¯ Ú©Ù†ØªØ§Ú©ØªÙˆØ±Ù‡Ø§ Ø¨Ø±Ø§ÛŒ Ù…ÙˆØªÙˆØ±Ù‡Ø§ÛŒ Ø¨Ø§Ù„Ø§ÛŒ 5kW Ø¯ÙˆØ¨Ø±Ø§Ø¨Ø± Ù…ÛŒâ€ŒØ´ÙˆØ¯
                                const highPowerMotors = this.components.motors.filter(m => m.over5kw && parseFloat(m.power) > 5);
                                highPowerMotors.forEach(motor => {
                                    bom.push({
                                        name: 'Ú©Ù†ØªØ§Ú©ØªÙˆØ± Ø§Ø¶Ø§ÙÛŒ Ø¨Ø±Ø§ÛŒ Ú©Ù†ØªØ±Ù„ Ø³Ø±Ø¹Øª',
                                        spec: `Ø¨Ø±Ø§ÛŒ Ù…ÙˆØªÙˆØ± ${motor.power}kW`,
                                        qty: motor.count,
                                        unit: 'Ø¹Ø¯Ø¯',
                                        note: 'Ø¨Ù‡ Ø¯Ù„ÛŒÙ„ ÙˆØ¬ÙˆØ¯ Ú©Ù†ØªØ±Ù„ Ø³Ø±Ø¹Øª'
                                    });
                                });
                                
                                // Ø§Ú¯Ø± Ø³Ù†Ø³ÙˆØ± Ø­Ø±Ø§Ø±Øª ÙØ¹Ø§Ù„ Ø¨Ø§Ø´Ø¯
                                if (optional.hasThermalSensor) {
                                    bom.push({
                                        name: 'Ø³Ù†Ø³ÙˆØ± ØªØ´Ø®ÛŒØµ Ø­Ø±Ø§Ø±Øª Ø¯Ø§Ø®Ù„ ØªØ§Ø¨Ù„Ùˆ',
                                        spec: 'ØªØ±Ù…ÙˆØ³ØªØ§Øª',
                                        qty: 1,
                                        unit: 'Ø¹Ø¯Ø¯',
                                        note: ''
                                    });
                                }
                            }
                            
                            // Ø§Ú¯Ø± HMI ÙˆØ¬ÙˆØ¯ Ø¯Ø§Ø±Ø¯
                            if (optional.id === 3 && optional.count > 0) {
                                bom.push({
                                    name: 'Ú©Ø§Ø¨Ù„ Ø§Ø±ØªØ¨Ø§Ø·ÛŒ HMI',
                                    spec: 'Ethernet ÛŒØ§ PROFINET',
                                    qty: 1,
                                    unit: 'Ø¹Ø¯Ø¯',
                                    note: ''
                                });
                            }
                        }
                    });
                    
                    // 5. Ù‚Ø·Ø¹Ø§Øª Ø«Ø§Ø¨Øª Ø³ÛŒØ³ØªÙ…
                    bom.push({ name: 'PLC Ù…Ø±Ú©Ø²ÛŒ', spec: 'CPU Ø¨Ø§ Ø­Ø¯Ø§Ù‚Ù„ 20 Ø¯ÛŒØ¬ÛŒØªØ§Ù„ ÙˆØ±ÙˆØ¯ÛŒ/Ø®Ø±ÙˆØ¬ÛŒ', qty: 1, unit: 'Ø¹Ø¯Ø¯', note: '' });
                    bom.push({ name: 'Ù…Ù†Ø¨Ø¹ ØªØºØ°ÛŒÙ‡ 24VDC', spec: '10A', qty: 1, unit: 'Ø¹Ø¯Ø¯', note: 'Ø¨Ø±Ø§ÛŒ Ø³Ù†Ø³ÙˆØ±Ù‡Ø§ Ùˆ Ø§Ú©Ú†ÙˆÛŒØªÙˆØ±Ù‡Ø§' });
                    bom.push({ name: 'Ø¨Ø±ÛŒÚ©Ø± Ø§ØµÙ„ÛŒ Ø³Ù‡ ÙØ§Ø²', spec: '63A', qty: 1, unit: 'Ø¹Ø¯Ø¯', note: '' });
                    bom.push({ name: 'Ø¨Ø±ÛŒÚ©Ø± ØªÚ© ÙØ§Ø²', spec: '10A', qty: 3, unit: 'Ø¹Ø¯Ø¯', note: 'Ø¨Ø±Ø§ÛŒ ØªØºØ°ÛŒÙ‡ Ù…Ø¯Ø§Ø± Ú©Ù†ØªØ±Ù„' });
                    bom.push({ name: 'ØªØ±Ù…ÛŒÙ†Ø§Ù„ Ø¨Ø±Ù‚', spec: 'Ø¨Ø±Ø§ÛŒ Ø§ØªØµØ§Ù„Ø§Øª Ù‚Ø¯Ø±Øª', qty: 20, unit: 'Ø¹Ø¯Ø¯', note: '' });
                    bom.push({ name: 'ØªØ±Ù…ÛŒÙ†Ø§Ù„ Ø³ÛŒÚ¯Ù†Ø§Ù„', spec: 'Ø¨Ø±Ø§ÛŒ Ø§ØªØµØ§Ù„Ø§Øª Ø³ÛŒÚ¯Ù†Ø§Ù„', qty: 30, unit: 'Ø¹Ø¯Ø¯', note: '' });
                    bom.push({ name: 'Ø´ÛŒÙ†Ù‡ Ø§Ø±Øª', spec: 'Ù…Ø³ÛŒ', qty: 1, unit: 'Ù…ØªØ±', note: '' });
                    bom.push({ name: 'Ø´ÛŒÙ†Ù‡ Ù†ÙˆÙ„', spec: 'Ù…Ø³ÛŒ', qty: 1, unit: 'Ù…ØªØ±', note: '' });
                    bom.push({ name: 'Ú©Ø§Ø¨Ù„ Ú©Ù†ØªØ±Ù„', spec: '0.75mmÂ²', qty: 50, unit: 'Ù…ØªØ±', note: '' });
                    bom.push({ name: 'Ú©Ø§Ø¨Ù„ Ù‚Ø¯Ø±Øª', spec: '4mmÂ²', qty: 30, unit: 'Ù…ØªØ±', note: '' });
                    bom.push({ name: 'ÙÛŒÙˆØ² Ø­ÙØ§Ø¸ØªÛŒ', spec: 'Ø¨Ø±Ø§ÛŒ Ù…Ø¯Ø§Ø±Ø§Øª Ú©Ù†ØªØ±Ù„', qty: 5, unit: 'Ø¹Ø¯Ø¯', note: '' });
                    bom.push({ name: 'Ú†Ø±Ø§Øº Ø³ÛŒÚ¯Ù†Ø§Ù„', spec: 'Ø³Ù‡ Ø±Ù†Ú¯ (Ù‚Ø±Ù…Ø²ØŒ Ø²Ø±Ø¯ØŒ Ø³Ø¨Ø²)', qty: 3, unit: 'Ø¹Ø¯Ø¯', note: '' });
                    bom.push({ name: 'Ú©Ù„ÛŒØ¯ Ø§Ø³ØªØ§Ù¾', spec: 'Ù‚Ø±Ù…Ø²', qty: 1, unit: 'Ø¹Ø¯Ø¯', note: '' });
                    bom.push({ name: 'Ú©Ù„ÛŒØ¯ Ø§Ø³ØªØ§Ø±Øª', spec: 'Ø³Ø¨Ø²', qty: 1, unit: 'Ø¹Ø¯Ø¯', note: '' });
                    bom.push({ name: 'Ú©Ù„ÛŒØ¯ Ø³Ù„Ú©ØªÙˆØ±', spec: 'Auto/Manual', qty: 1, unit: 'Ø¹Ø¯Ø¯', note: '' });
                    bom.push({ name: 'ØªØ§Ø¨Ù„Ùˆ Ø¨Ø±Ù‚', spec: 'IP54, 1000x800x300mm', qty: 1, unit: 'Ø¹Ø¯Ø¯', note: '' });
                    
                    this.bomList = bom;
                    
                    // Ù…Ø­Ø§Ø³Ø¨Ù‡ Ù…Ø¬Ù…ÙˆØ¹â€ŒÙ‡Ø§
                    this.totalComponents = bom.reduce((sum, item) => sum + item.qty, 0);
                    this.totalRelays = bom.filter(item => item.name.includes('Ø±Ù„Ù‡')).reduce((sum, item) => sum + item.qty, 0);
                    this.totalContactors = bom.filter(item => item.name.includes('Ú©Ù†ØªØ§Ú©ØªÙˆØ±')).reduce((sum, item) => sum + item.qty, 0);
                },
                
                // Ø§ÛŒØ¬Ø§Ø¯ Ú†ÛŒØ¯Ù…Ø§Ù† ØªØ§Ø¨Ù„Ùˆ
                generateLayout() {
                    const layout = [];
                    let row = 1, col = 1;
                    
                    // PLC
                    layout.push({
                        type: 'plc',
                        label: 'PLC',
                        cols: 4,
                        rows: 3,
                        tooltip: 'PLC Ù…Ø±Ú©Ø²ÛŒ Ø¨Ø§ Ù…Ø§Ú˜ÙˆÙ„â€ŒÙ‡Ø§ÛŒ ÙˆØ±ÙˆØ¯ÛŒ/Ø®Ø±ÙˆØ¬ÛŒ'
                    });
                    col += 4;
                    
                    // Ù…Ù†Ø¨Ø¹ ØªØºØ°ÛŒÙ‡
                    layout.push({
                        type: 'psu',
                        label: 'PSU 24V',
                        cols: 3,
                        rows: 2,
                        tooltip: 'Ù…Ù†Ø¨Ø¹ ØªØºØ°ÛŒÙ‡ 24VDC, 10A'
                    });
                    col += 3;
                    
                    // HMI Ø§Ú¯Ø± ÙˆØ¬ÙˆØ¯ Ø¯Ø§Ø±Ø¯
                    const hmi = this.components.optionals.find(o => o.id === 3);
                    if (hmi && hmi.count > 0) {
                        layout.push({
                            type: 'hmi',
                            label: 'HMI',
                            cols: 4,
                            rows: 2,
                            tooltip: `Ù¾Ù†Ù„ Ø§Ù¾Ø±Ø§ØªÙˆØ± ${hmi.value} Ø§ÛŒÙ†Ú†`
                        });
                        col += 4;
                    }
                    
                    // Ø±ÙØªÙ† Ø¨Ù‡ Ø±Ø¯ÛŒÙ Ø¨Ø¹Ø¯ÛŒ
                    row += 3;
                    col = 1;
                    
                    // Ø±Ù„Ù‡â€ŒÙ‡Ø§
                    const relayCount = this.totalRelays;
                    const relaysPerRow = 10;
                    const relayRows = Math.ceil(relayCount / relaysPerRow);
                    
                    for (let i = 0; i < relayCount; i++) {
                        if (col > relaysPerRow) {
                            col = 1;
                            row++;
                        }
                        
                        layout.push({
                            type: 'relay',
                            label: `RL${i+1}`,
                            cols: 1,
                            rows: 1,
                            tooltip: 'Ø±Ù„Ù‡ Ú©Ù†ØªØ±Ù„ 24VDC'
                        });
                        col++;
                    }
                    
                    // Ø±ÙØªÙ† Ø¨Ù‡ Ø±Ø¯ÛŒÙ Ø¨Ø¹Ø¯ÛŒ
                    row += relayRows;
                    col = 1;
                    
                    // Ú©Ù†ØªØ§Ú©ØªÙˆØ±Ù‡Ø§
                    const contactorCount = this.totalContactors;
                    for (let i = 0; i < contactorCount; i++) {
                        if (col > 6) {
                            col = 1;
                            row++;
                        }
                        
                        layout.push({
                            type: 'contactor',
                            label: `KM${i+1}`,
                            cols: 2,
                            rows: 2,
                            tooltip: 'Ú©Ù†ØªØ§Ú©ØªÙˆØ± Ù…ÙˆØªÙˆØ±'
                        });
                        col += 2;
                    }
                    
                    // Ø±ÙØªÙ† Ø¨Ù‡ Ø±Ø¯ÛŒÙ Ø¨Ø¹Ø¯ÛŒ
                    row += Math.ceil(contactorCount / 3) * 2;
                    col = 1;
                    
                    // Ø§ÛŒÙ†ÙˆØ±ØªØ± Ø§Ú¯Ø± ÙˆØ¬ÙˆØ¯ Ø¯Ø§Ø±Ø¯
                    const vfd = this.components.optionals.find(o => o.id === 1);
                    if (vfd && vfd.count > 0) {
                        layout.push({
                            type: 'vfd',
                            label: `VFD ${vfd.value}kW`,
                            cols: 5,
                            rows: 4,
                            tooltip: `Ø§ÛŒÙ†ÙˆØ±ØªØ± ${vfd.value} Ú©ÛŒÙ„ÙˆÙˆØ§Øª`
                        });
                        col += 5;
                    }
                    
                    // Ø³Ø§ÙØª Ø§Ø³ØªØ§Ø±ØªØ± Ø§Ú¯Ø± ÙˆØ¬ÙˆØ¯ Ø¯Ø§Ø±Ø¯
                    const softStarter = this.components.optionals.find(o => o.id === 2);
                    if (softStarter && softStarter.count > 0) {
                        layout.push({
                            type: 'soft',
                            label: `Soft ${softStarter.value}kW`,
                            cols: 5,
                            rows: 2,
                            tooltip: `Ø³Ø§ÙØª Ø§Ø³ØªØ§Ø±ØªØ± ${softStarter.value} Ú©ÛŒÙ„ÙˆÙˆØ§Øª`
                        });
                        col += 5;
                    }
                    
                    // Ø¨Ø±ÛŒÚ©Ø± Ø§ØµÙ„ÛŒ
                    layout.push({
                        type: 'breaker',
                        label: 'Main CB',
                        cols: 3,
                        rows: 2,
                        tooltip: 'Ø¨Ø±ÛŒÚ©Ø± Ø§ØµÙ„ÛŒ Ø³Ù‡ ÙØ§Ø² 63A'
                    });
                    col += 3;
                    
                    // ØªØ±Ù…ÛŒÙ†Ø§Ù„â€ŒÙ‡Ø§
                    layout.push({
                        type: 'terminal',
                        label: 'Terminals',
                        cols: 4,
                        rows: 3,
                        tooltip: 'ØªØ±Ù…ÛŒÙ†Ø§Ù„â€ŒÙ‡Ø§ÛŒ Ù‚Ø¯Ø±Øª Ùˆ Ø³ÛŒÚ¯Ù†Ø§Ù„'
                    });
                    
                    this.layoutItems = layout;
                    this.totalSpace = layout.reduce((sum, item) => sum + (item.cols * item.rows), 0);
                },
                
                // ØªÙˆÙ„ÛŒØ¯ ØªÚ¯â€ŒÙ‡Ø§ÛŒ Ø§ØªØµØ§Ù„Ø§Øª
                generateTags() {
                    const tags = [];
                    let tagId = 1;
                    
                    // ØªÚ¯â€ŒÙ‡Ø§ÛŒ Ù…ÙˆØªÙˆØ±Ù‡Ø§
                    this.components.motors.forEach(motor => {
                        for (let i = 0; i < motor.count; i++) {
                            tags.push({
                                id: `M${motor.id}.${i+1}`,
                                description: `${motor.name} - ÙˆØ§Ø­Ø¯ ${i+1}`,
                                type: 'Power',
                                connection: `KM${tagId} -> Ù…ÙˆØªÙˆØ±`
                            });
                            tagId++;
                        }
                    });
                    
                    // ØªÚ¯â€ŒÙ‡Ø§ÛŒ Ø§Ú©Ú†ÙˆÛŒØªÙˆØ±Ù‡Ø§
                    this.components.actuators.forEach(actuator => {
                        for (let i = 0; i < actuator.count; i++) {
                            tags.push({
                                id: `A${actuator.id}.${i+1}`,
                                description: `${actuator.name} - ÙˆØ§Ø­Ø¯ ${i+1}`,
                                type: actuator.hasPositioner ? 'Analog Output' : 'Digital Output',
                                connection: `Q${tagId} -> Ø§Ú©Ú†ÙˆÛŒØªÙˆØ±`
                            });
                            tagId++;
                        }
                    });
                    
                    // ØªÚ¯â€ŒÙ‡Ø§ÛŒ Ø³Ù†Ø³ÙˆØ±Ù‡Ø§
                    this.components.sensors.forEach(sensor => {
                        for (let i = 0; i < sensor.count; i++) {
                            tags.push({
                                id: `S${sensor.id}.${i+1}`,
                                description: `${sensor.name} - ÙˆØ§Ø­Ø¯ ${i+1}`,
                                type: sensor.type.includes('Ø¢Ù†Ø§Ù„ÙˆÚ¯') ? 'Analog Input' : 'Digital Input',
                                connection: `I${tagId} -> Ø³Ù†Ø³ÙˆØ±`
                            });
                            tagId++;
                        }
                    });
                    
                    this.tagsList = tags;
                },
                
                // Ø°Ø®ÛŒØ±Ù‡ Ù¾Ø±ÙˆÚ˜Ù‡ Ø¯Ø± localStorage
                saveProject() {
                    const project = {
                        components: this.components,
                        bomList: this.bomList,
                        timestamp: new Date().toISOString()
                    };
                    
                    localStorage.setItem('plcProject', JSON.stringify(project));
                    alert('Ù¾Ø±ÙˆÚ˜Ù‡ Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø°Ø®ÛŒØ±Ù‡ Ø´Ø¯!');
                },
                
                // Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ù¾Ø±ÙˆÚ˜Ù‡ Ø§Ø² localStorage
                loadProject(event) {
                    if (event.target.files.length === 0) return;
                    
                    const file = event.target.files[0];
                    const reader = new FileReader();
                    
                    reader.onload = (e) => {
                        try {
                            const project = JSON.parse(e.target.result);
                            this.components = project.components;
                            this.calculateBOM();
                            this.generateLayout();
                            this.generateTags();
                            alert('Ù¾Ø±ÙˆÚ˜Ù‡ Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø´Ø¯!');
                        } catch (error) {
                            alert('Ø®Ø·Ø§ Ø¯Ø± Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ ÙØ§ÛŒÙ„!');
                        }
                    };
                    
                    reader.readAsText(file);
                },
                
                // Ø®Ø±ÙˆØ¬ÛŒ JSON Ø§Ø² Ù¾Ø±ÙˆÚ˜Ù‡
                exportToJSON() {
                    const project = {
                        components: this.components,
                        bomList: this.bomList,
                        layoutItems: this.layoutItems,
                        tagsList: this.tagsList,
                        totals: {
                            components: this.totalComponents,
                            relays: this.totalRelays,
                            contactors: this.totalContactors,
                            space: this.totalSpace
                        },
                        timestamp: new Date().toISOString()
                    };
                    
                    const dataStr = JSON.stringify(project, null, 2);
                    const dataUri = 'data:application/json;charset=utf-8,'+ encodeURIComponent(dataStr);
                    
                    const exportFileDefaultName = `plc_project_${new Date().toISOString().slice(0,10)}.json`;
                    
                    const linkElement = document.createElement('a');
                    linkElement.setAttribute('href', dataUri);
                    linkElement.setAttribute('download', exportFileDefaultName);
                    linkElement.click();
                },
                
                // Ø¨Ø§Ø²Ù†Ø´Ø§Ù†ÛŒ Ø¨Ù‡ Ù…Ù‚Ø§Ø¯ÛŒØ± Ù¾ÛŒØ´â€ŒÙØ±Ø¶
                resetToDefaults() {
                    if (confirm('Ø¢ÛŒØ§ Ø§Ø² Ø¨Ø§Ø²Ù†Ø´Ø§Ù†ÛŒ ØªÙ…Ø§Ù… Ù…Ù‚Ø§Ø¯ÛŒØ± Ø¨Ù‡ Ù¾ÛŒØ´â€ŒÙØ±Ø¶ Ø§Ø·Ù…ÛŒÙ†Ø§Ù† Ø¯Ø§Ø±ÛŒØ¯ØŸ')) {
                        this.components.motors.forEach(motor => {
                            motor.count = motor.defaultCount;
                            motor.power = motor.defaultPower.replace('kW', '');
                        });
                        
                        this.components.actuators.forEach(actuator => {
                            actuator.count = actuator.defaultCount;
                            actuator.hasPositioner = actuator.id === 4 ? false : true;
                            actuator.hasInput = actuator.id === 2 ? false : true;
                        });
                        
                        this.components.sensors.forEach(sensor => {
                            sensor.count = sensor.defaultCount;
                        });
                        
                        this.components.optionals.forEach(optional => {
                            optional.count = optional.defaultCount;
                            optional.value = optional.id === 1 || optional.id === 2 ? '30' : 
                                           optional.id === 3 ? '7' : '';
                            optional.hasThermalSensor = false;
                        });
                        
                        this.calculateBOM();
                        this.generateLayout();
                        this.generateTags();
                    }
                }
            };
        }
    </script>
</body>
</html>