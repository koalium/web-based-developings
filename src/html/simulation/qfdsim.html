<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>شبیه‌سازی کوانتومی پیشرفته پروتون و نوترون</title>
    <script src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js" defer></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Tahoma', 'Segoe UI', sans-serif;
        }
        
        :root {
            --proton-color: #3b82f6;
            --neutron-color: #6b7280;
            --quark-red: #ef4444;
            --quark-green: #10b981;
            --quark-blue: #3b82f6;
            --antiquark-cyan: #06b6d4;
            --antiquark-magenta: #d946ef;
            --antiquark-yellow: #eab308;
            --gluon-orange: #f97316;
            --gluon-purple: #8b5cf6;
            --w-boson: #dc2626;
            --z-boson: #7c3aed;
            --pion: #ec4899;
            --photon: #fbbf24;
            --dark-bg: #0f172a;
            --card-bg: #1e293b;
            --text: #e2e8f0;
            --highlight: #10b981;
            --warning: #f59e0b;
            --danger: #ef4444;
        }
        
        body {
            background: linear-gradient(135deg, var(--dark-bg), #1e1b4b);
            color: var(--text);
            line-height: 1.8;
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 2000px;
            margin: 0 auto;
        }
        
        header {
            text-align: center;
            margin-bottom: 40px;
            padding: 30px;
            background: rgba(30, 41, 59, 0.7);
            border-radius: 16px;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(100, 116, 139, 0.3);
            position: relative;
            overflow: hidden;
        }
        
        header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, var(--quark-red), var(--quark-green), var(--quark-blue));
        }
        
        h1 {
            font-size: 2.8rem;
            margin-bottom: 15px;
            background: linear-gradient(90deg, var(--proton-color), var(--neutron-color));
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            text-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
        }
        
        .subtitle {
            font-size: 1.3rem;
            opacity: 0.9;
            max-width: 800px;
            margin: 0 auto 20px;
        }
        
        .dashboard {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-bottom: 40px;
        }
        
        @media (max-width: 1400px) {
            .dashboard {
                grid-template-columns: 1fr;
            }
        }
        
        .nucleon-panel {
            background: var(--card-bg);
            border-radius: 16px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(100, 116, 139, 0.3);
            display: flex;
            flex-direction: column;
        }
        
        .panel-title {
            font-size: 1.6rem;
            margin-bottom: 20px;
            color: var(--proton-color);
            border-bottom: 2px solid rgba(100, 150, 255, 0.3);
            padding-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .neutron .panel-title {
            color: var(--neutron-color);
        }
        
        .panel-title::before {
            content: '';
            width: 12px;
            height: 12px;
            border-radius: 50%;
        }
        
        .proton .panel-title::before {
            background: var(--proton-color);
        }
        
        .neutron .panel-title::before {
            background: var(--neutron-color);
        }
        
        .visualization-area {
            position: relative;
            width: 100%;
            height: 400px;
            background: rgba(15, 23, 42, 0.7);
            border-radius: 12px;
            border: 1px solid rgba(100, 116, 139, 0.3);
            overflow: hidden;
            margin-bottom: 20px;
        }
        
        .nucleon-boundary {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 250px;
            height: 250px;
            border-radius: 50%;
            border: 3px dashed;
            background: rgba(59, 130, 246, 0.1);
            box-shadow: 0 0 30px rgba(59, 130, 246, 0.3);
        }
        
        .proton-boundary {
            border-color: var(--proton-color);
        }
        
        .neutron-boundary {
            border-color: var(--neutron-color);
        }
        
        .particle {
            position: absolute;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            font-size: 12px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
            transition: all 0.3s ease;
            z-index: 10;
            cursor: pointer;
        }
        
        .particle.quark {
            width: 35px;
            height: 35px;
        }
        
        .particle.antiquark {
            width: 32px;
            height: 32px;
            border: 2px solid white;
        }
        
        .particle.gluon {
            width: 28px;
            height: 28px;
            border-radius: 30% 70% 70% 30% / 30% 30% 70% 70%;
            animation: gluonPulse 2s infinite alternate;
        }
        
        .particle.boson {
            width: 25px;
            height: 25px;
            border-radius: 20%;
        }
        
        .particle.photon {
            width: 22px;
            height: 22px;
            border-radius: 50%;
            animation: photonPulse 1s infinite;
        }
        
        @keyframes gluonPulse {
            0% { transform: scale(1) rotate(0deg); }
            100% { transform: scale(1.1) rotate(180deg); }
        }
        
        @keyframes photonPulse {
            0%, 100% { opacity: 1; transform: scale(1); }
            50% { opacity: 0.7; transform: scale(1.1); }
        }
        
        .quark.red { background: var(--quark-red); }
        .quark.green { background: var(--quark-green); }
        .quark.blue { background: var(--quark-blue); }
        
        .antiquark.cyan { background: var(--antiquark-cyan); }
        .antiquark.magenta { background: var(--antiquark-magenta); }
        .antiquark.yellow { background: var(--antiquark-yellow); }
        
        .gluon.orange { background: var(--gluon-orange); }
        .gluon.purple { background: var(--gluon-purple); }
        
        .boson.w { background: var(--w-boson); }
        .boson.z { background: var(--z-boson); }
        .boson.pion { background: var(--pion); }
        .photon { background: var(--photon); }
        
        .interaction-line {
            position: absolute;
            height: 2px;
            background: linear-gradient(90deg, transparent, var(--gluon-orange), transparent);
            transform-origin: 0 0;
            z-index: 5;
            pointer-events: none;
        }
        
        .decay-line {
            position: absolute;
            height: 2px;
            background: linear-gradient(90deg, transparent, var(--w-boson), transparent);
            transform-origin: 0 0;
            z-index: 5;
            pointer-events: none;
        }
        
        .quantum-field {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            opacity: 0.1;
            background: radial-gradient(circle, var(--gluon-orange) 0%, transparent 70%);
            animation: fieldPulse 3s infinite alternate;
        }
        
        @keyframes fieldPulse {
            0% { opacity: 0.05; transform: scale(1); }
            100% { opacity: 0.15; transform: scale(1.1); }
        }
        
        .stats-panel {
            background: var(--card-bg);
            border-radius: 16px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(100, 116, 139, 0.3);
            margin-top: 30px;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        
        .stat-card {
            background: rgba(15, 23, 42, 0.7);
            border-radius: 12px;
            padding: 20px;
            border-left: 4px solid var(--highlight);
            transition: transform 0.2s;
        }
        
        .stat-card:hover {
            transform: translateY(-2px);
        }
        
        .stat-title {
            font-weight: bold;
            margin-bottom: 10px;
            color: var(--proton-color);
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .stat-value {
            font-size: 1.5rem;
            font-weight: bold;
            color: var(--highlight);
            font-family: 'Courier New', monospace;
        }
        
        .stat-trend {
            font-size: 0.9rem;
            margin-top: 5px;
        }
        
        .trend-up { color: var(--highlight); }
        .trend-down { color: var(--danger); }
        .trend-stable { color: var(--warning); }
        
        .controls-panel {
            background: var(--card-bg);
            border-radius: 16px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(100, 116, 139, 0.3);
            margin-top: 30px;
        }
        
        .control-group {
            margin-bottom: 25px;
        }
        
        .control-title {
            font-size: 1.2rem;
            margin-bottom: 15px;
            color: var(--proton-color);
        }
        
        .slider-container {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 10px;
        }
        
        label {
            min-width: 200px;
            font-weight: 600;
        }
        
        input[type="range"] {
            flex: 1;
            height: 8px;
            border-radius: 4px;
            background: rgba(100, 116, 139, 0.3);
            outline: none;
            -webkit-appearance: none;
        }
        
        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: var(--proton-color);
            cursor: pointer;
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.3);
        }
        
        .value-display {
            min-width: 80px;
            text-align: center;
            padding: 5px 10px;
            background: rgba(30, 41, 59, 0.7);
            border-radius: 6px;
            font-family: 'Courier New', monospace;
            font-weight: bold;
        }
        
        .button-group {
            display: flex;
            gap: 15px;
            margin-top: 20px;
            flex-wrap: wrap;
        }
        
        button {
            background: linear-gradient(90deg, var(--proton-color), #3b82f6);
            border: none;
            color: white;
            padding: 12px 24px;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
            flex: 1;
            min-width: 150px;
        }
        
        button:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 18px rgba(0, 0, 0, 0.3);
        }
        
        button:active {
            transform: translateY(1px);
        }
        
        button.secondary {
            background: linear-gradient(90deg, var(--neutron-color), #6b7280);
        }
        
        button.warning {
            background: linear-gradient(90deg, var(--warning), #f59e0b);
        }
        
        .charts-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-top: 30px;
        }
        
        @media (max-width: 1200px) {
            .charts-container {
                grid-template-columns: 1fr;
            }
        }
        
        .chart-panel {
            background: var(--card-bg);
            border-radius: 16px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(100, 116, 139, 0.3);
            height: 400px;
        }
        
        .calculation-panel {
            background: var(--card-bg);
            border-radius: 16px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(100, 116, 139, 0.3);
            margin-top: 30px;
        }
        
        .math {
            font-style: italic;
            margin: 15px 0;
            padding: 15px;
            background: rgba(30, 41, 59, 0.7);
            border-radius: 8px;
            border-left: 4px solid var(--gluon-orange);
            font-family: 'Times New Roman', serif;
            direction: ltr;
            text-align: left;
        }
        
        .event-log {
            background: rgba(15, 23, 42, 0.7);
            border-radius: 12px;
            padding: 20px;
            margin-top: 20px;
            max-height: 300px;
            overflow-y: auto;
            font-family: 'Courier New', monospace;
            font-size: 0.9rem;
        }
        
        .log-entry {
            margin-bottom: 8px;
            padding-bottom: 8px;
            border-bottom: 1px solid rgba(100, 116, 139, 0.3);
            transition: background 0.2s;
        }
        
        .log-entry:hover {
            background: rgba(255, 255, 255, 0.05);
        }
        
        .log-time {
            color: var(--highlight);
            font-weight: bold;
        }
        
        .log-type-interaction { border-left: 3px solid var(--gluon-orange); padding-left: 10px; }
        .log-type-decay { border-left: 3px solid var(--w-boson); padding-left: 10px; }
        .log-type-creation { border-left: 3px solid var(--highlight); padding-left: 10px; }
        .log-type-error { border-left: 3px solid var(--danger); padding-left: 10px; }
        
        footer {
            text-align: center;
            margin-top: 50px;
            padding: 25px;
            font-size: 0.9rem;
            opacity: 0.8;
            border-top: 1px solid rgba(100, 116, 139, 0.3);
        }
        
        .particle-legend {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            margin: 20px 0;
            justify-content: center;
        }
        
        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px 15px;
            background: rgba(15, 23, 42, 0.7);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .legend-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        }
        
        .legend-color {
            width: 16px;
            height: 16px;
            border-radius: 50%;
        }
        
        .quark-legend { background: var(--quark-red); }
        .antiquark-legend { 
            background: var(--antiquark-cyan); 
            border: 2px solid white;
        }
        .gluon-legend { 
            background: var(--gluon-orange); 
            border-radius: 30% 70% 70% 30% / 30% 30% 70% 70%;
        }
        .boson-legend { background: var(--w-boson); border-radius: 20%; }
        .photon-legend { background: var(--photon); }
        
        .particle-info {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: var(--card-bg);
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
            border: 2px solid var(--highlight);
            z-index: 1000;
            max-width: 400px;
            display: none;
        }
        
        .info-close {
            position: absolute;
            top: 10px;
            left: 10px;
            background: var(--danger);
            color: white;
            border: none;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .quantum-effects {
            background: var(--card-bg);
            border-radius: 16px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(100, 116, 139, 0.3);
            margin-top: 30px;
        }
        
        .effects-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        
        .effect-card {
            background: rgba(15, 23, 42, 0.7);
            border-radius: 12px;
            padding: 20px;
            border-left: 4px solid var(--warning);
        }
        
        .effect-title {
            font-weight: bold;
            margin-bottom: 10px;
            color: var(--warning);
        }
        
        .energy-indicator {
            height: 10px;
            background: linear-gradient(90deg, var(--quark-red), var(--quark-green), var(--quark-blue));
            border-radius: 5px;
            margin: 10px 0;
            overflow: hidden;
        }
        
        .energy-level {
            height: 100%;
            background: rgba(255, 255, 255, 0.5);
            border-radius: 5px;
            transition: width 0.5s ease;
        }
    </style>
</head>
<body>
    <div class="container" x-data="advancedQuantumSimulation()">
        <header>
            <h1>شبیه‌سازی کوانتومی پیشرفته پروتون و نوترون</h1>
            <p class="subtitle">مدل‌سازی پیشرفته برهمکنش‌های درون‌هسته‌ای با محاسبات احتمالاتی، میدان‌های کوانتومی و اثرات نسبیتی</p>
            
            <div class="particle-legend">
                <div class="legend-item" @click="toggleParticleType('quark')">
                    <div class="legend-color quark-legend"></div>
                    <span>کوارک‌ها</span>
                </div>
                <div class="legend-item" @click="toggleParticleType('antiquark')">
                    <div class="legend-color antiquark-legend"></div>
                    <span>پادکوارک‌ها</span>
                </div>
                <div class="legend-item" @click="toggleParticleType('gluon')">
                    <div class="legend-color gluon-legend"></div>
                    <span>گلئون‌ها</span>
                </div>
                <div class="legend-item" @click="toggleParticleType('boson')">
                    <div class="legend-color boson-legend"></div>
                    <span>بوزون‌های弱</span>
                </div>
                <div class="legend-item" @click="toggleParticleType('photon')">
                    <div class="legend-color photon-legend"></div>
                    <span>فوتون‌ها</span>
                </div>
            </div>
        </header>
        
        <div class="dashboard">
            <div class="nucleon-panel proton">
                <h2 class="panel-title">ساختار پروتون</h2>
                <div class="visualization-area" id="protonViz">
                    <div class="quantum-field" x-show="showQuantumFields"></div>
                    <div class="nucleon-boundary proton-boundary"></div>
                    <!-- ذرات به صورت پویا تولید می‌شوند -->
                </div>
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-title">کوارک‌های ظرفیت</div>
                        <div class="stat-value" x-text="protonStats.valenceQuarks"></div>
                        <div class="stat-trend trend-stable">پایدار</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-title">گلئون‌ها</div>
                        <div class="stat-value" x-text="protonStats.gluons"></div>
                        <div class="stat-trend" :class="protonStats.gluonTrend"></div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-title">کوارک‌های دریایی</div>
                        <div class="stat-value" x-text="protonStats.seaQuarks"></div>
                        <div class="stat-trend" :class="protonStats.seaQuarkTrend"></div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-title">انرژی کل (MeV)</div>
                        <div class="stat-value" x-text="protonStats.totalEnergy.toFixed(1)"></div>
                        <div class="energy-indicator">
                            <div class="energy-level" :style="`width: ${(protonStats.totalEnergy/1500)*100}%`"></div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="nucleon-panel neutron">
                <h2 class="panel-title">ساختار نوترون</h2>
                <div class="visualization-area" id="neutronViz">
                    <div class="quantum-field" x-show="showQuantumFields"></div>
                    <div class="nucleon-boundary neutron-boundary"></div>
                    <!-- ذرات به صورت پویا تولید می‌شوند -->
                </div>
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-title">کوارک‌های ظرفیت</div>
                        <div class="stat-value" x-text="neutronStats.valenceQuarks"></div>
                        <div class="stat-trend trend-stable">پایدار</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-title">گلئون‌ها</div>
                        <div class="stat-value" x-text="neutronStats.gluons"></div>
                        <div class="stat-trend" :class="neutronStats.gluonTrend"></div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-title">کوارک‌های دریایی</div>
                        <div class="stat-value" x-text="neutronStats.seaQuarks"></div>
                        <div class="stat-trend" :class="neutronStats.seaQuarkTrend"></div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-title">انرژی کل (MeV)</div>
                        <div class="stat-value" x-text="neutronStats.totalEnergy.toFixed(1)"></div>
                        <div class="energy-indicator">
                            <div class="energy-level" :style="`width: ${(neutronStats.totalEnergy/1500)*100}%`"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="controls-panel">
            <h2 class="panel-title">کنترل‌های پیشرفته شبیه‌سازی</h2>
            
            <div class="control-group">
                <h3 class="control-title">پارامترهای فیزیکی پیشرفته</h3>
                <div class="slider-container">
                    <label for="energy-scale">مقیاس انرژی (GeV)</label>
                    <input type="range" id="energy-scale" min="0.1" max="5.0" step="0.1" 
                           x-model="energyScale" @input="updatePhysics">
                    <div class="value-display" x-text="`${energyScale} GeV`"></div>
                </div>
                
                <div class="slider-container">
                    <label for="temperature">دمای کوانتومی (MeV)</label>
                    <input type="range" id="temperature" min="10" max="500" step="10" 
                           x-model="quantumTemperature" @input="updatePhysics">
                    <div class="value-display" x-text="`${quantumTemperature} MeV`"></div>
                </div>
                
                <div class="slider-container">
                    <label for="time-step">گام زمانی (fm/c)</label>
                    <input type="range" id="time-step" min="0.01" max="1.0" step="0.01" 
                           x-model="timeStep" @input="updatePhysics">
                    <div class="value-display" x-text="`${timeStep} fm/c`"></div>
                </div>
            </div>
            
            <div class="control-group">
                <h3 class="control-title">احتمالات برهمکنش پیشرفته</h3>
                <div class="slider-container">
                    <label for="gluon-exchange">تبادل گلئون</label>
                    <input type="range" id="gluon-exchange" min="0" max="100" step="1" 
                           x-model="interactionProbabilities.gluonExchange" @input="updateProbabilities">
                    <div class="value-display" x-text="`${interactionProbabilities.gluonExchange}%`"></div>
                </div>
                
                <div class="slider-container">
                    <label for="quark-pair">تولید جفت کوارک-پادکوارک</label>
                    <input type="range" id="quark-pair" min="0" max="100" step="1" 
                           x-model="interactionProbabilities.quarkPair" @input="updateProbabilities">
                    <div class="value-display" x-text="`${interactionProbabilities.quarkPair}%`"></div>
                </div>
                
                <div class="slider-container">
                    <label for="beta-decay">واپاشی بتا (نوترون)</label>
                    <input type="range" id="beta-decay" min="0" max="5" step="0.1" 
                           x-model="interactionProbabilities.betaDecay" @input="updateProbabilities">
                    <div class="value-display" x-text="`${interactionProbabilities.betaDecay}%`"></div>
                </div>
            </div>
            
            <div class="button-group">
                <button @click="startSimulation()">شروع شبیه‌سازی</button>
                <button @click="pauseSimulation()" class="secondary">توقف موقت</button>
                <button @click="resetSimulation()" class="warning">بازنشانی کامل</button>
                <button @click="singleStep()">یک گام</button>
                <button @click="toggleQuantumFields()">میدان‌های کوانتومی</button>
                <button @click="exportData()">خروجی داده</button>
            </div>
        </div>
        
        <div class="charts-container">
            <div class="chart-panel">
                <h2 class="panel-title">توزیع احتمالات برهمکنش</h2>
                <canvas id="probabilityChart" width="400" height="200"></canvas>
            </div>
            
            <div class="chart-panel">
                <h2 class="panel-title">تکامل زمانی انرژی</h2>
                <canvas id="energyChart" width="400" height="200"></canvas>
            </div>
        </div>
        
        <div class="quantum-effects">
            <h2 class="panel-title">اثرات کوانتومی پیشرفته</h2>
            
            <div class="effects-grid">
                <div class="effect-card">
                    <div class="effect-title">نوسانات کوانتومی خلاء</div>
                    <p>تولید و نابودی جفت‌های مجازی با انرژی ΔEΔt ≈ ħ</p>
                    <div class="energy-indicator">
                        <div class="energy-level" :style="`width: ${vacuumFluctuation}%`"></div>
                    </div>
                </div>
                
                <div class="effect-card">
                    <div class="effect-title">پلاریزاسیون خلاء</div>
                    <p>تغییر در توزیع بار الکتریکی ناشی از جفت‌های مجازی</p>
                    <div class="energy-indicator">
                        <div class="energy-level" :style="`width: ${vacuumPolarization}%`"></div>
                    </div>
                </div>
                
                <div class="effect-card">
                    <div class="effect-title">تاخیر زمانی نسبیتی</div>
                    <p>تاثیرات نسبیتی بر نیمه‌عمر ذرات در حال حرکت</p>
                    <div class="energy-indicator">
                        <div class="energy-level" :style="`width: ${timeDilation}%`"></div>
                    </div>
                </div>
                
                <div class="effect-card">
                    <div class="effect-title">درهم‌تنیدگی کوانتومی</div>
                    <p>همبستگی کوانتومی بین ذرات درون نوکلئون</p>
                    <div class="energy-indicator">
                        <div class="energy-level" :style="`width: ${quantumEntanglement}%`"></div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="calculation-panel">
            <h2 class="panel-title">محاسبات کوانتومی پیشرفته</h2>
            
            <div class="math">
                معادله DGLAP برای تکامل تابع چگالی:
                ∂f(x, Q²)/∂lnQ² = (αs/2π) ∫_x^1 (dz/z) P(z) f(x/z, Q²)
            </div>
            
            <div class="math">
                تابع چگالی کوارک‌ها با اصلاحات QCD:
                f(x, Q²) = A x^α (1-x)^β (1 + γ√x + δx) + Δ(x, Q²)
            </div>
            
            <div class="math">
                احتمال واپاشی بتا با اصلاحات QED:
                Γ = (G_F² m_p⁵ / 2π³) |V_ud|² (1 + 3g_A²) f(Q) (1 + δ_R)
            </div>
            
            <div class="event-log">
                <h3 class="control-title">گزارش پیشرفته رویدادها</h3>
                <div x-html="eventLog"></div>
            </div>
        </div>
        
        <div class="particle-info" id="particleInfo" x-show="showParticleInfo">
            <button class="info-close" @click="showParticleInfo = false">×</button>
            <h3 x-text="selectedParticle.type + ' اطلاعات'"></h3>
            <div x-html="selectedParticle.info"></div>
        </div>
        
        <footer>
            <p>شبیه‌سازی پیشرفته فیزیک ذرات | مدل‌سازی کوانتومی پروتون و نوترون</p>
            <p>بر اساس QCD، QED و نظریه میدان کوانتومی | ساخته شده با Alpine.js و Chart.js</p>
        </footer>
    </div>

    <script>
        document.addEventListener('alpine:init', () => {
            Alpine.data('advancedQuantumSimulation', () => ({
                // پارامترهای پیشرفته شبیه‌سازی
                energyScale: 1.0,
                quantumTemperature: 100,
                timeStep: 0.1,
                isRunning: false,
                simulationTime: 0,
                showQuantumFields: true,
                showParticleInfo: false,
                selectedParticle: {},
                hiddenParticleTypes: [],
                
                // پارامترهای اثرات کوانتومی
                vacuumFluctuation: 30,
                vacuumPolarization: 25,
                timeDilation: 15,
                quantumEntanglement: 40,
                
                // احتمالات برهمکنش
                interactionProbabilities: {
                    gluonExchange: 30,
                    quarkPair: 15,
                    betaDecay: 0.1,
                    photonEmission: 5,
                    pionExchange: 20
                },
                
                // آمار پیشرفته ذرات
                protonStats: {
                    valenceQuarks: 'uud',
                    gluons: 0,
                    seaQuarks: 0,
                    totalEnergy: 938.3,
                    gluonTrend: 'trend-stable',
                    seaQuarkTrend: 'trend-stable',
                    energyHistory: []
                },
                
                neutronStats: {
                    valenceQuarks: 'udd',
                    gluons: 0,
                    seaQuarks: 0,
                    totalEnergy: 939.6,
                    gluonTrend: 'trend-stable',
                    seaQuarkTrend: 'trend-stable',
                    energyHistory: []
                },
                
                // ذرات و برهمکنش‌ها
                protonParticles: [],
                neutronParticles: [],
                interactions: [],
                eventLog: '',
                
                // نمودارها
                probabilityChart: null,
                energyChart: null,
                
                init() {
                    this.initializeAdvancedParticles();
                    this.setupCharts();
                    this.updateVisualization();
                    this.startSimulation();
                },
                
                initializeAdvancedParticles() {
                    // مقداردهی اولیه ذرات پروتون
                    this.protonParticles = [
                        this.createValenceQuark('u', 'red', 125, 125),
                        this.createValenceQuark('u', 'green', 175, 125),
                        this.createValenceQuark('d', 'blue', 150, 175)
                    ];
                    
                    // مقداردهی اولیه ذرات نوترون
                    this.neutronParticles = [
                        this.createValenceQuark('u', 'red', 125, 125),
                        this.createValenceQuark('d', 'green', 175, 125),
                        this.createValenceQuark('d', 'blue', 150, 175)
                    ];
                    
                    // تولید ذرات مجازی پیشرفته
                    this.generateAdvancedVirtualParticles();
                },
                
                createValenceQuark(flavor, color, x, y) {
                    return {
                        type: 'quark',
                        flavor: flavor,
                        color: color,
                        x: x,
                        y: y,
                        vx: (Math.random() - 0.5) * 0.5,
                        vy: (Math.random() - 0.5) * 0.5,
                        mass: flavor === 'u' ? 2.3 : 4.8, // MeV
                        charge: flavor === 'u' ? 2/3 : -1/3,
                        spin: 1/2,
                        info: this.getParticleInfo('quark', flavor)
                    };
                },
                
                generateAdvancedVirtualParticles() {
                    // تولید گلئون‌های پیشرفته
                    for (let i = 0; i < 12; i++) {
                        this.protonParticles.push(this.createAdvancedGluon('proton'));
                        this.neutronParticles.push(this.createAdvancedGluon('neutron'));
                    }
                    
                    // تولید جفت کوارک-پادکوارک دریایی با انواع مختلف
                    for (let i = 0; i < 6; i++) {
                        const pair = this.createAdvancedQuarkPair();
                        this.protonParticles.push(pair.quark, pair.antiquark);
                        
                        const pair2 = this.createAdvancedQuarkPair();
                        this.neutronParticles.push(pair2.quark, pair2.antiquark);
                    }
                    
                    // تولید فوتون‌های مجازی
                    for (let i = 0; i < 4; i++) {
                        this.protonParticles.push(this.createVirtualPhoton('proton'));
                        this.neutronParticles.push(this.createVirtualPhoton('neutron'));
                    }
                    
                    this.updateAdvancedStats();
                },
                
                createAdvancedGluon(nucleon) {
                    const centerX = 200;
                    const centerY = 200;
                    const radius = 60 + Math.random() * 60;
                    const angle = Math.random() * 2 * Math.PI;
                    
                    return {
                        type: 'gluon',
                        color: Math.random() > 0.5 ? 'orange' : 'purple',
                        x: centerX + radius * Math.cos(angle),
                        y: centerY + radius * Math.sin(angle),
                        vx: (Math.random() - 0.5) * 2,
                        vy: (Math.random() - 0.5) * 2,
                        nucleon: nucleon,
                        mass: 0,
                        charge: 0,
                        spin: 1,
                        info: this.getParticleInfo('gluon')
                    };
                },
                
                createAdvancedQuarkPair() {
                    const flavors = ['u', 'd', 's', 'c'];
                    const probabilities = [0.4, 0.4, 0.15, 0.05]; // احتمال انواع کوارک
                    const quarkColors = ['red', 'green', 'blue'];
                    const antiquarkColors = ['cyan', 'magenta', 'yellow'];
                    
                    let rand = Math.random();
                    let flavorIndex = 0;
                    let cumulativeProb = 0;
                    
                    for (let i = 0; i < probabilities.length; i++) {
                        cumulativeProb += probabilities[i];
                        if (rand <= cumulativeProb) {
                            flavorIndex = i;
                            break;
                        }
                    }
                    
                    const flavor = flavors[flavorIndex];
                    const colorIdx = Math.floor(Math.random() * 3);
                    
                    const centerX = 200 + (Math.random() - 0.5) * 80;
                    const centerY = 200 + (Math.random() - 0.5) * 80;
                    
                    const quarkMass = flavor === 'u' ? 2.3 : flavor === 'd' ? 4.8 : 
                                   flavor === 's' ? 95 : 1275; // MeV
                    
                    return {
                        quark: {
                            type: 'quark',
                            flavor: flavor,
                            color: quarkColors[colorIdx],
                            x: centerX - 8,
                            y: centerY - 8,
                            vx: (Math.random() - 0.5),
                            vy: (Math.random() - 0.5),
                            mass: quarkMass,
                            charge: flavor === 'u' || flavor === 'c' ? 2/3 : -1/3,
                            spin: 1/2,
                            info: this.getParticleInfo('quark', flavor)
                        },
                        antiquark: {
                            type: 'antiquark',
                            flavor: flavor,
                            color: antiquarkColors[colorIdx],
                            x: centerX + 8,
                            y: centerY + 8,
                            vx: (Math.random() - 0.5),
                            vy: (Math.random() - 0.5),
                            mass: quarkMass,
                            charge: flavor === 'u' || flavor === 'c' ? -2/3 : 1/3,
                            spin: 1/2,
                            info: this.getParticleInfo('antiquark', flavor)
                        }
                    };
                },
                
                createVirtualPhoton(nucleon) {
                    const centerX = 200;
                    const centerY = 200;
                    const radius = 40 + Math.random() * 80;
                    const angle = Math.random() * 2 * Math.PI;
                    
                    return {
                        type: 'photon',
                        x: centerX + radius * Math.cos(angle),
                        y: centerY + radius * Math.sin(angle),
                        vx: (Math.random() - 0.5) * 3,
                        vy: (Math.random() - 0.5) * 3,
                        nucleon: nucleon,
                        mass: 0,
                        charge: 0,
                        spin: 1,
                        info: this.getParticleInfo('photon')
                    };
                },
                
                getParticleInfo(type, flavor = '') {
                    const info = {
                        quark: `
                            <p><strong>کوارک ${flavor}</strong></p>
                            <p>بار الکتریکی: ${flavor === 'u' || flavor === 'c' ? '+2/3' : '-1/3'}</p>
                            <p>جرم: ${flavor === 'u' ? '2.3' : flavor === 'd' ? '4.8' : flavor === 's' ? '95' : '1275'} MeV</p>
                            <p>اسپین: 1/2</p>
                            <p>بار رنگ: ${['قرمز', 'سبز', 'آبی'][Math.floor(Math.random()*3)]}</p>
                        `,
                        antiquark: `
                            <p><strong>پادکوارک ${flavor}</strong></p>
                            <p>بار الکتریکی: ${flavor === 'u' || flavor === 'c' ? '-2/3' : '+1/3'}</p>
                            <p>جرم: ${flavor === 'u' ? '2.3' : flavor === 'd' ? '4.8' : flavor === 's' ? '95' : '1275'} MeV</p>
                            <p>اسپین: 1/2</p>
                            <p>بار رنگ: ${['آبی-زرد', 'ارغوانی', 'زرد'][Math.floor(Math.random()*3)]}</p>
                        `,
                        gluon: `
                            <p><strong>گلئون</strong></p>
                            <p>بار الکتریکی: 0</p>
                            <p>جرم: 0 MeV</p>
                            <p>اسپین: 1</p>
                            <p>حامل نیروی قوی</p>
                            <p>دارای بار رنگ دوگانه</p>
                        `,
                        photon: `
                            <p><strong>فوتون</strong></p>
                            <p>بار الکتریکی: 0</p>
                            <p>جرم: 0 MeV</p>
                            <p>اسپین: 1</p>
                            <p>حامل نیروی الکترومغناطیس</p>
                            <p>سرعت: c</p>
                        `
                    };
                    
                    return info[type] || '<p>اطلاعات ذره در دسترس نیست</p>';
                },
                
                setupCharts() {
                    // نمودار احتمالات
                    const probCtx = document.getElementById('probabilityChart').getContext('2d');
                    this.probabilityChart = new Chart(probCtx, {
                        type: 'bar',
                        data: {
                            labels: ['تبادل گلئون', 'جفت کوارک', 'واپاشی بتا', 'فوتون', 'پایون'],
                            datasets: [{
                                label: 'احتمال برهمکنش (%)',
                                data: [30, 15, 0.1, 5, 20],
                                backgroundColor: [
                                    'rgba(255, 99, 132, 0.7)',
                                    'rgba(54, 162, 235, 0.7)',
                                    'rgba(255, 206, 86, 0.7)',
                                    'rgba(75, 192, 192, 0.7)',
                                    'rgba(153, 102, 255, 0.7)'
                                ],
                                borderColor: [
                                    'rgba(255, 99, 132, 1)',
                                    'rgba(54, 162, 235, 1)',
                                    'rgba(255, 206, 86, 1)',
                                    'rgba(75, 192, 192, 1)',
                                    'rgba(153, 102, 255, 1)'
                                ],
                                borderWidth: 1
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            scales: {
                                y: {
                                    beginAtZero: true,
                                    max: 50,
                                    title: {
                                        display: true,
                                        text: 'احتمال (%)'
                                    }
                                }
                            },
                            plugins: {
                                legend: {
                                    display: false
                                }
                            }
                        }
                    });
                    
                    // نمودار انرژی
                    const energyCtx = document.getElementById('energyChart').getContext('2d');
                    this.energyChart = new Chart(energyCtx, {
                        type: 'line',
                        data: {
                            labels: [],
                            datasets: [
                                {
                                    label: 'انرژی پروتون (MeV)',
                                    data: [],
                                    borderColor: 'rgba(59, 130, 246, 1)',
                                    backgroundColor: 'rgba(59, 130, 246, 0.1)',
                                    tension: 0.4,
                                    fill: true
                                },
                                {
                                    label: 'انرژی نوترون (MeV)',
                                    data: [],
                                    borderColor: 'rgba(107, 114, 128, 1)',
                                    backgroundColor: 'rgba(107, 114, 128, 0.1)',
                                    tension: 0.4,
                                    fill: true
                                }
                            ]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            scales: {
                                y: {
                                    title: {
                                        display: true,
                                        text: 'انرژی (MeV)'
                                    }
                                },
                                x: {
                                    title: {
                                        display: true,
                                        text: 'زمان (fm/c)'
                                    }
                                }
                            }
                        }
                    });
                },
                
                startSimulation() {
                    this.isRunning = true;
                    this.simulationLoop();
                    this.addEvent('شبیه‌سازی پیشرفته شروع شد', 'creation');
                },
                
                pauseSimulation() {
                    this.isRunning = false;
                    this.addEvent('شبیه‌سازی متوقف شد', 'creation');
                },
                
                resetSimulation() {
                    this.pauseSimulation();
                    this.simulationTime = 0;
                    this.initializeAdvancedParticles();
                    this.interactions = [];
                    this.eventLog = '';
                    this.protonStats.energyHistory = [];
                    this.neutronStats.energyHistory = [];
                    this.updateVisualization();
                    this.addEvent('شبیه‌سازی بازنشانی کامل شد', 'creation');
                },
                
                singleStep() {
                    this.simulationTime += this.timeStep;
                    this.processAdvancedInteractions();
                    this.updateAdvancedParticles();
                    this.updateVisualization();
                    this.addEvent('یک گام شبیه‌سازی پیشرفته اجرا شد', 'creation');
                },
                
                simulationLoop() {
                    if (!this.isRunning) return;
                    
                    this.singleStep();
                    
                    // ادامه حلقه با توجه به سرعت شبیه‌سازی
                    setTimeout(() => {
                        this.simulationLoop();
                    }, 100);
                },
                
                processAdvancedInteractions() {
                    this.interactions = [];
                    
                    // پردازش برهمکنش‌های پیشرفته
                    this.processNucleonInteractions(this.protonParticles, 'proton');
                    this.processNucleonInteractions(this.neutronParticles, 'neutron');
                    
                    // پردازش اثرات کوانتومی
                    this.processQuantumEffects();
                    
                    this.updateAdvancedStats();
                    this.updateEnergyChart();
                },
                
                processNucleonInteractions(particles, nucleonType) {
                    for (let i = 0; i < particles.length; i++) {
                        for (let j = i + 1; j < particles.length; j++) {
                            const p1 = particles[i];
                            const p2 = particles[j];
                            
                            // محاسبه فاصله
                            const dx = p1.x - p2.x;
                            const dy = p1.y - p2.y;
                            const distance = Math.sqrt(dx * dx + dy * dy);
                            
                            // بررسی انواع مختلف برهمکنش
                            this.checkGluonExchange(p1, p2, distance, nucleonType);
                            this.checkQuarkAnnihilation(p1, p2, distance, nucleonType);
                            this.checkPhotonEmission(p1, p2, distance, nucleonType);
                            this.checkPionExchange(p1, p2, distance, nucleonType);
                        }
                    }
                    
                    // پردازش واپاشی بتا برای نوترون
                    if (nucleonType === 'neutron' && Math.random() * 100 < this.interactionProbabilities.betaDecay) {
                        this.processBetaDecay();
                    }
                },
                
                checkGluonExchange(p1, p2, distance, nucleonType) {
                    if ((p1.type === 'quark' && p2.type === 'quark') || 
                        (p1.type === 'quark' && p2.type === 'antiquark') ||
                        (p1.type === 'antiquark' && p2.type === 'quark')) {
                        if (distance < 60 && Math.random() * 100 < this.interactionProbabilities.gluonExchange) {
                            this.interactions.push({
                                type: 'gluon-exchange',
                                p1: p1,
                                p2: p2,
                                strength: (80 - distance) / 80
                            });
                            this.addEvent(`تبادل گلئون در ${nucleonType}`, 'interaction');
                        }
                    }
                },
                
                checkQuarkAnnihilation(p1, p2, distance, nucleonType) {
                    if ((p1.type === 'quark' && p2.type === 'antiquark') && 
                        p1.flavor === p2.flavor && distance < 40) {
                        if (Math.random() * 100 < this.interactionProbabilities.quarkPair) {
                            this.interactions.push({
                                type: 'annihilation',
                                p1: p1,
                                p2: p2,
                                strength: 1.0
                            });
                            this.addEvent(`نابودی جفت کوارک-پادکوارک در ${nucleonType}`, 'interaction');
                        }
                    }
                },
                
                checkPhotonEmission(p1, p2, distance, nucleonType) {
                    if ((p1.type === 'quark' && p2.type === 'quark') && distance < 50) {
                        if (Math.random() * 100 < this.interactionProbabilities.photonEmission) {
                            this.interactions.push({
                                type: 'photon-emission',
                                p1: p1,
                                p2: p2,
                                strength: (70 - distance) / 70
                            });
                            this.addEvent(`گسیل فوتون در ${nucleonType}`, 'interaction');
                        }
                    }
                },
                
                checkPionExchange(p1, p2, distance, nucleonType) {
                    if ((p1.type === 'quark' && p2.type === 'quark') && 
                        p1.flavor !== p2.flavor && distance < 70) {
                        if (Math.random() * 100 < this.interactionProbabilities.pionExchange) {
                            this.interactions.push({
                                type: 'pion-exchange',
                                p1: p1,
                                p2: p2,
                                strength: (90 - distance) / 90
                            });
                            this.addEvent(`تبادل پایون در ${nucleonType}`, 'interaction');
                        }
                    }
                },
                
                processQuantumEffects() {
                    // شبیه‌سازی نوسانات خلاء
                    if (Math.random() * 100 < this.vacuumFluctuation / 2) {
                        const pair = this.createAdvancedQuarkPair();
                        if (Math.random() > 0.5) {
                            this.protonParticles.push(pair.quark, pair.antiquark);
                            this.addEvent('نوسان خلاء: تولید جفت کوارک-پادکوارک در پروتون', 'creation');
                        } else {
                            this.neutronParticles.push(pair.quark, pair.antiquark);
                            this.addEvent('نوسان خلاء: تولید جفت کوارک-پادکوارک در نوترون', 'creation');
                        }
                    }
                    
                    // شبیه‌سازی درهم‌تنیدگی کوانتومی
                    if (Math.random() * 100 < this.quantumEntanglement / 3) {
                        this.addEvent('اثر درهم‌تنیدگی کوانتومی مشاهده شد', 'creation');
                    }
                },
                
                processBetaDecay() {
                    // شبیه‌سازی واپاشی بتا: n → p + e⁻ + ν̄e
                    if (Math.random() * 100 < this.interactionProbabilities.betaDecay) {
                        this.addEvent('واپاشی بتا: نوترون → پروتون + الکترون + پادنوترینو', 'decay');
                        
                        // ایجاد خط واپاشی در ویژوال‌سازی
                        this.interactions.push({
                            type: 'beta-decay',
                            p1: { x: 200, y: 200 },
                            p2: { x: 300, y: 100 },
                            strength: 0.8
                        });
                    }
                },
                
                updateAdvancedParticles() {
                    // به‌روزرسانی موقعیت ذرات با فیزیک پیشرفته
                    const allParticles = [...this.protonParticles, ...this.neutronParticles];
                    
                    allParticles.forEach(particle => {
                        // حرکت با در نظر گرفتن دما و اثرات کوانتومی
                        const thermalVelocity = Math.sqrt(this.quantumTemperature / (particle.mass || 1));
                        particle.vx += (Math.random() - 0.5) * thermalVelocity * 0.1;
                        particle.vy += (Math.random() - 0.5) * thermalVelocity * 0.1;
                        
                        // محدود کردن سرعت نسبیتی
                        const speed = Math.sqrt(particle.vx * particle.vx + particle.vy * particle.vy);
                        const maxSpeed = 5 * (1 - particle.mass / (particle.mass + this.energyScale * 1000));
                        if (speed > maxSpeed) {
                            particle.vx = (particle.vx / speed) * maxSpeed;
                            particle.vy = (particle.vy / speed) * maxSpeed;
                        }
                        
                        // به‌روزرسانی موقعیت
                        particle.x += particle.vx;
                        particle.y += particle.vy;
                        
                        // برخورد با مرز نوکلئون
                        this.handleBoundaryCollision(particle);
                    });
                },
                
                handleBoundaryCollision(particle) {
                    const centerX = 200, centerY = 200;
                    const dx = particle.x - centerX;
                    const dy = particle.y - centerY;
                    const distance = Math.sqrt(dx * dx + dy * dy);
                    
                    if (distance > 120) {
                        // برگرداندن ذره به داخل با حفظ انرژی
                        const angle = Math.atan2(dy, dx);
                        particle.x = centerX + 115 * Math.cos(angle);
                        particle.y = centerY + 115 * Math.sin(angle);
                        
                        // تغییر جهت حرکت با ضریب بازتاب
                        const dotProduct = particle.vx * Math.cos(angle) + particle.vy * Math.sin(angle);
                        particle.vx -= 2 * dotProduct * Math.cos(angle) * 0.9;
                        particle.vy -= 2 * dotProduct * Math.sin(angle) * 0.9;
                    }
                },
                
                updateVisualization() {
                    this.renderNucleon('proton', this.protonParticles);
                    this.renderNucleon('neutron', this.neutronParticles);
                },
                
                renderNucleon(nucleonType, particles) {
                    const container = document.getElementById(`${nucleonType}Viz`);
                    
                    // پاک‌سازی ویژوال‌سازی قبلی
                    container.querySelectorAll('.particle, .interaction-line, .decay-line').forEach(el => {
                        if (!el.classList.contains('nucleon-boundary') && !el.classList.contains('quantum-field')) {
                            el.remove();
                        }
                    });
                    
                    // رندر ذرات
                    particles.forEach((particle, index) => {
                        if (this.hiddenParticleTypes.includes(particle.type)) return;
                        
                        const el = document.createElement('div');
                        el.className = `particle ${particle.type} ${particle.color || ''}`;
                        el.style.left = `${particle.x}px`;
                        el.style.top = `${particle.y}px`;
                        el.dataset.index = index;
                        
                        if (particle.type === 'quark' || particle.type === 'antiquark') {
                            el.textContent = particle.type === 'antiquark' ? `${particle.flavor}̄` : particle.flavor;
                        }
                        
                        // اضافه کردن event برای نمایش اطلاعات ذره
                        el.addEventListener('click', () => {
                            this.selectedParticle = particle;
                            this.showParticleInfo = true;
                        });
                        
                        container.appendChild(el);
                    });
                    
                    // رندر برهمکنش‌ها
                    this.interactions.forEach(interaction => {
                        const line = document.createElement('div');
                        line.className = interaction.type === 'beta-decay' ? 'decay-line' : 'interaction-line';
                        
                        const dx = interaction.p2.x - interaction.p1.x;
                        const dy = interaction.p2.y - interaction.p1.y;
                        const length = Math.sqrt(dx * dx + dy * dy);
                        const angle = Math.atan2(dy, dx) * 180 / Math.PI;
                        
                        line.style.width = `${length}px`;
                        line.style.left = `${interaction.p1.x}px`;
                        line.style.top = `${interaction.p1.y}px`;
                        line.style.transform = `rotate(${angle}deg)`;
                        line.style.opacity = interaction.strength;
                        
                        container.appendChild(line);
                    });
                },
                
                updateAdvancedStats() {
                    // آمار پروتون
                    this.protonStats.gluons = this.protonParticles.filter(p => p.type === 'gluon').length;
                    this.protonStats.seaQuarks = this.protonParticles.filter(p => 
                        p.type === 'quark' && !['u', 'd'].includes(p.flavor)).length;
                    
                    // محاسبه انرژی کل پروتون
                    this.protonStats.totalEnergy = 938.3 + // انرژی سکون
                        this.protonParticles.reduce((sum, p) => sum + (p.mass || 0), 0) * 0.1 + // انرژی جرمی
                        this.protonParticles.reduce((sum, p) => sum + (p.vx * p.vx + p.vy * p.vy) * (p.mass || 1) * 0.5, 0); // انرژی جنبشی
                    
                    // آمار نوترون
                    this.neutronStats.gluons = this.neutronParticles.filter(p => p.type === 'gluon').length;
                    this.neutronStats.seaQuarks = this.neutronParticles.filter(p => 
                        p.type === 'quark' && !['u', 'd'].includes(p.flavor)).length;
                    
                    // محاسبه انرژی کل نوترون
                    this.neutronStats.totalEnergy = 939.6 + // انرژی سکون
                        this.neutronParticles.reduce((sum, p) => sum + (p.mass || 0), 0) * 0.1 + // انرژی جرمی
                        this.neutronParticles.reduce((sum, p) => sum + (p.vx * p.vx + p.vy * p.vy) * (p.mass || 1) * 0.5, 0); // انرژی جنبشی
                    
                    // به‌روزرسانی روندها
                    this.updateTrends();
                },
                
                updateTrends() {
                    // این تابع روند تغییرات آماری را محاسبه می‌کند
                    // برای سادگی، از مقادیر تصادفی استفاده می‌کنیم
                    const trends = ['trend-up', 'trend-down', 'trend-stable'];
                    this.protonStats.gluonTrend = trends[Math.floor(Math.random() * 3)];
                    this.protonStats.seaQuarkTrend = trends[Math.floor(Math.random() * 3)];
                    this.neutronStats.gluonTrend = trends[Math.floor(Math.random() * 3)];
                    this.neutronStats.seaQuarkTrend = trends[Math.floor(Math.random() * 3)];
                },
                
                updateEnergyChart() {
                    // اضافه کردن داده‌های جدید به نمودار انرژی
                    const timeLabel = this.simulationTime.toFixed(1);
                    
                    this.protonStats.energyHistory.push(this.protonStats.totalEnergy);
                    this.neutronStats.energyHistory.push(this.neutronStats.totalEnergy);
                    
                    // محدود کردن طول تاریخچه
                    if (this.protonStats.energyHistory.length > 50) {
                        this.protonStats.energyHistory.shift();
                        this.neutronStats.energyHistory.shift();
                    }
                    
                    // به‌روزرسانی نمودار
                    this.energyChart.data.labels = Array.from({length: this.protonStats.energyHistory.length}, 
                        (_, i) => (this.simulationTime - (this.protonStats.energyHistory.length - i - 1) * this.timeStep).toFixed(1));
                    this.energyChart.data.datasets[0].data = this.protonStats.energyHistory;
                    this.energyChart.data.datasets[1].data = this.neutronStats.energyHistory;
                    this.energyChart.update();
                },
                
                addEvent(message, type = 'interaction') {
                    const timestamp = this.simulationTime.toFixed(2);
                    const logEntry = `<div class="log-entry log-type-${type}">
                        <span class="log-time">t=${timestamp} fm/c:</span> ${message}
                    </div>`;
                    
                    this.eventLog = logEntry + this.eventLog;
                    
                    // محدود کردن طول گزارش
                    if (this.eventLog.split('<div class="log-entry">').length > 25) {
                        const events = this.eventLog.split('<div class="log-entry">');
                        this.eventLog = events.slice(0, 25).join('<div class="log-entry">');
                    }
                },
                
                updatePhysics() {
                    // به‌روزرسانی فیزیک بر اساس پارامترهای جدید
                    this.addEvent(`مقیاس انرژی به ${this.energyScale} GeV تنظیم شد`, 'creation');
                    this.addEvent(`دمای کوانتومی به ${this.quantumTemperature} MeV تنظیم شد`, 'creation');
                },
                
                updateProbabilities() {
                    // به‌روزرسانی نمودار احتمالات
                    this.probabilityChart.data.datasets[0].data = [
                        this.interactionProbabilities.gluonExchange,
                        this.interactionProbabilities.quarkPair,
                        this.interactionProbabilities.betaDecay,
                        this.interactionProbabilities.photonEmission,
                        this.interactionProbabilities.pionExchange
                    ];
                    this.probabilityChart.update();
                    
                    this.addEvent('احتمالات برهمکنش به‌روزرسانی شد', 'creation');
                },
                
                toggleQuantumFields() {
                    this.showQuantumFields = !this.showQuantumFields;
                    this.addEvent(`میدان‌های کوانتومی ${this.showQuantumFields ? 'فعال' : 'غیرفعال'} شد`, 'creation');
                },
                
                toggleParticleType(type) {
                    const index = this.hiddenParticleTypes.indexOf(type);
                    if (index > -1) {
                        this.hiddenParticleTypes.splice(index, 1);
                        this.addEvent(`نمایش ${type}ها فعال شد`, 'creation');
                    } else {
                        this.hiddenParticleTypes.push(type);
                        this.addEvent(`نمایش ${type}ها غیرفعال شد`, 'creation');
                    }
                    this.updateVisualization();
                },
                
                exportData() {
                    const data = {
                        simulationTime: this.simulationTime,
                        parameters: {
                            energyScale: this.energyScale,
                            quantumTemperature: this.quantumTemperature,
                            timeStep: this.timeStep
                        },
                        probabilities: this.interactionProbabilities,
                        protonStats: this.protonStats,
                        neutronStats: this.neutronStats,
                        quantumEffects: {
                            vacuumFluctuation: this.vacuumFluctuation,
                            vacuumPolarization: this.vacuumPolarization,
                            timeDilation: this.timeDilation,
                            quantumEntanglement: this.quantumEntanglement
                        }
                    };
                    
                    const dataStr = JSON.stringify(data, null, 2);
                    const dataBlob = new Blob([dataStr], {type: 'application/json'});
                    
                    const link = document.createElement('a');
                    link.href = URL.createObjectURL(dataBlob);
                    link.download = `advanced_quantum_simulation_${Date.now()}.json`;
                    link.click();
                    
                    this.addEvent('داده‌های پیشرفته شبیه‌سازی ذخیره شد', 'creation');
                }
            }));
        });
    </script>
</body>
</html>