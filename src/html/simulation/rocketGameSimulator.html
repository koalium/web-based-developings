<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø´Ø¨ÛŒÙ‡â€ŒØ³Ø§Ø² Ø­Ø±ÙÙ‡â€ŒØ§ÛŒ Ù¾Ø±ØªØ§Ø¨ Ù…ÙˆØ´Ú© - Ù†Ù…Ø§ÛŒØ´ 3D Ùˆ Ú©Ø§Ù†ÙˆØ§Ø³ Ø¨Ø²Ø±Ú¯</title>
    <script src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js" defer></script>
    <style>
        :root {
            --primary-color: #00f2fe;
            --secondary-color: #4facfe;
            --danger-color: #ff4757;
            --success-color: #00b09b;
            --warning-color: #ffc107;
            --dark-bg: #0a0a2a;
            --medium-bg: #1a1a3a;
            --light-bg: #2a2a4a;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: linear-gradient(to bottom, var(--dark-bg), var(--medium-bg));
            color: #fff;
            min-height: 100vh;
            overflow: hidden;
        }
        
        .container {
            display: grid;
            grid-template-columns: 320px 1fr;
            grid-template-rows: 80px 1fr 200px;
            grid-template-areas: 
                "header header"
                "sidebar canvas"
                "sidebar controls";
            height: 100vh;
            gap: 10px;
            padding: 10px;
        }
        
        @media (max-width: 1200px) {
            .container {
                grid-template-columns: 1fr;
                grid-template-rows: 80px 300px 1fr 200px;
                grid-template-areas: 
                    "header"
                    "sidebar"
                    "canvas"
                    "controls";
            }
        }
        
        header {
            grid-area: header;
            background: rgba(20, 30, 60, 0.9);
            border-radius: 15px;
            padding: 15px 30px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(100, 150, 255, 0.2);
        }
        
        .logo {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .logo-icon {
            font-size: 2.5rem;
            color: var(--primary-color);
        }
        
        .logo-text {
            display: flex;
            flex-direction: column;
        }
        
        .logo-title {
            font-size: 1.8rem;
            font-weight: bold;
            background: linear-gradient(to right, var(--primary-color), var(--secondary-color));
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
        }
        
        .logo-subtitle {
            font-size: 0.9rem;
            color: #a0d2ff;
        }
        
        .header-controls {
            display: flex;
            gap: 15px;
            align-items: center;
        }
        
        .header-btn {
            padding: 10px 20px;
            background: rgba(40, 60, 120, 0.7);
            border: 1px solid rgba(100, 150, 255, 0.3);
            border-radius: 8px;
            color: white;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .header-btn:hover {
            background: rgba(60, 100, 200, 0.7);
            transform: translateY(-2px);
        }
        
        .header-btn.emergency {
            background: rgba(220, 53, 69, 0.7);
            border-color: rgba(220, 53, 69, 0.5);
            animation: pulse-emergency 2s infinite;
        }
        
        @keyframes pulse-emergency {
            0% { box-shadow: 0 0 0 0 rgba(220, 53, 69, 0.7); }
            70% { box-shadow: 0 0 0 10px rgba(220, 53, 69, 0); }
            100% { box-shadow: 0 0 0 0 rgba(220, 53, 69, 0); }
        }
        
        .sidebar {
            grid-area: sidebar;
            background: rgba(20, 30, 60, 0.9);
            border-radius: 15px;
            padding: 20px;
            display: flex;
            flex-direction: column;
            gap: 20px;
            overflow-y: auto;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(100, 150, 255, 0.2);
        }
        
        .sidebar-section {
            background: rgba(30, 45, 90, 0.5);
            border-radius: 10px;
            padding: 15px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .section-title {
            font-size: 1.2rem;
            color: var(--primary-color);
            margin-bottom: 15px;
            padding-bottom: 8px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .stage-item {
            background: rgba(40, 60, 120, 0.3);
            border-radius: 8px;
            padding: 12px;
            margin-bottom: 10px;
            transition: all 0.3s ease;
            border: 1px solid transparent;
        }
        
        .stage-item.active {
            border-color: var(--primary-color);
            background: rgba(0, 242, 254, 0.1);
        }
        
        .stage-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }
        
        .stage-name {
            font-weight: bold;
            color: #a0d2ff;
        }
        
        .stage-status {
            font-size: 0.8rem;
            padding: 2px 8px;
            border-radius: 10px;
        }
        
        .status-active {
            background: rgba(0, 242, 254, 0.2);
            color: var(--primary-color);
        }
        
        .status-separated {
            background: rgba(0, 176, 155, 0.2);
            color: var(--success-color);
        }
        
        .stage-details {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 5px;
            font-size: 0.85rem;
        }
        
        .detail-item {
            display: flex;
            justify-content: space-between;
            padding: 3px 0;
        }
        
        .detail-label {
            color: #a0d2ff;
        }
        
        .detail-value {
            color: var(--primary-color);
            font-weight: bold;
        }
        
        .fuel-bar {
            height: 8px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 4px;
            margin-top: 8px;
            overflow: hidden;
        }
        
        .fuel-fill {
            height: 100%;
            background: linear-gradient(to right, var(--success-color), #96c93d);
            border-radius: 4px;
            transition: width 0.5s ease;
        }
        
        .fuel-fill.low {
            background: linear-gradient(to right, var(--warning-color), #ff8a00);
        }
        
        .fuel-fill.critical {
            background: linear-gradient(to right, var(--danger-color), #da1b60);
        }
        
        .quick-action {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin-top: 10px;
        }
        
        .action-btn {
            padding: 8px;
            background: rgba(40, 60, 120, 0.5);
            border: none;
            border-radius: 6px;
            color: white;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.9rem;
            text-align: center;
        }
        
        .action-btn:hover {
            background: rgba(60, 100, 200, 0.5);
            transform: translateY(-2px);
        }
        
        .action-btn.active {
            background: rgba(0, 242, 254, 0.3);
            border: 1px solid var(--primary-color);
        }
        
        .telemetry-panel {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        
        .telemetry-item {
            background: rgba(40, 60, 120, 0.3);
            border-radius: 8px;
            padding: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .telemetry-label {
            display: flex;
            align-items: center;
            gap: 8px;
            color: #a0d2ff;
        }
        
        .telemetry-icon {
            font-size: 1.2rem;
        }
        
        .telemetry-value {
            font-size: 1.2rem;
            color: var(--primary-color);
            font-weight: bold;
        }
        
        .telemetry-unit {
            font-size: 0.9rem;
            color: #a0d2ff;
            margin-right: 5px;
        }
        
        .canvas-container {
            grid-area: canvas;
            background: linear-gradient(to bottom, #000428, #004e92);
            border-radius: 15px;
            overflow: hidden;
            position: relative;
            box-shadow: 0 5px 30px rgba(0, 0, 0, 0.7);
            border: 2px solid rgba(100, 150, 255, 0.3);
        }
        
        canvas {
            display: block;
            width: 100%;
            height: 100%;
        }
        
        .canvas-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 10;
        }
        
        .hud {
            position: absolute;
            top: 20px;
            left: 20px;
            right: 20px;
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
        }
        
        .hud-left, .hud-right {
            background: rgba(0, 0, 0, 0.7);
            border-radius: 10px;
            padding: 15px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(5px);
        }
        
        .hud-item {
            margin-bottom: 10px;
        }
        
        .hud-label {
            font-size: 0.9rem;
            color: #a0d2ff;
            margin-bottom: 3px;
        }
        
        .hud-value {
            font-size: 1.3rem;
            color: var(--primary-color);
            font-weight: bold;
        }
        
        .radar {
            position: absolute;
            bottom: 20px;
            left: 20px;
            width: 200px;
            height: 200px;
            background: rgba(0, 0, 0, 0.7);
            border-radius: 50%;
            border: 2px solid var(--primary-color);
            overflow: hidden;
        }
        
        .radar-scan {
            position: absolute;
            width: 100%;
            height: 100%;
            background: conic-gradient(transparent 0deg, rgba(0, 242, 254, 0.3) 180deg, transparent 360deg);
            animation: radar-scan 4s linear infinite;
        }
        
        @keyframes radar-scan {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .radar-center {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 10px;
            height: 10px;
            background: var(--primary-color);
            border-radius: 50%;
        }
        
        .radar-dot {
            position: absolute;
            width: 6px;
            height: 6px;
            background: var(--danger-color);
            border-radius: 50%;
            transform: translate(-50%, -50%);
        }
        
        .crosshair {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 40px;
            height: 40px;
            pointer-events: none;
        }
        
        .crosshair::before, .crosshair::after {
            content: '';
            position: absolute;
            background: var(--primary-color);
        }
        
        .crosshair::before {
            top: 50%;
            left: 0;
            right: 0;
            height: 2px;
            transform: translateY(-50%);
        }
        
        .crosshair::after {
            left: 50%;
            top: 0;
            bottom: 0;
            width: 2px;
            transform: translateX(-50%);
        }
        
        .stage-indicator {
            position: absolute;
            bottom: 20px;
            right: 20px;
            display: flex;
            gap: 10px;
            background: rgba(0, 0, 0, 0.7);
            padding: 15px;
            border-radius: 10px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(5px);
        }
        
        .stage-dot {
            width: 25px;
            height: 25px;
            border-radius: 50%;
            background: #444;
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.8rem;
            color: white;
        }
        
        .stage-dot.active {
            background: var(--primary-color);
            box-shadow: 0 0 15px var(--primary-color);
            animation: pulse 2s infinite;
        }
        
        .stage-dot.separated {
            background: var(--success-color);
        }
        
        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(0, 242, 254, 0.7); }
            70% { box-shadow: 0 0 0 10px rgba(0, 242, 254, 0); }
            100% { box-shadow: 0 0 0 0 rgba(0, 242, 254, 0); }
        }
        
        .controls-panel {
            grid-area: controls;
            background: rgba(20, 30, 60, 0.9);
            border-radius: 15px;
            padding: 15px;
            display: flex;
            flex-direction: column;
            gap: 15px;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(100, 150, 255, 0.2);
        }
        
        .throttle-control {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .throttle-slider {
            flex: 1;
            -webkit-appearance: none;
            appearance: none;
            height: 12px;
            background: linear-gradient(to right, var(--success-color), var(--warning-color), var(--danger-color));
            border-radius: 6px;
            outline: none;
        }
        
        .throttle-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 24px;
            height: 24px;
            background: var(--primary-color);
            border-radius: 50%;
            cursor: pointer;
            border: 2px solid white;
            box-shadow: 0 0 10px rgba(0, 242, 254, 0.7);
        }
        
        .throttle-value {
            width: 60px;
            text-align: center;
            font-size: 1.2rem;
            color: var(--primary-color);
            font-weight: bold;
        }
        
        .control-buttons {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 10px;
        }
        
        .control-btn {
            padding: 15px;
            background: rgba(40, 60, 120, 0.7);
            border: none;
            border-radius: 10px;
            color: white;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 5px;
            font-size: 0.9rem;
        }
        
        .control-btn:hover {
            background: rgba(60, 100, 200, 0.7);
            transform: translateY(-3px);
        }
        
        .control-btn:active {
            transform: translateY(0);
        }
        
        .control-btn.boost {
            background: linear-gradient(to bottom, #00b09b, #96c93d);
        }
        
        .control-btn.reduce {
            background: linear-gradient(to bottom, #ff8a00, #da1b60);
        }
        
        .control-btn.separate {
            background: linear-gradient(to bottom, var(--primary-color), var(--secondary-color));
        }
        
        .control-btn.emergency {
            background: linear-gradient(to bottom, var(--danger-color), #ff8a00);
            animation: pulse-emergency 1.5s infinite;
        }
        
        .btn-icon {
            font-size: 1.5rem;
        }
        
        .message-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.5s ease;
        }
        
        .message-overlay.active {
            opacity: 1;
            pointer-events: all;
        }
        
        .message-box {
            background: rgba(20, 30, 60, 0.95);
            border-radius: 20px;
            padding: 40px;
            max-width: 600px;
            width: 90%;
            text-align: center;
            border: 2px solid var(--primary-color);
            box-shadow: 0 0 50px rgba(0, 242, 254, 0.5);
            transform: scale(0.9);
            transition: transform 0.5s ease;
        }
        
        .message-overlay.active .message-box {
            transform: scale(1);
        }
        
        .message-title {
            font-size: 2.5rem;
            color: var(--primary-color);
            margin-bottom: 20px;
        }
        
        .message-text {
            font-size: 1.3rem;
            color: #a0d2ff;
            margin-bottom: 30px;
            line-height: 1.6;
        }
        
        .message-stats {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .stat {
            text-align: center;
        }
        
        .stat-value {
            font-size: 2rem;
            color: var(--primary-color);
            font-weight: bold;
        }
        
        .stat-label {
            font-size: 0.9rem;
            color: #a0d2ff;
        }
        
        .message-button {
            padding: 15px 40px;
            background: linear-gradient(to right, var(--success-color), #96c93d);
            border: none;
            border-radius: 10px;
            color: white;
            font-size: 1.2rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .message-button:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 20px rgba(150, 201, 61, 0.4);
        }
        
        .loading-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: var(--dark-bg);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 2000;
        }
        
        .loading-spinner {
            width: 80px;
            height: 80px;
            border: 8px solid rgba(255, 255, 255, 0.1);
            border-top: 8px solid var(--primary-color);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-bottom: 30px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .loading-text {
            font-size: 1.5rem;
            color: var(--primary-color);
            text-align: center;
        }
        
        .perspective-wrapper {
            perspective: 1000px;
            width: 100%;
            height: 100%;
        }
        
        .camera-indicator {
            position: absolute;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 10px;
            background: rgba(0, 0, 0, 0.7);
            padding: 10px 20px;
            border-radius: 20px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(5px);
        }
        
        .camera-btn {
            padding: 8px 15px;
            background: rgba(40, 60, 120, 0.5);
            border: none;
            border-radius: 6px;
            color: white;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.9rem;
        }
        
        .camera-btn:hover {
            background: rgba(60, 100, 200, 0.7);
        }
        
        .camera-btn.active {
            background: var(--primary-color);
            color: #000;
            font-weight: bold;
        }
        
        .trajectory-line {
            position: absolute;
            pointer-events: none;
        }
        
        .engine-flame {
            position: absolute;
            pointer-events: none;
            filter: blur(5px);
            mix-blend-mode: screen;
        }
        
        .particle {
            position: absolute;
            pointer-events: none;
            border-radius: 50%;
        }
        
        .cloud {
            position: absolute;
            pointer-events: none;
            opacity: 0.8;
            filter: blur(10px);
        }
        
        .star {
            position: absolute;
            pointer-events: none;
            border-radius: 50%;
            background: white;
        }
    </style>
</head>
<body>
    <!-- ØµÙØ­Ù‡ Ù„ÙˆØ¯ÛŒÙ†Ú¯ -->
    <div class="loading-screen" id="loadingScreen">
        <div class="loading-spinner"></div>
        <div class="loading-text">Ø¯Ø± Ø­Ø§Ù„ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø´Ø¨ÛŒÙ‡â€ŒØ³Ø§Ø² Ù¾ÛŒØ´Ø±ÙØªÙ‡...</div>
    </div>

    <!-- Ù¾ÛŒØ§Ù… Ù†ØªÛŒØ¬Ù‡ -->
    <div class="message-overlay" id="messageOverlay">
        <div class="message-box">
            <div class="message-title" id="messageTitle">Ù…Ø§Ù…ÙˆØ±ÛŒØª Ù…ÙˆÙÙ‚!</div>
            <div class="message-text" id="messageText">Ù…ÙˆØ´Ú© Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø¨Ù‡ Ù…Ø¯Ø§Ø± Ù…ÙˆØ±Ø¯ Ù†Ø¸Ø± Ø±Ø³ÛŒØ¯.</div>
            <div class="message-stats">
                <div class="stat">
                    <div class="stat-value" id="statAltitude">0 km</div>
                    <div class="stat-label">Ø­Ø¯Ø§Ú©Ø«Ø± Ø§Ø±ØªÙØ§Ø¹</div>
                </div>
                <div class="stat">
                    <div class="stat-value" id="statVelocity">0 m/s</div>
                    <div class="stat-label">Ø­Ø¯Ø§Ú©Ø«Ø± Ø³Ø±Ø¹Øª</div>
                </div>
                <div class="stat">
                    <div class="stat-value" id="statTime">0 s</div>
                    <div class="stat-label">Ù…Ø¯Øª Ù¾Ø±ÙˆØ§Ø²</div>
                </div>
            </div>
            <button class="message-button" onclick="rocketGame.closeMessage()">Ø§Ø¯Ø§Ù…Ù‡</button>
        </div>
    </div>

    <div class="container">
        <!-- Ù‡Ø¯Ø± -->
        <header>
            <div class="logo">
                <div class="logo-icon">ğŸš€</div>
                <div class="logo-text">
                    <div class="logo-title">Ø´Ø¨ÛŒÙ‡â€ŒØ³Ø§Ø² Ø­Ø±ÙÙ‡â€ŒØ§ÛŒ Ù¾Ø±ØªØ§Ø¨ Ù…ÙˆØ´Ú©</div>
                    <div class="logo-subtitle">Ù†Ù…Ø§ÛŒØ´ 3D Ø¨Ø§ Ú©Ø§Ù†ÙˆØ§Ø³ Ø¨Ø²Ø±Ú¯ | Ø³ÛŒØ³ØªÙ… Ú©Ù†ØªØ±Ù„ Ù¾ÛŒØ´Ø±ÙØªÙ‡</div>
                </div>
            </div>
            <div class="header-controls">
                <button class="header-btn" onclick="rocketGame.saveDesign()">
                    <span>ğŸ’¾</span>
                    Ø°Ø®ÛŒØ±Ù‡ Ø·Ø±Ø§Ø­ÛŒ
                </button>
                <button class="header-btn" onclick="rocketGame.loadDesign()">
                    <span>ğŸ“‚</span>
                    Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø·Ø±Ø§Ø­ÛŒ
                </button>
                <button class="header-btn emergency" onclick="rocketGame.emergencyExplode()">
                    <span>ğŸ’¥</span>
                    ØªØ®Ø±ÛŒØ¨ Ø§Ø¶Ø·Ø±Ø§Ø±ÛŒ
                </button>
            </div>
        </header>

        <!-- Ø³Ø§ÛŒØ¯Ø¨Ø§Ø± -->
        <div class="sidebar">
            <!-- ÙˆØ¶Ø¹ÛŒØª Ù…Ø±Ø§Ø­Ù„ -->
            <div class="sidebar-section">
                <div class="section-title">
                    <span>ğŸš€</span>
                    ÙˆØ¶Ø¹ÛŒØª Ù…Ø±Ø§Ø­Ù„ Ù…ÙˆØ´Ú©
                </div>
                <div id="stagesContainer">
                    <!-- Ù…Ø±Ø§Ø­Ù„ Ø§ÛŒÙ†Ø¬Ø§ Ø§Ø¶Ø§ÙÙ‡ Ù…ÛŒâ€ŒØ´ÙˆÙ†Ø¯ -->
                </div>
            </div>

            <!-- ØªÙ„Ù‡â€ŒÙ…ØªØ±ÛŒ -->
            <div class="sidebar-section telemetry-panel">
                <div class="section-title">
                    <span>ğŸ“¡</span>
                    ØªÙ„Ù‡â€ŒÙ…ØªØ±ÛŒ Ù„Ø­Ø¸Ù‡â€ŒØ§ÛŒ
                </div>
                <div class="telemetry-item">
                    <div class="telemetry-label">
                        <span class="telemetry-icon">ğŸ“ˆ</span>
                        Ø§Ø±ØªÙØ§Ø¹
                    </div>
                    <div class="telemetry-value">
                        <span id="telemetryAltitude">0</span>
                        <span class="telemetry-unit">km</span>
                    </div>
                </div>
                <div class="telemetry-item">
                    <div class="telemetry-label">
                        <span class="telemetry-icon">âš¡</span>
                        Ø³Ø±Ø¹Øª
                    </div>
                    <div class="telemetry-value">
                        <span id="telemetryVelocity">0</span>
                        <span class="telemetry-unit">m/s</span>
                    </div>
                </div>
                <div class="telemetry-item">
                    <div class="telemetry-label">
                        <span class="telemetry-icon">ğŸ”¥</span>
                        Ø´ØªØ§Ø¨
                    </div>
                    <div class="telemetry-value">
                        <span id="telemetryAcceleration">0</span>
                        <span class="telemetry-unit">g</span>
                    </div>
                </div>
                <div class="telemetry-item">
                    <div class="telemetry-label">
                        <span class="telemetry-icon">â›½</span>
                        Ø³ÙˆØ®Øª
                    </div>
                    <div class="telemetry-value">
                        <span id="telemetryFuel">100</span>
                        <span class="telemetry-unit">%</span>
                    </div>
                </div>
                <div class="telemetry-item">
                    <div class="telemetry-label">
                        <span class="telemetry-icon">ğŸ¯</span>
                        Ù…Ø±Ø­Ù„Ù‡ ÙØ¹Ø§Ù„
                    </div>
                    <div class="telemetry-value">
                        <span id="telemetryStage">1</span>
                        <span class="telemetry-unit">/3</span>
                    </div>
                </div>
                <div class="telemetry-item">
                    <div class="telemetry-label">
                        <span class="telemetry-icon">â±ï¸</span>
                        Ø²Ù…Ø§Ù† Ù¾Ø±ÙˆØ§Ø²
                    </div>
                    <div class="telemetry-value">
                        <span id="telemetryTime">0</span>
                        <span class="telemetry-unit">s</span>
                    </div>
                </div>
            </div>

            <!-- Ø§Ù‚Ø¯Ø§Ù…Ø§Øª Ø³Ø±ÛŒØ¹ -->
            <div class="sidebar-section">
                <div class="section-title">
                    <span>âš¡</span>
                    Ø§Ù‚Ø¯Ø§Ù…Ø§Øª Ø³Ø±ÛŒØ¹
                </div>
                <div class="quick-action">
                    <button class="action-btn" onclick="rocketGame.loadPreset('small')">Ù…ÙˆØ´Ú© Ú©ÙˆÚ†Ú©</button>
                    <button class="action-btn" onclick="rocketGame.loadPreset('medium')">Ù…ÙˆØ´Ú© Ù…ØªÙˆØ³Ø·</button>
                    <button class="action-btn" onclick="rocketGame.loadPreset('heavy')">Ù…ÙˆØ´Ú© Ø³Ù†Ú¯ÛŒÙ†</button>
                    <button class="action-btn" onclick="rocketGame.addStage()">â• Ø§ÙØ²ÙˆØ¯Ù† Ù…Ø±Ø­Ù„Ù‡</button>
                    <button class="action-btn" onclick="rocketGame.resetRocket()">ğŸ”„ Ø¨Ø§Ø²Ù†Ø´Ø§Ù†ÛŒ</button>
                    <button class="action-btn" onclick="rocketGame.launchRocket()" id="launchBtn">ğŸš€ Ù¾Ø±ØªØ§Ø¨</button>
                </div>
            </div>
        </div>

        <!-- Ú©Ø§Ù†ÙˆØ§Ø³ Ø§ØµÙ„ÛŒ -->
        <div class="canvas-container">
            <div class="perspective-wrapper">
                <canvas id="gameCanvas"></canvas>
            </div>
            
            <!-- HUD Ùˆ Overlay -->
            <div class="canvas-overlay">
                <!-- HUD Ú†Ù¾ -->
                <div class="hud">
                    <div class="hud-left">
                        <div class="hud-item">
                            <div class="hud-label">Ø§Ø±ØªÙØ§Ø¹</div>
                            <div class="hud-value" id="hudAltitude">0 km</div>
                        </div>
                        <div class="hud-item">
                            <div class="hud-label">Ø³Ø±Ø¹Øª</div>
                            <div class="hud-value" id="hudVelocity">0 m/s</div>
                        </div>
                        <div class="hud-item">
                            <div class="hud-label">ÙØ´Ø§Ø± Ø¯ÛŒÙ†Ø§Ù…ÛŒÚ©ÛŒ</div>
                            <div class="hud-value" id="hudDynamicPressure">0 kPa</div>
                        </div>
                    </div>
                    
                    <div class="hud-right">
                        <div class="hud-item">
                            <div class="hud-label">Ú¯Ø§Ø² Ù…ÙˆØªÙˆØ±</div>
                            <div class="hud-value" id="hudThrottle">100%</div>
                        </div>
                        <div class="hud-item">
                            <div class="hud-label">Ø¯Ù…Ø§ÛŒ Ø¨Ø¯Ù†Ù‡</div>
                            <div class="hud-value" id="hudTemperature">20Â°C</div>
                        </div>
                        <div class="hud-item">
                            <div class="hud-label">ÙˆØ¶Ø¹ÛŒØª Ù…Ø§Ù…ÙˆØ±ÛŒØª</div>
                            <div class="hud-value" id="hudMissionStatus">Ø¢Ù…Ø§Ø¯Ù‡</div>
                        </div>
                    </div>
                </div>
                
                <!-- Ø±Ø§Ø¯Ø§Ø± -->
                <div class="radar">
                    <div class="radar-scan"></div>
                    <div class="radar-center"></div>
                    <!-- Ù†Ù‚Ø§Ø· Ø±Ø§Ø¯Ø§Ø± Ø§ÛŒÙ†Ø¬Ø§ Ø§Ø¶Ø§ÙÙ‡ Ù…ÛŒâ€ŒØ´ÙˆÙ†Ø¯ -->
                </div>
                
                <!-- Ù†Ø´Ø§Ù†Ú¯Ø± Ù‡Ø¯Ù -->
                <div class="crosshair"></div>
                
                <!-- Ù†Ø´Ø§Ù†Ú¯Ø± Ù…Ø±Ø§Ø­Ù„ -->
                <div class="stage-indicator" id="stageIndicator">
                    <!-- Ù†Ù‚Ø§Ø· Ù…Ø±Ø§Ø­Ù„ Ø§ÛŒÙ†Ø¬Ø§ Ø§Ø¶Ø§ÙÙ‡ Ù…ÛŒâ€ŒØ´ÙˆÙ†Ø¯ -->
                </div>
                
                <!-- Ú©Ù†ØªØ±Ù„ Ø¯ÙˆØ±Ø¨ÛŒÙ† -->
                <div class="camera-indicator">
                    <button class="camera-btn active" onclick="rocketGame.setCameraView('launch')">ğŸš€ Ù†Ù…Ø§ÛŒ Ù¾Ø±ØªØ§Ø¨</button>
                    <button class="camera-btn" onclick="rocketGame.setCameraView('follow')">ğŸ“¡ Ù†Ù…Ø§ÛŒ Ø¯Ù†Ø¨Ø§Ù„â€ŒÚ©Ù†Ù†Ø¯Ù‡</button>
                    <button class="camera-btn" onclick="rocketGame.setCameraView('cockpit')">ğŸ‘ï¸ Ù†Ù…Ø§ÛŒ Ú©Ø§Ø¨ÛŒÙ†</button>
                    <button class="camera-btn" onclick="rocketGame.setCameraView('orbital')">ğŸ›°ï¸ Ù†Ù…Ø§ÛŒ Ù…Ø¯Ø§Ø±ÛŒ</button>
                </div>
            </div>
        </div>

        <!-- Ù¾Ù†Ù„ Ú©Ù†ØªØ±Ù„ -->
        <div class="controls-panel">
            <!-- Ú©Ù†ØªØ±Ù„ Ú¯Ø§Ø² -->
            <div class="throttle-control">
                <div style="color: #a0d2ff;">Ú©Ø§Ù‡Ø´ Ú¯Ø§Ø²</div>
                <input type="range" min="30" max="150" value="100" class="throttle-slider" id="throttleSlider" 
                       oninput="rocketGame.setThrottle(this.value/100)">
                <div style="color: #a0d2ff;">Ø§ÙØ²Ø§ÛŒØ´ Ú¯Ø§Ø²</div>
                <div class="throttle-value" id="throttleValue">100%</div>
            </div>

            <!-- Ø¯Ú©Ù…Ù‡â€ŒÙ‡Ø§ÛŒ Ú©Ù†ØªØ±Ù„ -->
            <div class="control-buttons">
                <button class="control-btn boost" onmousedown="rocketGame.boostThrust()" onmouseup="rocketGame.normalThrust()">
                    <div class="btn-icon">â¬†ï¸</div>
                    <div>Ø§ÙØ²Ø§ÛŒØ´ Ú¯Ø§Ø²</div>
                </button>
                <button class="control-btn reduce" onmousedown="rocketGame.reduceThrust()" onmouseup="rocketGame.normalThrust()">
                    <div class="btn-icon">â¬‡ï¸</div>
                    <div>Ú©Ø§Ù‡Ø´ Ú¯Ø§Ø²</div>
                </button>
                <button class="control-btn separate" onclick="rocketGame.separateStage()" id="separateBtn">
                    <div class="btn-icon">ğŸ“¤</div>
                    <div>Ø¬Ø¯Ø§Ø³Ø§Ø²ÛŒ Ù…Ø±Ø­Ù„Ù‡</div>
                </button>
                <button class="control-btn emergency" onclick="rocketGame.emergencyExplode()">
                    <div class="btn-icon">ğŸ’¥</div>
                    <div>ØªØ®Ø±ÛŒØ¨ Ø§Ø¶Ø·Ø±Ø§Ø±ÛŒ</div>
                </button>
            </div>
        </div>
    </div>

    <script>
        // Ù…ØªØºÛŒØ±Ù‡Ø§ÛŒ Ø¬Ù‡Ø§Ù†ÛŒ Ø¨Ø±Ø§ÛŒ Ø¯Ø³ØªØ±Ø³ÛŒ Ø§Ø² Ø®Ø§Ø±Ø¬
        let rocketGame = null;

        document.addEventListener('DOMContentLoaded', function() {
            // Ù…Ø®ÙÛŒ Ú©Ø±Ø¯Ù† ØµÙØ­Ù‡ Ù„ÙˆØ¯ÛŒÙ†Ú¯ Ø¨Ø¹Ø¯ Ø§Ø² 2 Ø«Ø§Ù†ÛŒÙ‡
            setTimeout(() => {
                document.getElementById('loadingScreen').style.display = 'none';
                rocketGame = new RocketGame();
                rocketGame.init();
            }, 2000);
        });

        class RocketGame {
            constructor() {
                // ÙˆØ¶Ø¹ÛŒØª Ø¨Ø§Ø²ÛŒ
                this.isFlying = false;
                this.isLaunching = false;
                this.gamePaused = false;
                this.flightTime = 0;
                this.maxAltitude = 0;
                this.maxVelocity = 0;
                
                // Ù¾Ø§Ø±Ø§Ù…ØªØ±Ù‡Ø§ÛŒ ÙÛŒØ²ÛŒÚ©ÛŒ
                this.currentAltitude = 0;
                this.currentVelocity = 0;
                this.currentAcceleration = 0;
                this.currentFuel = 100;
                this.currentStage = 1;
                this.currentMass = 0;
                this.dynamicPressure = 0;
                this.hullTemperature = 20;
                this.throttle = 1.0;
                
                // Ú©Ù†ØªØ±Ù„â€ŒÙ‡Ø§
                this.isBoosting = false;
                this.isReducing = false;
                this.canSeparate = false;
                this.autoSeparation = true;
                this.cameraView = 'launch';
                
                // Ø·Ø±Ø§Ø­ÛŒ Ù…ÙˆØ´Ú©
                this.stages = [];
                this.selectedBoosterId = null;
                this.boosterCount = 0;
                
                // Ú©Ø§Ù†ÙˆØ§Ø³ Ùˆ Ú¯Ø±Ø§ÙÛŒÚ©
                this.canvas = null;
                this.ctx = null;
                this.canvasWidth = 0;
                this.canvasHeight = 0;
                this.animationId = null;
                this.lastTimestamp = 0;
                
                // Ø°Ø±Ø§Øª Ùˆ Ø¬Ù„ÙˆÙ‡â€ŒÙ‡Ø§ÛŒ ÙˆÛŒÚ˜Ù‡
                this.particles = [];
                this.stars = [];
                this.clouds = [];
                this.flames = [];
                
                // Ù…Ø³ÛŒØ± Ù¾Ø±ÙˆØ§Ø²
                this.trajectory = [];
                
                // ÙÛŒØ²ÛŒÚ©
                this.gravity = 9.81;
                this.earthRadius = 6371000;
                
                // ØªÙ„Ù‡â€ŒÙ…ØªØ±ÛŒ
                this.telemetryUpdateInterval = null;
                
                // Ù¾ÛŒØ§Ù…
                this.messageActive = false;
            }
            
            init() {
                this.canvas = document.getElementById('gameCanvas');
                this.ctx = this.canvas.getContext('2d');
                
                // ØªÙ†Ø¸ÛŒÙ… Ø§Ù†Ø¯Ø§Ø²Ù‡ Ú©Ø§Ù†ÙˆØ§Ø³
                this.resizeCanvas();
                window.addEventListener('resize', () => this.resizeCanvas());
                
                // Ú©Ù†ØªØ±Ù„â€ŒÙ‡Ø§ÛŒ ØµÙØ­Ù‡ Ú©Ù„ÛŒØ¯
                window.addEventListener('keydown', (e) => this.handleKeyDown(e));
                window.addEventListener('keyup', (e) => this.handleKeyUp(e));
                
                // Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø·Ø±Ø§Ø­ÛŒ Ø°Ø®ÛŒØ±Ù‡ Ø´Ø¯Ù‡
                this.loadSavedDesign();
                
                // Ø§ÛŒØ¬Ø§Ø¯ Ø³ØªØ§Ø±Ú¯Ø§Ù† Ùˆ Ø§Ø¨Ø±Ù‡Ø§
                this.createStars();
                this.createClouds();
                
                // Ø´Ø±ÙˆØ¹ Ø­Ù„Ù‚Ù‡ Ø¨Ø§Ø²ÛŒ
                this.gameLoop();
                
                // Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ ØªÙ„Ù‡â€ŒÙ…ØªØ±ÛŒ
                this.startTelemetryUpdates();
            }
            
            resizeCanvas() {
                const container = document.querySelector('.canvas-container');
                this.canvasWidth = this.canvas.width = container.clientWidth;
                this.canvasHeight = this.canvas.height = container.clientHeight;
            }
            
            createStars() {
                this.stars = [];
                const starCount = 300;
                
                for (let i = 0; i < starCount; i++) {
                    this.stars.push({
                        x: Math.random() * this.canvasWidth,
                        y: Math.random() * this.canvasHeight * 0.7,
                        size: Math.random() * 2 + 0.5,
                        brightness: Math.random() * 0.5 + 0.5,
                        twinkleSpeed: Math.random() * 0.02 + 0.01,
                        twinklePhase: Math.random() * Math.PI * 2
                    });
                }
            }
            
            createClouds() {
                this.clouds = [];
                const cloudCount = 8;
                
                for (let i = 0; i < cloudCount; i++) {
                    this.clouds.push({
                        x: Math.random() * this.canvasWidth,
                        y: Math.random() * this.canvasHeight * 0.3 + this.canvasHeight * 0.6,
                        width: Math.random() * 100 + 150,
                        height: Math.random() * 40 + 30,
                        speed: Math.random() * 0.5 + 0.2,
                        opacity: Math.random() * 0.3 + 0.4
                    });
                }
            }
            
            gameLoop(timestamp = 0) {
                const deltaTime = timestamp - this.lastTimestamp || 0;
                this.lastTimestamp = timestamp;
                
                if (!this.gamePaused) {
                    if (this.isFlying) {
                        this.updatePhysics(deltaTime);
                        this.updateParticles(deltaTime);
                        this.updateTrajectory();
                    }
                    
                    this.updateClouds(deltaTime);
                    this.updateStars(deltaTime);
                }
                
                this.drawScene();
                
                this.animationId = requestAnimationFrame((ts) => this.gameLoop(ts));
            }
            
            updatePhysics(deltaTime) {
                if (deltaTime > 100) return;
                
                const timeStep = Math.min(deltaTime / 1000, 0.1);
                this.flightTime += timeStep;
                
                // Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ø§Ø±ØªÙØ§Ø¹ Ùˆ Ø³Ø±Ø¹Øª (Ù…Ø­Ø§Ø³Ø¨Ø§Øª Ø³Ø§Ø¯Ù‡ Ø´Ø¯Ù‡)
                this.currentAcceleration = (this.throttle * 20) - (this.gravity * (1 - this.currentAltitude / 1000000));
                this.currentVelocity += this.currentAcceleration * timeStep;
                this.currentAltitude += this.currentVelocity * timeStep;
                
                // Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ø±Ú©ÙˆØ±Ø¯Ù‡Ø§
                this.maxAltitude = Math.max(this.maxAltitude, this.currentAltitude);
                this.maxVelocity = Math.max(this.maxVelocity, this.currentVelocity);
                
                // Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ø³ÙˆØ®Øª
                if (this.stages.length > 0) {
                    const activeStageIndex = this.stages.length - this.currentStage;
                    if (activeStageIndex >= 0 && activeStageIndex < this.stages.length) {
                        const stage = this.stages[activeStageIndex];
                        stage.fuelRemaining = Math.max(0, stage.fuelRemaining - (this.throttle * 0.5 * timeStep));
                        this.currentFuel = stage.fuelRemaining;
                        
                        if (stage.fuelRemaining <= 0.1 && !stage.isSeparated && this.currentStage > 1) {
                            this.canSeparate = true;
                            if (this.autoSeparation) {
                                setTimeout(() => this.separateStage(), 1000);
                            }
                        }
                    }
                }
                
                // Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ ÙØ´Ø§Ø± Ùˆ Ø¯Ù…Ø§
                if (this.currentAltitude < 100000) {
                    this.dynamicPressure = 0.5 * 1.225 * Math.exp(-this.currentAltitude / 8500) * Math.pow(this.currentVelocity, 2) / 1000;
                } else {
                    this.dynamicPressure = 0;
                }
                
                this.hullTemperature = 20 + (this.dynamicPressure * 0.5) + (this.currentVelocity * 0.001);
                
                // Ø¨Ø±Ø±Ø³ÛŒ Ø´Ø±Ø§ÛŒØ· Ù¾Ø§ÛŒØ§Ù†ÛŒ
                if (this.currentAltitude <= 0 && this.currentVelocity < 0) {
                    this.endFlight("Ø³Ù‚ÙˆØ· Ù…ÙˆØ´Ú©!");
                } else if (this.currentStage === 1 && this.currentFuel <= 0) {
                    this.endFlight("Ø³ÙˆØ®Øª ØªÙ…Ø§Ù… Ø´Ø¯");
                }
                
                // Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ UI
                this.updateUI();
            }
            
            updateParticles(deltaTime) {
                // Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ø°Ø±Ø§Øª
                for (let i = this.particles.length - 1; i >= 0; i--) {
                    const particle = this.particles[i];
                    particle.life -= deltaTime / 1000;
                    
                    if (particle.life <= 0) {
                        this.particles.splice(i, 1);
                        continue;
                    }
                    
                    particle.x += particle.vx * deltaTime / 1000;
                    particle.y += particle.vy * deltaTime / 1000;
                    particle.vy += 0.1 * deltaTime / 1000;
                }
                
                // Ø§ÛŒØ¬Ø§Ø¯ Ø°Ø±Ø§Øª Ø¬Ø¯ÛŒØ¯ Ø¨Ø±Ø§ÛŒ Ø´Ø¹Ù„Ù‡
                if (this.isFlying && this.currentFuel > 0) {
                    const flameCount = Math.floor(this.throttle * 10);
                    for (let i = 0; i < flameCount; i++) {
                        this.createFlameParticle();
                    }
                }
            }
            
            createFlameParticle() {
                const rocketCenterX = this.canvasWidth / 2;
                const rocketBottom = this.canvasHeight * 0.7;
                
                this.particles.push({
                    x: rocketCenterX + (Math.random() - 0.5) * 30,
                    y: rocketBottom,
                    vx: (Math.random() - 0.5) * 5,
                    vy: -Math.random() * 10 - 5,
                    size: Math.random() * 8 + 4,
                    color: `rgba(255, ${Math.floor(Math.random() * 100 + 100)}, 0, ${Math.random() * 0.8 + 0.2})`,
                    life: Math.random() * 0.5 + 0.3
                });
            }
            
            updateTrajectory() {
                const point = {
                    x: this.canvasWidth / 2,
                    y: this.canvasHeight * 0.7 - (this.currentAltitude / 10000),
                    time: this.flightTime
                };
                
                this.trajectory.push(point);
                
                // Ù…Ø­Ø¯ÙˆØ¯ Ú©Ø±Ø¯Ù† ØªØ¹Ø¯Ø§Ø¯ Ù†Ù‚Ø§Ø· Ù…Ø³ÛŒØ±
                if (this.trajectory.length > 100) {
                    this.trajectory.shift();
                }
            }
            
            updateClouds(deltaTime) {
                for (const cloud of this.clouds) {
                    cloud.x += cloud.speed * deltaTime / 1000;
                    if (cloud.x > this.canvasWidth + cloud.width) {
                        cloud.x = -cloud.width;
                        cloud.y = Math.random() * this.canvasHeight * 0.3 + this.canvasHeight * 0.6;
                    }
                }
            }
            
            updateStars(deltaTime) {
                for (const star of this.stars) {
                    star.twinklePhase += star.twinkleSpeed * deltaTime / 1000;
                }
            }
            
            drawScene() {
                const ctx = this.ctx;
                const width = this.canvasWidth;
                const height = this.canvasHeight;
                
                // Ù¾Ø§Ú© Ú©Ø±Ø¯Ù† Ú©Ø§Ù†ÙˆØ§Ø³
                ctx.fillStyle = '#000428';
                ctx.fillRect(0, 0, width, height);
                
                // Ø±Ø³Ù… Ú¯Ø±Ø§Ø¯ÛŒØ§Ù† Ø¢Ø³Ù…Ø§Ù†
                const skyGradient = ctx.createLinearGradient(0, 0, 0, height);
                skyGradient.addColorStop(0, '#000428');
                skyGradient.addColorStop(0.7, '#004e92');
                skyGradient.addColorStop(1, '#1a1a3a');
                ctx.fillStyle = skyGradient;
                ctx.fillRect(0, 0, width, height);
                
                // Ø±Ø³Ù… Ø³ØªØ§Ø±Ú¯Ø§Ù†
                this.drawStars();
                
                // Ø±Ø³Ù… Ø§Ø¨Ø±Ù‡Ø§
                this.drawClouds();
                
                // Ø±Ø³Ù… Ø²Ù…ÛŒÙ†
                this.drawEarth();
                
                // Ø±Ø³Ù… Ø³Ú©ÙˆÛŒ Ù¾Ø±ØªØ§Ø¨ (Ø¯Ø± Ù†Ù…Ø§ÛŒ Ù¾Ø±ØªØ§Ø¨)
                if (this.cameraView === 'launch' && this.currentAltitude < 1000) {
                    this.drawLaunchPad();
                }
                
                // Ø±Ø³Ù… Ù…Ø³ÛŒØ± Ù¾Ø±ÙˆØ§Ø²
                this.drawTrajectory();
                
                // Ø±Ø³Ù… Ù…ÙˆØ´Ú©
                this.drawRocket();
                
                // Ø±Ø³Ù… Ø°Ø±Ø§Øª
                this.drawParticles();
                
                // Ø±Ø³Ù… Ø´Ø¹Ù„Ù‡ Ù…ÙˆØªÙˆØ±
                if (this.isFlying && this.currentFuel > 0) {
                    this.drawEngineFlame();
                }
                
                // Ø±Ø³Ù… Ø¬Ù„ÙˆÙ‡â€ŒÙ‡Ø§ÛŒ ÙˆÛŒÚ˜Ù‡
                if (this.explosionActive) {
                    this.drawExplosion();
                }
            }
            
            drawStars() {
                const ctx = this.ctx;
                
                for (const star of this.stars) {
                    const brightness = 0.5 + 0.5 * Math.sin(star.twinklePhase);
                    
                    ctx.beginPath();
                    ctx.arc(star.x, star.y, star.size, 0, Math.PI * 2);
                    ctx.fillStyle = `rgba(255, 255, 255, ${star.brightness * brightness})`;
                    ctx.fill();
                    
                    // Ø¯Ø±Ø®Ø´Ø´ Ø³ØªØ§Ø±Ù‡
                    if (star.size > 1) {
                        const glow = ctx.createRadialGradient(star.x, star.y, 0, star.x, star.y, star.size * 3);
                        glow.addColorStop(0, `rgba(255, 255, 255, ${0.3 * brightness})`);
                        glow.addColorStop(1, 'rgba(255, 255, 255, 0)');
                        
                        ctx.fillStyle = glow;
                        ctx.beginPath();
                        ctx.arc(star.x, star.y, star.size * 3, 0, Math.PI * 2);
                        ctx.fill();
                    }
                }
            }
            
            drawClouds() {
                const ctx = this.ctx;
                
                for (const cloud of this.clouds) {
                    ctx.fillStyle = `rgba(255, 255, 255, ${cloud.opacity})`;
                    
                    // Ø±Ø³Ù… Ø§Ø¨Ø± Ø¨Ø§ Ú†Ù†Ø¯ Ø¨ÛŒØ¶ÛŒ
                    const cloudParts = 3;
                    for (let i = 0; i < cloudParts; i++) {
                        const offsetX = (i - 1) * (cloud.width / 3);
                        const partWidth = cloud.width / 2;
                        const partHeight = cloud.height * (0.5 + Math.random() * 0.5);
                        
                        ctx.beginPath();
                        ctx.ellipse(
                            cloud.x + offsetX,
                            cloud.y + (Math.random() - 0.5) * 10,
                            partWidth,
                            partHeight,
                            0, 0, Math.PI * 2
                        );
                        ctx.fill();
                    }
                }
            }
            
            drawEarth() {
                const ctx = this.ctx;
                const width = this.canvasWidth;
                const height = this.canvasHeight;
                
                // Ù…Ø­Ø§Ø³Ø¨Ù‡ Ù…ÙˆÙ‚Ø¹ÛŒØª Ø²Ù…ÛŒÙ† Ø¨Ø± Ø§Ø³Ø§Ø³ Ø§Ø±ØªÙØ§Ø¹
                let earthY = height;
                let earthRadius = height * 0.8;
                
                if (this.currentAltitude > 0) {
                    const scale = Math.min(1, 100000 / (this.currentAltitude + 100000));
                    earthY = height * (0.5 + 0.5 * scale);
                    earthRadius = height * 0.4 * scale;
                }
                
                // Ø¯Ø±Ø®Ø´Ø´ Ø²Ù…ÛŒÙ†
                const glow = ctx.createRadialGradient(
                    width / 2, earthY, 0,
                    width / 2, earthY, earthRadius * 1.5
                );
                glow.addColorStop(0, 'rgba(64, 164, 255, 0.3)');
                glow.addColorStop(1, 'rgba(64, 164, 255, 0)');
                
                ctx.fillStyle = glow;
                ctx.beginPath();
                ctx.arc(width / 2, earthY, earthRadius * 1.5, 0, Math.PI * 2);
                ctx.fill();
                
                // Ø²Ù…ÛŒÙ†
                const earthGradient = ctx.createRadialGradient(
                    width / 2 - earthRadius / 3, earthY - earthRadius / 3, 0,
                    width / 2, earthY, earthRadius
                );
                earthGradient.addColorStop(0, '#1e90ff');
                earthGradient.addColorStop(0.7, '#1c86ee');
                earthGradient.addColorStop(1, '#104e8b');
                
                ctx.fillStyle = earthGradient;
                ctx.beginPath();
                ctx.arc(width / 2, earthY, earthRadius, 0, Math.PI * 2);
                ctx.fill();
                
                // Ù‚Ø§Ø±Ù‡â€ŒÙ‡Ø§
                ctx.fillStyle = 'rgba(34, 139, 34, 0.3)';
                
                // Ù‚Ø§Ø±Ù‡ 1
                ctx.beginPath();
                ctx.arc(width / 2 - earthRadius / 3, earthY - earthRadius / 4, earthRadius / 5, 0, Math.PI * 2);
                ctx.fill();
                
                // Ù‚Ø§Ø±Ù‡ 2
                ctx.beginPath();
                ctx.arc(width / 2 + earthRadius / 4, earthY + earthRadius / 5, earthRadius / 6, 0, Math.PI * 2);
                ctx.fill();
                
                // Ø§Ø¨Ø±Ù‡Ø§
                ctx.fillStyle = 'rgba(255, 255, 255, 0.2)';
                ctx.beginPath();
                ctx.arc(width / 2 - earthRadius / 5, earthY + earthRadius / 3, earthRadius / 8, 0, Math.PI * 2);
                ctx.fill();
            }
            
            drawLaunchPad() {
                const ctx = this.ctx;
                const width = this.canvasWidth;
                const height = this.canvasHeight;
                
                // Ø³Ú©ÙˆÛŒ Ù¾Ø±ØªØ§Ø¨
                const platformHeight = height * 0.15;
                const platformWidth = width * 0.3;
                
                ctx.fillStyle = '#444';
                ctx.fillRect(width / 2 - platformWidth / 2, height * 0.85, platformWidth, platformHeight);
                
                // Ø¬Ø²Ø¦ÛŒØ§Øª Ø³Ú©Ùˆ
                ctx.fillStyle = '#555';
                for (let i = 0; i < 5; i++) {
                    const x = width / 2 - platformWidth / 2 + (i * platformWidth / 4);
                    ctx.fillRect(x, height * 0.85, 10, platformHeight);
                }
                
                // Ù¾Ø§ÛŒÙ‡â€ŒÙ‡Ø§ÛŒ Ø³Ú©Ùˆ
                ctx.fillStyle = '#666';
                ctx.fillRect(width / 2 - platformWidth / 2 - 20, height * 0.85, 20, platformHeight);
                ctx.fillRect(width / 2 + platformWidth / 2, height * 0.85, 20, platformHeight);
                
                // Ø¯ÙˆØ¯Ú©Ø´â€ŒÙ‡Ø§
                ctx.fillStyle = '#333';
                const chimneyCount = 3;
                for (let i = 0; i < chimneyCount; i++) {
                    const chimneyX = width / 2 - platformWidth / 3 + (i * platformWidth / 3);
                    const chimneyWidth = 30;
                    const chimneyHeight = 60;
                    
                    ctx.fillRect(chimneyX - chimneyWidth / 2, height * 0.85 - chimneyHeight, chimneyWidth, chimneyHeight);
                    
                    // Ø¯ÙˆØ¯
                    if (this.isLaunching || this.isFlying) {
                        for (let j = 0; j < 3; j++) {
                            const smokeX = chimneyX + (Math.random() - 0.5) * 20;
                            const smokeY = height * 0.85 - chimneyHeight - (j * 20);
                            const smokeSize = 15 + j * 10;
                            
                            ctx.fillStyle = `rgba(200, 200, 200, ${0.3 - j * 0.1})`;
                            ctx.beginPath();
                            ctx.arc(smokeX, smokeY, smokeSize, 0, Math.PI * 2);
                            ctx.fill();
                        }
                    }
                }
                
                // Ú©Ø§Ø¨Ù„â€ŒÙ‡Ø§ Ùˆ Ø§ØªØµØ§Ù„Ø§Øª
                ctx.strokeStyle = '#888';
                ctx.lineWidth = 3;
                
                const cableCount = 4;
                for (let i = 0; i < cableCount; i++) {
                    const cableX = width / 2 - platformWidth / 2 + 50 + (i * 60);
                    ctx.beginPath();
                    ctx.moveTo(cableX, height * 0.85);
                    ctx.lineTo(width / 2, height * 0.7);
                    ctx.stroke();
                }
            }
            
            drawTrajectory() {
                if (this.trajectory.length < 2) return;
                
                const ctx = this.ctx;
                
                // Ø±Ø³Ù… Ø®Ø· Ù…Ø³ÛŒØ±
                ctx.strokeStyle = 'rgba(0, 242, 254, 0.5)';
                ctx.lineWidth = 2;
                ctx.beginPath();
                
                for (let i = 0; i < this.trajectory.length; i++) {
                    const point = this.trajectory[i];
                    const alpha = i / this.trajectory.length;
                    
                    if (i === 0) {
                        ctx.moveTo(point.x, point.y);
                    } else {
                        ctx.lineTo(point.x, point.y);
                    }
                }
                
                ctx.stroke();
                
                // Ø±Ø³Ù… Ù†Ù‚Ø§Ø· Ù…Ø³ÛŒØ±
                for (let i = 0; i < this.trajectory.length; i += 5) {
                    const point = this.trajectory[i];
                    const alpha = i / this.trajectory.length;
                    
                    ctx.fillStyle = `rgba(0, 242, 254, ${0.3 + alpha * 0.5})`;
                    ctx.beginPath();
                    ctx.arc(point.x, point.y, 3, 0, Math.PI * 2);
                    ctx.fill();
                }
            }
            
            drawRocket() {
                const ctx = this.ctx;
                const width = this.canvasWidth;
                const height = this.canvasHeight;
                
                // Ù…Ø­Ø§Ø³Ø¨Ù‡ Ù…ÙˆÙ‚Ø¹ÛŒØª Ù…ÙˆØ´Ú© Ø¨Ø± Ø§Ø³Ø§Ø³ Ù†Ù…Ø§ÛŒ Ø¯ÙˆØ±Ø¨ÛŒÙ†
                let rocketX, rocketY, rocketScale;
                
                switch (this.cameraView) {
                    case 'launch':
                        rocketX = width / 2;
                        rocketY = height * 0.7 - (this.currentAltitude / 1000);
                        rocketScale = 1 - (this.currentAltitude / 200000);
                        break;
                        
                    case 'follow':
                        rocketX = width / 2;
                        rocketY = height * 0.6;
                        rocketScale = 0.8;
                        break;
                        
                    case 'cockpit':
                        rocketX = width / 2;
                        rocketY = height * 0.7;
                        rocketScale = 1.2;
                        break;
                        
                    case 'orbital':
                        rocketX = width / 2;
                        rocketY = height * 0.5;
                        rocketScale = 0.5;
                        break;
                        
                    default:
                        rocketX = width / 2;
                        rocketY = height * 0.7;
                        rocketScale = 1;
                }
                
                // Ù…Ø­Ø¯ÙˆØ¯ Ú©Ø±Ø¯Ù† Ù…Ù‚ÛŒØ§Ø³
                rocketScale = Math.max(0.3, Math.min(rocketScale, 1.5));
                
                // Ø°Ø®ÛŒØ±Ù‡ ÙˆØ¶Ø¹ÛŒØª Ú©Ø§Ù†ÙˆØ§Ø³
                ctx.save();
                
                // Ø§Ù†ØªÙ‚Ø§Ù„ Ø¨Ù‡ Ù…Ø±Ú©Ø² Ù…ÙˆØ´Ú©
                ctx.translate(rocketX, rocketY);
                ctx.scale(rocketScale, rocketScale);
                
                // Ø±Ø³Ù… Ù…Ø±Ø§Ø­Ù„ Ù…ÙˆØ´Ú©
                const stageCount = this.stages.length;
                const stageHeight = 80;
                const stageWidth = 40;
                
                let currentY = 0;
                
                for (let i = 0; i < stageCount; i++) {
                    const stageIndex = stageCount - i - 1;
                    const stage = this.stages[stageIndex];
                    const stageNumber = stageCount - stageIndex;
                    const isActive = stageNumber === this.currentStage;
                    const isSeparated = stage.isSeparated;
                    
                    if (!isSeparated) {
                        this.drawStage(ctx, 0, currentY, stageWidth, stageHeight, stageNumber, isActive, stage);
                        currentY -= stageHeight;
                    }
                }
                
                // Ø±Ø³Ù… Ø¯Ù…Ø§ØºÙ‡
                this.drawNoseCone(ctx, 0, currentY, stageWidth);
                
                // Ø±Ø³Ù… Ø¨ÙˆØ³ØªØ±Ù‡Ø§
                if (this.selectedBoosterId && this.boosterCount > 0 && this.currentStage === stageCount) {
                    this.drawBoosters(ctx, stageWidth, stageHeight);
                }
                
                // Ø¨Ø§Ø²ÛŒØ§Ø¨ÛŒ ÙˆØ¶Ø¹ÛŒØª Ú©Ø§Ù†ÙˆØ§Ø³
                ctx.restore();
            }
            
            drawStage(ctx, x, y, width, height, stageNumber, isActive, stage) {
                // Ø±Ù†Ú¯ Ù…Ø±Ø­Ù„Ù‡ Ø¨Ø± Ø§Ø³Ø§Ø³ ÙˆØ¶Ø¹ÛŒØª
                let stageColor = '#666';
                if (isActive && this.isFlying) {
                    stageColor = '#00f2fe';
                } else if (stage.isSeparated) {
                    stageColor = '#00b09b';
                } else if (stage.fuelRemaining < 30) {
                    stageColor = '#ffc107';
                } else if (stage.fuelRemaining < 10) {
                    stageColor = '#ff4757';
                }
                
                // Ø¨Ø¯Ù†Ù‡ Ù…Ø±Ø­Ù„Ù‡ Ø¨Ø§ Ú¯Ø±Ø§Ø¯ÛŒØ§Ù†
                const bodyGradient = ctx.createLinearGradient(
                    x - width/2, y,
                    x + width/2, y
                );
                bodyGradient.addColorStop(0, '#333');
                bodyGradient.addColorStop(0.5, stageColor);
                bodyGradient.addColorStop(1, '#333');
                
                ctx.fillStyle = bodyGradient;
                ctx.fillRect(x - width/2, y, width, height);
                
                // Ø­Ø§Ø´ÛŒÙ‡â€ŒÙ‡Ø§ Ùˆ Ø¬Ø²Ø¦ÛŒØ§Øª
                ctx.strokeStyle = '#555';
                ctx.lineWidth = 2;
                ctx.strokeRect(x - width/2, y, width, height);
                
                // Ø®Ø·ÙˆØ· Ø§ÙÙ‚ÛŒ Ø¨Ø±Ø§ÛŒ Ø§ÛŒØ¬Ø§Ø¯ Ø¬Ù„ÙˆÙ‡ 3D
                ctx.strokeStyle = '#777';
                ctx.lineWidth = 1;
                for (let i = 1; i < 4; i++) {
                    ctx.beginPath();
                    ctx.moveTo(x - width/2, y + (height * i/4));
                    ctx.lineTo(x + width/2, y + (height * i/4));
                    ctx.stroke();
                }
                
                // Ø´Ù…Ø§Ø±Ù‡ Ù…Ø±Ø­Ù„Ù‡
                ctx.fillStyle = '#ffffff';
                ctx.font = 'bold 16px Arial';
                ctx.textAlign = 'center';
                ctx.textBaseline = 'middle';
                ctx.fillText(stageNumber, x, y + height/2);
                
                // Ù†ÙˆØ§Ø± Ø³ÙˆØ®Øª
                const fuelBarWidth = width * 0.8;
                const fuelBarHeight = 6;
                const fuelBarX = x - fuelBarWidth/2;
                const fuelBarY = y + height - 15;
                
                ctx.fillStyle = '#333';
                ctx.fillRect(fuelBarX, fuelBarY, fuelBarWidth, fuelBarHeight);
                
                let fuelColor = '#00b09b';
                if (stage.fuelRemaining < 30) fuelColor = '#ffc107';
                if (stage.fuelRemaining < 10) fuelColor = '#ff4757';
                
                ctx.fillStyle = fuelColor;
                ctx.fillRect(fuelBarX, fuelBarY, fuelBarWidth * (stage.fuelRemaining / 100), fuelBarHeight);
                
                // Ù…ÙˆØªÙˆØ±Ù‡Ø§ Ø¯Ø± Ù¾Ø§ÛŒÛŒÙ† Ù…Ø±Ø­Ù„Ù‡
                if (isActive || stageNumber === this.currentStage) {
                    const engineCount = stage.engineCount || 1;
                    const engineWidth = 8;
                    const engineHeight = 15;
                    const engineSpacing = width / (engineCount + 1);
                    
                    for (let i = 1; i <= engineCount; i++) {
                        const engineX = x - width/2 + (engineSpacing * i) - engineWidth/2;
                        const engineY = y + height;
                        
                        ctx.fillStyle = '#444';
                        ctx.fillRect(engineX, engineY, engineWidth, engineHeight);
                        
                        ctx.fillStyle = '#555';
                        ctx.fillRect(engineX, engineY, engineWidth, 3);
                    }
                }
            }
            
            drawNoseCone(ctx, x, y, width) {
                const coneHeight = 60;
                
                // Ù…Ø®Ø±ÙˆØ· Ø¯Ù…Ø§ØºÙ‡
                ctx.fillStyle = '#f00';
                ctx.beginPath();
                ctx.moveTo(x, y - coneHeight);
                ctx.lineTo(x - width/2, y);
                ctx.lineTo(x + width/2, y);
                ctx.closePath();
                ctx.fill();
                
                // Ø­Ø§Ø´ÛŒÙ‡
                ctx.strokeStyle = '#c00';
                ctx.lineWidth = 2;
                ctx.stroke();
                
                // Ø¢Ù†ØªÙ†
                ctx.strokeStyle = '#aaa';
                ctx.lineWidth = 2;
                ctx.beginPath();
                ctx.moveTo(x, y - coneHeight);
                ctx.lineTo(x, y - coneHeight - 20);
                ctx.stroke();
                
                // Ù¾Ø§ÛŒÙ‡ Ø¢Ù†ØªÙ†
                ctx.fillStyle = '#aaa';
                ctx.beginPath();
                ctx.arc(x, y - coneHeight, 3, 0, Math.PI * 2);
                ctx.fill();
            }
            
            drawBoosters(ctx, stageWidth, stageHeight) {
                const boosterCount = Math.min(this.boosterCount, 4);
                const boosterWidth = 25;
                const boosterHeight = 60;
                const boosterSpacing = stageWidth + 30;
                
                for (let i = 0; i < boosterCount; i++) {
                    const side = i % 2 === 0 ? -1 : 1;
                    const position = Math.floor(i / 2);
                    const boosterX = (boosterSpacing * side) + (position * 20 * side);
                    const boosterY = -stageHeight * (this.stages.length - 1) + boosterHeight/2;
                    
                    // Ø¨Ø¯Ù†Ù‡ Ø¨ÙˆØ³ØªØ±
                    ctx.fillStyle = '#ff8a00';
                    ctx.fillRect(boosterX - boosterWidth/2, boosterY - boosterHeight/2, boosterWidth, boosterHeight);
                    
                    // Ø­Ø§Ø´ÛŒÙ‡
                    ctx.strokeStyle = '#ff6b00';
                    ctx.lineWidth = 2;
                    ctx.strokeRect(boosterX - boosterWidth/2, boosterY - boosterHeight/2, boosterWidth, boosterHeight);
                    
                    // Ø®Ø·ÙˆØ· Ø§ÙÙ‚ÛŒ
                    ctx.strokeStyle = '#ff9d33';
                    ctx.lineWidth = 1;
                    for (let j = 1; j < 4; j++) {
                        ctx.beginPath();
                        ctx.moveTo(boosterX - boosterWidth/2, boosterY - boosterHeight/2 + (boosterHeight * j/4));
                        ctx.lineTo(boosterX + boosterWidth/2, boosterY - boosterHeight/2 + (boosterHeight * j/4));
                        ctx.stroke();
                    }
                    
                    // Ø§ØªØµØ§Ù„Ø§Øª Ø¨Ù‡ Ù…ÙˆØ´Ú©
                    ctx.strokeStyle = '#888';
                    ctx.lineWidth = 3;
                    ctx.beginPath();
                    ctx.moveTo(boosterX, boosterY);
                    ctx.lineTo(side * stageWidth/2, boosterY);
                    ctx.stroke();
                }
            }
            
            drawEngineFlame() {
                const ctx = this.ctx;
                const width = this.canvasWidth;
                const height = this.canvasHeight;
                
                // Ù…ÙˆÙ‚Ø¹ÛŒØª Ø´Ø¹Ù„Ù‡
                const rocketX = width / 2;
                const rocketY = height * 0.7 + 100; // Ù¾Ø§ÛŒÛŒÙ† Ù…ÙˆØ´Ú©
                
                // Ø§Ù†Ø¯Ø§Ø²Ù‡ Ø´Ø¹Ù„Ù‡ Ø¨Ø± Ø§Ø³Ø§Ø³ Ú¯Ø§Ø²
                const flameLength = 80 * this.throttle;
                const flameWidth = 40 * this.throttle;
                
                // Ø´Ø¹Ù„Ù‡ Ø§ØµÙ„ÛŒ
                const flameGradient = ctx.createLinearGradient(
                    rocketX, rocketY,
                    rocketX, rocketY + flameLength
                );
                flameGradient.addColorStop(0, '#ffff00');
                flameGradient.addColorStop(0.3, '#ff8c00');
                flameGradient.addColorStop(1, 'rgba(255, 69, 0, 0)');
                
                ctx.fillStyle = flameGradient;
                ctx.beginPath();
                ctx.ellipse(rocketX, rocketY + flameLength/2, flameWidth/2, flameLength/2, 0, 0, Math.PI * 2);
                ctx.fill();
                
                // Ù‡Ø³ØªÙ‡ Ø¯Ø§Øº Ø´Ø¹Ù„Ù‡
                const coreGradient = ctx.createRadialGradient(
                    rocketX, rocketY, 0,
                    rocketX, rocketY, flameWidth/3
                );
                coreGradient.addColorStop(0, '#ffffff');
                coreGradient.addColorStop(1, 'rgba(255, 255, 255, 0)');
                
                ctx.fillStyle = coreGradient;
                ctx.beginPath();
                ctx.arc(rocketX, rocketY, flameWidth/3, 0, Math.PI * 2);
                ctx.fill();
            }
            
            drawParticles() {
                const ctx = this.ctx;
                
                for (const particle of this.particles) {
                    ctx.fillStyle = particle.color;
                    ctx.beginPath();
                    ctx.arc(particle.x, particle.y, particle.size * (particle.life / 0.8), 0, Math.PI * 2);
                    ctx.fill();
                }
            }
            
            drawExplosion() {
                if (!this.explosionActive) return;
                
                const ctx = this.ctx;
                const width = this.canvasWidth;
                const height = this.canvasHeight;
                
                // Ù…ÙˆÙ‚Ø¹ÛŒØª Ø§Ù†ÙØ¬Ø§Ø±
                const explosionX = width / 2;
                const explosionY = height * 0.7 - (this.currentAltitude / 1000);
                
                // Ø´Ø¹Ø§Ø¹ Ø§Ù†ÙØ¬Ø§Ø±
                const explosionRadius = this.explosionTime * 50;
                
                // Ø§Ù†ÙØ¬Ø§Ø± Ø§ØµÙ„ÛŒ
                const explosionGradient = ctx.createRadialGradient(
                    explosionX, explosionY, 0,
                    explosionX, explosionY, explosionRadius
                );
                explosionGradient.addColorStop(0, '#ffffff');
                explosionGradient.addColorStop(0.2, '#ffff00');
                explosionGradient.addColorStop(0.5, '#ff8c00');
                explosionGradient.addColorStop(1, 'rgba(255, 0, 0, 0)');
                
                ctx.fillStyle = explosionGradient;
                ctx.beginPath();
                ctx.arc(explosionX, explosionY, explosionRadius, 0, Math.PI * 2);
                ctx.fill();
                
                // Ù…ÙˆØ¬ Ø§Ù†ÙØ¬Ø§Ø±
                const shockwaveRadius = explosionRadius * 1.5;
                ctx.strokeStyle = `rgba(255, 255, 255, ${1 - this.explosionTime})`;
                ctx.lineWidth = 5;
                ctx.beginPath();
                ctx.arc(explosionX, explosionY, shockwaveRadius, 0, Math.PI * 2);
                ctx.stroke();
                
                // Ø°Ø±Ø§Øª Ø§Ù†ÙØ¬Ø§Ø±
                if (this.explosionTime < 0.5) {
                    for (let i = 0; i < 5; i++) {
                        const angle = Math.random() * Math.PI * 2;
                        const speed = Math.random() * 10 + 5;
                        const size = Math.random() * 10 + 5;
                        
                        ctx.fillStyle = `rgba(255, ${Math.floor(Math.random() * 100 + 100)}, 0, ${1 - this.explosionTime})`;
                        ctx.beginPath();
                        ctx.arc(
                            explosionX + Math.cos(angle) * explosionRadius * 2,
                            explosionY + Math.sin(angle) * explosionRadius * 2,
                            size, 0, Math.PI * 2
                        );
                        ctx.fill();
                    }
                }
                
                // Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ø²Ù…Ø§Ù† Ø§Ù†ÙØ¬Ø§Ø±
                this.explosionTime += 0.02;
                if (this.explosionTime > 1) {
                    this.explosionActive = false;
                }
            }
            
            updateUI() {
                // Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ù…Ù‚Ø§Ø¯ÛŒØ± HUD
                document.getElementById('hudAltitude').textContent = `${(this.currentAltitude / 1000).toFixed(1)} km`;
                document.getElementById('hudVelocity').textContent = `${Math.round(this.currentVelocity)} m/s`;
                document.getElementById('hudDynamicPressure').textContent = `${Math.round(this.dynamicPressure)} kPa`;
                document.getElementById('hudThrottle').textContent = `${Math.round(this.throttle * 100)}%`;
                document.getElementById('hudTemperature').textContent = `${Math.round(this.hullTemperature)}Â°C`;
                
                // Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ ÙˆØ¶Ø¹ÛŒØª Ù…Ø§Ù…ÙˆØ±ÛŒØª
                let missionStatus = 'Ø¢Ù…Ø§Ø¯Ù‡';
                if (this.isLaunching) missionStatus = 'Ø´Ù…Ø§Ø±Ø´ Ù…Ø¹Ú©ÙˆØ³';
                if (this.isFlying) missionStatus = 'Ø¯Ø± Ø­Ø§Ù„ Ù¾Ø±ÙˆØ§Ø²';
                if (this.currentAltitude > 100000) missionStatus = 'Ø®Ø§Ø±Ø¬ Ø§Ø² Ø¬Ùˆ';
                if (this.currentVelocity > 7800) missionStatus = 'Ø³Ø±Ø¹Øª Ù…Ø¯Ø§Ø±ÛŒ';
                document.getElementById('hudMissionStatus').textContent = missionStatus;
                
                // Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ø§Ø³Ù„Ø§ÛŒØ¯Ø± Ú¯Ø§Ø²
                document.getElementById('throttleSlider').value = this.throttle * 100;
                document.getElementById('throttleValue').textContent = `${Math.round(this.throttle * 100)}%`;
                
                // Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ ÙˆØ¶Ø¹ÛŒØª Ù…Ø±Ø§Ø­Ù„
                this.updateStagesUI();
            }
            
            updateStagesUI() {
                const container = document.getElementById('stagesContainer');
                container.innerHTML = '';
                
                for (let i = this.stages.length - 1; i >= 0; i--) {
                    const stage = this.stages[i];
                    const stageNumber = this.stages.length - i;
                    const isActive = stageNumber === this.currentStage;
                    const isSeparated = stage.isSeparated;
                    
                    const stageElement = document.createElement('div');
                    stageElement.className = `stage-item ${isActive ? 'active' : ''}`;
                    
                    let statusText = 'ØºÛŒØ±ÙØ¹Ø§Ù„';
                    let statusClass = '';
                    
                    if (isSeparated) {
                        statusText = 'Ø¬Ø¯Ø§ Ø´Ø¯Ù‡';
                        statusClass = 'status-separated';
                    } else if (isActive && this.isFlying) {
                        statusText = 'ÙØ¹Ø§Ù„';
                        statusClass = 'status-active';
                    }
                    
                    stageElement.innerHTML = `
                        <div class="stage-header">
                            <div class="stage-name">Ù…Ø±Ø­Ù„Ù‡ ${stageNumber}: ${stage.name || 'Ø¨Ø¯ÙˆÙ† Ù†Ø§Ù…'}</div>
                            <div class="stage-status ${statusClass}">${statusText}</div>
                        </div>
                        <div class="stage-details">
                            <div class="detail-item">
                                <span class="detail-label">Ø³ÙˆØ®Øª:</span>
                                <span class="detail-value">${Math.round(stage.fuelRemaining)}%</span>
                            </div>
                            <div class="detail-item">
                                <span class="detail-label">Ù…ÙˆØªÙˆØ±Ù‡Ø§:</span>
                                <span class="detail-value">${stage.engineCount || 1}</span>
                            </div>
                            <div class="detail-item">
                                <span class="detail-label">Ù†ÙˆØ¹ Ø³ÙˆØ®Øª:</span>
                                <span class="detail-value">${this.getFuelName(stage.fuelType)}</span>
                            </div>
                            <div class="detail-item">
                                <span class="detail-label">Ù†ÙˆØ¹ Ù…ÙˆØªÙˆØ±:</span>
                                <span class="detail-value">${this.getMotorName(stage.motorType)}</span>
                            </div>
                        </div>
                        <div class="fuel-bar">
                            <div class="fuel-fill ${stage.fuelRemaining < 30 ? 'low' : ''} ${stage.fuelRemaining < 10 ? 'critical' : ''}" 
                                 style="width: ${stage.fuelRemaining}%"></div>
                        </div>
                    `;
                    
                    container.appendChild(stageElement);
                }
                
                // Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ù†Ø´Ø§Ù†Ú¯Ø± Ù…Ø±Ø§Ø­Ù„
                this.updateStageIndicator();
            }
            
            updateStageIndicator() {
                const container = document.getElementById('stageIndicator');
                container.innerHTML = '';
                
                for (let i = 0; i < this.stages.length; i++) {
                    const stageNumber = this.stages.length - i;
                    const stage = this.stages[i];
                    const isActive = stageNumber === this.currentStage;
                    const isSeparated = stage.isSeparated;
                    
                    const dot = document.createElement('div');
                    dot.className = `stage-dot ${isActive ? 'active' : ''} ${isSeparated ? 'separated' : ''}`;
                    dot.textContent = stageNumber;
                    dot.title = `Ù…Ø±Ø­Ù„Ù‡ ${stageNumber}: ${stage.name || 'Ø¨Ø¯ÙˆÙ† Ù†Ø§Ù…'}`;
                    
                    container.appendChild(dot);
                }
            }
            
            startTelemetryUpdates() {
                this.telemetryUpdateInterval = setInterval(() => {
                    if (this.isFlying) {
                        document.getElementById('telemetryAltitude').textContent = (this.currentAltitude / 1000).toFixed(1);
                        document.getElementById('telemetryVelocity').textContent = Math.round(this.currentVelocity);
                        document.getElementById('telemetryAcceleration').textContent = (this.currentAcceleration / 9.81).toFixed(2);
                        document.getElementById('telemetryFuel').textContent = Math.round(this.currentFuel);
                        document.getElementById('telemetryStage').textContent = this.currentStage;
                        document.getElementById('telemetryTime').textContent = Math.round(this.flightTime);
                    }
                }, 100);
            }
            
            // Ù…ØªØ¯Ù‡Ø§ÛŒ Ú©Ù†ØªØ±Ù„
            
            setThrottle(value) {
                this.throttle = Math.max(0.3, Math.min(value, 1.5));
            }
            
            boostThrust() {
                if (this.isFlying) {
                    this.isBoosting = true;
                    this.isReducing = false;
                    this.throttle = Math.min(1.5, this.throttle + 0.1);
                }
            }
            
            reduceThrust() {
                if (this.isFlying) {
                    this.isReducing = true;
                    this.isBoosting = false;
                    this.throttle = Math.max(0.3, this.throttle - 0.1);
                }
            }
            
            normalThrust() {
                this.isBoosting = false;
                this.isReducing = false;
            }
            
            separateStage() {
                if (!this.canSeparate || this.currentStage <= 1) return;
                
                const currentStageIndex = this.stages.length - this.currentStage;
                this.stages[currentStageIndex].isSeparated = true;
                this.currentStage--;
                
                if (this.currentStage >= 1) {
                    const nextStageIndex = this.stages.length - this.currentStage;
                    this.stages[nextStageIndex].isActive = true;
                    
                    // Ø§ÛŒØ¬Ø§Ø¯ Ø§Ù†ÙØ¬Ø§Ø± Ú©ÙˆÚ†Ú© Ø¨Ø±Ø§ÛŒ Ø¬Ø¯Ø§Ø³Ø§Ø²ÛŒ
                    this.createSeparationExplosion();
                    
                    // Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ UI
                    this.updateStagesUI();
                }
                
                this.canSeparate = false;
            }
            
            createSeparationExplosion() {
                const rocketX = this.canvasWidth / 2;
                const rocketY = this.canvasHeight * 0.7 - (this.currentAltitude / 1000);
                
                for (let i = 0; i < 20; i++) {
                    this.particles.push({
                        x: rocketX + (Math.random() - 0.5) * 50,
                        y: rocketY + (Math.random() - 0.5) * 50,
                        vx: (Math.random() - 0.5) * 10,
                        vy: (Math.random() - 0.5) * 10,
                        size: Math.random() * 6 + 3,
                        color: `rgba(255, ${Math.floor(Math.random() * 100 + 100)}, 0, ${Math.random() * 0.8 + 0.2})`,
                        life: Math.random() * 0.8 + 0.5
                    });
                }
            }
            
            emergencyExplode() {
                if (!this.isFlying && !this.isLaunching) return;
                
                this.explosionActive = true;
                this.explosionTime = 0;
                this.isFlying = false;
                this.isLaunching = false;
                
                // Ø§ÛŒØ¬Ø§Ø¯ Ø°Ø±Ø§Øª Ø§Ù†ÙØ¬Ø§Ø±
                const rocketX = this.canvasWidth / 2;
                const rocketY = this.canvasHeight * 0.7 - (this.currentAltitude / 1000);
                
                for (let i = 0; i < 100; i++) {
                    const angle = Math.random() * Math.PI * 2;
                    const speed = Math.random() * 15 + 5;
                    
                    this.particles.push({
                        x: rocketX,
                        y: rocketY,
                        vx: Math.cos(angle) * speed,
                        vy: Math.sin(angle) * speed,
                        size: Math.random() * 8 + 4,
                        color: `rgba(255, ${Math.floor(Math.random() * 100 + 100)}, 0, ${Math.random() * 0.8 + 0.2})`,
                        life: Math.random() * 1 + 0.5
                    });
                }
                
                this.endFlight("ØªØ®Ø±ÛŒØ¨ Ø§Ø¶Ø·Ø±Ø§Ø±ÛŒ Ù…ÙˆØ´Ú©! ğŸ’¥");
            }
            
            launchRocket() {
                if (this.stages.length === 0) {
                    this.showMessage("Ø®Ø·Ø§", "Ø§Ø¨ØªØ¯Ø§ Ù…Ø±Ø§Ø­Ù„ÛŒ Ø¨Ù‡ Ù…ÙˆØ´Ú© Ø§Ø¶Ø§ÙÙ‡ Ú©Ù†ÛŒØ¯!");
                    return;
                }
                
                if (this.isFlying || this.isLaunching) return;
                
                this.isLaunching = true;
                
                // Ø´Ù…Ø§Ø±Ø´ Ù…Ø¹Ú©ÙˆØ³
                let countdown = 5;
                const countdownInterval = setInterval(() => {
                    if (countdown > 0) {
                        this.showMessage("Ø´Ù…Ø§Ø±Ø´ Ù…Ø¹Ú©ÙˆØ³", `${countdown}...`);
                        countdown--;
                    } else {
                        clearInterval(countdownInterval);
                        this.isLaunching = false;
                        this.isFlying = true;
                        this.closeMessage();
                        
                        // Ù…Ù‚Ø¯Ø§Ø±Ø¯Ù‡ÛŒ Ø§ÙˆÙ„ÛŒÙ‡ Ù…Ø±Ø§Ø­Ù„
                        for (const stage of this.stages) {
                            stage.isActive = false;
                            stage.isSeparated = false;
                            stage.fuelRemaining = 100;
                        }
                        
                        this.stages[this.stages.length - 1].isActive = true;
                        this.currentStage = this.stages.length;
                        
                        // Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ UI
                        this.updateStagesUI();
                    }
                }, 1000);
            }
            
            endFlight(reason) {
                this.isFlying = false;
                
                setTimeout(() => {
                    this.showResult(
                        "Ù¾Ø§ÛŒØ§Ù† Ù…Ø§Ù…ÙˆØ±ÛŒØª",
                        reason,
                        (this.maxAltitude / 1000).toFixed(1) + " km",
                        Math.round(this.maxVelocity) + " m/s",
                        Math.round(this.flightTime) + " s"
                    );
                }, 2000);
            }
            
            showMessage(title, text) {
                document.getElementById('messageTitle').textContent = title;
                document.getElementById('messageText').textContent = text;
                document.getElementById('messageOverlay').classList.add('active');
                this.messageActive = true;
            }
            
            showResult(title, text, altitude, velocity, time) {
                document.getElementById('messageTitle').textContent = title;
                document.getElementById('messageText').textContent = text;
                document.getElementById('statAltitude').textContent = altitude;
                document.getElementById('statVelocity').textContent = velocity;
                document.getElementById('statTime').textContent = time;
                document.getElementById('messageOverlay').classList.add('active');
                this.messageActive = true;
            }
            
            closeMessage() {
                document.getElementById('messageOverlay').classList.remove('active');
                this.messageActive = false;
            }
            
            setCameraView(view) {
                this.cameraView = view;
                
                // Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ø¯Ú©Ù…Ù‡â€ŒÙ‡Ø§ÛŒ Ø¯ÙˆØ±Ø¨ÛŒÙ†
                const buttons = document.querySelectorAll('.camera-btn');
                buttons.forEach(btn => btn.classList.remove('active'));
                
                document.querySelectorAll('.camera-btn').forEach(btn => {
                    if (btn.textContent.includes(
                        view === 'launch' ? 'Ù¾Ø±ØªØ§Ø¨' :
                        view === 'follow' ? 'Ø¯Ù†Ø¨Ø§Ù„â€ŒÚ©Ù†Ù†Ø¯Ù‡' :
                        view === 'cockpit' ? 'Ú©Ø§Ø¨ÛŒÙ†' : 'Ù…Ø¯Ø§Ø±ÛŒ'
                    )) {
                        btn.classList.add('active');
                    }
                });
            }
            
            // Ù…ØªØ¯Ù‡Ø§ÛŒ Ø·Ø±Ø§Ø­ÛŒ Ù…ÙˆØ´Ú©
            
            addStage() {
                if (this.stages.length >= 6) return;
                
                const stageNumber = this.stages.length + 1;
                this.stages.push({
                    id: stageNumber,
                    name: `Ù…Ø±Ø­Ù„Ù‡ ${stageNumber}`,
                    fuelType: 1,
                    motorType: 2,
                    tankSize: 2,
                    engineCount: 1,
                    fuelRemaining: 100,
                    isActive: false,
                    isSeparated: false
                });
                
                this.updateStagesUI();
            }
            
            loadPreset(preset) {
                this.stages = [];
                
                switch(preset) {
                    case 'small':
                        this.addStage();
                        break;
                        
                    case 'medium':
                        this.addStage();
                        this.addStage();
                        break;
                        
                    case 'heavy':
                        this.addStage();
                        this.addStage();
                        this.addStage();
                        this.selectedBoosterId = 1;
                        this.boosterCount = 2;
                        break;
                }
                
                this.updateStagesUI();
            }
            
            resetRocket() {
                this.stages = [];
                this.selectedBoosterId = null;
                this.boosterCount = 0;
                this.updateStagesUI();
            }
            
            saveDesign() {
                const design = {
                    stages: this.stages,
                    selectedBoosterId: this.selectedBoosterId,
                    boosterCount: this.boosterCount
                };
                
                localStorage.setItem('rocketDesign', JSON.stringify(design));
                this.showMessage("Ø°Ø®ÛŒØ±Ù‡ Ø´Ø¯", "Ø·Ø±Ø§Ø­ÛŒ Ù…ÙˆØ´Ú© Ø°Ø®ÛŒØ±Ù‡ Ø´Ø¯.");
            }
            
            loadDesign() {
                const saved = localStorage.getItem('rocketDesign');
                if (saved) {
                    try {
                        const design = JSON.parse(saved);
                        this.stages = design.stages || [];
                        this.selectedBoosterId = design.selectedBoosterId || null;
                        this.boosterCount = design.boosterCount || 0;
                        
                        this.updateStagesUI();
                        this.showMessage("Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø´Ø¯", "Ø·Ø±Ø§Ø­ÛŒ Ù…ÙˆØ´Ú© Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø´Ø¯.");
                    } catch (e) {
                        this.showMessage("Ø®Ø·Ø§", "Ø®Ø·Ø§ Ø¯Ø± Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø·Ø±Ø§Ø­ÛŒ.");
                    }
                } else {
                    this.showMessage("Ø®Ø·Ø§", "Ù‡ÛŒÚ† Ø·Ø±Ø§Ø­ÛŒ Ø°Ø®ÛŒØ±Ù‡â€ŒØ´Ø¯Ù‡â€ŒØ§ÛŒ ÛŒØ§ÙØª Ù†Ø´Ø¯.");
                }
            }
            
            loadSavedDesign() {
                const saved = localStorage.getItem('rocketDesign');
                if (saved) {
                    try {
                        const design = JSON.parse(saved);
                        this.stages = design.stages || [];
                        this.selectedBoosterId = design.selectedBoosterId || null;
                        this.boosterCount = design.boosterCount || 0;
                    } catch (e) {
                        // Ø·Ø±Ø§Ø­ÛŒ Ù¾ÛŒØ´â€ŒÙØ±Ø¶
                        this.loadPreset('medium');
                    }
                } else {
                    this.loadPreset('medium');
                }
            }
            
            getFuelName(id) {
                const fuels = {
                    1: "RP-1/LOX",
                    2: "LH2/LOX",
                    3: "Ø³ÙˆØ®Øª Ø¬Ø§Ù…Ø¯"
                };
                return fuels[id] || "Ù†Ø§Ù…Ø´Ø®Øµ";
            }
            
            getMotorName(id) {
                const motors = {
                    1: "Ú©ÙˆÚ†Ú©",
                    2: "Ù…ØªÙˆØ³Ø·",
                    3: "Ø¨Ø²Ø±Ú¯"
                };
                return motors[id] || "Ù†Ø§Ù…Ø´Ø®Øµ";
            }
            
            handleKeyDown(e) {
                if (this.messageActive) return;
                
                switch(e.key) {
                    case "ArrowUp":
                        this.boostThrust();
                        break;
                    case "ArrowDown":
                        this.reduceThrust();
                        break;
                    case " ":
                        if (this.canSeparate) {
                            this.separateStage();
                            e.preventDefault();
                        }
                        break;
                    case "Escape":
                        this.emergencyExplode();
                        break;
                    case "Enter":
                        this.launchRocket();
                        break;
                }
            }
            
            handleKeyUp(e) {
                if (e.key === "ArrowUp" || e.key === "ArrowDown") {
                    this.normalThrust();
                }
            }
        }
    </script>
</body>
</html>