<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Advanced Textile Factory HVAC Calculator</title>
    <style>
        :root {
            --primary-color: #2c3e50;
            --secondary-color: #3498db;
            --accent-color: #e74c3c;
            --light-color: #ecf0f1;
            --dark-color: #2c3e50;
            --success-color: #27ae60;
            --warning-color: #f39c12;
            --info-color: #2980b9;
            --section-1: #e3f2fd;
            --section-2: #e8f5e9;
            --section-3: #fff3e0;
            --section-4: #fce4ec;
            --section-5: #f3e5f5;
            --section-6: #e0f7fa;
        }
        
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            padding: 15px;
            padding-bottom: 120px;
            background-color: #f9f9f9;
            color: #333;
            line-height: 1.6;
        }
        
        h1, h2, h3, h4 {
            color: var(--primary-color);
            margin-bottom: 15px;
        }
        
        h1 {
            font-size: 1.8rem;
            text-align: center;
            margin-bottom: 20px;
            color: var(--secondary-color);
            border-bottom: 2px solid var(--secondary-color);
            padding-bottom: 10px;
        }
        
        h2 {
            font-size: 1.5rem;
            background: linear-gradient(90deg, var(--primary-color), var(--secondary-color));
            color: white;
            padding: 12px;
            border-radius: 5px;
            margin-top: 20px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        
        h3 {
            font-size: 1.3rem;
            color: var(--secondary-color);
            margin-top: 15px;
            border-left: 4px solid var(--secondary-color);
            padding-left: 10px;
        }
        
        h4 {
            font-size: 1.1rem;
            color: var(--dark-color);
            margin: 10px 0;
        }
        
        .section {
            display: none;
            background-color: white;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 20px;
            border-top: 4px solid;
        }
        
        #section1 {
            border-top-color: var(--section-1);
            background-color: var(--section-1);
        }
        #section2 {
            border-top-color: var(--section-2);
            background-color: var(--section-2);
        }
        #section3 {
            border-top-color: var(--section-3);
            background-color: var(--section-3);
        }
        #section4 {
            border-top-color: var(--section-4);
            background-color: var(--section-4);
        }
        #section5 {
            border-top-color: var(--section-5);
            background-color: var(--section-5);
        }
        #section6 {
            border-top-color: var(--section-6);
            background-color: var(--section-6);
        }
        
        .section.active {
            display: block;
            animation: fadeIn 0.4s ease-out;
        }
        
        .input-group {
            margin-bottom: 15px;
            background-color: rgba(255,255,255,0.7);
            padding: 12px;
            border-radius: 6px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }
        
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
            color: var(--dark-color);
        }
        
        input, select {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 1rem;
            transition: all 0.3s;
            background-color: white;
        }
        
        input:focus, select:focus {
            border-color: var(--secondary-color);
            outline: none;
            box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.2);
        }
        
        button {
            background-color: var(--secondary-color);
            color: white;
            border: none;
            padding: 12px 15px;
            border-radius: 4px;
            cursor: pointer;
            margin-top: 10px;
            font-size: 1rem;
            font-weight: 600;
            transition: all 0.3s;
            width: 100%;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        
        button:hover {
            background-color: #2980b9;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.15);
        }
        
        button:active {
            transform: translateY(0);
        }
        
        .result {
            margin-top: 15px;
            padding: 15px;
            background-color: white;
            border-radius: 4px;
            border-left: 4px solid var(--secondary-color);
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }
        
        .result h4 {
            color: var(--primary-color);
            margin-bottom: 10px;
            border-bottom: 1px solid #eee;
            padding-bottom: 5px;
        }
        
        .navbar {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background-color: var(--primary-color);
            display: flex;
            justify-content: space-around;
            padding: 5px 0;
            box-shadow: 0 -2px 10px rgba(0,0,0,0.2);
            z-index: 1000;
            overflow-x: auto;
            white-space: nowrap;
        }
        
        .nav-item {
            color: white;
            text-align: center;
            padding: 10px 5px;
            cursor: pointer;
            flex: 1;
            font-size: 0.8rem;
            transition: all 0.3s;
            border-radius: 4px;
            margin: 0 2px;
            min-width: 60px;
        }
        
        .nav-item.active {
            background-color: var(--secondary-color);
            transform: translateY(-5px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }
        
        .two-columns {
            display: flex;
            gap: 20px;
        }
        
        .column {
            flex: 1;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 10px;
            font-size: 0.9rem;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }
        
        table, th, td {
            border: 1px solid #ddd;
        }
        
        th, td {
            padding: 8px;
            text-align: left;
        }
        
        th {
            background-color: var(--primary-color);
            color: white;
        }
        
        tr:nth-child(even) {
            background-color: #f2f2f2;
        }
        
        .chart-container {
            width: 100%;
            height: 400px;
            margin: 15px 0;
            position: relative;
            border: 1px solid #ddd;
            border-radius: 4px;
            background-color: white;
            overflow: hidden;
        }
        
        #psychrometricChart {
            width: 100%;
            height: 100%;
        }
        
        .chart-tooltip {
            position: absolute;
            background-color: rgba(255, 255, 255, 0.9);
            border: 1px solid #ddd;
            border-radius: 4px;
            padding: 8px;
            pointer-events: none;
            font-size: 0.9rem;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            z-index: 100;
            display: none;
        }
        
        .info-box {
            background-color: #e8f4fc;
            border-left: 4px solid var(--info-color);
            padding: 10px;
            margin: 10px 0;
            border-radius: 0 4px 4px 0;
        }
        
        .warning-box {
            background-color: #fef5e7;
            border-left: 4px solid var(--warning-color);
            padding: 10px;
            margin: 10px 0;
            border-radius: 0 4px 4px 0;
        }
        
        .success-box {
            background-color: #e8f8ef;
            border-left: 4px solid var(--success-color);
            padding: 10px;
            margin: 10px 0;
            border-radius: 0 4px 4px 0;
        }
        
        .fan-performance-table {
            width: 100%;
            overflow-x: auto;
            margin: 15px 0;
        }
        
        .add-salon-btn {
            background-color: var(--accent-color);
            margin-bottom: 15px;
        }
        
        .salon-input-group {
            border: 1px dashed var(--secondary-color);
            padding: 10px;
            margin-bottom: 15px;
            border-radius: 4px;
            background-color: rgba(255,255,255,0.7);
        }
        
        .remove-salon-btn {
            background-color: #95a5a6;
            margin-top: 5px;
        }
        
        .total-airflow {
            background-color: var(--success-color);
            color: white;
            padding: 15px;
            border-radius: 4px;
            margin-top: 15px;
            text-align: center;
            font-weight: bold;
            font-size: 1.1rem;
        }
        
        .humidity-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }
        
        .humidity-cell {
            background-color: white;
            padding: 10px;
            border-radius: 4px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }
        
        @media (max-width: 1024px) {
            .two-columns {
                flex-direction: column;
            }
            
            .humidity-grid {
                grid-template-columns: 1fr;
            }
        }
        
        @media (max-width: 768px) {
            .nav-item {
                font-size: 0.7rem;
                padding: 8px 2px;
            }
            
            h1 {
                font-size: 1.5rem;
            }
            
            h2 {
                font-size: 1.3rem;
            }
            
            h3 {
                font-size: 1.1rem;
            }
            
            .section {
                padding: 12px;
            }
            
            .chart-container {
                height: 300px;
            }
        }
        
        @media (max-width: 480px) {
            body {
                padding: 10px;
                padding-bottom: 100px;
            }
            
            .section {
                padding: 10px;
            }
            
            .input-group {
                padding: 10px;
            }
            
            .result {
                padding: 10px;
            }
            
            button {
                padding: 10px;
            }
            
            .navbar {
                padding: 5px 0;
            }
            
            .nav-item {
                font-size: 0.65rem;
                padding: 6px 2px;
                min-width: 50px;
            }
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .slider-container {
            margin-top: 10px;
        }
        
        .slider {
            width: 100%;
            height: 8px;
            border-radius: 4px;
            background: #ddd;
            outline: none;
            -webkit-appearance: none;
        }
        
        .slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 18px;
            height: 18px;
            border-radius: 50%;
            background: var(--secondary-color);
            cursor: pointer;
        }
        
        .slider::-moz-range-thumb {
            width: 18px;
            height: 18px;
            border-radius: 50%;
            background: var(--secondary-color);
            cursor: pointer;
        }
        
        .slider-value {
            text-align: center;
            font-weight: bold;
            margin-top: 5px;
            color: var(--dark-color);
        }
        
        .pump-image {
            width: 100%;
            max-width: 300px;
            height: auto;
            margin: 10px auto;
            display: block;
            border-radius: 4px;
        }
    </style>
</head>
<body>
    <h1>Advanced Textile Factory HVAC Design Calculator</h1>
    
    <div class="two-columns">
        <div class="column">
            <div id="section1" class="section active">
                <h2>1. Air Volume Calculation</h2>
                <div class="input-group">
                    <label for="ach">Air Changes per Hour (ACH):</label>
                    <input type="number" id="ach" value="35" min="1" step="0.1">
                    <div class="info-box">
                        <strong>Typical ACH values:</strong> Textile mills 30-50, Spinning 40-60, Weaving 25-40
                    </div>
                </div>
                <div class="input-group">
                    <label for="silosHeight">Silos Height (m):</label>
                    <input type="number" id="silosHeight" step="0.01" min="0">
                </div>
                <div class="input-group">
                    <label for="silosWidth">Silos Width (m):</label>
                    <input type="number" id="silosWidth" step="0.01" min="0">
                </div>
                <div class="input-group">
                    <label for="silosLength">Silos Length (m):</label>
                    <input type="number" id="silosLength" step="0.01" min="0">
                </div>
                <div class="input-group">
                    <label for="machineArea">Area Occupied by Machines (m²):</label>
                    <input type="number" id="machineArea" step="0.01" min="0" value="0">
                    <div class="info-box">
                        Subtract machine area from total floor area for accurate air volume calculation
                    </div>
                </div>
                
                <button class="add-salon-btn" onclick="addSalon()">Add Additional Salon</button>
                
                <div id="salonContainer"></div>
                
                <button onclick="calculateVolume()">Calculate Air Volume</button>
                <div class="result" id="volumeResult"></div>
                <div class="total-airflow" id="totalAirflowResult"></div>
            </div>
            
            <div id="section2" class="section">
                <h2>2. Design Conditions</h2>
                <div class="input-group">
                    <label for="designTemp">Design Temperature (°C):</label>
                    <input type="number" id="designTemp" value="27" step="0.1">
                </div>
                <div class="input-group">
                    <label for="designHumidity">Design Humidity (%RH):</label>
                    <input type="number" id="designHumidity" value="55" min="0" max="100" step="0.1">
                    <div class="info-box">
                        <strong>Textile humidity requirements:</strong> Cotton spinning 50-60%, Weaving 65-75%, Synthetic fibers 45-55%
                    </div>
                </div>
                <div class="input-group">
                    <label for="outsideTemp">Summer Outside Temperature (°C):</label>
                    <input type="number" id="outsideTemp" step="0.1" value="35">
                </div>
                <div class="input-group">
                    <label for="outsideHumidity">Summer Outside Humidity (%RH):</label>
                    <input type="number" id="outsideHumidity" min="0" max="100" step="0.1" value="60">
                </div>
                <div class="input-group">
                    <label for="winterOutsideTemp">Winter Outside Temperature (°C):</label>
                    <input type="number" id="winterOutsideTemp" step="0.1" value="5">
                </div>
                <div class="input-group">
                    <label for="winterOutsideHumidity">Winter Outside Humidity (%RH):</label>
                    <input type="number" id="winterOutsideHumidity" min="0" max="100" step="0.1" value="80">
                </div>
                <div class="input-group">
                    <label for="sunlightHeating">Sunlight Heating (kW):</label>
                    <input type="number" id="sunlightHeating" step="0.1" min="0" value="0">
                    <div class="info-box">
                        Estimate solar heat gain through windows and roof (typically 0.5-2 kW per 100m²)
                    </div>
                </div>
                <div class="input-group">
                    <label for="machinePower">Machinery Heat Generation (kW):</label>
                    <input type="number" id="machinePower" step="0.1" min="0" value="0">
                    <div class="info-box">
                        Total heat output from textile machinery (check equipment specifications)
                    </div>
                </div>
                <button onclick="calculateDesignConditions()">Calculate Psychrometric Data</button>
                <div class="result" id="designResult">
                    <div id="psychrometricResults"></div>
                </div>
            </div>
            
            <div id="section3" class="section">
                <h2>3. Textile Production & Humidification</h2>
                <div class="input-group">
                    <label for="capacity">Production Capacity (ton/day):</label>
                    <input type="number" id="capacity" value="10" step="0.1" min="0">
                </div>
                <div class="input-group">
                    <label for="workHours">Work Hours per Day:</label>
                    <input type="number" id="workHours" value="10" min="1" max="24">
                </div>
                <div class="input-group">
                    <label for="cottonHumidity">Cotton Input Humidity (%):</label>
                    <input type="number" id="cottonHumidity" value="8" min="0" max="100" step="0.1">
                </div>
                <div class="input-group">
                    <label for="humidityLoss">Humidity Loss (%):</label>
                    <input type="number" id="humidityLoss" value="2" min="0" max="100" step="0.1">
                    <div class="info-box">
                        Typical moisture loss: Cotton 1.5-3%, Synthetics 0.5-1.5%
                    </div>
                </div>
                <div class="input-group">
                    <label for="fiberType">Fiber Type:</label>
                    <select id="fiberType">
                        <option value="cotton">Cotton</option>
                        <option value="wool">Wool</option>
                        <option value="synthetic">Synthetic</option>
                        <option value="blend">Blend</option>
                    </select>
                </div>
                <div class="input-group">
                    <label for="pumpType">Humidification Pump Type:</label>
                    <select id="pumpType">
                        <option value="centrifugal">Centrifugal</option>
                        <option value="diaphragm">Diaphragm</option>
                        <option value="piston">Piston</option>
                        <option value="rotary">Rotary</option>
                    </select>
                </div>
                <div class="input-group">
                    <label for="airVelocity">Air Velocity in Humidifier (m/s):</label>
                    <input type="number" id="airVelocity" value="4" min="2" max="6" step="0.1">
                    <div class="info-box">
                        Recommended velocity: 3-5 m/s for optimal humidification efficiency
                    </div>
                </div>
                <button onclick="calculateTextileNeeds()">Calculate Humidification Needs</button>
                <div class="result" id="textileResult"></div>
            </div>
        </div>
        
        <div class="column">
            <div id="section4" class="section">
                <h2>4. Duct & Filter Sizing</h2>
                <div class="input-group">
                    <label for="airflowRate">Airflow Rate (m³/h):</label>
                    <input type="number" id="airflowRate" step="0.1" min="0">
                </div>
                <div class="input-group">
                    <label for="maxDuctVelocity">Max Duct Velocity (m/s):</label>
                    <input type="number" id="maxDuctVelocity" value="6" step="0.1" min="1" max="10">
                    <div class="info-box">
                        <strong>Recommended velocities:</strong> Main ducts 6-8 m/s, Branch ducts 4-6 m/s, Final runs 2-4 m/s
                    </div>
                </div>
                <div class="input-group">
                    <label for="ductShape">Duct Shape:</label>
                    <select id="ductShape">
                        <option value="round">Round</option>
                        <option value="rectangular">Rectangular</option>
                    </select>
                </div>
                <div class="input-group">
                    <label for="ductRatio">Duct Aspect Ratio (W:H):</label>
                    <select id="ductRatio">
                        <option value="1">1:1 (Square)</option>
                        <option value="1.33">4:3</option>
                        <option value="1.77">16:9</option>
                        <option value="2">2:1</option>
                        <option value="3">3:1</option>
                    </select>
                </div>
                <button onclick="calculateDuctSize()">Calculate Duct Size</button>
                <div class="result" id="ductResult"></div>
                
                <h3>Filter Selection</h3>
                <div class="input-group">
                    <label for="filterDiameter">Filter Diameter (mm):</label>
                    <select id="filterDiameter">
                        <option value="2000">2000</option>
                        <option value="2500">2500</option>
                        <option value="3000">3000</option>
                    </select>
                </div>
                <div class="input-group">
                    <label for="filterLength">Filter Length (mm):</label>
                    <select id="filterLength">
                        <option value="1700">1700</option>
                        <option value="3400">3400</option>
                        <option value="5100">5100</option>
                    </select>
                    <div class="info-box">
                        Rotary filters typically have face velocities of 0.8-1.2 m/s for textile applications
                    </div>
                </div>
                <div class="input-group">
                    <label for="filterCount">Number of Filters:</label>
                    <input type="number" id="filterCount" min="1" max="10" value="2">
                </div>
                <div class="input-group">
                    <label for="filterEfficiency">Filter Efficiency (%):</label>
                    <input type="number" id="filterEfficiency" value="85" min="50" max="99" step="1">
                </div>
                <button onclick="calculateFilter()">Calculate Filter Parameters</button>
                <div class="result" id="filterResult"></div>
            </div>
            
            <div id="section5" class="section">
                <h2>5. Fan Selection & Heat Loss Compensation</h2>
                <h3>Feed Air Fans (Luwa 22kW)</h3>
                <div class="input-group">
                    <label for="feedAirflow">Feed Airflow per Fan (m³/h):</label>
                    <input type="number" id="feedAirflow" step="0.1" min="0">
                </div>
                <div class="input-group">
                    <label for="fanBladeAngle">Fan Blade Angle (degrees):</label>
                    <input type="number" id="fanBladeAngle" value="18" min="10" max="30" step="0.5">
                    <div class="slider-container">
                        <input type="range" min="10" max="30" value="18" step="0.5" class="slider" id="fanBladeAngleSlider" oninput="updateFanAngle()">
                        <div class="slider-value" id="fanBladeAngleValue">18°</div>
                    </div>
                    <div class="info-box">
                        <strong>Optimal blade angle for textile applications:</strong> 17-20° (balance between flow and pressure) 
                    </div>
                </div>
                <div class="input-group">
                    <label for="fanDiameter">Fan Diameter (mm):</label>
                    <select id="fanDiameter" onchange="updateFanPerformance()">
                        <option value="1120">1120</option>
                        <option value="1400">1400</option>
                        <option value="1600">1600</option>
                    </select>
                </div>
                <div class="input-group">
                    <label for="fanBladeCount">Number of Blades:</label>
                    <select id="fanBladeCount" onchange="updateFanPerformance()">
                        <option value="5">5</option>
                        <option value="10">10</option>
                    </select>
                </div>
                <div class="input-group">
                    <label for="fanRPM">Motor RPM:</label>
                    <select id="fanRPM" onchange="updateFanPerformance()">
                        <option value="1450">1450 RPM</option>
                        <option value="1500">1500 RPM</option>
                    </select>
                </div>
                <div class="fan-performance-table">
                    <table>
                        <tr>
                            <th>Blade Angle</th>
                            <th>Max Flow (m³/h)</th>
                            <th>Max Pressure (Pa)</th>
                            <th>Efficiency</th>
                            <th>Power (kW)</th>
                        </tr>
                        <tbody id="fanPerformanceTable">
                            <!-- Will be populated by JavaScript -->
                        </tbody>
                    </table>
                </div>
                <div class="chart-container">
                    <div class="chart-placeholder">Fan Performance Curve Will Appear Here</div>
                </div>
                <button onclick="calculateFeedFan()">Calculate Feed Fan Parameters</button>
                <div class="result" id="feedFanResult"></div>
                
                <h3>Return Air Fans (30kW)</h3>
                <div class="input-group">
                    <label for="returnAirflow">Return Airflow per Fan (m³/h):</label>
                    <input type="number" id="returnAirflow" step="0.1" min="0">
                </div>
                <div class="input-group">
                    <label for="pressureDrop">System Pressure Drop (Pa):</label>
                    <input type="number" id="pressureDrop" step="1" min="0" value="800">
                    <div class="info-box">
                        Typical pressure drops: Filters 150-300 Pa, Ducts 200-500 Pa, Dampers 50-150 Pa
                    </div>
                </div>
                <div class="input-group">
                    <label for="returnFanDiameter">Fan Diameter (mm):</label>
                    <select id="returnFanDiameter">
                        <option value="1120">1120</option>
                        <option value="1400">1400</option>
                        <option value="1600">1600</option>
                    </select>
                </div>
                <button onclick="calculateReturnFan()">Calculate Return Fan</button>
                <div class="result" id="returnFanResult"></div>
                
                <h3>Winter Heat Loss Compensation</h3>
                <div class="input-group">
                    <label for="siloUValue">Silo U-value (W/m²K):</label>
                    <input type="number" id="siloUValue" value="1.2" step="0.1" min="0.1">
                    <div class="info-box">
                        Typical U-values: Uninsulated concrete 2.5, Insulated walls 0.6-1.5, Well-insulated 0.3-0.6
                    </div>
                </div>
                <div class="input-group">
                    <label for="operatingHours">Daily Operating Hours in Winter:</label>
                    <input type="number" id="operatingHours" value="10" min="1" max="24">
                </div>
                <button onclick="calculateHeatLoss()">Calculate Heat Loss & Compensation</button>
                <div class="result" id="heatLossResult"></div>
            </div>
            
            <div id="section6" class="section">
                <h2>6. Psychrometric Analysis</h2>
                <div class="input-group">
                    <label for="currentTemp">Current Temperature (°C):</label>
                    <input type="number" id="currentTemp" value="25" step="0.1">
                </div>
                <div class="input-group">
                    <label for="currentHumidity">Current Humidity (%RH):</label>
                    <input type="number" id="currentHumidity" value="50" min="0" max="100" step="0.1">
                </div>
                <button onclick="updatePsychrometricChart()">Update Chart</button>
                
                <div class="chart-container">
                    <canvas id="psychrometricChart"></canvas>
                    <div class="chart-tooltip" id="psychroTooltip"></div>
                </div>
                
                <div class="result">
                    <h4>Psychrometric Properties</h4>
                    <div class="humidity-grid">
                        <div class="humidity-cell">
                            <strong>Dew Point:</strong> <span id="dewPointValue">--</span> °C
                        </div>
                        <div class="humidity-cell">
                            <strong>Wet Bulb:</strong> <span id="wetBulbValue">--</span> °C
                        </div>
                        <div class="humidity-cell">
                            <strong>Humidity Ratio:</strong> <span id="humidityRatioValue">--</span> g/kg
                        </div>
                        <div class="humidity-cell">
                            <strong>Enthalpy:</strong> <span id="enthalpyValue">--</span> kJ/kg
                        </div>
                        <div class="humidity-cell">
                            <strong>Specific Volume:</strong> <span id="specificVolumeValue">--</span> m³/kg
                        </div>
                        <div class="humidity-cell">
                            <strong>Vapor Pressure:</strong> <span id="vaporPressureValue">--</span> kPa
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <div class="navbar">
        <div class="nav-item active" onclick="showSection(1)">Air Volume</div>
        <div class="nav-item" onclick="showSection(2)">Conditions</div>
        <div class="nav-item" onclick="showSection(3)">Humidification</div>
        <div class="nav-item" onclick="showSection(4)">Duct & Filter</div>
        <div class="nav-item" onclick="showSection(5)">Fans & Heat</div>
        <div class="nav-item" onclick="showSection(6)">Psychrometric</div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-annotation"></script>
    <script>
        // Navigation functions
        function showSection(sectionNumber) {
            // Hide all sections
            document.querySelectorAll('.section').forEach(section => {
                section.classList.remove('active');
            });
            
            // Show selected section
            document.getElementById('section' + sectionNumber).classList.add('active');
            
            // Update active nav item
            document.querySelectorAll('.nav-item').forEach(item => {
                item.classList.remove('active');
            });
            
            document.querySelectorAll('.nav-item')[sectionNumber - 1].classList.add('active');
            
            // Special handling for psychrometric chart
            if (sectionNumber === 6) {
                updatePsychrometricChart();
            }
        }
        
        // Salon management
        let salonCount = 0;
        
        function addSalon() {
            salonCount++;
            const salonDiv = document.createElement('div');
            salonDiv.className = 'salon-input-group';
            salonDiv.id = `salon-${salonCount}`;
            
            salonDiv.innerHTML = `
                <h4>Salon ${salonCount}</h4>
                <div class="input-group">
                    <label for="salonHeight${salonCount}">Salon Height (m):</label>
                    <input type="number" id="salonHeight${salonCount}" step="0.01" min="0">
                </div>
                <div class="input-group">
                    <label for="salonWidth${salonCount}">Salon Width (m):</label>
                    <input type="number" id="salonWidth${salonCount}" step="0.01" min="0">
                </div>
                <div class="input-group">
                    <label for="salonLength${salonCount}">Salon Length (m):</label>
                    <input type="number" id="salonLength${salonCount}" step="0.01" min="0">
                </div>
                <div class="input-group">
                    <label for="salonACH${salonCount}">Salon ACH:</label>
                    <input type="number" id="salonACH${salonCount}" value="35" min="1" step="0.1">
                </div>
                <button class="remove-salon-btn" onclick="removeSalon(${salonCount})">Remove Salon</button>
            `;
            
            document.getElementById('salonContainer').appendChild(salonDiv);
        }
        
        function removeSalon(id) {
            const salonToRemove = document.getElementById(`salon-${id}`);
            if (salonToRemove) {
                salonToRemove.remove();
            }
        }
        
        // Calculation functions
        function calculateVolume() {
            // Main silos calculation
            const ach = parseFloat(document.getElementById('ach').value);
            const height = parseFloat(document.getElementById('silosHeight').value);
            const width = parseFloat(document.getElementById('silosWidth').value);
            const length = parseFloat(document.getElementById('silosLength').value);
            const machineArea = parseFloat(document.getElementById('machineArea').value) || 0;
            
            if (isNaN(height) || isNaN(width) || isNaN(length)) {
                alert('Please enter valid dimensions for main silos');
                return;
            }
            
            const totalArea = width * length;
            const effectiveArea = totalArea - machineArea;
            const volume = height * effectiveArea;
            const airflowRate = volume * ach;
            
            // Salon calculations
            let salonAirflows = [];
            let salonHTML = '';
            let totalSalonAirflow = 0;
            
            for (let i = 1; i <= salonCount; i++) {
                const salonHeight = parseFloat(document.getElementById(`salonHeight${i}`)?.value);
                const salonWidth = parseFloat(document.getElementById(`salonWidth${i}`)?.value);
                const salonLength = parseFloat(document.getElementById(`salonLength${i}`)?.value);
                const salonACH = parseFloat(document.getElementById(`salonACH${i}`)?.value);
                
                if (!isNaN(salonHeight) && !isNaN(salonWidth) && !isNaN(salonLength) && !isNaN(salonACH)) {
                    const salonVolume = salonHeight * salonWidth * salonLength;
                    const salonAirflow = salonVolume * salonACH;
                    salonAirflows.push(salonAirflow);
                    totalSalonAirflow += salonAirflow;
                    
                    salonHTML += `
                        <p><strong>Salon ${i} Airflow:</strong> ${salonAirflow.toFixed(2)} m³/h (${(salonAirflow/3600).toFixed(2)} m³/s)</p>
                    `;
                }
            }
            
            // Total airflow calculation
            const totalAirflow = airflowRate + totalSalonAirflow;
            
            document.getElementById('volumeResult').innerHTML = `
                <h4>Main Silos Results</h4>
                <p><strong>Total Area:</strong> ${totalArea.toFixed(2)} m²</p>
                <p><strong>Effective Area (minus machines):</strong> ${effectiveArea.toFixed(2)} m²</p>
                <p><strong>Volume:</strong> ${volume.toFixed(2)} m³</p>
                <p><strong>Airflow Rate:</strong> ${airflowRate.toFixed(2)} m³/h (${(airflowRate/3600).toFixed(2)} m³/s)</p>
                
                ${salonCount > 0 ? `<h4>Salon Airflows</h4>${salonHTML}` : ''}
            `;
            
            document.getElementById('totalAirflowResult').innerHTML = `
                <strong>Total System Airflow:</strong> ${totalAirflow.toFixed(2)} m³/h (${(totalAirflow/3600).toFixed(2)} m³/s)
            `;
            
            // Update airflow rate in other sections
            document.getElementById('airflowRate').value = totalAirflow.toFixed(2);
            document.getElementById('feedAirflow').value = (totalAirflow / 2).toFixed(2);
            document.getElementById('returnAirflow').value = (totalAirflow / 2).toFixed(2);
        }
        
        function calculateDesignConditions() {
            const designTemp = parseFloat(document.getElementById('designTemp').value);
            const designHumidity = parseFloat(document.getElementById('designHumidity').value);
            const outsideTemp = parseFloat(document.getElementById('outsideTemp').value);
            const outsideHumidity = parseFloat(document.getElementById('outsideHumidity').value);
            const winterOutsideTemp = parseFloat(document.getElementById('winterOutsideTemp').value);
            const winterOutsideHumidity = parseFloat(document.getElementById('winterOutsideHumidity').value);
            const sunlightHeating = parseFloat(document.getElementById('sunlightHeating').value) || 0;
            const machinePower = parseFloat(document.getElementById('machinePower').value) || 0;
            
            if (isNaN(designTemp) || isNaN(designHumidity) || isNaN(outsideTemp) || isNaN(outsideHumidity) || 
                isNaN(winterOutsideTemp) || isNaN(winterOutsideHumidity)) {
                alert('Please enter all values');
                return;
            }
            
            // Psychrometric calculations (simplified)
            // Summer conditions
            const designEnthalpy = calculateEnthalpy(designTemp, designHumidity);
            const outsideEnthalpy = calculateEnthalpy(outsideTemp, outsideHumidity);
            const summerHeatNeeded = designEnthalpy - outsideEnthalpy;
            
            // Winter conditions
            const winterOutsideEnthalpy = calculateEnthalpy(winterOutsideTemp, winterOutsideHumidity);
            const winterHeatNeeded = designEnthalpy - winterOutsideEnthalpy;
            
            // Dew point calculations
            const designDewPoint = calculateDewPoint(designTemp, designHumidity);
            const outsideDewPoint = calculateDewPoint(outsideTemp, outsideHumidity);
            const winterDewPoint = calculateDewPoint(winterOutsideTemp, winterOutsideHumidity);
            
            // Humidity ratio (g/kg)
            const designHumidityRatio = calculateHumidityRatio(designTemp, designHumidity);
            const outsideHumidityRatio = calculateHumidityRatio(outsideTemp, outsideHumidity);
            const winterHumidityRatio = calculateHumidityRatio(winterOutsideTemp, winterOutsideHumidity);
            
            // Wet bulb calculations
            const designWetBulb = calculateWetBulb(designTemp, designHumidity);
            const outsideWetBulb = calculateWetBulb(outsideTemp, outsideHumidity);
            const winterWetBulb = calculateWetBulb(winterOutsideTemp, winterOutsideHumidity);
            
            document.getElementById('psychrometricResults').innerHTML = `
                <h4>Summer Conditions</h4>
                <p><strong>Design Enthalpy:</strong> ${designEnthalpy.toFixed(2)} kJ/kg</p>
                <p><strong>Outside Enthalpy:</strong> ${outsideEnthalpy.toFixed(2)} kJ/kg</p>
                <p><strong>Cooling Needed:</strong> ${summerHeatNeeded.toFixed(2)} kJ/kg</p>
                <p><strong>Design Dew Point:</strong> ${designDewPoint.toFixed(2)} °C</p>
                <p><strong>Outside Dew Point:</strong> ${outsideDewPoint.toFixed(2)} °C</p>
                <p><strong>Design Humidity Ratio:</strong> ${designHumidityRatio.toFixed(2)} g/kg</p>
                <p><strong>Outside Humidity Ratio:</strong> ${outsideHumidityRatio.toFixed(2)} g/kg</p>
                <p><strong>Design Wet Bulb:</strong> ${designWetBulb.toFixed(2)} °C</p>
                <p><strong>Outside Wet Bulb:</strong> ${outsideWetBulb.toFixed(2)} °C</p>
                
                <h4>Winter Conditions</h4>
                <p><strong>Winter Outside Enthalpy:</strong> ${winterOutsideEnthalpy.toFixed(2)} kJ/kg</p>
                <p><strong>Heating Needed:</strong> ${winterHeatNeeded.toFixed(2)} kJ/kg</p>
                <p><strong>Winter Dew Point:</strong> ${winterDewPoint.toFixed(2)} °C</p>
                <p><strong>Winter Humidity Ratio:</strong> ${winterHumidityRatio.toFixed(2)} g/kg</p>
                <p><strong>Winter Wet Bulb:</strong> ${winterWetBulb.toFixed(2)} °C</p>
                
                <h4>Additional Heat Sources</h4>
                <p><strong>Sunlight Heating:</strong> ${sunlightHeating.toFixed(2)} kW</p>
                <p><strong>Machinery Heat:</strong> ${machinePower.toFixed(2)} kW</p>
                <p><strong>Total Additional Heat:</strong> ${(sunlightHeating + machinePower).toFixed(2)} kW</p>
                
                <div class="warning-box">
                    <strong>Winter Warning:</strong> Ensure surface temperatures stay above ${winterDewPoint.toFixed(1)}°C to prevent condensation
                </div>
            `;
            
            // Update psychrometric chart if visible
            if (document.getElementById('section6').classList.contains('active')) {
                updatePsychrometricChart();
            }
        }
        
        function calculateTextileNeeds() {
            const capacity = parseFloat(document.getElementById('capacity').value);
            const workHours = parseFloat(document.getElementById('workHours').value);
            const cottonHumidity = parseFloat(document.getElementById('cottonHumidity').value);
            const humidityLoss = parseFloat(document.getElementById('humidityLoss').value);
            const fiberType = document.getElementById('fiberType').value;
            const pumpType = document.getElementById('pumpType').value;
            const airVelocity = parseFloat(document.getElementById('airVelocity').value);
            
            if (isNaN(capacity) || isNaN(workHours) || isNaN(cottonHumidity) || isNaN(humidityLoss) || isNaN(airVelocity)) {
                alert('Please enter all values');
                return;
            }
            
            const hourlyCapacity = capacity / workHours;
            const waterLoss = hourlyCapacity * (humidityLoss / 100);
            const vaporNeeded = waterLoss * 1000; // Convert to kg/h
            
            // Fiber specific adjustments
            let fiberFactor = 1;
            let idealRH = "55-60%";
            switch(fiberType) {
                case "cotton":
                    fiberFactor = 1.0;
                    idealRH = "50-65%";
                    break;
                case "wool":
                    fiberFactor = 1.2;
                    idealRH = "60-70%";
                    break;
                case "synthetic":
                    fiberFactor = 0.8;
                    idealRH = "45-55%";
                    break;
                case "blend":
                    fiberFactor = 0.9;
                    idealRH = "50-60%";
                    break;
            }
            
            // Pump type adjustments
            let pumpEfficiency = 0.7;
            let pumpPower = 0;
            let pumpImage = '';
            let pumpPipeSize = 0;
            let pumpInletSize = 0;
            let pumpOutletSize = 0;
            
            // Humidifier sizing based on air velocity
            const airflowRate = parseFloat(document.getElementById('airflowRate').value) || 10000; // Default 10,000 m³/h if not set
            const airflowM3s = airflowRate / 3600;
            const humidifierArea = airflowM3s / airVelocity;
            const humidifierDiameter = Math.sqrt((4 * humidifierArea) / Math.PI) * 1000; // in mm
            const humidifierLength = humidifierDiameter * 1.5; // Typical aspect ratio
            
            // Pump calculations based on industry standards
            switch(pumpType) {
                case "centrifugal":
                    pumpEfficiency = 0.75;
                    pumpPower = vaporNeeded * 0.02;
                    pumpImage = 'https://example.com/pump-centrifugal.jpg';
                    pumpPipeSize = Math.max(25, Math.min(100, Math.sqrt(vaporNeeded / 10) * 10));
                    pumpInletSize = pumpPipeSize * 1.25;
                    pumpOutletSize = pumpPipeSize;
                    break;
                case "diaphragm":
                    pumpEfficiency = 0.65;
                    pumpPower = vaporNeeded * 0.025;
                    pumpImage = 'https://example.com/pump-diaphragm.jpg';
                    pumpPipeSize = Math.max(20, Math.min(80, Math.sqrt(vaporNeeded / 15) * 10));
                    pumpInletSize = pumpPipeSize;
                    pumpOutletSize = pumpPipeSize;
                    break;
                case "piston":
                    pumpEfficiency = 0.6;
                    pumpPower = vaporNeeded * 0.03;
                    pumpImage = 'https://example.com/pump-piston.jpg';
                    pumpPipeSize = Math.max(15, Math.min(50, Math.sqrt(vaporNeeded / 20) * 10));
                    pumpInletSize = pumpPipeSize * 1.5;
                    pumpOutletSize = pumpPipeSize;
                    break;
                case "rotary":
                    pumpEfficiency = 0.7;
                    pumpPower = vaporNeeded * 0.022;
                    pumpImage = 'https://example.com/pump-rotary.jpg';
                    pumpPipeSize = Math.max(20, Math.min(70, Math.sqrt(vaporNeeded / 12) * 10));
                    pumpInletSize = pumpPipeSize * 1.2;
                    pumpOutletSize = pumpPipeSize;
                    break;
            }
            
            const adjustedVaporNeeded = vaporNeeded * fiberFactor;
            const pumpPowerRequired = pumpPower / pumpEfficiency;
            
            document.getElementById('textileResult').innerHTML = `
                <h4>Textile Humidification Requirements</h4>
                <p><strong>Hourly Capacity:</strong> ${hourlyCapacity.toFixed(2)} ton/h</p>
                <p><strong>Water Loss:</strong> ${waterLoss.toFixed(2)} ton/h</p>
                <p><strong>Base Humidification Needed:</strong> ${vaporNeeded.toFixed(2)} kg/h</p>
                <p><strong>Adjusted for ${fiberType} fibers:</strong> ${adjustedVaporNeeded.toFixed(2)} kg/h</p>
                
                <h4>Humidifier Sizing</h4>
                <p><strong>Airflow Velocity:</strong> ${airVelocity.toFixed(1)} m/s</p>
                <p><strong>Required Cross-Sectional Area:</strong> ${humidifierArea.toFixed(3)} m²</p>
                <p><strong>Recommended Diameter:</strong> ${humidifierDiameter.toFixed(0)} mm</p>
                <p><strong>Recommended Length:</strong> ${humidifierLength.toFixed(0)} mm</p>
                
                <h4>Pump Specifications (${pumpType})</h4>
                <p><strong>Pump Power Required:</strong> ${pumpPowerRequired.toFixed(2)} kW</p>
                <p><strong>Pump Efficiency:</strong> ${(pumpEfficiency*100).toFixed(0)}%</p>
                <p><strong>Inlet Pipe Size:</strong> ${pumpInletSize.toFixed(0)} mm</p>
                <p><strong>Outlet Pipe Size:</strong> ${pumpOutletSize.toFixed(0)} mm</p>
                
                ${pumpImage ? `<img src="${pumpImage}" alt="${pumpType} pump" class="pump-image">` : ''}
                
                <div class="info-box">
                    <strong>Ideal RH for ${fiberType}:</strong> ${idealRH}
                </div>
                <div class="warning-box">
                    <strong>Note:</strong> Actual humidification may need adjustment based on process measurements
                </div>
            `;
        }
        
        function calculateDuctSize() {
            const airflowRate = parseFloat(document.getElementById('airflowRate').value);
            const maxVelocity = parseFloat(document.getElementById('maxDuctVelocity').value);
            const ductShape = document.getElementById('ductShape').value;
            const ductRatio = parseFloat(document.getElementById('ductRatio').value);
            
            if (isNaN(airflowRate) || isNaN(maxVelocity)) {
                alert('Please enter valid values');
                return;
            }
            
            const airflowM3s = airflowRate / 3600; // Convert to m³/s
            let ductSize, ductArea;
            
            if (ductShape === "round") {
                ductArea = airflowM3s / maxVelocity;
                const ductDiameter = Math.sqrt((4 * ductArea) / Math.PI) * 1000; // in mm
                ductSize = `${ductDiameter.toFixed(0)} mm diameter`;
                
                // Calculate actual velocity
                const actualVelocity = airflowM3s / (Math.PI * Math.pow(ductDiameter/1000/2, 2));
                
                document.getElementById('ductResult').innerHTML = `
                    <h4>Round Duct Results</h4>
                    <p><strong>Airflow:</strong> ${(airflowM3s).toFixed(2)} m³/s</p>
                    <p><strong>Required Duct Area:</strong> ${ductArea.toFixed(4)} m²</p>
                    <p><strong>Recommended Duct Diameter:</strong> ${ductDiameter.toFixed(0)} mm</p>
                    <p><strong>Actual Air Velocity:</strong> ${actualVelocity.toFixed(2)} m/s</p>
                    <div class="${actualVelocity > 8 ? 'warning-box' : 'success-box'}">
                        ${actualVelocity > 8 ? 'Warning: Velocity exceeds recommended maximum (8 m/s)' : 'Velocity within acceptable range'}
                    </div>
                `;
            } else {
                // Rectangular duct
                ductArea = airflowM3s / maxVelocity;
                let ductHeight, ductWidth;
                
                if (ductRatio === 1) {
                    // Square duct
                    ductHeight = Math.sqrt(ductArea) * 1000;
                    ductWidth = ductHeight;
                } else {
                    // Rectangular with specified ratio
                    ductHeight = Math.sqrt(ductArea / ductRatio) * 1000;
                    ductWidth = ductHeight * ductRatio;
                }
                
                ductSize = `${ductWidth.toFixed(0)} × ${ductHeight.toFixed(0)} mm`;
                
                // Calculate actual velocity
                const actualVelocity = airflowM3s / ((ductWidth/1000) * (ductHeight/1000));
                
                document.getElementById('ductResult').innerHTML = `
                    <h4>Rectangular Duct Results</h4>
                    <p><strong>Airflow:</strong> ${(airflowM3s).toFixed(2)} m³/s</p>
                    <p><strong>Required Duct Area:</strong> ${ductArea.toFixed(4)} m²</p>
                    <p><strong>Recommended Duct Size (${ductRatio === 1 ? 'Square' : ductRatio.toFixed(2)+':1'} aspect):</strong> ${ductWidth.toFixed(0)} × ${ductHeight.toFixed(0)} mm</p>
                    <p><strong>Actual Air Velocity:</strong> ${actualVelocity.toFixed(2)} m/s</p>
                    <div class="${actualVelocity > 8 ? 'warning-box' : 'success-box'}">
                        ${actualVelocity > 8 ? 'Warning: Velocity exceeds recommended maximum (8 m/s)' : 'Velocity within acceptable range'}
                    </div>
                `;
            }
        }
        
        function calculateFilter() {
            const airflowRate = parseFloat(document.getElementById('airflowRate').value);
            const diameter = parseFloat(document.getElementById('filterDiameter').value);
            const length = parseFloat(document.getElementById('filterLength').value);
            const efficiency = parseFloat(document.getElementById('filterEfficiency').value);
            const filterCount = parseInt(document.getElementById('filterCount').value);
            
            if (isNaN(airflowRate) || isNaN(diameter) || isNaN(length) || isNaN(filterCount)) {
                alert('Please enter valid values');
                return;
            }
            
            const filterArea = Math.PI * (diameter / 1000) * (length / 1000); // m²
            const totalFilterArea = filterArea * filterCount;
            const velocity = (airflowRate / 3600) / totalFilterArea;
            
            document.getElementById('filterResult').innerHTML = `
                <h4>Filter Calculation Results</h4>
                <p><strong>Single Filter Area:</strong> ${filterArea.toFixed(2)} m² (${diameter}mm × ${length}mm)</p>
                <p><strong>Total Filter Area (${filterCount} filters):</strong> ${totalFilterArea.toFixed(2)} m²</p>
                <p><strong>Air Velocity:</strong> ${velocity.toFixed(2)} m/s (${(velocity*100).toFixed(0)}% of max)</p>
                <p><strong>Filter Efficiency:</strong> ${efficiency}%</p>
                <div class="${velocity > 0.93 ? 'warning-box' : 'success-box'}">
                    ${velocity > 0.93 ? 'Warning: Velocity exceeds recommended maximum (0.93 m/s)' : 'Velocity within acceptable range'}
                </div>
                <div class="info-box">
                    <strong>Recommendation:</strong> Use ${filterCount} × ${diameter}mm × ${length}mm rotary filters
                </div>
            `;
        }
        
        // Fan performance data based on Luwa standards 
        const fanPerformanceData = {
            "1120": {
                "5": {
                    "1450": {
                        "10": { flow: 18000, pressure: 450, efficiency: 72, power: 15 },
                        "15": { flow: 22000, pressure: 600, efficiency: 78, power: 18 },
                        "20": { flow: 25000, pressure: 750, efficiency: 82, power: 20 },
                        "25": { flow: 27000, pressure: 900, efficiency: 80, power: 22 },
                        "30": { flow: 28000, pressure: 1050, efficiency: 77, power: 24 }
                    },
                    "1500": {
                        "10": { flow: 18500, pressure: 480, efficiency: 73, power: 15.5 },
                        "15": { flow: 22500, pressure: 630, efficiency: 79, power: 18.5 },
                        "20": { flow: 25500, pressure: 780, efficiency: 83, power: 20.5 },
                        "25": { flow: 27500, pressure: 930, efficiency: 81, power: 22.5 },
                        "30": { flow: 28500, pressure: 1080, efficiency: 78, power: 24.5 }
                    }
                },
                "10": {
                    "1450": {
                        "10": { flow: 20000, pressure: 500, efficiency: 75, power: 16 },
                        "15": { flow: 24000, pressure: 650, efficiency: 80, power: 19 },
                        "20": { flow: 27000, pressure: 800, efficiency: 84, power: 21 },
                        "25": { flow: 29000, pressure: 950, efficiency: 82, power: 23 },
                        "30": { flow: 30000, pressure: 1100, efficiency: 79, power: 25 }
                    },
                    "1500": {
                        "10": { flow: 20500, pressure: 530, efficiency: 76, power: 16.5 },
                        "15": { flow: 24500, pressure: 680, efficiency: 81, power: 19.5 },
                        "20": { flow: 27500, pressure: 830, efficiency: 85, power: 21.5 },
                        "25": { flow: 29500, pressure: 980, efficiency: 83, power: 23.5 },
                        "30": { flow: 30500, pressure: 1130, efficiency: 80, power: 25.5 }
                    }
                }
            },
            "1400": {
                "5": {
                    "1450": {
                        "10": { flow: 22000, pressure: 500, efficiency: 74, power: 18 },
                        "15": { flow: 26000, pressure: 650, efficiency: 80, power: 21 },
                        "20": { flow: 29000, pressure: 800, efficiency: 84, power: 23 },
                        "25": { flow: 31000, pressure: 950, efficiency: 82, power: 25 },
                        "30": { flow: 32000, pressure: 1100, efficiency: 79, power: 27 }
                    },
                    "1500": {
                        "10": { flow: 22500, pressure: 530, efficiency: 75, power: 18.5 },
                        "15": { flow: 26500, pressure: 680, efficiency: 81, power: 21.5 },
                        "20": { flow: 29500, pressure: 830, efficiency: 85, power: 23.5 },
                        "25": { flow: 31500, pressure: 980, efficiency: 83, power: 25.5 },
                        "30": { flow: 32500, pressure: 1130, efficiency: 80, power: 27.5 }
                    }
                },
                "10": {
                    "1450": {
                        "10": { flow: 24000, pressure: 550, efficiency: 77, power: 19 },
                        "15": { flow: 28000, pressure: 700, efficiency: 82, power: 22 },
                        "20": { flow: 31000, pressure: 850, efficiency: 86, power: 24 },
                        "25": { flow: 33000, pressure: 1000, efficiency: 84, power: 26 },
                        "30": { flow: 34000, pressure: 1150, efficiency: 81, power: 28 }
                    },
                    "1500": {
                        "10": { flow: 24500, pressure: 580, efficiency: 78, power: 19.5 },
                        "15": { flow: 28500, pressure: 730, efficiency: 83, power: 22.5 },
                        "20": { flow: 31500, pressure: 880, efficiency: 87, power: 24.5 },
                        "25": { flow: 33500, pressure: 1030, efficiency: 85, power: 26.5 },
                        "30": { flow: 34500, pressure: 1180, efficiency: 80, power: 28.5 }
                    }
                }
            },
            "1600": {
                "5": {
                    "1450": {
                        "10": { flow: 26000, pressure: 550, efficiency: 76, power: 20 },
                        "15": { flow: 30000, pressure: 700, efficiency: 82, power: 23 },
                        "20": { flow: 33000, pressure: 850, efficiency: 86, power: 25 },
                        "25": { flow: 35000, pressure: 1000, efficiency: 84, power: 27 },
                        "30": { flow: 36000, pressure: 1150, efficiency: 81, power: 29 }
                    },
                    "1500": {
                        "10": { flow: 26500, pressure: 580, efficiency: 77, power: 20.5 },
                        "15": { flow: 30500, pressure: 730, efficiency: 83, power: 23.5 },
                        "20": { flow: 33500, pressure: 880, efficiency: 87, power: 25.5 },
                        "25": { flow: 35500, pressure: 1030, efficiency: 85, power: 27.5 },
                        "30": { flow: 36500, pressure: 1180, efficiency: 80, power: 29.5 }
                    }
                },
                "10": {
                    "1450": {
                        "10": { flow: 28000, pressure: 600, efficiency: 79, power: 21 },
                        "15": { flow: 32000, pressure: 750, efficiency: 84, power: 24 },
                        "20": { flow: 35000, pressure: 900, efficiency: 88, power: 26 },
                        "25": { flow: 37000, pressure: 1050, efficiency: 86, power: 28 },
                        "30": { flow: 38000, pressure: 1200, efficiency: 81, power: 30 }
                    },
                    "1500": {
                        "10": { flow: 28500, pressure: 630, efficiency: 80, power: 21.5 },
                        "15": { flow: 32500, pressure: 780, efficiency: 85, power: 24.5 },
                        "20": { flow: 35500, pressure: 930, efficiency: 89, power: 26.5 },
                        "25": { flow: 37500, pressure: 1080, efficiency: 87, power: 28.5 },
                        "30": { flow: 38500, pressure: 1230, efficiency: 80, power: 30.5 }
                    }
                }
            }
        };
        
        function updateFanAngle() {
            const slider = document.getElementById('fanBladeAngleSlider');
            const angle = parseFloat(slider.value);
            document.getElementById('fanBladeAngle').value = angle;
            document.getElementById('fanBladeAngleValue').textContent = angle + '°';
            updateFanPerformance();
        }
        
        function updateFanPerformance() {
            const diameter = document.getElementById('fanDiameter').value;
            const bladeCount = document.getElementById('fanBladeCount').value;
            const rpm = document.getElementById('fanRPM').value;
            
            const tableBody = document.getElementById('fanPerformanceTable');
            tableBody.innerHTML = '';
            
            const angles = [10, 15, 20, 25, 30];
            
            angles.forEach(angle => {
                const data = fanPerformanceData[diameter][bladeCount][rpm][angle];
                const row = document.createElement('tr');
                
                if (angle === parseFloat(document.getElementById('fanBladeAngle').value)) {
                    row.style.backgroundColor = '#e3f2fd';
                }
                
                row.innerHTML = `
                    <td>${angle}°</td>
                    <td>${data.flow.toLocaleString()}</td>
                    <td>${data.pressure}</td>
                    <td>${data.efficiency}%</td>
                    <td>${data.power}</td>
                `;
                
                row.addEventListener('click', () => {
                    document.getElementById('fanBladeAngle').value = angle;
                    document.getElementById('fanBladeAngleSlider').value = angle;
                    document.getElementById('fanBladeAngleValue').textContent = angle + '°';
                    updateFanPerformance();
                });
                
                tableBody.appendChild(row);
            });
        }
        
        function calculateFeedFan() {
            const airflow = parseFloat(document.getElementById('feedAirflow').value);
            const bladeAngle = parseFloat(document.getElementById('fanBladeAngle').value);
            const diameter = document.getElementById('fanDiameter').value;
            const bladeCount = document.getElementById('fanBladeCount').value;
            const rpm = document.getElementById('fanRPM').value;
            
            if (isNaN(airflow) || isNaN(bladeAngle) || bladeAngle < 10 || bladeAngle > 30) {
                alert('Please enter valid airflow and blade angle (10-30°)');
                return;
            }
            
            // Get performance data
            const angleKey = Math.round(bladeAngle / 5) * 5; // Round to nearest 5
            const perfData = fanPerformanceData[diameter][bladeCount][rpm][angleKey];
            
            if (!perfData) {
                alert('No performance data available for selected configuration');
                return;
            }
            
            // Calculate number of fans needed
            const fansNeeded = Math.ceil(airflow / perfData.flow);
            const actualFlowPerFan = airflow / fansNeeded;
            
            // Interpolate performance for exact angle
            let flow, pressure, efficiency, power;
            
            if (angleKey === 10) {
                flow = perfData.flow;
                pressure = perfData.pressure;
                efficiency = perfData.efficiency;
                power = perfData.power;
            } else {
                const lowerAngle = Math.floor(bladeAngle / 5) * 5;
                const upperAngle = lowerAngle + 5;
                const lowerData = fanPerformanceData[diameter][bladeCount][rpm][lowerAngle];
                const upperData = fanPerformanceData[diameter][bladeCount][rpm][upperAngle];
                
                const ratio = (bladeAngle - lowerAngle) / 5;
                
                flow = lowerData.flow + (upperData.flow - lowerData.flow) * ratio;
                pressure = lowerData.pressure + (upperData.pressure - lowerData.pressure) * ratio;
                efficiency = lowerData.efficiency + (upperData.efficiency - lowerData.efficiency) * ratio;
                power = lowerData.power + (upperData.power - lowerData.power) * ratio;
            }
            
            // Adjust for actual flow
            const flowRatio = actualFlowPerFan / flow;
            const actualPressure = pressure * Math.pow(flowRatio, 2);
            const actualPower = power * Math.pow(flowRatio, 3);
            
            document.getElementById('feedFanResult').innerHTML = `
                <h4>Feed Fan (Luwa 22kW) Results</h4>
                <p><strong>Selected Configuration:</strong> ${diameter}mm diameter, ${bladeCount} blades, ${rpm} RPM</p>
                <p><strong>Blade Angle:</strong> ${bladeAngle.toFixed(1)}°</p>
                <p><strong>Airflow per Fan:</strong> ${actualFlowPerFan.toFixed(0)} m³/h</p>
                <p><strong>Static Pressure:</strong> ${actualPressure.toFixed(0)} Pa</p>
                <p><strong>Efficiency:</strong> ${efficiency.toFixed(1)}%</p>
                <p><strong>Estimated Power per Fan:</strong> ${actualPower.toFixed(1)} kW</p>
                <p><strong>Number of Fans Needed:</strong> ${fansNeeded}</p>
                <p><strong>Total System Power:</strong> ${(actualPower * fansNeeded).toFixed(1)} kW</p>
                
                <div class="${bladeAngle < 17 || bladeAngle > 20 ? 'warning-box' : 'success-box'}">
                    ${bladeAngle < 17 || bladeAngle > 20 ? 
                      'For textile applications, blade angles of 17-20° typically provide best balance' : 
                      'Blade angle well suited for textile applications'}
                </div>
                <div class="info-box">
                    <strong>Note:</strong> Actual performance may vary based on specific fan model and system characteristics 
                </div>
            `;
        }
        
        function calculateReturnFan() {
            const airflow = parseFloat(document.getElementById('returnAirflow').value);
            const pressureDrop = parseFloat(document.getElementById('pressureDrop').value);
            const diameter = document.getElementById('returnFanDiameter').value;
            
            if (isNaN(airflow) || isNaN(pressureDrop)) {
                alert('Please enter valid values');
                return;
            }
            
            // Simplified return fan calculation based on diameter
            let tipSpeed, rpm, efficiency, maxFlow;
            
            switch(diameter) {
                case "1120":
                    tipSpeed = 35;
                    rpm = 1450;
                    efficiency = 82;
                    maxFlow = 30000;
                    break;
                case "1400":
                    tipSpeed = 32;
                    rpm = 1450;
                    efficiency = 84;
                    maxFlow = 35000;
                    break;
                case "1600":
                    tipSpeed = 30;
                    rpm = 1450;
                    efficiency = 85;
                    maxFlow = 40000;
                    break;
            }
            
            const fansNeeded = Math.ceil(airflow / maxFlow);
            const actualFlowPerFan = airflow / fansNeeded;
            
            // Calculate power
            const power = (actualFlowPerFan / 3600 * pressureDrop) / (efficiency / 100);
            
            document.getElementById('returnFanResult').innerHTML = `
                <h4>Return Fan (30kW) Results</h4>
                <p><strong>Selected Diameter:</strong> ${diameter} mm</p>
                <p><strong>RPM:</strong> ${rpm}</p>
                <p><strong>System Pressure Drop:</strong> ${pressureDrop} Pa</p>
                <p><strong>Efficiency:</strong> ${efficiency}%</p>
                <p><strong>Airflow per Fan:</strong> ${actualFlowPerFan.toFixed(0)} m³/h</p>
                <p><strong>Estimated Power per Fan:</strong> ${power.toFixed(1)} kW</p>
                <p><strong>Number of Fans Needed:</strong> ${fansNeeded}</p>
                <p><strong>Total System Power:</strong> ${(power * fansNeeded).toFixed(1)} kW</p>
                <div class="${power > 30 ? 'warning-box' : 'success-box'}">
                    ${power > 30 ? 'Warning: Power exceeds 30kW fan capacity - consider larger fans or multiple units' : 'Power within 30kW fan capacity'}
                </div>
                <div class="info-box">
                    <strong>Note:</strong> 30kW return fans typically handle 25,000-30,000 m³/h at 800-1200 Pa 
                </div>
            `;
        }
        
        function calculateHeatLoss() {
            const siloHeight = parseFloat(document.getElementById('silosHeight').value);
            const siloWidth = parseFloat(document.getElementById('silosWidth').value);
            const siloLength = parseFloat(document.getElementById('silosLength').value);
            const uValue = parseFloat(document.getElementById('siloUValue').value);
            const winterOutsideTemp = parseFloat(document.getElementById('winterOutsideTemp').value);
            const designTemp = parseFloat(document.getElementById('designTemp').value);
            const operatingHours = parseFloat(document.getElementById('operatingHours').value);
            const airflowRate = parseFloat(document.getElementById('airflowRate').value);
            const sunlightHeating = parseFloat(document.getElementById('sunlightHeating').value) || 0;
            const machinePower = parseFloat(document.getElementById('machinePower').value) || 0;
            
            if (isNaN(siloHeight) || isNaN(siloWidth) || isNaN(siloLength) || isNaN(uValue) || 
                isNaN(winterOutsideTemp) || isNaN(designTemp) || isNaN(operatingHours) || isNaN(airflowRate)) {
                alert('Please complete previous sections first');
                return;
            }
            
            // Calculate surface area (excluding floor)
            const wallArea = 2 * (siloHeight * siloWidth + siloHeight * siloLength);
            const roofArea = siloWidth * siloLength;
            const totalArea = wallArea + roofArea;
            
            // Heat loss calculation
            const tempDifference = designTemp - winterOutsideTemp;
            const heatLossWatts = totalArea * uValue * tempDifference;
            const heatLosskW = heatLossWatts / 1000;
            const dailyHeatLoss = heatLosskW * operatingHours;
            
            // Heat needed for incoming air
            const winterOutsideEnthalpy = calculateEnthalpy(winterOutsideTemp, 
                parseFloat(document.getElementById('winterOutsideHumidity').value));
            const designEnthalpy = calculateEnthalpy(designTemp, 
                parseFloat(document.getElementById('designHumidity').value));
            const enthalpyDifference = designEnthalpy - winterOutsideEnthalpy;
            const airHeatkW = (airflowRate / 3600) * 1.2 * enthalpyDifference; // 1.2 kg/m³ air density
            
            // Total heat requirement
            const totalHeatkW = heatLosskW + airHeatkW - (sunlightHeating + machinePower);
            const dailyTotalHeat = totalHeatkW * operatingHours;
            
            document.getElementById('heatLossResult').innerHTML = `
                <h4>Winter Heat Loss Analysis</h4>
                <p><strong>Total Exposed Area:</strong> ${totalArea.toFixed(2)} m²</p>
                <p><strong>Temperature Difference:</strong> ${tempDifference.toFixed(1)} °C</p>
                <p><strong>Fabric Heat Loss:</strong> ${heatLosskW.toFixed(2)} kW</p>
                <p><strong>Daily Fabric Loss:</strong> ${dailyHeatLoss.toFixed(2)} kWh</p>
                
                <h4>Air Heating Requirements</h4>
                <p><strong>Enthalpy Difference:</strong> ${enthalpyDifference.toFixed(2)} kJ/kg</p>
                <p><strong>Air Heating Power:</strong> ${airHeatkW.toFixed(2)} kW</p>
                
                <h4>Additional Heat Sources</h4>
                <p><strong>Sunlight Heating:</strong> ${sunlightHeating.toFixed(2)} kW</p>
                <p><strong>Machinery Heat:</strong> ${machinePower.toFixed(2)} kW</p>
                <p><strong>Total Additional Heat:</strong> ${(sunlightHeating + machinePower).toFixed(2)} kW</p>
                
                <h4>Net Heating Requirements</h4>
                <p><strong>Net Heating Power:</strong> ${Math.max(0, totalHeatkW).toFixed(2)} kW</p>
                <p><strong>Daily Net Heat:</strong> ${Math.max(0, dailyTotalHeat).toFixed(2)} kWh</p>
                
                <div class="warning-box">
                    <strong>Recommendation:</strong> Install heating capacity of ${Math.ceil(Math.max(0, totalHeatkW * 1.2))} kW (including 20% safety margin)
                </div>
                <div class="info-box">
                    <strong>Energy Saving Tip:</strong> Consider heat recovery from exhaust air to reduce heating costs
                </div>
            `;
        }
        
        // Psychrometric chart variables
        let psychrometricChart;
        
        function updatePsychrometricChart() {
            const temp = parseFloat(document.getElementById('currentTemp').value);
            const humidity = parseFloat(document.getElementById('currentHumidity').value);
            
            if (isNaN(temp) || isNaN(humidity)) {
                alert('Please enter valid temperature and humidity values');
                return;
            }
            
            // Calculate psychrometric properties
            const dewPoint = calculateDewPoint(temp, humidity);
            const wetBulb = calculateWetBulb(temp, humidity);
            const humidityRatio = calculateHumidityRatio(temp, humidity);
            const enthalpy = calculateEnthalpy(temp, humidity);
            const specificVolume = calculateSpecificVolume(temp, humidity);
            const vaporPressure = calculateVaporPressure(temp, humidity);
            
            // Update displayed values
            document.getElementById('dewPointValue').textContent = dewPoint.toFixed(2);
            document.getElementById('wetBulbValue').textContent = wetBulb.toFixed(2);
            document.getElementById('humidityRatioValue').textContent = humidityRatio.toFixed(2);
            document.getElementById('enthalpyValue').textContent = enthalpy.toFixed(2);
            document.getElementById('specificVolumeValue').textContent = specificVolume.toFixed(3);
            document.getElementById('vaporPressureValue').textContent = vaporPressure.toFixed(4);
            
            // Create or update chart
            const ctx = document.getElementById('psychrometricChart').getContext('2d');
            
            if (psychrometricChart) {
                psychrometricChart.destroy();
            }
            
            // Generate psychrometric chart data
            const chartData = generatePsychrometricChartData();
            
            psychrometricChart = new Chart(ctx, {
                type: 'scatter',
                data: {
                    datasets: [
                        // Constant relative humidity lines
                        {
                            label: '100% RH',
                            data: chartData.rh100,
                            borderColor: 'rgba(0, 0, 255, 0.7)',
                            backgroundColor: 'rgba(0, 0, 255, 0.1)',
                            borderWidth: 2,
                            pointRadius: 0,
                            showLine: true,
                            fill: false
                        },
                        {
                            label: '80% RH',
                            data: chartData.rh80,
                            borderColor: 'rgba(0, 128, 255, 0.7)',
                            backgroundColor: 'rgba(0, 128, 255, 0.1)',
                            borderWidth: 2,
                            pointRadius: 0,
                            showLine: true,
                            fill: false
                        },
                        {
                            label: '60% RH',
                            data: chartData.rh60,
                            borderColor: 'rgba(0, 200, 255, 0.7)',
                            backgroundColor: 'rgba(0, 200, 255, 0.1)',
                            borderWidth: 2,
                            pointRadius: 0,
                            showLine: true,
                            fill: false
                        },
                        {
                            label: '40% RH',
                            data: chartData.rh40,
                            borderColor: 'rgba(100, 220, 255, 0.7)',
                            backgroundColor: 'rgba(100, 220, 255, 0.1)',
                            borderWidth: 2,
                            pointRadius: 0,
                            showLine: true,
                            fill: false
                        },
                        {
                            label: '20% RH',
                            data: chartData.rh20,
                            borderColor: 'rgba(150, 240, 255, 0.7)',
                            backgroundColor: 'rgba(150, 240, 255, 0.1)',
                            borderWidth: 2,
                            pointRadius: 0,
                            showLine: true,
                            fill: false
                        },
                        // Current point
                        {
                            label: 'Current Condition',
                            data: [{
                                x: temp,
                                y: humidityRatio * 1000 // Convert to g/kg
                            }],
                            backgroundColor: 'rgba(255, 0, 0, 1)',
                            borderColor: 'rgba(255, 255, 255, 1)',
                            borderWidth: 2,
                            pointRadius: 8,
                            pointHoverRadius: 10
                        },
                        // Dew point
                        {
                            label: 'Dew Point',
                            data: [{
                                x: dewPoint,
                                y: calculateHumidityRatio(dewPoint, 100) * 1000
                            }],
                            backgroundColor: 'rgba(0, 0, 200, 1)',
                            borderColor: 'rgba(255, 255, 255, 1)',
                            borderWidth: 2,
                            pointRadius: 6,
                            pointHoverRadius: 8
                        },
                        // Wet bulb
                        {
                            label: 'Wet Bulb',
                            data: [{
                                x: wetBulb,
                                y: calculateHumidityRatio(wetBulb, 100) * 1000
                            }],
                            backgroundColor: 'rgba(0, 200, 0, 1)',
                            borderColor: 'rgba(255, 255, 255, 1)',
                            borderWidth: 2,
                            pointRadius: 6,
                            pointHoverRadius: 8
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        x: {
                            type: 'linear',
                            position: 'bottom',
                            title: {
                                display: true,
                                text: 'Dry Bulb Temperature (°C)'
                            },
                            min: 0,
                            max: 50
                        },
                        y: {
                            title: {
                                display: true,
                                text: 'Humidity Ratio (g/kg)'
                            },
                            min: 0,
                            max: 30
                        }
                    },
                    plugins: {
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    const label = context.dataset.label || '';
                                    if (label === 'Current Condition') {
                                        return [
                                            label,
                                            `Temperature: ${temp.toFixed(1)}°C`,
                                            `RH: ${humidity.toFixed(1)}%`,
                                            `HR: ${(humidityRatio*1000).toFixed(2)} g/kg`,
                                            `Enthalpy: ${enthalpy.toFixed(2)} kJ/kg`,
                                            `Dew Point: ${dewPoint.toFixed(1)}°C`,
                                            `Wet Bulb: ${wetBulb.toFixed(1)}°C`
                                        ];
                                    } else if (label === 'Dew Point') {
                                        return [
                                            label,
                                            `Temperature: ${dewPoint.toFixed(1)}°C`,
                                            `RH: 100%`,
                                            `HR: ${(calculateHumidityRatio(dewPoint, 100)*1000).toFixed(2)} g/kg`
                                        ];
                                    } else if (label === 'Wet Bulb') {
                                        return [
                                            label,
                                            `Temperature: ${wetBulb.toFixed(1)}°C`,
                                            `RH: 100%`,
                                            `HR: ${(calculateHumidityRatio(wetBulb, 100)*1000).toFixed(2)} g/kg`
                                        ];
                                    }
                                    return label;
                                }
                            }
                        },
                        annotation: {
                            annotations: {
                                line1: {
                                    type: 'line',
                                    yMin: humidityRatio * 1000,
                                    yMax: humidityRatio * 1000,
                                    borderColor: 'rgba(255, 0, 0, 0.5)',
                                    borderWidth: 1,
                                    borderDash: [6, 6]
                                },
                                line2: {
                                    type: 'line',
                                    xMin: temp,
                                    xMax: temp,
                                    borderColor: 'rgba(255, 0, 0, 0.5)',
                                    borderWidth: 1,
                                    borderDash: [6, 6]
                                }
                            }
                        }
                    },
                    onClick: (e) => {
                        const canvasPosition = Chart.helpers.getRelativePosition(e, psychrometricChart);
                        const dataX = psychrometricChart.scales.x.getValueForPixel(canvasPosition.x);
                        const dataY = psychrometricChart.scales.y.getValueForPixel(canvasPosition.y);
                        
                        // Update inputs with clicked values
                        document.getElementById('currentTemp').value = dataX.toFixed(1);
                        
                        // Find closest RH line to estimate humidity
                        const clickedHR = dataY / 1000; // Convert back to kg/kg
                        let estimatedRH = 0;
                        let minDiff = Infinity;
                        
                        for (let t = 0; t <= 50; t += 0.5) {
                            for (let rh = 5; rh <= 100; rh += 5) {
                                const hr = calculateHumidityRatio(t, rh);
                                const diff = Math.abs(hr - clickedHR);
                                
                                if (diff < minDiff && t.toFixed(1) === dataX.toFixed(1)) {
                                    minDiff = diff;
                                    estimatedRH = rh;
                                }
                            }
                        }
                        
                        document.getElementById('currentHumidity').value = estimatedRH.toFixed(1);
                        updatePsychrometricChart();
                    }
                }
            });
        }
        
        function generatePsychrometricChartData() {
            const data = {
                rh100: [],
                rh80: [],
                rh60: [],
                rh40: [],
                rh20: []
            };
            
            // Generate data points for each RH curve
            for (let t = 0; t <= 50; t += 0.5) {
                data.rh100.push({
                    x: t,
                    y: calculateHumidityRatio(t, 100) * 1000
                });
                
                data.rh80.push({
                    x: t,
                    y: calculateHumidityRatio(t, 80) * 1000
                });
                
                data.rh60.push({
                    x: t,
                    y: calculateHumidityRatio(t, 60) * 1000
                });
                
                data.rh40.push({
                    x: t,
                    y: calculateHumidityRatio(t, 40) * 1000
                });
                
                data.rh20.push({
                    x: t,
                    y: calculateHumidityRatio(t, 20) * 1000
                });
            }
            
            return data;
        }
        
        // Psychrometric helper functions
        function calculateEnthalpy(tempC, relativeHumidity) {
            // More accurate enthalpy calculation (kJ/kg)
            const satVapPress = 0.61078 * Math.exp((17.27 * tempC) / (tempC + 237.3));
            const vapPress = satVapPress * (relativeHumidity / 100);
            const humidityRatio = 0.622 * vapPress / (101.325 - vapPress);
            return (1.006 * tempC) + (humidityRatio * (2501 + 1.805 * tempC));
        }
        
        function calculateDewPoint(tempC, relativeHumidity) {
            // Accurate dew point calculation (°C)
            const a = 17.27;
            const b = 237.7;
            const alpha = ((a * tempC) / (b + tempC)) + Math.log(relativeHumidity/100);
            return (b * alpha) / (a - alpha);
        }
        
        function calculateHumidityRatio(tempC, relativeHumidity) {
            // Humidity ratio in kg/kg
            const satVapPress = 0.61078 * Math.exp((17.27 * tempC) / (tempC + 237.3));
            const vapPress = satVapPress * (relativeHumidity / 100);
            return 0.622 * vapPress / (101.325 - vapPress);
        }
        
        function calculateWetBulb(tempC, relativeHumidity) {
            // Approximation of wet bulb temperature (°C)
            const tw = tempC * Math.atan(0.151977 * Math.sqrt(relativeHumidity + 8.313659)) +
                Math.atan(tempC + relativeHumidity) - Math.atan(relativeHumidity - 1.676331) +
                0.00391838 * Math.pow(relativeHumidity, 1.5) * Math.atan(0.023101 * relativeHumidity) - 4.686035;
            return tw;
        }
        
        function calculateSpecificVolume(tempC, relativeHumidity) {
            // Specific volume (m³/kg)
            const humidityRatio = calculateHumidityRatio(tempC, relativeHumidity);
            return (0.2871 * (tempC + 273.15) * (1 + 1.6078 * humidityRatio)) / (101.325);
        }
        
        function calculateVaporPressure(tempC, relativeHumidity) {
            // Vapor pressure (kPa)
            const satVapPress = 0.61078 * Math.exp((17.27 * tempC) / (tempC + 237.3));
            return satVapPress * (relativeHumidity / 100);
        }
        
        // Initialize fan performance table and psychrometric chart
        window.onload = function() {
            updateFanPerformance();
            updatePsychrometricChart();
        };
    </script>
</body>
</html>