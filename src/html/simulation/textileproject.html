<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>سیستم طراحی تهویه نساجی</title>
    
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Vazirmatn:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Alpine.js -->
    <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.12.0/dist/cdn.min.js"></script>
    
    <style>
        :root {
            --primary-gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            --secondary-gradient: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            --success-gradient: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            --warning-gradient: linear-gradient(135deg, #f6d365 0%, #fda085 100%);
        }
        
        body {
            font-family: 'Vazirmatn', sans-serif;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            min-height: 100vh;
            overflow-x: hidden;
        }
        
        .glass-effect {
            background: rgba(255, 255, 255, 0.85);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }
        
        .sidebar {
            background: linear-gradient(180deg, #667eea 0%, #764ba2 100%);
            color: white;
            height: 100vh;
            position: fixed;
            overflow-y: auto;
            transition: all 0.3s;
            z-index: 1000;
        }
        
        .sidebar.collapsed {
            width: 70px;
        }
        
        .sidebar.expanded {
            width: 280px;
        }
        
        .main-content {
            margin-right: 280px;
            transition: all 0.3s;
        }
        
        .main-content.expanded {
            margin-right: 70px;
        }
        
        .nav-link {
            color: rgba(255, 255, 255, 0.8);
            border-radius: 10px;
            margin: 5px 0;
            transition: all 0.3s;
        }
        
        .nav-link:hover, .nav-link.active {
            background: rgba(255, 255, 255, 0.2);
            color: white;
        }
        
        .section-card {
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.08);
            transition: all 0.3s;
            border: none;
            overflow: hidden;
        }
        
        .section-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.12);
        }
        
        .card-header {
            background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 1rem 1.5rem;
            font-weight: 600;
        }
        
        .btn-gradient {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 10px;
            padding: 0.6rem 1.5rem;
            transition: all 0.3s;
        }
        
        .btn-gradient:hover {
            background: linear-gradient(135deg, #764ba2 0%, #667eea 100%);
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(118, 75, 162, 0.3);
        }
        
        .btn-success-gradient {
            background: var(--success-gradient);
            color: white;
            border: none;
        }
        
        .btn-warning-gradient {
            background: var(--warning-gradient);
            color: white;
            border: none;
        }
        
        .form-control, .form-select {
            border-radius: 10px;
            padding: 0.75rem 1rem;
            border: 1px solid #e0e0e0;
            transition: all 0.3s;
        }
        
        .form-control:focus, .form-select:focus {
            border-color: #667eea;
            box-shadow: 0 0 0 0.25rem rgba(102, 126, 234, 0.25);
        }
        
        .badge-gradient {
            background: var(--secondary-gradient);
            color: white;
            padding: 0.35rem 0.75rem;
            border-radius: 50px;
        }
        
        .table-hover tbody tr {
            transition: all 0.3s;
        }
        
        .table-hover tbody tr:hover {
            background-color: rgba(102, 126, 234, 0.1);
        }
        
        .result-box {
            background: linear-gradient(135deg, #f6d365 0%, #fda085 100%);
            color: #333;
            padding: 1rem;
            border-radius: 10px;
            font-weight: 600;
            margin-top: 1rem;
        }
        
        .input-group-text {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 10px 0 0 10px;
        }
        
        .floating-action-btn {
            position: fixed;
            bottom: 30px;
            left: 30px;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: var(--secondary-gradient);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.2);
            z-index: 1000;
            transition: all 0.3s;
        }
        
        .floating-action-btn:hover {
            transform: scale(1.1);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.3);
        }
        
        .project-card {
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .project-card:hover {
            transform: scale(1.02);
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.15);
        }
        
        .section-icon {
            width: 50px;
            height: 50px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-left: 15px;
            background: rgba(255, 255, 255, 0.2);
        }
        
        .toggle-btn {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.2);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .toggle-btn:hover {
            background: rgba(255, 255, 255, 0.3);
        }
        
        .progress-gradient {
            background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
        }
        
        .mobile-header {
            display: none;
            background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 1rem;
            position: sticky;
            top: 0;
            z-index: 999;
        }
        
        .mobile-menu-btn {
            background: rgba(255, 255, 255, 0.2);
            border: none;
            color: white;
            width: 40px;
            height: 40px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        @media (max-width: 992px) {
            .sidebar {
                transform: translateX(100%);
                width: 280px;
                right: 0;
            }
            
            .sidebar.show {
                transform: translateX(0);
            }
            
            .main-content {
                margin-right: 0;
            }
            
            .mobile-header {
                display: flex;
                justify-content: space-between;
                align-items: center;
            }
        }
        
        .animate-pulse {
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.7; }
            100% { opacity: 1; }
        }
        
        .tab-content {
            min-height: 500px;
        }
        
        .station-badge {
            background: var(--success-gradient);
            color: white;
            padding: 0.25rem 0.75rem;
            border-radius: 50px;
            font-size: 0.85rem;
        }
        
        .calculation-result {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 1.5rem;
            border-right: 5px solid #667eea;
        }
        
        .section-indicator {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            display: inline-block;
            margin-left: 5px;
        }
        
        .section-complete {
            background-color: #28a745;
        }
        
        .section-incomplete {
            background-color: #ffc107;
        }
        
        .section-empty {
            background-color: #dc3545;
        }
    </style>
</head>
<body x-data="app()" x-init="init()">
    <!-- Mobile Header -->
    <div class="mobile-header d-lg-none">
        <div>
            <h5 class="mb-0"><i class="fas fa-wind me-2"></i> طراحی تهویه نساجی</h5>
            <small class="opacity-75">نسخه: 2.1.4</small>
        </div>
        <button class="mobile-menu-btn" @click="mobileMenuOpen = !mobileMenuOpen">
            <i class="fas fa-bars"></i>
        </button>
    </div>
    
    <!-- Sidebar -->
    <div class="sidebar position-fixed top-0 end-0 shadow-lg" 
         :class="sidebarCollapsed ? 'collapsed' : 'expanded'"
         :class="{'show': mobileMenuOpen}" 
         x-show="!isMobile || mobileMenuOpen"
         x-transition>
        <div class="d-flex flex-column h-100 p-3">
            <!-- Sidebar Header -->
            <div class="d-flex align-items-center mb-4">
                <div class="section-icon" :class="sidebarCollapsed ? 'mx-auto' : ''">
                    <i class="fas fa-wind fa-lg"></i>
                </div>
                <div x-show="!sidebarCollapsed" class="me-2">
                    <h5 class="mb-0">تهویه نساجی</h5>
                    <small class="opacity-75">سیستم طراحی پیشرفته</small>
                </div>
                <div class="ms-auto toggle-btn" @click="sidebarCollapsed = !sidebarCollapsed" x-show="!isMobile">
                    <i class="fas" :class="sidebarCollapsed ? 'fa-chevron-left' : 'fa-chevron-right'"></i>
                </div>
            </div>
            
            <!-- Project Selector -->
            <div x-show="!sidebarCollapsed" class="mb-4">
                <div class="d-flex justify-content-between align-items-center mb-2">
                    <h6 class="mb-0">پروژه‌ها</h6>
                    <span class="badge bg-light text-dark">{{projects.length}}</span>
                </div>
                <select class="form-select form-select-sm mb-3" x-model="currentProjectId" @change="loadProject($event.target.value)">
                    <template x-for="project in projects" :key="project.id">
                        <option :value="project.id" x-text="project.name"></option>
                    </template>
                </select>
                <button class="btn btn-gradient btn-sm w-100" @click="showNewProjectModal = true">
                    <i class="fas fa-plus me-1"></i> پروژه جدید
                </button>
            </div>
            
            <!-- Navigation -->
            <nav class="nav flex-column mb-auto">
                <a class="nav-link py-3" :class="{active: activeSection === 'dashboard'}" @click="changeSection('dashboard')">
                    <i class="fas fa-tachometer-alt me-2" x-show="!sidebarCollapsed"></i>
                    <span x-show="!sidebarCollapsed">داشبورد</span>
                    <div x-show="sidebarCollapsed" class="text-center">
                        <i class="fas fa-tachometer-alt"></i>
                    </div>
                </a>
                
                <a class="nav-link py-3" :class="{active: activeSection === 'problem'}" @click="changeSection('problem')">
                    <i class="fas fa-clipboard-list me-2" x-show="!sidebarCollapsed"></i>
                    <span x-show="!sidebarCollapsed">1. تعریف پروژه</span>
                    <div x-show="sidebarCollapsed" class="text-center">
                        <i class="fas fa-clipboard-list"></i>
                    </div>
                </a>
                
                <a class="nav-link py-3" :class="{active: activeSection === 'condition'}" @click="changeSection('condition')">
                    <i class="fas fa-temperature-low me-2" x-show="!sidebarCollapsed"></i>
                    <span x-show="!sidebarCollapsed">2. شرایط محیطی</span>
                    <div x-show="sidebarCollapsed" class="text-center">
                        <i class="fas fa-temperature-low"></i>
                    </div>
                </a>
                
                <a class="nav-link py-3" :class="{active: activeSection.startsWith('station')}" @click="changeSection('station')">
                    <i class="fas fa-industry me-2" x-show="!sidebarCollapsed"></i>
                    <span x-show="!sidebarCollapsed">3. ایستگاه‌های AC</span>
                    <div x-show="sidebarCollapsed" class="text-center">
                        <i class="fas fa-industry"></i>
                    </div>
                </a>
                
                <div x-show="!sidebarCollapsed && activeSection.startsWith('station')" class="ms-4 mt-2">
                    <a class="nav-link py-2 small" :class="{active: activeSection === 'station-space'}" @click="changeSection('station-space')">
                        <i class="fas fa-vector-square me-2"></i> فضاها
                    </a>
                    <a class="nav-link py-2 small" :class="{active: activeSection === 'station-duct'}" @click="changeSection('station-duct')">
                        <i class="fas fa-drafting-compass me-2"></i> کانال
                    </a>
                    <a class="nav-link py-2 small" :class="{active: activeSection === 'station-vent'}" @click="changeSection('station-vent')">
                        <i class="fas fa-wind me-2"></i> دریچه‌ها
                    </a>
                    <a class="nav-link py-2 small" :class="{active: activeSection === 'station-arf'}" @click="changeSection('station-arf')">
                        <i class="fas fa-filter me-2"></i> فیلتر دوار
                    </a>
                    <a class="nav-link py-2 small" :class="{active: activeSection === 'station-damper'}" @click="changeSection('station-damper')">
                        <i class="fas fa-compress-alt me-2"></i> دمپرها
                    </a>
                    <a class="nav-link py-2 small" :class="{active: activeSection === 'station-airwasher'}" @click="changeSection('station-airwasher')">
                        <i class="fas fa-shower me-2"></i> هوا شوی
                    </a>
                    <a class="nav-link py-2 small" :class="{active: activeSection === 'station-coil'}" @click="changeSection('station-coil')">
                        <i class="fas fa-fire me-2"></i> کویل گرمایش
                    </a>
                    <a class="nav-link py-2 small" :class="{active: activeSection === 'station-fan'}" @click="changeSection('station-fan')">
                        <i class="fas fa-fan me-2"></i> فن‌ها
                    </a>
                </div>
                
                <a class="nav-link py-3" :class="{active: activeSection === 'fp'}" @click="changeSection('fp')">
                    <i class="fas fa-filter me-2" x-show="!sidebarCollapsed"></i>
                    <span x-show="!sidebarCollapsed">4. فیلتر پلن</span>
                    <div x-show="sidebarCollapsed" class="text-center">
                        <i class="fas fa-filter"></i>
                    </div>
                </a>
                
                <a class="nav-link py-3" :class="{active: activeSection === 'report'}" @click="changeSection('report')">
                    <i class="fas fa-chart-bar me-2" x-show="!sidebarCollapsed"></i>
                    <span x-show="!sidebarCollapsed">5. گزارش‌ها</span>
                    <div x-show="sidebarCollapsed" class="text-center">
                        <i class="fas fa-chart-bar"></i>
                    </div>
                </div>
                
                <a class="nav-link py-3" :class="{active: activeSection === 'templates'}" @click="changeSection('templates')">
                    <i class="fas fa-layer-group me-2" x-show="!sidebarCollapsed"></i>
                    <span x-show="!sidebarCollapsed">6. قالب‌ها</span>
                    <div x-show="sidebarCollapsed" class="text-center">
                        <i class="fas fa-layer-group"></i>
                    </div>
                </a>
            </nav>
            
            <!-- Sidebar Footer -->
            <div x-show="!sidebarCollapsed" class="mt-auto pt-3 border-top">
                <div class="d-flex justify-content-between align-items-center mb-2">
                    <small class="opacity-75">پیشرفت پروژه</small>
                    <small x-text="projectProgress + '%'"></small>
                </div>
                <div class="progress mb-3" style="height: 6px;">
                    <div class="progress-bar progress-gradient" role="progressbar" :style="'width: ' + projectProgress + '%'"></div>
                </div>
                <div class="d-flex justify-content-between">
                    <small class="opacity-75">
                        <i class="fas fa-dollar-sign me-1"></i>
                        <span x-text="formatCurrency(totalCost)"></span>
                    </small>
                    <small class="opacity-75">
                        <i class="fas fa-calendar-alt me-1"></i>
                        <span x-text="currentDate"></span>
                    </small>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Main Content -->
    <div class="main-content p-3" :class="sidebarCollapsed ? 'expanded' : ''">
        
        <!-- Dashboard Section -->
        <div x-show="activeSection === 'dashboard'" x-transition>
            <div class="d-flex justify-content-between align-items-center mb-4">
                <h3 class="fw-bold text-gradient">داشبورد پروژه</h3>
                <div>
                    <button class="btn btn-gradient me-2" @click="exportProject()">
                        <i class="fas fa-file-export me-1"></i> خروجی
                    </button>
                    <button class="btn btn-success-gradient" @click="showReportModal = true">
                        <i class="fas fa-chart-pie me-1"></i> گزارش کامل
                    </button>
                </div>
            </div>
            
            <!-- Project Summary -->
            <div class="row mb-4">
                <div class="col-md-4 mb-3">
                    <div class="section-card h-100">
                        <div class="card-header d-flex justify-content-between align-items-center">
                            <span>پروژه فعال</span>
                            <i class="fas fa-project-diagram"></i>
                        </div>
                        <div class="card-body">
                            <h4 x-text="getCurrentProject().name" class="text-primary"></h4>
                            <p x-text="getCurrentProject().description" class="text-muted"></p>
                            <div class="d-flex justify-content-between mb-2">
                                <small>مکان:</small>
                                <small x-text="getCurrentProject().location" class="fw-bold"></small>
                            </div>
                            <div class="d-flex justify-content-between mb-2">
                                <small>طراح:</small>
                                <small x-text="getCurrentProject().author" class="fw-bold"></small>
                            </div>
                            <div class="d-flex justify-content-between">
                                <small>تاریخ ایجاد:</small>
                                <small x-text="getCurrentProject().createdAt" class="fw-bold"></small>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="col-md-8 mb-3">
                    <div class="section-card h-100">
                        <div class="card-header d-flex justify-content-between align-items-center">
                            <span>وضعیت بخش‌ها</span>
                            <i class="fas fa-tasks"></i>
                        </div>
                        <div class="card-body">
                            <div class="row">
                                <div class="col-6 col-md-3 mb-3">
                                    <div class="text-center p-3 rounded" style="background: rgba(40, 167, 69, 0.1);">
                                        <div class="h2 mb-0" x-text="completedSections"></div>
                                        <small>تکمیل شده</small>
                                    </div>
                                </div>
                                <div class="col-6 col-md-3 mb-3">
                                    <div class="text-center p-3 rounded" style="background: rgba(255, 193, 7, 0.1);">
                                        <div class="h2 mb-0" x-text="inProgressSections"></div>
                                        <small>در حال انجام</small>
                                    </div>
                                </div>
                                <div class="col-6 col-md-3 mb-3">
                                    <div class="text-center p-3 rounded" style="background: rgba(220, 53, 69, 0.1);">
                                        <div class="h2 mb-0" x-text="pendingSections"></div>
                                        <small>شروع نشده</small>
                                    </div>
                                </div>
                                <div class="col-6 col-md-3 mb-3">
                                    <div class="text-center p-3 rounded" style="background: rgba(102, 126, 234, 0.1);">
                                        <div class="h2 mb-0" x-text="getCurrentProject().stations.length"></div>
                                        <small>ایستگاه‌ها</small>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="progress mb-3" style="height: 10px;">
                                <div class="progress-bar bg-success" role="progressbar" :style="'width: ' + (completedSections/totalSections*100) + '%'"></div>
                                <div class="progress-bar bg-warning" role="progressbar" :style="'width: ' + (inProgressSections/totalSections*100) + '%'"></div>
                                <div class="progress-bar bg-danger" role="progressbar" :style="'width: ' + (pendingSections/totalSections*100) + '%'"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Quick Actions -->
            <div class="row mb-4">
                <div class="col-12">
                    <div class="section-card">
                        <div class="card-header d-flex justify-content-between align-items-center">
                            <span>عملیات سریع</span>
                            <i class="fas fa-bolt"></i>
                        </div>
                        <div class="card-body">
                            <div class="row">
                                <div class="col-md-3 col-6 mb-3">
                                    <button class="btn btn-outline-primary w-100 py-3" @click="changeSection('problem')">
                                        <i class="fas fa-clipboard-list fa-2x mb-2"></i>
                                        <div>تعریف پروژه</div>
                                    </button>
                                </div>
                                <div class="col-md-3 col-6 mb-3">
                                    <button class="btn btn-outline-success w-100 py-3" @click="changeSection('station')">
                                        <i class="fas fa-industry fa-2x mb-2"></i>
                                        <div>ایستگاه جدید</div>
                                    </button>
                                </div>
                                <div class="col-md-3 col-6 mb-3">
                                    <button class="btn btn-outline-warning w-100 py-3" @click="changeSection('fp')">
                                        <i class="fas fa-filter fa-2x mb-2"></i>
                                        <div>فیلتر پلن</div>
                                    </button>
                                </div>
                                <div class="col-md-3 col-6 mb-3">
                                    <button class="btn btn-outline-info w-100 py-3" @click="changeSection('report')">
                                        <i class="fas fa-chart-bar fa-2x mb-2"></i>
                                        <div>گزارش‌ها</div>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Recent Projects -->
            <div class="row">
                <div class="col-12">
                    <div class="section-card">
                        <div class="card-header d-flex justify-content-between align-items-center">
                            <span>پروژه‌های اخیر</span>
                            <i class="fas fa-history"></i>
                        </div>
                        <div class="card-body">
                            <div class="table-responsive">
                                <table class="table table-hover">
                                    <thead>
                                        <tr>
                                            <th>نام پروژه</th>
                                            <th>مکان</th>
                                            <th>تاریخ ایجاد</th>
                                            <th>وضعیت</th>
                                            <th>هزینه تخمینی</th>
                                            <th>عملیات</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <template x-for="project in recentProjects" :key="project.id">
                                            <tr>
                                                <td x-text="project.name"></td>
                                                <td x-text="project.location"></td>
                                                <td x-text="project.createdAt"></td>
                                                <td>
                                                    <span class="badge" :class="{
                                                        'bg-success': project.progress >= 80,
                                                        'bg-warning': project.progress >= 30 && project.progress < 80,
                                                        'bg-danger': project.progress < 30
                                                    }" x-text="project.progress + '%'"></span>
                                                </td>
                                                <td x-text="formatCurrency(project.estimatedCost)"></td>
                                                <td>
                                                    <button class="btn btn-sm btn-outline-primary" @click="loadProject(project.id)">
                                                        <i class="fas fa-eye"></i>
                                                    </button>
                                                </td>
                                            </tr>
                                        </template>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Problem Section -->
        <div x-show="activeSection === 'problem'" x-transition>
            <div class="d-flex justify-content-between align-items-center mb-4">
                <h3 class="fw-bold">1. تعریف پروژه</h3>
                <button class="btn btn-gradient" @click="saveProblem()">
                    <i class="fas fa-save me-1"></i> ذخیره
                </button>
            </div>
            
            <div class="row">
                <div class="col-lg-8">
                    <div class="section-card mb-4">
                        <div class="card-header">
                            <span>مشخصات کلی پروژه</span>
                        </div>
                        <div class="card-body">
                            <div class="row">
                                <div class="col-md-6 mb-3">
                                    <label class="form-label">نام پروژه</label>
                                    <input type="text" class="form-control" x-model="currentProject.problem.name" placeholder="مثال: پروژه تهویه کارخانه نساجی سپهر">
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label class="form-label">محل پروژه</label>
                                    <input type="text" class="form-control" x-model="currentProject.problem.location" placeholder="مثال: کیلومتر 15 جاده قدیم قم">
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label class="form-label">نام طراح</label>
                                    <input type="text" class="form-control" x-model="currentProject.problem.author" placeholder="مثال: مهندس احمدی">
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label class="form-label">ورژن پروژه</label>
                                    <input type="text" class="form-control" x-model="currentProject.problem.version" placeholder="مثال: 2.1.0">
                                </div>
                                <div class="col-12 mb-3">
                                    <label class="form-label">توضیحات پروژه</label>
                                    <textarea class="form-control" rows="4" x-model="currentProject.problem.description" placeholder="توضیحات کامل درباره پروژه، اهداف، مشخصات فنی و..."></textarea>
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label class="form-label">تاریخ شروع</label>
                                    <input type="date" class="form-control" x-model="currentProject.problem.startDate">
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label class="form-label">تاریخ پایان پیش‌بین‌ی</label>
                                    <input type="date" class="form-control" x-model="currentProject.problem.endDate">
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label class="form-label">نوع صنعت</label>
                                    <select class="form-select" x-model="currentProject.problem.industryType">
                                        <option value="spinning">ریسندگی</option>
                                        <option value="weaving">بافندگی</option>
                                        <option value="finishing">تکمیل</option>
                                        <option value="composite">ترکیبی</option>
                                    </select>
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label class="form-label">ظرفیت تولید (کیلوگرم/روز)</label>
                                    <input type="number" class="form-control" x-model="currentProject.problem.productionCapacity" placeholder="مثال: 5000">
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="col-lg-4">
                    <div class="section-card mb-4">
                        <div class="card-header">
                            <span>خلاصه اطلاعات</span>
                        </div>
                        <div class="card-body">
                            <div class="mb-3">
                                <small class="text-muted d-block">وضعیت تکمیل</small>
                                <div class="progress" style="height: 8px;">
                                    <div class="progress-bar bg-success" role="progressbar" :style="'width: ' + problemProgress + '%'"></div>
                                </div>
                                <small class="text-muted" x-text="problemProgress + '%'"></small>
                            </div>
                            
                            <div class="mb-3">
                                <small class="text-muted d-block">آخرین بروزرسانی</small>
                                <small x-text="currentProject.problem.lastUpdated || 'ثبت نشده'"></small>
                            </div>
                            
                            <div class="mb-3">
                                <small class="text-muted d-block">تعداد ایستگاه‌ها</small>
                                <small x-text="currentProject.stations.length"></small>
                            </div>
                            
                            <div class="mb-3">
                                <small class="text-muted d-block">تعداد فیلتر پلن‌ها</small>
                                <small x-text="currentProject.filterPlans.length"></small>
                            </div>
                            
                            <div class="result-box">
                                <div class="d-flex justify-content-between">
                                    <span>هزینه تخمینی:</span>
                                    <span x-text="formatCurrency(calculateEstimatedCost())"></span>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="section-card">
                        <div class="card-header">
                            <span>عملیات</span>
                        </div>
                        <div class="card-body">
                            <button class="btn btn-success-gradient w-100 mb-2" @click="saveProblem()">
                                <i class="fas fa-save me-1"></i> ذخیره پروژه
                            </button>
                            <button class="btn btn-outline-primary w-100 mb-2" @click="changeSection('condition')">
                                <i class="fas fa-arrow-left me-1"></i> بخش بعدی (شرایط محیطی)
                            </button>
                            <button class="btn btn-outline-secondary w-100" @click="exportProblemData()">
                                <i class="fas fa-download me-1"></i> خروجی اطلاعات
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Condition Section -->
        <div x-show="activeSection === 'condition'" x-transition>
            <div class="d-flex justify-content-between align-items-center mb-4">
                <h3 class="fw-bold">2. شرایط محیطی</h3>
                <button class="btn btn-gradient" @click="saveCondition()">
                    <i class="fas fa-save me-1"></i> ذخیره
                </button>
            </div>
            
            <div class="row">
                <div class="col-lg-8">
                    <div class="section-card mb-4">
                        <div class="card-header">
                            <span>شرایط آب و هوایی</span>
                        </div>
                        <div class="card-body">
                            <div class="row">
                                <div class="col-md-6 mb-3">
                                    <label class="form-label">دمای سردترین دوره سال (°C)</label>
                                    <input type="number" class="form-control" x-model="currentProject.condition.coldTemp" step="0.1" placeholder="مثال: 5">
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label class="form-label">دمای گرمترین دوره سال (°C)</label>
                                    <input type="number" class="form-control" x-model="currentProject.condition.warmTemp" step="0.1" placeholder="مثال: 40">
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label class="form-label">رطوبت نسبی سردترین دوره (%)</label>
                                    <input type="number" class="form-control" x-model="currentProject.condition.coldHumidity" min="0" max="100" placeholder="مثال: 60">
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label class="form-label">رطوبت نسبی گرمترین دوره (%)</label>
                                    <input type="number" class="form-control" x-model="currentProject.condition.warmHumidity" min="0" max="100" placeholder="مثال: 30">
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label class="form-label">دمای داخلی مطلوب (°C)</label>
                                    <input type="number" class="form-control" x-model="currentProject.condition.insideTemp" step="0.1" value="27">
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label class="form-label">رطوبت داخلی مطلوب (%)</label>
                                    <input type="number" class="form-control" x-model="currentProject.condition.insideHumidity" min="0" max="100" value="68">
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="section-card mb-4">
                        <div class="card-header">
                            <span>مشخصات سالن</span>
                        </div>
                        <div class="card-body">
                            <div class="row">
                                <div class="col-md-4 mb-3">
                                    <label class="form-label">طول سالن (متر)</label>
                                    <input type="number" class="form-control" x-model="currentProject.condition.hallLength" step="0.1" placeholder="مثال: 44">
                                </div>
                                <div class="col-md-4 mb-3">
                                    <label class="form-label">عرض سالن (متر)</label>
                                    <input type="number" class="form-control" x-model="currentProject.condition.hallWidth" step="0.1" placeholder="مثال: 21">
                                </div>
                                <div class="col-md-4 mb-3">
                                    <label class="form-label">ارتفاع سالن (متر)</label>
                                    <input type="number" class="form-control" x-model="currentProject.condition.hallHeight" step="0.1" placeholder="مثال: 5">
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label class="form-label">ضخامت دیوار (سانتی‌متر)</label>
                                    <input type="number" class="form-control" x-model="currentProject.condition.wallThickness" step="0.1" placeholder="مثال: 20">
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label class="form-label">ضخامت سقف (سانتی‌متر)</label>
                                    <input type="number" class="form-control" x-model="currentProject.condition.roofThickness" step="0.1" placeholder="مثال: 15">
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label class="form-label">تعداد درب</label>
                                    <input type="number" class="form-control" x-model="currentProject.condition.doorCount" placeholder="مثال: 4">
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label class="form-label">ابعاد درب (متر)</label>
                                    <input type="text" class="form-control" x-model="currentProject.condition.doorSize" placeholder="مثال: 2.5x3">
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label class="form-label">جنس دیوار</label>
                                    <select class="form-select" x-model="currentProject.condition.wallMaterial">
                                        <option value="brick">آجر</option>
                                        <option value="concrete">بتن</option>
                                        <option value="metal">فلزی</option>
                                        <option value="composite">کامپوزیت</option>
                                    </select>
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label class="form-label">جنس سقف</label>
                                    <select class="form-select" x-model="currentProject.condition.roofMaterial">
                                        <option value="concrete">بتن</option>
                                        <option value="metal">فلزی</option>
                                        <option value="composite">کامپوزیت</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="col-lg-4">
                    <div class="section-card mb-4">
                        <div class="card-header">
                            <span>محاسبات خودکار</span>
                        </div>
                        <div class="card-body">
                            <div class="calculation-result mb-3">
                                <div class="d-flex justify-content-between mb-2">
                                    <span>حجم سالن:</span>
                                    <span x-text="calculateHallVolume() + ' m³'"></span>
                                </div>
                                <div class="d-flex justify-content-between mb-2">
                                    <span>مساحت کف:</span>
                                    <span x-text="calculateHallArea() + ' m²'"></span>
                                </div>
                                <div class="d-flex justify-content-between mb-2">
                                    <span>مساحت دیوارها:</span>
                                    <span x-text="calculateWallArea() + ' m²'"></span>
                                </div>
                                <div class="d-flex justify-content-between">
                                    <span>مساحت سقف:</span>
                                    <span x-text="calculateRoofArea() + ' m²'"></span>
                                </div>
                            </div>
                            
                            <div class="calculation-result">
                                <div class="d-flex justify-content-between mb-2">
                                    <span>اختلاف دمای زمستان:</span>
                                    <span x-text="calculateTempDifference('cold') + ' °C'"></span>
                                </div>
                                <div class="d-flex justify-content-between mb-2">
                                    <span>اختلاف دمای تابستان:</span>
                                    <span x-text="calculateTempDifference('warm') + ' °C'"></span>
                                </div>
                                <div class="d-flex justify-content-between">
                                    <span>تعداد ACH پیشنهادی:</span>
                                    <span x-text="recommendedACH()"></span>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="section-card">
                        <div class="card-header">
                            <span>عملیات</span>
                        </div>
                        <div class="card-body">
                            <button class="btn btn-success-gradient w-100 mb-2" @click="saveCondition()">
                                <i class="fas fa-save me-1"></i> ذخیره شرایط
                            </button>
                            <div class="d-flex gap-2">
                                <button class="btn btn-outline-primary w-50" @click="changeSection('problem')">
                                    <i class="fas fa-arrow-right me-1"></i> بخش قبلی
                                </button>
                                <button class="btn btn-outline-primary w-50" @click="changeSection('station')">
                                    بخش بعدی <i class="fas fa-arrow-left me-1"></i>
                                </button>
                            </div>
                            <button class="btn btn-outline-secondary w-100 mt-2" @click="resetCondition()">
                                <i class="fas fa-redo me-1"></i> بازنشانی فرم
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Station Section -->
        <div x-show="activeSection === 'station'" x-transition>
            <div class="d-flex justify-content-between align-items-center mb-4">
                <h3 class="fw-bold">3. ایستگاه‌های AC</h3>
                <div>
                    <button class="btn btn-gradient me-2" @click="showNewStationModal = true">
                        <i class="fas fa-plus me-1"></i> ایستگاه جدید
                    </button>
                    <button class="btn btn-success-gradient" @click="saveStations()">
                        <i class="fas fa-save me-1"></i> ذخیره
                    </button>
                </div>
            </div>
            
            <div class="row">
                <div class="col-lg-8">
                    <!-- Stations List -->
                    <div class="section-card mb-4" x-show="currentProject.stations.length > 0">
                        <div class="card-header">
                            <span>لیست ایستگاه‌ها</span>
                            <span class="badge bg-light text-dark ms-2" x-text="currentProject.stations.length"></span>
                        </div>
                        <div class="card-body">
                            <div class="table-responsive">
                                <table class="table table-hover">
                                    <thead>
                                        <tr>
                                            <th>نام ایستگاه</th>
                                            <th>نوع</th>
                                            <th>تعداد فضا</th>
                                            <th>حجم هوا (m³/h)</th>
                                            <th>وضعیت</th>
                                            <th>عملیات</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <template x-for="(station, index) in currentProject.stations" :key="station.id">
                                            <tr>
                                                <td x-text="station.name"></td>
                                                <td>
                                                    <span class="badge" :class="{
                                                        'bg-primary': station.type === 'spinning',
                                                        'bg-success': station.type === 'finishing',
                                                        'bg-warning': station.type === 'weaving',
                                                        'bg-info': station.type === 'other'
                                                    }" x-text="getStationTypeLabel(station.type)"></span>
                                                </td>
                                                <td x-text="station.spaces ? station.spaces.length : 0"></td>
                                                <td x-text="calculateStationAirflow(station)"></td>
                                                <td>
                                                    <span class="section-indicator" :class="{
                                                        'section-complete': station.completion >= 80,
                                                        'section-incomplete': station.completion >= 30 && station.completion < 80,
                                                        'section-empty': station.completion < 30
                                                    }"></span>
                                                    <small x-text="station.completion + '%'"></small>
                                                </td>
                                                <td>
                                                    <div class="btn-group btn-group-sm">
                                                        <button class="btn btn-outline-primary" @click="editStation(index)">
                                                            <i class="fas fa-edit"></i>
                                                        </button>
                                                        <button class="btn btn-outline-info" @click="viewStationDetails(index)">
                                                            <i class="fas fa-eye"></i>
                                                        </button>
                                                        <button class="btn btn-outline-danger" @click="deleteStation(index)">
                                                            <i class="fas fa-trash"></i>
                                                        </button>
                                                    </div>
                                                </td>
                                            </tr>
                                        </template>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                    
                    <!-- No Stations Message -->
                    <div x-show="currentProject.stations.length === 0" class="text-center py-5">
                        <i class="fas fa-industry fa-4x text-muted mb-3"></i>
                        <h4 class="text-muted mb-3">هیچ ایستگاهی تعریف نشده است</h4>
                        <p class="text-muted mb-4">برای شروع طراحی، یک ایستگاه جدید ایجاد کنید.</p>
                        <button class="btn btn-gradient btn-lg" @click="showNewStationModal = true">
                            <i class="fas fa-plus me-2"></i> ایجاد اولین ایستگاه
                        </button>
                    </div>
                    
                    <!-- Station Templates -->
                    <div class="section-card">
                        <div class="card-header">
                            <span>قالب‌های آماده ایستگاه</span>
                        </div>
                        <div class="card-body">
                            <div class="row">
                                <div class="col-md-4 mb-3">
                                    <div class="border rounded p-3 text-center h-100">
                                        <i class="fas fa-spinner fa-2x text-primary mb-3"></i>
                                        <h5>ریسندگی استاندارد</h5>
                                        <p class="text-muted small">ایستگاه ریسندگی با 2 فضا و ACH 35</p>
                                        <button class="btn btn-outline-primary btn-sm" @click="addStationFromTemplate('spinning-standard')">
                                            استفاده از قالب
                                        </button>
                                    </div>
                                </div>
                                <div class="col-md-4 mb-3">
                                    <div class="border rounded p-3 text-center h-100">
                                        <i class="fas fa-tshirt fa-2x text-success mb-3"></i>
                                        <h5>تکمیل استاندارد</h5>
                                        <p class="text-muted small">ایستگاه تکمیل با 3 فضا و ACH 25</p>
                                        <button class="btn btn-outline-success btn-sm" @click="addStationFromTemplate('finishing-standard')">
                                            استفاده از قالب
                                        </button>
                                    </div>
                                </div>
                                <div class="col-md-4 mb-3">
                                    <div class="border rounded p-3 text-center h-100">
                                        <i class="fas fa-th fa-2x text-warning mb-3"></i>
                                        <h5>بافندگی استاندارد</h5>
                                        <p class="text-muted small">ایستگاه بافندگی با 2 فضا و ACH 30</p>
                                        <button class="btn btn-outline-warning btn-sm" @click="addStationFromTemplate('weaving-standard')">
                                            استفاده از قالب
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="col-lg-4">
                    <!-- Station Summary -->
                    <div class="section-card mb-4">
                        <div class="card-header">
                            <span>خلاصه ایستگاه‌ها</span>
                        </div>
                        <div class="card-body">
                            <div class="mb-3">
                                <small class="text-muted d-block">تعداد کل ایستگاه‌ها</small>
                                <h4 x-text="currentProject.stations.length"></h4>
                            </div>
                            
                            <div class="mb-3">
                                <small class="text-muted d-block">حجم هوای کل (m³/h)</small>
                                <h4 x-text="calculateTotalAirflow()"></h4>
                            </div>
                            
                            <div class="mb-3">
                                <small class="text-muted d-block">تعداد کل فضاها</small>
                                <h4 x-text="calculateTotalSpaces()"></h4>
                            </div>
                            
                            <div class="mb-3">
                                <small class="text-muted d-block">میانگین تکمیل</small>
                                <div class="progress" style="height: 8px;">
                                    <div class="progress-bar bg-success" role="progressbar" :style="'width: ' + calculateAverageStationCompletion() + '%'"></div>
                                </div>
                                <small class="text-muted" x-text="calculateAverageStationCompletion() + '%'"></small>
                            </div>
                            
                            <div class="result-box">
                                <div class="d-flex justify-content-between">
                                    <span>هزینه تخمینی ایستگاه‌ها:</span>
                                    <span x-text="formatCurrency(calculateStationsCost())"></span>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Quick Actions -->
                    <div class="section-card">
                        <div class="card-header">
                            <span>عملیات سریع</span>
                        </div>
                        <div class="card-body">
                            <button class="btn btn-outline-primary w-100 mb-2" @click="changeSection('station-space')">
                                <i class="fas fa-vector-square me-1"></i> مدیریت فضاها
                            </button>
                            <button class="btn btn-outline-success w-100 mb-2" @click="changeSection('station-duct')">
                                <i class="fas fa-drafting-compass me-1"></i> طراحی کانال
                            </button>
                            <button class="btn btn-outline-warning w-100 mb-2" @click="changeSection('station-vent')">
                                <i class="fas fa-wind me-1"></i> محاسبه دریچه‌ها
                            </button>
                            <button class="btn btn-outline-info w-100 mb-2" @click="changeSection('station-airwasher')">
                                <i class="fas fa-shower me-1"></i> محاسبه هوا شوی
                            </button>
                            <button class="btn btn-outline-danger w-100" @click="changeSection('station-fan')">
                                <i class="fas fa-fan me-1"></i> انتخاب فن‌ها
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Station Space Section -->
        <div x-show="activeSection === 'station-space'" x-transition>
            <div class="d-flex justify-content-between align-items-center mb-4">
                <h3 class="fw-bold">3-1. فضاهای ایستگاه</h3>
                <div>
                    <button class="btn btn-gradient me-2" @click="showNewSpaceModal = true">
                        <i class="fas fa-plus me-1"></i> فضای جدید
                    </button>
                    <button class="btn btn-success-gradient" @click="saveSpaces()">
                        <i class="fas fa-save me-1"></i> ذخیره
                    </button>
                </div>
            </div>
            
            <div class="row">
                <div class="col-lg-8">
                    <!-- Current Station Selector -->
                    <div class="section-card mb-4">
                        <div class="card-header">
                            <span>انتخاب ایستگاه</span>
                        </div>
                        <div class="card-body">
                            <div class="row align-items-center">
                                <div class="col-md-8 mb-3">
                                    <select class="form-select" x-model="currentStationIndex" @change="loadStationSpaces()">
                                        <template x-for="(station, index) in currentProject.stations" :key="station.id">
                                            <option :value="index" x-text="station.name"></option>
                                        </template>
                                    </select>
                                </div>
                                <div class="col-md-4 mb-3">
                                    <div class="d-flex align-items-center">
                                        <div class="me-3">
                                            <small class="text-muted d-block">تعداد فضاها</small>
                                            <span x-text="getCurrentStation().spaces ? getCurrentStation().spaces.length : 0" class="fw-bold"></span>
                                        </div>
                                        <div>
                                            <small class="text-muted d-block">حجم هوا</small>
                                            <span x-text="calculateStationAirflow(getCurrentStation())" class="fw-bold"></span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Spaces List -->
                    <div class="section-card" x-show="getCurrentStation().spaces && getCurrentStation().spaces.length > 0">
                        <div class="card-header">
                            <span>لیست فضاهای ایستگاه <span x-text="getCurrentStation().name"></span></span>
                            <span class="badge bg-light text-dark ms-2" x-text="getCurrentStation().spaces.length"></span>
                        </div>
                        <div class="card-body">
                            <div class="table-responsive">
                                <table class="table table-hover">
                                    <thead>
                                        <tr>
                                            <th>نام فضا</th>
                                            <th>طول (m)</th>
                                            <th>عرض (m)</th>
                                            <th>ارتفاع (m)</th>
                                            <th>مساحت (m²)</th>
                                            <th>حجم (m³)</th>
                                            <th>ACH</th>
                                            <th>حجم هوا (m³/h)</th>
                                            <th>عملیات</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <template x-for="(space, index) in getCurrentStation().spaces" :key="space.id">
                                            <tr>
                                                <td x-text="space.name"></td>
                                                <td x-text="space.length"></td>
                                                <td x-text="space.width"></td>
                                                <td x-text="space.height"></td>
                                                <td x-text="calculateSpaceArea(space)"></td>
                                                <td x-text="calculateSpaceVolume(space)"></td>
                                                <td x-text="space.ach"></td>
                                                <td x-text="calculateSpaceAirflow(space)"></td>
                                                <td>
                                                    <div class="btn-group btn-group-sm">
                                                        <button class="btn btn-outline-primary" @click="editSpace(index)">
                                                            <i class="fas fa-edit"></i>
                                                        </button>
                                                        <button class="btn btn-outline-danger" @click="deleteSpace(index)">
                                                            <i class="fas fa-trash"></i>
                                                        </button>
                                                    </div>
                                                </td>
                                            </tr>
                                        </template>
                                    </tbody>
                                    <tfoot>
                                        <tr class="table-primary">
                                            <td colspan="7" class="text-end fw-bold">مجموع:</td>
                                            <td x-text="calculateStationAirflow(getCurrentStation())" class="fw-bold"></td>
                                            <td></td>
                                        </tr>
                                    </tfoot>
                                </table>
                            </div>
                        </div>
                    </div>
                    
                    <!-- No Spaces Message -->
                    <div x-show="!getCurrentStation().spaces || getCurrentStation().spaces.length === 0" class="text-center py-5">
                        <i class="fas fa-vector-square fa-4x text-muted mb-3"></i>
                        <h4 class="text-muted mb-3">هیچ فضایی تعریف نشده است</h4>
                        <p class="text-muted mb-4">برای این ایستگاه فضایی تعریف نشده است. می‌توانید فضاهای جدید ایجاد کنید.</p>
                        <button class="btn btn-gradient btn-lg" @click="showNewSpaceModal = true">
                            <i class="fas fa-plus me-2"></i> ایجاد فضای جدید
                        </button>
                    </div>
                </div>
                
                <div class="col-lg-4">
                    <!-- Space Calculations -->
                    <div class="section-card mb-4">
                        <div class="card-header">
                            <span>محاسبات فضای فعلی</span>
                        </div>
                        <div class="card-body">
                            <div class="calculation-result mb-3">
                                <div class="d-flex justify-content-between mb-2">
                                    <span>مجموع مساحت فضاها:</span>
                                    <span x-text="calculateTotalSpaceArea() + ' m²'"></span>
                                </div>
                                <div class="d-flex justify-content-between mb-2">
                                    <span>مجموع حجم فضاها:</span>
                                    <span x-text="calculateTotalSpaceVolume() + ' m³'"></span>
                                </div>
                                <div class="d-flex justify-content-between mb-2">
                                    <span>مجموع حجم هوا:</span>
                                    <span x-text="calculateStationAirflow(getCurrentStation()) + ' m³/h'"></span>
                                </div>
                                <div class="d-flex justify-content-between">
                                    <span>حجم هوا بر ثانیه:</span>
                                    <span x-text="calculateAirflowPerSecond() + ' m³/s'"></span>
                                </div>
                            </div>
                            
                            <div class="mb-3">
                                <label class="form-label">ACH پیشنهادی بر اساس نوع فضا</label>
                                <select class="form-select" @change="updateSuggestedACH($event.target.value)">
                                    <option value="">انتخاب نوع فضا</option>
                                    <option value="spinning">ریسندگی (ACH: 35-45)</option>
                                    <option value="weaving">بافندگی (ACH: 30-40)</option>
                                    <option value="finishing">تکمیل (ACH: 25-35)</option>
                                    <option value="storage">انبار (ACH: 10-15)</option>
                                    <option value="office">اداری (ACH: 8-12)</option>
                                </select>
                            </div>
                            
                            <div class="mb-3">
                                <label class="form-label">ACH دستی</label>
                                <input type="number" class="form-control" x-model="suggestedACH" min="1" max="100" @input="updateAllSpacesACH()" placeholder="مقدار ACH">
                            </div>
                        </div>
                    </div>
                    
                    <!-- Quick Actions -->
                    <div class="section-card">
                        <div class="card-header">
                            <span>عملیات</span>
                        </div>
                        <div class="card-body">
                            <button class="btn btn-success-gradient w-100 mb-2" @click="saveSpaces()">
                                <i class="fas fa-save me-1"></i> ذخیره فضاها
                            </button>
                            <div class="d-flex gap-2 mb-2">
                                <button class="btn btn-outline-primary w-50" @click="changeSection('station')">
                                    <i class="fas fa-arrow-right me-1"></i> بازگشت
                                </button>
                                <button class="btn btn-outline-primary w-50" @click="changeSection('station-duct')">
                                    ادامه <i class="fas fa-arrow-left me-1"></i>
                                </button>
                            </div>
                            <button class="btn btn-outline-secondary w-100" @click="addSampleSpaces()">
                                <i class="fas fa-magic me-1"></i> افزودن فضاهای نمونه
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Duct Section -->
        <div x-show="activeSection === 'station-duct'" x-transition>
            <div class="d-flex justify-content-between align-items-center mb-4">
                <h3 class="fw-bold">3-2. طراحی کانال‌ها</h3>
                <div>
                    <button class="btn btn-gradient me-2" @click="showNewDuctModal = true">
                        <i class="fas fa-plus me-1"></i> کانال جدید
                    </button>
                    <button class="btn btn-success-gradient" @click="saveDucts()">
                        <i class="fas fa-save me-1"></i> ذخیره
                    </button>
                </div>
            </div>
            
            <div class="row">
                <div class="col-lg-8">
                    <div class="section-card mb-4">
                        <div class="card-header">
                            <span>کانال‌های تغذیه (Feed)</span>
                        </div>
                        <div class="card-body">
                            <div class="row mb-4">
                                <div class="col-md-6">
                                    <h6>کانال اصلی</h6>
                                    <div class="border rounded p-3">
                                        <div class="row">
                                            <div class="col-6 mb-2">
                                                <small class="text-muted d-block">قطر (m)</small>
                                                <span x-text="currentProject.ducts.feed.main.diameter || 'تعریف نشده'" class="fw-bold"></span>
                                            </div>
                                            <div class="col-6 mb-2">
                                                <small class="text-muted d-block">جنس</small>
                                                <span x-text="currentProject.ducts.feed.main.material || 'تعریف نشده'" class="fw-bold"></span>
                                            </div>
                                            <div class="col-6 mb-2">
                                                <small class="text-muted d-block">تعداد</small>
                                                <span x-text="currentProject.ducts.feed.main.count || 'تعریف نشده'" class="fw-bold"></span>
                                            </div>
                                            <div class="col-6 mb-2">
                                                <small class="text-muted d-block">مساحت مقطع (m²)</small>
                                                <span x-text="calculateMainFeedDuctArea()" class="fw-bold"></span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <h6>کانال انشعابی</h6>
                                    <div class="border rounded p-3">
                                        <div class="row">
                                            <div class="col-6 mb-2">
                                                <small class="text-muted d-block">قطر (m)</small>
                                                <span x-text="currentProject.ducts.feed.branch.diameter || 'تعریف نشده'" class="fw-bold"></span>
                                            </div>
                                            <div class="col-6 mb-2">
                                                <small class="text-muted d-block">جنس</small>
                                                <span x-text="currentProject.ducts.feed.branch.material || 'تعریف نشده'" class="fw-bold"></span>
                                            </div>
                                            <div class="col-6 mb-2">
                                                <small class="text-muted d-block">تعداد</small>
                                                <span x-text="currentProject.ducts.feed.branch.count || 'تعریف نشده'" class="fw-bold"></span>
                                            </div>
                                            <div class="col-6 mb-2">
                                                <small class="text-muted d-block">مساحت کل (m²)</small>
                                                <span x-text="calculateBranchFeedDuctArea()" class="fw-bold"></span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="calculation-result">
                                <div class="d-flex justify-content-between">
                                    <span>سرعت هوا در کانال اصلی:</span>
                                    <span x-text="calculateAirVelocityInMainFeedDuct() + ' m/s'"></span>
                                </div>
                                <small class="text-muted d-block">محدوده مجاز: 6-8 m/s</small>
                            </div>
                        </div>
                    </div>
                    
                    <div class="section-card">
                        <div class="card-header">
                            <span>کانال‌های برگشت (Return)</span>
                        </div>
                        <div class="card-body">
                            <div class="row mb-4">
                                <div class="col-md-6">
                                    <h6>کانال اصلی</h6>
                                    <div class="border rounded p-3">
                                        <div class="row">
                                            <div class="col-6 mb-2">
                                                <small class="text-muted d-block">عرض (m)</small>
                                                <span x-text="currentProject.ducts.return.main.width || 'تعریف نشده'" class="fw-bold"></span>
                                            </div>
                                            <div class="col-6 mb-2">
                                                <small class="text-muted d-block">ارتفاع (m)</small>
                                                <span x-text="currentProject.ducts.return.main.height || 'تعریف نشده'" class="fw-bold"></span>
                                            </div>
                                            <div class="col-6 mb-2">
                                                <small class="text-muted d-block">تعداد</small>
                                                <span x-text="currentProject.ducts.return.main.count || 'تعریف نشده'" class="fw-bold"></span>
                                            </div>
                                            <div class="col-6 mb-2">
                                                <small class="text-muted d-block">مساحت مقطع (m²)</small>
                                                <span x-text="calculateMainReturnDuctArea()" class="fw-bold"></span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <h6>کانال انشعابی</h6>
                                    <div class="border rounded p-3">
                                        <div class="row">
                                            <div class="col-6 mb-2">
                                                <small class="text-muted d-block">عرض (m)</small>
                                                <span x-text="currentProject.ducts.return.branch.width || 'تعریف نشده'" class="fw-bold"></span>
                                            </div>
                                            <div class="col-6 mb-2">
                                                <small class="text-muted d-block">ارتفاع (m)</small>
                                                <span x-text="currentProject.ducts.return.branch.height || 'تعریف نشده'" class="fw-bold"></span>
                                            </div>
                                            <div class="col-6 mb-2">
                                                <small class="text-muted d-block">تعداد</small>
                                                <span x-text="currentProject.ducts.return.branch.count || 'تعریف نشده'" class="fw-bold"></span>
                                            </div>
                                            <div class="col-6 mb-2">
                                                <small class="text-muted d-block">مساحت کل (m²)</small>
                                                <span x-text="calculateBranchReturnDuctArea()" class="fw-bold"></span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="calculation-result">
                                <div class="d-flex justify-content-between">
                                    <span>سرعت هوا در کانال اصلی برگشت:</span>
                                    <span x-text="calculateAirVelocityInMainReturnDuct() + ' m/s'"></span>
                                </div>
                                <small class="text-muted d-block">محدوده مجاز: 5-7 m/s</small>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="col-lg-4">
                    <!-- Duct Calculations -->
                    <div class="section-card mb-4">
                        <div class="card-header">
                            <span>محاسبات کانال</span>
                        </div>
                        <div class="card-body">
                            <div class="calculation-result mb-3">
                                <div class="d-flex justify-content-between mb-2">
                                    <span>کل مساحت کانال تغذیه:</span>
                                    <span x-text="calculateTotalFeedDuctArea() + ' m²'"></span>
                                </div>
                                <div class="d-flex justify-content-between mb-2">
                                    <span>کل مساحت کانال برگشت:</span>
                                    <span x-text="calculateTotalReturnDuctArea() + ' m²'"></span>
                                </div>
                                <div class="d-flex justify-content-between mb-2">
                                    <span>نسبت مساحت برگشت به تغذیه:</span>
                                    <span x-text="calculateReturnToFeedRatio()"></span>
                                </div>
                                <div class="d-flex justify-content-between">
                                    <span>افت فشار تخمینی:</span>
                                    <span x-text="calculateDuctPressureDrop() + ' Pa'"></span>
                                </div>
                            </div>
                            
                            <div class="mb-3">
                                <label class="form-label">جنس کانال</label>
                                <select class="form-select" x-model="currentProject.ducts.material">
                                    <option value="galvanize">گالوانیزه</option>
                                    <option value="aluminum">آلومینیوم</option>
                                    <option value="stainless">استنلس استیل</option>
                                    <option value="pvc">PVC</option>
                                </select>
                            </div>
                            
                            <div class="mb-3">
                                <label class="form-label">ضخامت کانال (mm)</label>
                                <input type="number" class="form-control" x-model="currentProject.ducts.thickness" min="0.5" max="3" step="0.1" placeholder="مثال: 0.8">
                            </div>
                            
                            <div class="mb-3">
                                <label class="form-label">عایق‌کاری</label>
                                <select class="form-select" x-model="currentProject.ducts.insulation">
                                    <option value="none">بدون عایق</option>
                                    <option value="fiberglass">فایبرگلاس</option>
                                    <option value="foam">فوم</option>
                                    <option value="rubber">لاستیک</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Quick Actions -->
                    <div class="section-card">
                        <div class="card-header">
                            <span>عملیات</span>
                        </div>
                        <div class="card-body">
                            <button class="btn btn-success-gradient w-100 mb-2" @click="saveDucts()">
                                <i class="fas fa-save me-1"></i> ذخیره کانال‌ها
                            </button>
                            <div class="d-flex gap-2 mb-2">
                                <button class="btn btn-outline-primary w-50" @click="changeSection('station-space')">
                                    <i class="fas fa-arrow-right me-1"></i> بخش قبلی
                                </button>
                                <button class="btn btn-outline-primary w-50" @click="changeSection('station-vent')">
                                    ادامه <i class="fas fa-arrow-left me-1"></i>
                                </button>
                            </div>
                            <button class="btn btn-outline-secondary w-100" @click="autoDesignDucts()">
                                <i class="fas fa-robot me-1"></i> طراحی خودکار کانال
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Vent Section -->
        <div x-show="activeSection === 'station-vent'" x-transition>
            <div class="d-flex justify-content-between align-items-center mb-4">
                <h3 class="fw-bold">3-3. محاسبه دریچه‌ها</h3>
                <div>
                    <button class="btn btn-gradient me-2" @click="showNewVentModal = true">
                        <i class="fas fa-plus me-1"></i> دریچه جدید
                    </button>
                    <button class="btn btn-success-gradient" @click="saveVents()">
                        <i class="fas fa-save me-1"></i> ذخیره
                    </button>
                </div>
            </div>
            
            <div class="row">
                <div class="col-lg-8">
                    <div class="section-card mb-4">
                        <div class="card-header">
                            <span>دریچه‌های تغذیه (Feed Vents)</span>
                        </div>
                        <div class="card-body">
                            <div class="row mb-4">
                                <div class="col-md-6 mb-3">
                                    <label class="form-label">قطر دریچه (m)</label>
                                    <input type="number" class="form-control" x-model="currentProject.vents.feed.diameter" step="0.1" placeholder="مثال: 0.3">
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label class="form-label">عرض دریچه (m)</label>
                                    <input type="number" class="form-control" x-model="currentProject.vents.feed.width" step="0.1" :placeholder="'پیش‌فرض: ' + (0.7 * currentProject.vents.feed.diameter).toFixed(2)">
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label class="form-label">طول دریچه (m)</label>
                                    <input type="number" class="form-control" x-model="currentProject.vents.feed.length" step="0.1" :placeholder="'پیش‌فرض: ' + (2 * (0.7 * currentProject.vents.feed.diameter)).toFixed(2)">
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label class="form-label">تعداد دریچه</label>
                                    <input type="number" class="form-control" x-model="currentProject.vents.feed.count" placeholder="مثال: 24">
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label class="form-label">سرعت هوا در دریچه (m/s)</label>
                                    <input type="number" class="form-control" x-model="currentProject.vents.feed.airVelocity" step="0.1" placeholder="مطلوب: 2.2">
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label class="form-label">نوع دریچه</label>
                                    <select class="form-select" x-model="currentProject.vents.feed.type">
                                        <option value="circular">دایره‌ای</option>
                                        <option value="rectangular">مستطیلی</option>
                                        <option value="square">مربعی</option>
                                        <option value="linear">خطی</option>
                                    </select>
                                </div>
                            </div>
                            
                            <div class="calculation-result">
                                <div class="d-flex justify-content-between mb-2">
                                    <span>مساحت مقطع کل دریچه‌ها:</span>
                                    <span x-text="calculateTotalFeedVentArea() + ' m²'"></span>
                                </div>
                                <div class="d-flex justify-content-between mb-2">
                                    <span>سرعت واقعی هوا:</span>
                                    <span x-text="calculateActualFeedVentVelocity() + ' m/s'"></span>
                                </div>
                                <div class="d-flex justify-content-between">
                                    <span>وضعیت:</span>
                                    <span :class="calculateFeedVentStatus().class" x-text="calculateFeedVentStatus().text"></span>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="section-card">
                        <div class="card-header">
                            <span>دریچه‌های برگشت (Return Vents)</span>
                        </div>
                        <div class="card-body">
                            <div class="row mb-4">
                                <div class="col-md-6 mb-3">
                                    <label class="form-label">نوع دریچه برگشت</label>
                                    <select class="form-select" x-model="currentProject.vents.return.type" @change="updateReturnVentType()">
                                        <option value="narrow">باریک (5cm)</option>
                                        <option value="wide">عریض (50cm)</option>
                                        <option value="custom">سفارشی</option>
                                    </select>
                                </div>
                                <div class="col-md-6 mb-3" x-show="currentProject.vents.return.type === 'custom'">
                                    <label class="form-label">عرض دریچه (m)</label>
                                    <input type="number" class="form-control" x-model="currentProject.vents.return.width" step="0.01" placeholder="مثال: 0.05">
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label class="form-label">طول دریچه (m)</label>
                                    <input type="number" class="form-control" x-model="currentProject.vents.return.length" step="0.1" placeholder="مثال: 0.5">
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label class="form-label">تعداد دریچه</label>
                                    <input type="number" class="form-control" x-model="currentProject.vents.return.count" placeholder="مثال: 32">
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label class="form-label">سرعت هوا در دریچه (m/s)</label>
                                    <input type="number" class="form-control" x-model="currentProject.vents.return.airVelocity" step="0.1" placeholder="مطلوب: 3.0">
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label class="form-label">جنس دریچه</label>
                                    <select class="form-select" x-model="currentProject.vents.return.material">
                                        <option value="galvanize">گالوانیزه</option>
                                        <option value="aluminum">آلومینیوم</option>
                                        <option value="plastic">پلاستیک</option>
                                    </select>
                                </div>
                            </div>
                            
                            <div class="calculation-result">
                                <div class="d-flex justify-content-between mb-2">
                                    <span>مساحت مقطع کل دریچه‌های برگشت:</span>
                                    <span x-text="calculateTotalReturnVentArea() + ' m²'"></span>
                                </div>
                                <div class="d-flex justify-content-between mb-2">
                                    <span>سرعت واقعی هوا:</span>
                                    <span x-text="calculateActualReturnVentVelocity() + ' m/s'"></span>
                                </div>
                                <div class="d-flex justify-content-between">
                                    <span>نسبت مساحت برگشت به تغذیه:</span>
                                    <span x-text="calculateReturnToFeedVentRatio()"></span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="col-lg-4">
                    <!-- Vent Calculations -->
                    <div class="section-card mb-4">
                        <div class="card-header">
                            <span>نتایج محاسبات</span>
                        </div>
                        <div class="card-body">
                            <div class="calculation-result mb-3">
                                <div class="d-flex justify-content-between mb-2">
                                    <span>کل مساحت دریچه‌های تغذیه:</span>
                                    <span x-text="calculateTotalFeedVentArea() + ' m²'"></span>
                                </div>
                                <div class="d-flex justify-content-between mb-2">
                                    <span>کل مساحت دریچه‌های برگشت:</span>
                                    <span x-text="calculateTotalReturnVentArea() + ' m²'"></span>
                                </div>
                                <div class="d-flex justify-content-between mb-2">
                                    <span>نسبت کل دریچه‌ها:</span>
                                    <span x-text="calculateTotalVentRatio()"></span>
                                </div>
                                <div class="d-flex justify-content-between">
                                    <span>تعداد کل دریچه‌ها:</span>
                                    <span x-text="parseInt(currentProject.vents.feed.count || 0) + parseInt(currentProject.vents.return.count || 0)"></span>
                                </div>
                            </div>
                            
                            <div class="mb-3">
                                <label class="form-label">ضریب تخلیه دریچه (Cd)</label>
                                <input type="number" class="form-control" x-model="currentProject.vents.dischargeCoefficient" min="0.5" max="0.9" step="0.05" value="0.65">
                            </div>
                            
                            <div class="mb-3">
                                <label class="form-label">فاصله دریچه‌ها از هم (m)</label>
                                <input type="number" class="form-control" x-model="currentProject.vents.spacing" step="0.1" placeholder="مثال: 3.0">
                            </div>
                            
                            <div class="mb-3">
                                <label class="form-label">ارتفاع نصب از کف (m)</label>
                                <input type="number" class="form-control" x-model="currentProject.vents.installationHeight" step="0.1" placeholder="مثال: 2.5">
                            </div>
                        </div>
                    </div>
                    
                    <!-- Vent Status -->
                    <div class="section-card mb-4">
                        <div class="card-header">
                            <span>وضعیت طراحی دریچه</span>
                        </div>
                        <div class="card-body">
                            <div class="alert" :class="getVentDesignStatus().class">
                                <i class="fas" :class="getVentDesignStatus().icon"></i>
                                <span x-text="getVentDesignStatus().message"></span>
                            </div>
                            
                            <div class="mt-3">
                                <small class="text-muted d-block mb-2">توصیه‌ها:</small>
                                <ul class="small ps-3">
                                    <li x-show="currentProject.vents.feed.airVelocity > 4">سرعت هوا در دریچه تغذیه بیشتر از 4 m/s است. استفاده از دریچه با شکست‌دهنده هوا توصیه می‌شود.</li>
                                    <li x-show="currentProject.vents.return.airVelocity > 4">سرعت هوا در دریچه برگشت بیشتر از 4 m/s است. نیاز به بازنگری دارد.</li>
                                    <li x-show="calculateReturnToFeedVentRatio() < 0.8">نسبت مساحت دریچه‌های برگشت به تغذیه کمتر از 0.8 است. افزایش دریچه‌های برگشت توصیه می‌شود.</li>
                                    <li x-show="calculateActualFeedVentVelocity() >= 2 && calculateActualFeedVentVelocity() <= 2.5">سرعت هوا در دریچه‌های تغذیه در محدوده ایده‌آل قرار دارد.</li>
                                    <li x-show="calculateActualReturnVentVelocity() >= 2.5 && calculateActualReturnVentVelocity() <= 3.5">سرعت هوا در دریچه‌های برگشت در محدوده ایده‌آل قرار دارد.</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Quick Actions -->
                    <div class="section-card">
                        <div class="card-header">
                            <span>عملیات</span>
                        </div>
                        <div class="card-body">
                            <button class="btn btn-success-gradient w-100 mb-2" @click="saveVents()">
                                <i class="fas fa-save me-1"></i> ذخیره دریچه‌ها
                            </button>
                            <div class="d-flex gap-2 mb-2">
                                <button class="btn btn-outline-primary w-50" @click="changeSection('station-duct')">
                                    <i class="fas fa-arrow-right me-1"></i> بخش قبلی
                                </button>
                                <button class="btn btn-outline-primary w-50" @click="changeSection('station-arf')">
                                    ادامه <i class="fas fa-arrow-left me-1"></i>
                                </button>
                            </div>
                            <button class="btn btn-outline-secondary w-100" @click="optimizeVents()">
                                <i class="fas fa-cogs me-1"></i> بهینه‌سازی خودکار
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- ARF Section -->
        <div x-show="activeSection === 'station-arf'" x-transition>
            <div class="d-flex justify-content-between align-items-center mb-4">
                <h3 class="fw-bold">3-4. فیلتر دوار (Rotary Filter)</h3>
                <div>
                    <button class="btn btn-gradient me-2" @click="showNewARFModal = true">
                        <i class="fas fa-plus me-1"></i> فیلتر جدید
                    </button>
                    <button class="btn btn-success-gradient" @click="saveARF()">
                        <i class="fas fa-save me-1"></i> ذخیره
                    </button>
                </div>
            </div>
            
            <div class="row">
                <div class="col-lg-8">
                    <div class="section-card mb-4">
                        <div class="card-header">
                            <span>مشخصات فیلتر دوار</span>
                        </div>
                        <div class="card-body">
                            <div class="row mb-4">
                                <div class="col-md-6 mb-3">
                                    <label class="form-label">قطر فیلتر (m)</label>
                                    <select class="form-select" x-model="currentProject.arf.diameter">
                                        <option value="2">2.0 متر</option>
                                        <option value="2.5" selected>2.5 متر</option>
                                        <option value="3">3.0 متر</option>
                                        <option value="custom">سفارشی</option>
                                    </select>
                                </div>
                                <div class="col-md-6 mb-3" x-show="currentProject.arf.diameter === 'custom'">
                                    <label class="form-label">قطر سفارشی (m)</label>
                                    <input type="number" class="form-control" x-model="currentProject.arf.customDiameter" step="0.1" min="1" max="5" placeholder="مثال: 2.8">
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label class="form-label">طول فیلتر (m)</label>
                                    <select class="form-select" x-model="currentProject.arf.length">
                                        <option value="1.7">1.7 متر</option>
                                        <option value="3.4">3.4 متر</option>
                                        <option value="5.1">5.1 متر</option>
                                        <option value="5.2" selected>5.2 متر</option>
                                        <option value="custom">سفارشی</option>
                                    </select>
                                </div>
                                <div class="col-md-6 mb-3" x-show="currentProject.arf.length === 'custom'">
                                    <label class="form-label">طول سفارشی (m)</label>
                                    <input type="number" class="form-control" x-model="currentProject.arf.customLength" step="0.1" min="1" max="10" placeholder="مثال: 4.5">
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label class="form-label">تعداد فیلتر</label>
                                    <input type="number" class="form-control" x-model="currentProject.arf.count" min="1" max="20" placeholder="مثال: 2">
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label class="form-label">سرعت چرخش (دور در دقیقه)</label>
                                    <input type="number" class="form-control" x-model="currentProject.arf.rotationSpeed" min="1" max="20" value="3">
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label class="form-label">جنس فیلتر</label>
                                    <select class="form-select" x-model="currentProject.arf.material">
                                        <option value="polyester">پلی استر</option>
                                        <option value="polypropylene">پلی پروپیلن</option>
                                        <option value="stainless">استنلس استیل</option>
                                    </select>
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label class="form-label">سرعت هوا در فیلتر (m/s)</label>
                                    <input type="number" class="form-control" x-model="currentProject.arf.airVelocity" step="0.01" min="0.5" max="2" placeholder="مطلوب: 1.0-1.22">
                                </div>
                            </div>
                            
                            <div class="calculation-result">
                                <div class="d-flex justify-content-between mb-2">
                                    <span>قطر مؤثر فیلتر:</span>
                                    <span x-text="getEffectiveDiameter() + ' m'"></span>
                                </div>
                                <div class="d-flex justify-content-between mb-2">
                                    <span>طول مؤثر فیلتر:</span>
                                    <span x-text="getEffectiveLength() + ' m'"></span>
                                </div>
                                <div class="d-flex justify-content-between mb-2">
                                    <span>مساحت سطح فیلتر:</span>
                                    <span x-text="calculateFilterSurfaceArea() + ' m²'"></span>
                                </div>
                                <div class="d-flex justify-content-between">
                                    <span>مساحت مؤثر کل فیلترها:</span>
                                    <span x-text="calculateTotalFilterArea() + ' m²'"></span>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Dust Collector Package -->
                    <div class="section-card">
                        <div class="card-header">
                            <span>بسته گردگیر (Dust Collector Package)</span>
                        </div>
                        <div class="card-body">
                            <div class="mb-4">
                                <h6>مشخصات بسته برای هر فیلتر دوار:</h6>
                                <ul class="list-group list-group-flush">
                                    <li class="list-group-item d-flex justify-content-between">
                                        <span>فن گردگیر سانتریفیوژ 3.3 کیلووات</span>
                                        <span x-text="currentProject.arf.count * 2"></span>
                                    </li>
                                    <li class="list-group-item d-flex justify-content-between">
                                        <span>شاخه اتصال</span>
                                        <span x-text="currentProject.arf.count"></span>
                                    </li>
                                    <li class="list-group-item d-flex justify-content-between">
                                        <span>کانال اتصال</span>
                                        <span x-text="currentProject.arf.count"></span>
                                    </li>
                                    <li class="list-group-item d-flex justify-content-between">
                                        <span>هدر برس‌زنی (به ازای هر 1.7 متر طول)</span>
                                        <span x-text="calculateBrushingHeaders()"></span>
                                    </li>
                                    <li class="list-group-item d-flex justify-content-between">
                                        <span>موتور مکانیزم 0.25 کیلووات</span>
                                        <span x-text="currentProject.arf.count"></span>
                                    </li>
                                    <li class="list-group-item d-flex justify-content-between">
                                        <span>گیربکس موتور 1 کیلووات</span>
                                        <span x-text="currentProject.arf.count"></span>
                                    </li>
                                    <li class="list-group-item d-flex justify-content-between">
                                        <span>کیسه گردگیر ثابت</span>
                                        <span x-text="currentProject.arf.count * 2"></span>
                                    </li>
                                    <li class="list-group-item d-flex justify-content-between">
                                        <span>کیسه گردگیر قابل حمل</span>
                                        <span x-text="currentProject.arf.count * 2"></span>
                                    </li>
                                    <li class="list-group-item d-flex justify-content-between">
                                        <span>بست و اتصالات و کانال انعطاف‌پذیر</span>
                                        <span>1 ست</span>
                                    </li>
                                </ul>
                            </div>
                            
                            <div class="calculation-result">
                                <div class="d-flex justify-content-between">
                                    <span>هزینه تخمینی بسته گردگیر:</span>
                                    <span x-text="formatCurrency(calculateDustCollectorPackageCost())"></span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="col-lg-4">
                    <!-- ARF Calculations -->
                    <div class="section-card mb-4">
                        <div class="card-header">
                            <span>محاسبات فیلتر دوار</span>
                        </div>
                        <div class="card-body">
                            <div class="calculation-result mb-3">
                                <div class="d-flex justify-content-between mb-2">
                                    <span>سرعت واقعی هوا در فیلتر:</span>
                                    <span x-text="calculateActualARFVelocity() + ' m/s'"></span>
                                </div>
                                <div class="d-flex justify-content-between mb-2">
                                    <span>وضعیت سرعت هوا:</span>
                                    <span :class="getARFVelocityStatus().class" x-text="getARFVelocityStatus().text"></span>
                                </div>
                                <div class="d-flex justify-content-between mb-2">
                                    <span>ظرفیت فیلتر:</span>
                                    <span x-text="calculateARFCapacity() + ' m³/h'"></span>
                                </div>
                                <div class="d-flex justify-content-between">
                                    <span>نسبت ظرفیت به نیاز:</span>
                                    <span x-text="calculateARFCapacityRatio()"></span>
                                </div>
                            </div>
                            
                            <div class="mb-3">
                                <label class="form-label">نوع غبار</label>
                                <select class="form-select" x-model="currentProject.arf.dustType">
                                    <option value="cotton">پنبه</option>
                                    <option value="wool">پشم</option>
                                    <option value="synthetic">الیاف مصنوعی</option>
                                    <option value="mixed">مخلوط</option>
                                </select>
                            </div>
                            
                            <div class="mb-3">
                                <label class="form-label">غلظت غبار (mg/m³)</label>
                                <input type="number" class="form-control" x-model="currentProject.arf.dustConcentration" min="1" max="1000" value="50">
                            </div>
                            
                            <div class="mb-3">
                                <label class="form-label">راندمان فیلتراسیون (%)</label>
                                <input type="number" class="form-control" x-model="currentProject.arf.filtrationEfficiency" min="80" max="99.9" step="0.1" value="95">
                            </div>
                            
                            <div class="mb-3">
                                <label class="form-label">فشار کاری (Pa)</label>
                                <input type="number" class="form-control" x-model="currentProject.arf.operatingPressure" min="100" max="2000" value="500">
                            </div>
                        </div>
                    </div>
                    
                    <!-- ARF Status -->
                    <div class="section-card mb-4">
                        <div class="card-header">
                            <span>وضعیت طراحی فیلتر</span>
                        </div>
                        <div class="card-body">
                            <div class="alert" :class="getARFDesignStatus().class">
                                <i class="fas" :class="getARFDesignStatus().icon"></i>
                                <span x-text="getARFDesignStatus().message"></span>
                            </div>
                            
                            <div class="mt-3">
                                <small class="text-muted d-block mb-2">توصیه‌ها:</small>
                                <ul class="small ps-3">
                                    <li x-show="calculateActualARFVelocity() > 1.22">سرعت هوا در فیلتر بیشتر از 1.22 m/s است. کاهش سرعت یا افزایش مساحت فیلتر توصیه می‌شود.</li>
                                    <li x-show="calculateActualARFVelocity() >= 0.9 && calculateActualARFVelocity() <= 1.1">سرعت هوا در فیلتر در محدوده ایده‌آل قرار دارد.</li>
                                    <li x-show="calculateARFCapacityRatio() < 1">ظرفیت فیلتر کمتر از نیاز است. افزایش تعداد یا ابعاد فیلتر توصیه می‌شود.</li>
                                    <li x-show="calculateARFCapacityRatio() > 1.5">ظرفیت فیلتر بسیار بیشتر از نیاز است. امکان کاهش ابعاد وجود دارد.</li>
                                    <li x-show="currentProject.arf.dustType === 'cotton'">برای غبار پنبه، تمیزکاری مکرر فیلتر توصیه می‌شود.</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Quick Actions -->
                    <div class="section-card">
                        <div class="card-header">
                            <span>عملیات</span>
                        </div>
                        <div class="card-body">
                            <button class="btn btn-success-gradient w-100 mb-2" @click="saveARF()">
                                <i class="fas fa-save me-1"></i> ذخیره فیلتر
                            </button>
                            <div class="d-flex gap-2 mb-2">
                                <button class="btn btn-outline-primary w-50" @click="changeSection('station-vent')">
                                    <i class="fas fa-arrow-right me-1"></i> بخش قبلی
                                </button>
                                <button class="btn btn-outline-primary w-50" @click="changeSection('station-damper')">
                                    ادامه <i class="fas fa-arrow-left me-1"></i>
                                </button>
                            </div>
                            <button class="btn btn-outline-secondary w-100" @click="autoDesignARF()">
                                <i class="fas fa-cogs me-1"></i> طراحی خودکار فیلتر
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Damper Section -->
        <div x-show="activeSection === 'station-damper'" x-transition>
            <div class="d-flex justify-content-between align-items-center mb-4">
                <h3 class="fw-bold">3-5. دمپرها</h3>
                <div>
                    <button class="btn btn-gradient me-2" @click="showNewDamperModal = true">
                        <i class="fas fa-plus me-1"></i> دمپر جدید
                    </button>
                    <button class="btn btn-success-gradient" @click="saveDampers()">
                        <i class="fas fa-save me-1"></i> ذخیره
                    </button>
                </div>
            </div>
            
            <div class="row">
                <div class="col-lg-8">
                    <div class="section-card mb-4">
                        <div class="card-header">
                            <span>دمپر تازه‌هوا (Fresh Air Damper)</span>
                        </div>
                        <div class="card-body">
                            <div class="row mb-4">
                                <div class="col-md-6 mb-3">
                                    <label class="form-label">ارتفاع (m)</label>
                                    <input type="number" class="form-control" x-model="currentProject.dampers.fresh.height" step="0.01" value="2.82">
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label class="form-label">عرض (m)</label>
                                    <input type="number" class="form-control" x-model="currentProject.dampers.fresh.width" step="0.01" value="1.52">
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label class="form-label">تعداد</label>
                                    <input type="number" class="form-control" x-model="currentProject.dampers.fresh.count" min="1" value="3">
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label class="form-label">جنس</label>
                                    <select class="form-select" x-model="currentProject.dampers.fresh.material">
                                        <option value="galvanize">گالوانیزه</option>
                                        <option value="aluminum">آلومینیوم</option>
                                        <option value="stainless">استنلس استیل</option>
                                    </select>
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label class="form-label">نوع کنترل</label>
                                    <select class="form-select" x-model="currentProject.dampers.fresh.controlType">
                                        <option value="manual">دستی</option>
                                        <option value="motorized">موتوری</option>
                                        <option value="automatic">اتوماتیک</option>
                                    </select>
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label class="form-label">سرعت هوا (m/s)</label>
                                    <input type="number" class="form-control" x-model="currentProject.dampers.fresh.airVelocity" step="0.1" placeholder="حداکثر: 6.6">
                                </div>
                            </div>
                            
                            <div class="calculation-result">
                                <div class="d-flex justify-content-between mb-2">
                                    <span>مساحت مؤثر دمپر:</span>
                                    <span x-text="calculateFreshDamperArea() + ' m²'"></span>
                                </div>
                                <div class="d-flex justify-content-between mb-2">
                                    <span>سرعت واقعی هوا:</span>
                                    <span x-text="calculateActualFreshDamperVelocity() + ' m/s'"></span>
                                </div>
                                <div class="d-flex justify-content-between">
                                    <span>وضعیت:</span>
                                    <span :class="getFreshDamperStatus().class" x-text="getFreshDamperStatus().text"></span>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="section-card mb-4">
                        <div class="card-header">
                            <span>دمپر اگزاست (Exhaust Damper)</span>
                        </div>
                        <div class="card-body">
                            <div class="row mb-4">
                                <div class="col-md-6 mb-3">
                                    <label class="form-label">ارتفاع (m)</label>
                                    <input type="number" class="form-control" x-model="currentProject.dampers.exhaust.height" step="0.01" value="2.82">
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label class="form-label">عرض (m)</label>
                                    <input type="number" class="form-control" x-model="currentProject.dampers.exhaust.width" step="0.01" value="1.52">
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label class="form-label">تعداد</label>
                                    <input type="number" class="form-control" x-model="currentProject.dampers.exhaust.count" min="1" value="3">
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label class="form-label">جنس</label>
                                    <select class="form-select" x-model="currentProject.dampers.exhaust.material">
                                        <option value="galvanize">گالوانیزه</option>
                                        <option value="aluminum">آلومینیوم</option>
                                        <option value="stainless">استنلس استیل</option>
                                    </select>
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label class="form-label">نوع کنترل</label>
                                    <select class="form-select" x-model="currentProject.dampers.exhaust.controlType">
                                        <option value="manual">دستی</option>
                                        <option value="motorized">موتوری</option>
                                        <option value="automatic">اتوماتیک</option>
                                    </select>
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label class="form-label">سرعت هوا (m/s)</label>
                                    <input type="number" class="form-control" x-model="currentProject.dampers.exhaust.airVelocity" step="0.1" placeholder="حداکثر: 6.6">
                                </div>
                            </div>
                            
                            <div class="calculation-result">
                                <div class="d-flex justify-content-between mb-2">
                                    <span>مساحت مؤثر دمپر:</span>
                                    <span x-text="calculateExhaustDamperArea() + ' m²'"></span>
                                </div>
                                <div class="d-flex justify-content-between mb-2">
                                    <span>سرعت واقعی هوا:</span>
                                    <span x-text="calculateActualExhaustDamperVelocity() + ' m/s'"></span>
                                </div>
                                <div class="d-flex justify-content-between">
                                    <span>وضعیت:</span>
                                    <span :class="getExhaustDamperStatus().class" x-text="getExhaustDamperStatus().text"></span>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="section-card">
                        <div class="card-header">
                            <span>دمپر برگشت (Return Damper)</span>
                        </div>
                        <div class="card-body">
                            <div class="row mb-4">
                                <div class="col-md-6 mb-3">
                                    <label class="form-label">ارتفاع (m)</label>
                                    <input type="number" class="form-control" x-model="currentProject.dampers.return.height" step="0.01" value="2.82">
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label class="form-label">عرض (m)</label>
                                    <input type="number" class="form-control" x-model="currentProject.dampers.return.width" step="0.01" value="1.52">
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label class="form-label">تعداد</label>
                                    <input type="number" class="form-control" x-model="currentProject.dampers.return.count" min="1" value="3">
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label class="form-label">جنس</label>
                                    <select class="form-select" x-model="currentProject.dampers.return.material">
                                        <option value="galvanize">گالوانیزه</option>
                                        <option value="aluminum">آلومینیوم</option>
                                        <option value="stainless">استنلس استیل</option>
                                    </select>
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label class="form-label">نوع کنترل</label>
                                    <select class="form-select" x-model="currentProject.dampers.return.controlType">
                                        <option value="manual">دستی</option>
                                        <option value="motorized">موتوری</option>
                                        <option value="automatic">اتوماتیک</option>
                                    </select>
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label class="form-label">سرعت هوا (m/s)</label>
                                    <input type="number" class="form-control" x-model="currentProject.dampers.return.airVelocity" step="0.1" placeholder="حداکثر: 5.8">
                                </div>
                            </div>
                            
                            <div class="calculation-result">
                                <div class="d-flex justify-content-between mb-2">
                                    <span>مساحت مؤثر دمپر:</span>
                                    <span x-text="calculateReturnDamperArea() + ' m²'"></span>
                                </div>
                                <div class="d-flex justify-content-between mb-2">
                                    <span>سرعت واقعی هوا:</span>
                                    <span x-text="calculateActualReturnDamperVelocity() + ' m/s'"></span>
                                </div>
                                <div class="d-flex justify-content-between">
                                    <span>وضعیت:</span>
                                    <span :class="getReturnDamperStatus().class" x-text="getReturnDamperStatus().text"></span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="col-lg-4">
                    <!-- Damper Calculations -->
                    <div class="section-card mb-4">
                        <div class="card-header">
                            <span>خلاصه دمپرها</span>
                        </div>
                        <div class="card-body">
                            <div class="calculation-result mb-3">
                                <div class="d-flex justify-content-between mb-2">
                                    <span>مساحت کل دمپر تازه‌هوا:</span>
                                    <span x-text="calculateFreshDamperArea() + ' m²'"></span>
                                </div>
                                <div class="d-flex justify-content-between mb-2">
                                    <span>مساحت کل دمپر اگزاست:</span>
                                    <span x-text="calculateExhaustDamperArea() + ' m²'"></span>
                                </div>
                                <div class="d-flex justify-content-between mb-2">
                                    <span>مساحت کل دمپر برگشت:</span>
                                    <span x-text="calculateReturnDamperArea() + ' m²'"></span>
                                </div>
                                <div class="d-flex justify-content-between">
                                    <span>مساحت کل همه دمپرها:</span>
                                    <span x-text="calculateTotalDamperArea() + ' m²'"></span>
                                </div>
                            </div>
                            
                            <div class="mb-3">
                                <label class="form-label">راندمان دمپرها (ضریب بازده)</label>
                                <input type="number" class="form-control" x-model="currentProject.dampers.efficiency" min="0.5" max="0.95" step="0.01" value="0.92">
                            </div>
                            
                            <div class="mb-3">
                                <label class="form-label">نوع مقطع دمپر</label>
                                    <select class="form-select" x-model="currentProject.dampers.sectionType">
                                        <option value="rectangular">مستطیلی</option>
                                        <option value="circular">دایره‌ای</option>
                                        <option value="square">مربعی</option>
                                    </select>
                                </div>
                                
                                <div class="mb-3">
                                    <label class="form-label">ضخامت ورق (mm)</label>
                                    <input type="number" class="form-control" x-model="currentProject.dampers.sheetThickness" min="0.5" max="3" step="0.1" value="1.0">
                                </div>
                                
                                <div class="mb-3">
                                    <label class="form-label">نوع آب‌بندی</label>
                                    <select class="form-select" x-model="currentProject.dampers.sealingType">
                                        <option value="rubber">لاستیکی</option>
                                        <option value="foam">فومی</option>
                                        <option value="metal">فلزی</option>
                                        <option value="none">بدون آب‌بندی</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Damper Status -->
                        <div class="section-card mb-4">
                            <div class="card-header">
                                <span>وضعیت طراحی دمپرها</span>
                            </div>
                            <div class="card-body">
                                <div class="alert" :class="getDamperDesignStatus().class">
                                    <i class="fas" :class="getDamperDesignStatus().icon"></i>
                                    <span x-text="getDamperDesignStatus().message"></span>
                                </div>
                                
                                <div class="mt-3">
                                    <small class="text-muted d-block mb-2">توصیه‌ها:</small>
                                    <ul class="small ps-3">
                                        <li x-show="calculateActualFreshDamperVelocity() > 6.6">سرعت هوا در دمپر تازه‌هوا بیشتر از 6.6 m/s است. افزایش ابعاد دمپر توصیه می‌شود.</li>
                                        <li x-show="calculateActualExhaustDamperVelocity() > 6.6">سرعت هوا در دمپر اگزاست بیشتر از 6.6 m/s است. افزایش ابعاد دمپر توصیه می‌شود.</li>
                                        <li x-show="calculateActualReturnDamperVelocity() > 5.8">سرعت هوا در دمپر برگشت بیشتر از 5.8 m/s است. افزایش ابعاد دمپر توصیه می‌شود.</li>
                                        <li x-show="calculateActualFreshDamperVelocity() >= 5 && calculateActualFreshDamperVelocity() <= 6">سرعت هوا در دمپر تازه‌هوا در محدوده مناسب قرار دارد.</li>
                                        <li x-show="calculateActualExhaustDamperVelocity() >= 5 && calculateActualExhaustDamperVelocity() <= 6">سرعت هوا در دمپر اگزاست در محدوده مناسب قرار دارد.</li>
                                        <li x-show="calculateActualReturnDamperVelocity() >= 4.5 && calculateActualReturnDamperVelocity() <= 5.5">سرعت هوا در دمپر برگشت در محدوده مناسب قرار دارد.</li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Quick Actions -->
                        <div class="section-card">
                            <div class="card-header">
                                <span>عملیات</span>
                            </div>
                            <div class="card-body">
                                <button class="btn btn-success-gradient w-100 mb-2" @click="saveDampers()">
                                    <i class="fas fa-save me-1"></i> ذخیره دمپرها
                                </button>
                                <div class="d-flex gap-2 mb-2">
                                    <button class="btn btn-outline-primary w-50" @click="changeSection('station-arf')">
                                        <i class="fas fa-arrow-right me-1"></i> بخش قبلی
                                    </button>
                                    <button class="btn btn-outline-primary w-50" @click="changeSection('station-airwasher')">
                                        ادامه <i class="fas fa-arrow-left me-1"></i>
                                    </button>
                                </div>
                                <button class="btn btn-outline-secondary w-100" @click="autoDesignDampers()">
                                    <i class="fas fa-cogs me-1"></i> طراحی خودکار دمپرها
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Airwasher Section -->
            <div x-show="activeSection === 'station-airwasher'" x-transition>
                <div class="d-flex justify-content-between align-items-center mb-4">
                    <h3 class="fw-bold">3-6. هوا شوی (Air Washer)</h3>
                    <div>
                        <button class="btn btn-gradient me-2" @click="showNewAirWasherModal = true">
                            <i class="fas fa-plus me-1"></i> هوا شوی جدید
                        </button>
                        <button class="btn btn-success-gradient" @click="saveAirWasher()">
                            <i class="fas fa-save me-1"></i> ذخیره
                        </button>
                    </div>
                </div>
                
                <div class="row">
                    <div class="col-lg-8">
                        <div class="section-card mb-4">
                            <div class="card-header">
                                <span>مشخصات اصلی هوا شوی</span>
                            </div>
                            <div class="card-body">
                                <div class="row mb-4">
                                    <div class="col-md-6 mb-3">
                                        <label class="form-label">ارتفاع (m)</label>
                                        <input type="number" class="form-control" x-model="currentProject.airwasher.height" step="0.1" value="3.2">
                                    </div>
                                    <div class="col-md-6 mb-3">
                                        <label class="form-label">عرض (m)</label>
                                        <input type="number" class="form-control" x-model="currentProject.airwasher.width" step="0.1" value="5.0">
                                    </div>
                                    <div class="col-md-6 mb-3">
                                        <label class="form-label">تعداد سلول</label>
                                        <input type="number" class="form-control" x-model="currentProject.airwasher.cellCount" min="1" max="10" value="2">
                                    </div>
                                    <div class="col-md-6 mb-3">
                                        <label class="form-label">سرعت هوا (m/s)</label>
                                        <input type="number" class="form-control" x-model="currentProject.airwasher.airVelocity" step="0.01" max="4" placeholder="حداکثر: 3.77">
                                    </div>
                                    <div class="col-md-6 mb-3">
                                        <label class="form-label">جنس بدنه</label>
                                        <select class="form-select" x-model="currentProject.airwasher.bodyMaterial">
                                            <option value="stainless">استنلس استیل</option>
                                            <option value="galvanize">گالوانیزه</option>
                                            <option value="fiberglass">فایبرگلاس</option>
                                        </select>
                                    </div>
                                    <div class="col-md-6 mb-3">
                                        <label class="form-label">نوع نازل</label>
                                        <select class="form-select" x-model="currentProject.airwasher.nozzleType">
                                            <option value="spiral">مارپیچ</option>
                                            <option value="cone">مخروطی</option>
                                            <option value="fullcone">مخروط کامل</option>
                                        </select>
                                    </div>
                                </div>
                                
                                <div class="calculation-result">
                                    <div class="d-flex justify-content-between mb-2">
                                        <span>مساحت مقطع هوا شوی:</span>
                                        <span x-text="calculateAirWasherCrossSection() + ' m²'"></span>
                                    </div>
                                    <div class="d-flex justify-content-between mb-2">
                                        <span>سرعت واقعی هوا:</span>
                                        <span x-text="calculateActualAirWasherVelocity() + ' m/s'"></span>
                                    </div>
                                    <div class="d-flex justify-content-between">
                                        <span>وضعیت سرعت هوا:</span>
                                        <span :class="getAirWasherVelocityStatus().class" x-text="getAirWasherVelocityStatus().text"></span>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="section-card">
                            <div class="card-header">
                                <span>محاسبات آب‌پاشی</span>
                            </div>
                            <div class="card-body">
                                <div class="row mb-4">
                                    <div class="col-md-6 mb-3">
                                        <label class="form-label">قطر نازل (mm)</label>
                                        <input type="number" class="form-control" x-model="currentProject.airwasher.nozzleDiameter" step="0.1" value="2.5">
                                    </div>
                                    <div class="col-md-6 mb-3">
                                        <label class="form-label">فشار آب (bar)</label>
                                        <input type="number" class="form-control" x-model="currentProject.airwasher.waterPressure" step="0.1" value="3.0">
                                    </div>
                                    <div class="col-md-6 mb-3">
                                        <label class="form-label">دبی آب هر نازل (لیتر/دقیقه)</label>
                                        <input type="number" class="form-control" x-model="currentProject.airwasher.nozzleFlowRate" step="0.1" value="2.5">
                                    </div>
                                    <div class="col-md-6 mb-3">
                                        <label class="form-label">دمای آب ورودی (°C)</label>
                                        <input type="number" class="form-control" x-model="currentProject.airwasher.waterInletTemp" step="0.1" value="15">
                                    </div>
                                </div>
                                
                                <div class="calculation-result mb-4">
                                    <div class="d-flex justify-content-between mb-2">
                                        <span>تعداد رایزرها:</span>
                                        <span x-text="calculateRisersCount()"></span>
                                    </div>
                                    <div class="d-flex justify-content-between mb-2">
                                        <span>تعداد نازل‌ها:</span>
                                        <span x-text="calculateNozzlesCount()"></span>
                                    </div>
                                    <div class="d-flex justify-content-between mb-2">
                                        <span>دبی کل آب (m³/h):</span>
                                        <span x-text="calculateTotalWaterFlow()"></span>
                                    </div>
                                    <div class="d-flex justify-content-between">
                                        <span>هد پمپ مورد نیاز (m):</span>
                                        <span x-text="calculateRequiredPumpHead()"></span>
                                    </div>
                                </div>
                                
                                <div class="calculation-result">
                                    <div class="d-flex justify-content-between">
                                        <span>توان الکتروموتور پمپ (kW):</span>
                                        <span x-text="calculatePumpMotorPower()"></span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="col-lg-4">
                        <!-- Air Washer Components -->
                        <div class="section-card mb-4">
                            <div class="card-header">
                                <span>اجزای هوا شوی</span>
                            </div>
                            <div class="card-body">
                                <div class="mb-3">
                                    <h6>بادشکن‌ها (Air Baffles)</h6>
                                    <div class="row mb-2">
                                        <div class="col-6">
                                            <small class="text-muted d-block">تعداد</small>
                                            <span x-text="currentProject.airwasher.airBaffles.count || 100" class="fw-bold"></span>
                                        </div>
                                        <div class="col-6">
                                            <small class="text-muted d-block">جنس</small>
                                            <span x-text="currentProject.airwasher.airBaffles.material || 'ABS'" class="fw-bold"></span>
                                        </div>
                                    </div>
                                    <div class="row">
                                        <div class="col-6">
                                            <small class="text-muted d-block">ابعاد (m)</small>
                                            <span x-text="(currentProject.airwasher.airBaffles.height || 0.4) + '×' + (currentProject.airwasher.airBaffles.width || 0.3)" class="fw-bold"></span>
                                        </div>
                                        <div class="col-6">
                                            <small class="text-muted d-block">وزن (kg)</small>
                                            <span x-text="currentProject.airwasher.airBaffles.weight || 13.5" class="fw-bold"></span>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="mb-3">
                                    <h6>الیمیناتورها (Eliminators)</h6>
                                    <div class="row mb-2">
                                        <div class="col-6">
                                            <small class="text-muted d-block">تعداد</small>
                                            <span x-text="currentProject.airwasher.eliminators.count || 212" class="fw-bold"></span>
                                        </div>
                                        <div class="col-6">
                                            <small class="text-muted d-block">جنس</small>
                                            <span x-text="currentProject.airwasher.eliminators.material || 'ABS'" class="fw-bold"></span>
                                        </div>
                                    </div>
                                    <div class="row">
                                        <div class="col-6">
                                            <small class="text-muted d-block">ابعاد (m)</small>
                                            <span x-text="(currentProject.airwasher.eliminators.height || 1.5) + '×' + (currentProject.airwasher.eliminators.width || 0.15)" class="fw-bold"></span>
                                        </div>
                                        <div class="col-6">
                                            <small class="text-muted d-block">وزن (kg)</small>
                                            <span x-text="currentProject.airwasher.eliminators.weight || 1.3" class="fw-bold"></span>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="mb-3">
                                    <h6>پمپ آب</h6>
                                    <div class="row">
                                        <div class="col-6">
                                            <small class="text-muted d-block">نوع</small>
                                            <span class="fw-bold">سانتریفیوژ</span>
                                        </div>
                                        <div class="col-6">
                                            <small class="text-muted d-block">دور موتور (rpm)</small>
                                            <span class="fw-bold">1000</span>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="mb-3">
                                    <h6>لوله‌کشی و اتصالات</h6>
                                    <small class="text-muted d-block">شامل: لوله ورودی و خروجی، فیلتر، توری، فلنج، زانویی، اتصالات، سرریز و ...</small>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Air Washer Status -->
                        <div class="section-card mb-4">
                            <div class="card-header">
                                <span>وضعیت طراحی هوا شوی</span>
                            </div>
                            <div class="card-body">
                                <div class="alert" :class="getAirWasherDesignStatus().class">
                                    <i class="fas" :class="getAirWasherDesignStatus().icon"></i>
                                    <span x-text="getAirWasherDesignStatus().message"></span>
                                </div>
                                
                                <div class="mt-3">
                                    <small class="text-muted d-block mb-2">توصیه‌ها:</small>
                                    <ul class="small ps-3">
                                        <li x-show="calculateActualAirWasherVelocity() > 3.77">سرعت هوا در هوا شوی بیشتر از 3.77 m/s است. افزایش ابعاد هوا شوی توصیه می‌شود.</li>
                                        <li x-show="calculateActualAirWasherVelocity() >= 3 && calculateActualAirWasherVelocity() <= 3.5">سرعت هوا در هوا شوی در محدوده مناسب قرار دارد.</li>
                                        <li x-show="calculateRequiredPumpHead() > 35">هد پمپ مورد نیاز بیشتر از 35 متر است. انتخاب پمپ با هد مناسب ضروری است.</li>
                                        <li x-show="currentProject.airwasher.nozzleType === 'spiral'">نازل‌های مارپیچ برای ایجاد ذرات ریز آب مناسب‌تر هستند.</li>
                                        <li>دمای آب ورودی باید حداقل ۱۰ درجه کمتر از دمای نقطه شبنم هوا باشد.</li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Quick Actions -->
                        <div class="section-card">
                            <div class="card-header">
                                <span>عملیات</span>
                            </div>
                            <div class="card-body">
                                <button class="btn btn-success-gradient w-100 mb-2" @click="saveAirWasher()">
                                    <i class="fas fa-save me-1"></i> ذخیره هوا شوی
                                </button>
                                <div class="d-flex gap-2 mb-2">
                                    <button class="btn btn-outline-primary w-50" @click="changeSection('station-damper')">
                                        <i class="fas fa-arrow-right me-1"></i> بخش قبلی
                                    </button>
                                    <button class="btn btn-outline-primary w-50" @click="changeSection('station-coil')">
                                        ادامه <i class="fas fa-arrow-left me-1"></i>
                                    </button>
                                </div>
                                <button class="btn btn-outline-secondary w-100" @click="autoDesignAirWasher()">
                                    <i class="fas fa-cogs me-1"></i> طراحی خودکار هوا شوی
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Additional sections for Coil, Fan, Report, FP, Templates would follow similar patterns -->
            
            <!-- This is a simplified version - the complete implementation would include all sections -->
        </div>
    </div>
    
    <!-- Modals will be implemented here -->
    
    <!-- Floating Action Button -->
    <div class="floating-action-btn" @click="scrollToTop()">
        <i class="fas fa-arrow-up"></i>
    </div>
    
    <script>
        function app() {
            return {
                // Application State
                activeSection: 'dashboard',
                sidebarCollapsed: false,
                mobileMenuOpen: false,
                isMobile: false,
                currentProjectId: 1,
                currentStationIndex: 0,
                currentDate: new Date().toLocaleDateString('fa-IR'),
                suggestedACH: 35,
                
                // Modal States
                showNewProjectModal: false,
                showNewStationModal: false,
                showNewSpaceModal: false,
                showNewDuctModal: false,
                showNewVentModal: false,
                showNewARFModal: false,
                showNewDamperModal: false,
                showNewAirWasherModal: false,
                showReportModal: false,
                
                // Sample Data
                projects: [
                    {
                        id: 1,
                        name: 'پروژه تهویه کارخانه نساجی سپهر',
                        description: 'طراحی کامل سیستم تهویه برای سالن ریسندگی و بافندگی',
                        location: 'کیلومتر 15 جاده قدیم قم',
                        author: 'مهندس احمدی',
                        version: '2.1.0',
                        createdAt: '1402/05/15',
                        progress: 65,
                        estimatedCost: 125000,
                        problem: {
                            name: 'پروژه تهویه کارخانه نساجی سپهر',
                            description: 'طراحی سیستم تهویه مطبوع برای سالن‌های ریسندگی و بافندگی با ظرفیت تولید ۵۰۰۰ کیلوگرم در روز',
                            location: 'کیلومتر 15 جاده قدیم قم',
                            author: 'مهندس احمدی',
                            version: '2.1.0',
                            startDate: '1402/05/20',
                            endDate: '1402/08/30',
                            industryType: 'composite',
                            productionCapacity: 5000,
                            lastUpdated: '1402/05/18'
                        },
                        condition: {
                            coldTemp: 5,
                            warmTemp: 40,
                            coldHumidity: 60,
                            warmHumidity: 30,
                            insideTemp: 27,
                            insideHumidity: 68,
                            hallLength: 44,
                            hallWidth: 21,
                            hallHeight: 5,
                            wallThickness: 20,
                            roofThickness: 15,
                            doorCount: 4,
                            doorSize: '2.5x3',
                            wallMaterial: 'brick',
                            roofMaterial: 'concrete'
                        },
                        stations: [
                            {
                                id: 1,
                                name: 'ایستگاه ریسندگی ۱',
                                type: 'spinning',
                                completion: 75,
                                spaces: [
                                    {id: 1, name: 'سالن ریسندگی', length: 44, width: 21, height: 5, ach: 35},
                                    {id: 2, name: 'فضای آزاد', length: 44, width: 12, height: 5, ach: 20}
                                ]
                            },
                            {
                                id: 2,
                                name: 'ایستگاه تکمیل ۱',
                                type: 'finishing',
                                completion: 45,
                                spaces: [
                                    {id: 3, name: 'سالن تکمیل', length: 30, width: 15, height: 5, ach: 25}
                                ]
                            }
                        ],
                        ducts: {
                            feed: {
                                main: {diameter: 1.5, material: 'galvanize', count: 1},
                                branch: {diameter: 1, material: 'galvanize', count: 3}
                            },
                            return: {
                                main: {width: 1.8, height: 2, count: 1},
                                branch: {width: 1.6, height: 1.2, count: 4}
                            },
                            material: 'galvanize',
                            thickness: 0.8,
                            insulation: 'fiberglass'
                        },
                        vents: {
                            feed: {
                                diameter: 0.3,
                                width: 0.21,
                                length: 0.42,
                                count: 24,
                                airVelocity: 2.2,
                                type: 'circular'
                            },
                            return: {
                                type: 'narrow',
                                width: 0.05,
                                length: 0.5,
                                count: 32,
                                airVelocity: 3.0,
                                material: 'galvanize'
                            },
                            dischargeCoefficient: 0.65,
                            spacing: 3.0,
                            installationHeight: 2.5
                        },
                        arf: {
                            diameter: '2.5',
                            length: '5.2',
                            count: 2,
                            rotationSpeed: 3,
                            material: 'polyester',
                            airVelocity: 1.0,
                            dustType: 'cotton',
                            dustConcentration: 50,
                            filtrationEfficiency: 95,
                            operatingPressure: 500
                        },
                        dampers: {
                            fresh: {height: 2.82, width: 1.52, count: 3, material: 'galvanize', controlType: 'motorized', airVelocity: 5.8},
                            exhaust: {height: 2.82, width: 1.52, count: 3, material: 'galvanize', controlType: 'motorized', airVelocity: 5.8},
                            return: {height: 2.82, width: 1.52, count: 3, material: 'galvanize', controlType: 'motorized', airVelocity: 5.0},
                            efficiency: 0.92,
                            sectionType: 'rectangular',
                            sheetThickness: 1.0,
                            sealingType: 'rubber'
                        },
                        airwasher: {
                            height: 3.2,
                            width: 5.0,
                            cellCount: 2,
                            airVelocity: 3.5,
                            bodyMaterial: 'stainless',
                            nozzleType: 'spiral',
                            nozzleDiameter: 2.5,
                            waterPressure: 3.0,
                            nozzleFlowRate: 2.5,
                            waterInletTemp: 15,
                            airBaffles: {count: 100, height: 0.4, width: 0.3, weight: 13.5, material: 'ABS'},
                            eliminators: {count: 212, height: 1.5, width: 0.15, weight: 1.3, material: 'ABS'}
                        },
                        filterPlans: [],
                        templates: []
                    },
                    {
                        id: 2,
                        name: 'پروژه کارخانه نساجی مروارید',
                        description: 'بازسازی سیستم تهویه سالن بافندگی',
                        location: 'شهرک صنعتی عباس آباد',
                        author: 'مهندس کریمی',
                        version: '1.5.2',
                        createdAt: '1402/03/10',
                        progress: 30,
                        estimatedCost: 85000
                    },
                    {
                        id: 3,
                        name: 'پروژه کارگاه ریسندگی پاک',
                        description: 'طراحی سیستم تهویه برای کارگاه کوچک ریسندگی',
                        location: 'جاده ساوه',
                        author: 'مهندس رضایی',
                        version: '1.0.0',
                        createdAt: '1402/06/22',
                        progress: 15,
                        estimatedCost: 45000
                    }
                ],
                
                // Initialize application
                init() {
                    this.checkMobile();
                    window.addEventListener('resize', () => this.checkMobile());
                    this.loadProject(1);
                },
                
                // Utility Methods
                checkMobile() {
                    this.isMobile = window.innerWidth < 992;
                    if (!this.isMobile) {
                        this.mobileMenuOpen = false;
                    }
                },
                
                getCurrentProject() {
                    return this.projects.find(p => p.id == this.currentProjectId) || this.projects[0];
                },
                
                getCurrentStation() {
                    return this.getCurrentProject().stations[this.currentStationIndex] || {spaces: []};
                },
                
                changeSection(section) {
                    this.activeSection = section;
                    if (this.isMobile) {
                        this.mobileMenuOpen = false;
                    }
                },
                
                scrollToTop() {
                    window.scrollTo({top: 0, behavior: 'smooth'});
                },
                
                formatCurrency(amount) {
                    if (!amount) return '$0';
                    return '$' + amount.toLocaleString('en-US');
                },
                
                getStationTypeLabel(type) {
                    const labels = {
                        'spinning': 'ریسندگی',
                        'weaving': 'بافندگی',
                        'finishing': 'تکمیل',
                        'other': 'سایر'
                    };
                    return labels[type] || type;
                },
                
                // Project Methods
                loadProject(id) {
                    this.currentProjectId = id;
                    this.currentStationIndex = 0;
                    this.changeSection('dashboard');
                },
                
                saveProblem() {
                    const project = this.getCurrentProject();
                    project.problem.lastUpdated = new Date().toLocaleDateString('fa-IR');
                    alert('اطلاعات پروژه ذخیره شد.');
                },
                
                saveCondition() {
                    alert('شرایط محیطی ذخیره شد.');
                },
                
                saveStations() {
                    alert('ایستگاه‌ها ذخیره شدند.');
                },
                
                saveSpaces() {
                    alert('فضاها ذخیره شدند.');
                },
                
                saveDucts() {
                    alert('کانال‌ها ذخیره شدند.');
                },
                
                saveVents() {
                    alert('دریچه‌ها ذخیره شدند.');
                },
                
                saveARF() {
                    alert('فیلتر دوار ذخیره شد.');
                },
                
                saveDampers() {
                    alert('دمپرها ذخیره شدند.');
                },
                
                saveAirWasher() {
                    alert('هوا شوی ذخیره شد.');
                },
                
                // Calculation Methods for Problem Section
                calculateEstimatedCost() {
                    const project = this.getCurrentProject();
                    let cost = 0;
                    cost += project.problem.productionCapacity * 25; // Base cost
                    cost += project.stations.length * 15000; // Station cost
                    return cost;
                },
                
                // Calculation Methods for Condition Section
                calculateHallVolume() {
                    const cond = this.getCurrentProject().condition;
                    return (cond.hallLength || 0) * (cond.hallWidth || 0) * (cond.hallHeight || 0);
                },
                
                calculateHallArea() {
                    const cond = this.getCurrentProject().condition;
                    return (cond.hallLength || 0) * (cond.hallWidth || 0);
                },
                
                calculateWallArea() {
                    const cond = this.getCurrentProject().condition;
                    const perimeter = 2 * ((cond.hallLength || 0) + (cond.hallWidth || 0));
                    return perimeter * (cond.hallHeight || 0);
                },
                
                calculateRoofArea() {
                    return this.calculateHallArea();
                },
                
                calculateTempDifference(season) {
                    const cond = this.getCurrentProject().condition;
                    if (season === 'cold') {
                        return Math.abs((cond.insideTemp || 27) - (cond.coldTemp || 0));
                    } else {
                        return Math.abs((cond.warmTemp || 0) - (cond.insideTemp || 27));
                    }
                },
                
                recommendedACH() {
                    const project = this.getCurrentProject();
                    if (project.problem.industryType === 'spinning') return '35-45';
                    if (project.problem.industryType === 'weaving') return '30-40';
                    if (project.problem.industryType === 'finishing') return '25-35';
                    return '20-30';
                },
                
                resetCondition() {
                    const cond = this.getCurrentProject().condition;
                    cond.coldTemp = 5;
                    cond.warmTemp = 40;
                    cond.coldHumidity = 60;
                    cond.warmHumidity = 30;
                    cond.insideTemp = 27;
                    cond.insideHumidity = 68;
                    cond.hallLength = 44;
                    cond.hallWidth = 21;
                    cond.hallHeight = 5;
                    cond.wallThickness = 20;
                    cond.roofThickness = 15;
                    cond.doorCount = 4;
                    cond.doorSize = '2.5x3';
                    cond.wallMaterial = 'brick';
                    cond.roofMaterial = 'concrete';
                },
                
                // Calculation Methods for Station Section
                calculateStationAirflow(station) {
                    if (!station || !station.spaces) return 0;
                    return station.spaces.reduce((total, space) => {
                        const volume = (space.length || 0) * (space.width || 0) * (space.height || 0);
                        return total + (volume * (space.ach || 0));
                    }, 0);
                },
                
                calculateTotalAirflow() {
                    const project = this.getCurrentProject();
                    return project.stations.reduce((total, station) => {
                        return total + this.calculateStationAirflow(station);
                    }, 0);
                },
                
                calculateTotalSpaces() {
                    const project = this.getCurrentProject();
                    return project.stations.reduce((total, station) => {
                        return total + (station.spaces ? station.spaces.length : 0);
                    }, 0);
                },
                
                calculateAverageStationCompletion() {
                    const project = this.getCurrentProject();
                    if (project.stations.length === 0) return 0;
                    const total = project.stations.reduce((sum, station) => sum + (station.completion || 0), 0);
                    return Math.round(total / project.stations.length);
                },
                
                calculateStationsCost() {
                    const project = this.getCurrentProject();
                    return project.stations.length * 15000;
                },
                
                addStationFromTemplate(template) {
                    const project = this.getCurrentProject();
                    const newId = project.stations.length > 0 ? Math.max(...project.stations.map(s => s.id)) + 1 : 1;
                    
                    let newStation;
                    if (template === 'spinning-standard') {
                        newStation = {
                            id: newId,
                            name: `ایستگاه ریسندگی ${newId}`,
                            type: 'spinning',
                            completion: 10,
                            spaces: [
                                {id: 1, name: 'سالن ریسندگی', length: 44, width: 21, height: 5, ach: 35},
                                {id: 2, name: 'فضای آزاد', length: 44, width: 12, height: 5, ach: 20}
                            ]
                        };
                    } else if (template === 'finishing-standard') {
                        newStation = {
                            id: newId,
                            name: `ایستگاه تکمیل ${newId}`,
                            type: 'finishing',
                            completion: 10,
                            spaces: [
                                {id: 1, name: 'سالن تکمیل', length: 30, width: 15, height: 5, ach: 25},
                                {id: 2, name: 'خشک کن', length: 15, width: 10, height: 5, ach: 30},
                                {id: 3, name: 'اتاق کنترل', length: 8, width: 6, height: 3, ach: 12}
                            ]
                        };
                    } else if (template === 'weaving-standard') {
                        newStation = {
                            id: newId,
                            name: `ایستگاه بافندگی ${newId}`,
                            type: 'weaving',
                            completion: 10,
                            spaces: [
                                {id: 1, name: 'سالن بافندگی', length: 40, width: 20, height: 5, ach: 30},
                                {id: 2, name: 'انبار نخ', length: 20, width: 15, height: 5, ach: 15}
                            ]
                        };
                    }
                    
                    if (newStation) {
                        project.stations.push(newStation);
                        this.currentStationIndex = project.stations.length - 1;
                        alert(`ایستگاه جدید از قالب ${template} ایجاد شد.`);
                    }
                },
                
                editStation(index) {
                    this.currentStationIndex = index;
                    this.changeSection('station-space');
                },
                
                viewStationDetails(index) {
                    this.currentStationIndex = index;
                    alert(`جزئیات ایستگاه ${this.getCurrentProject().stations[index].name} نمایش داده می‌شود.`);
                },
                
                deleteStation(index) {
                    if (confirm('آیا از حذف این ایستگاه اطمینان دارید؟')) {
                        this.getCurrentProject().stations.splice(index, 1);
                        if (this.currentStationIndex >= this.getCurrentProject().stations.length) {
                            this.currentStationIndex = Math.max(0, this.getCurrentProject().stations.length - 1);
                        }
                    }
                },
                
                // Calculation Methods for Space Section
                loadStationSpaces() {
                    // This method would load spaces for the selected station
                    // Currently handled by getCurrentStation()
                },
                
                calculateSpaceArea(space) {
                    return (space.length || 0) * (space.width || 0);
                },
                
                calculateSpaceVolume(space) {
                    return this.calculateSpaceArea(space) * (space.height || 0);
                },
                
                calculateSpaceAirflow(space) {
                    return this.calculateSpaceVolume(space) * (space.ach || 0);
                },
                
                calculateTotalSpaceArea() {
                    const station = this.getCurrentStation();
                    if (!station.spaces) return 0;
                    return station.spaces.reduce((total, space) => total + this.calculateSpaceArea(space), 0);
                },
                
                calculateTotalSpaceVolume() {
                    const station = this.getCurrentStation();
                    if (!station.spaces) return 0;
                    return station.spaces.reduce((total, space) => total + this.calculateSpaceVolume(space), 0);
                },
                
                calculateAirflowPerSecond() {
                    return this.calculateStationAirflow(this.getCurrentStation()) / 3600;
                },
                
                updateSuggestedACH(type) {
                    const achValues = {
                        'spinning': 35,
                        'weaving': 30,
                        'finishing': 25,
                        'storage': 12,
                        'office': 10
                    };
                    this.suggestedACH = achValues[type] || 35;
                },
                
                updateAllSpacesACH() {
                    const station = this.getCurrentStation();
                    if (station.spaces) {
                        station.spaces.forEach(space => {
                            space.ach = this.suggestedACH;
                        });
                    }
                },
                
                addSampleSpaces() {
                    const station = this.getCurrentStation();
                    if (!station.spaces) station.spaces = [];
                    
                    const newId = station.spaces.length > 0 ? Math.max(...station.spaces.map(s => s.id)) + 1 : 1;
                    
                    station.spaces.push({
                        id: newId,
                        name: `فضای نمونه ${newId}`,
                        length: 20,
                        width: 15,
                        height: 5,
                        ach: 25
                    });
                    
                    alert('فضای نمونه اضافه شد.');
                },
                
                // Calculation Methods for Duct Section
                calculateMainFeedDuctArea() {
                    const duct = this.getCurrentProject().ducts.feed.main;
                    const radius = (duct.diameter || 0) / 2;
                    return Math.PI * radius * radius * (duct.count || 0);
                },
                
                calculateBranchFeedDuctArea() {
                    const duct = this.getCurrentProject().ducts.feed.branch;
                    const radius = (duct.diameter || 0) / 2;
                    return Math.PI * radius * radius * (duct.count || 0);
                },
                
                calculateAirVelocityInMainFeedDuct() {
                    const area = this.calculateMainFeedDuctArea();
                    if (area === 0) return 0;
                    return this.calculateAirflowPerSecond() / area;
                },
                
                calculateMainReturnDuctArea() {
                    const duct = this.getCurrentProject().ducts.return.main;
                    return (duct.width || 0) * (duct.height || 0) * (duct.count || 0);
                },
                
                calculateBranchReturnDuctArea() {
                    const duct = this.getCurrentProject().ducts.return.branch;
                    return (duct.width || 0) * (duct.height || 0) * (duct.count || 0);
                },
                
                calculateAirVelocityInMainReturnDuct() {
                    const area = this.calculateMainReturnDuctArea();
                    if (area === 0) return 0;
                    return this.calculateAirflowPerSecond() / area;
                },
                
                calculateTotalFeedDuctArea() {
                    return this.calculateMainFeedDuctArea() + this.calculateBranchFeedDuctArea();
                },
                
                calculateTotalReturnDuctArea() {
                    return this.calculateMainReturnDuctArea() + this.calculateBranchReturnDuctArea();
                },
                
                calculateReturnToFeedRatio() {
                    const feedArea = this.calculateTotalFeedDuctArea();
                    if (feedArea === 0) return '0';
                    const ratio = this.calculateTotalReturnDuctArea() / feedArea;
                    return ratio.toFixed(2);
                },
                
                calculateDuctPressureDrop() {
                    const velocity = this.calculateAirVelocityInMainFeedDuct();
                    // Simplified pressure drop calculation
                    return Math.round(velocity * velocity * 0.6 * 10) / 10;
                },
                
                autoDesignDucts() {
                    const project = this.getCurrentProject();
                    const airflow = this.calculateTotalAirflow() / 3600; // m³/s
                    
                    // Auto design main feed duct
                    const mainFeedDiameter = Math.sqrt(airflow / (Math.PI * 6)) * 2; // Assuming 6 m/s velocity
                    project.ducts.feed.main.diameter = Math.max(0.5, Math.min(2.5, Math.round(mainFeedDiameter * 10) / 10));
                    project.ducts.feed.main.count = 1;
                    
                    // Auto design branch feed ducts
                    project.ducts.feed.branch.diameter = Math.max(0.3, Math.min(1.2, mainFeedDiameter * 0.6));
                    project.ducts.feed.branch.count = Math.max(2, Math.min(8, Math.round(airflow / 2)));
                    
                    // Auto design return ducts
                    const returnAirflow = airflow * 0.8; // 80% return
                    const mainReturnArea = returnAirflow / 5; // Assuming 5 m/s velocity
                    const side = Math.sqrt(mainReturnArea);
                    project.ducts.return.main.width = Math.max(0.8, Math.min(2.5, Math.round(side * 10) / 10));
                    project.ducts.return.main.height = Math.max(0.8, Math.min(2.5, Math.round(side * 10) / 10));
                    project.ducts.return.main.count = 1;
                    
                    project.ducts.return.branch.width = project.ducts.return.main.width * 0.8;
                    project.ducts.return.branch.height = project.ducts.return.main.height * 0.8;
                    project.ducts.return.branch.count = Math.max(2, Math.min(6, Math.round(returnAirflow / 1.5)));
                    
                    alert('کانال‌ها به صورت خودکار طراحی شدند.');
                },
                
                // Calculation Methods for Vent Section
                calculateTotalFeedVentArea() {
                    const vent = this.getCurrentProject().vents.feed;
                    const width = vent.width || (0.7 * (vent.diameter || 0));
                    const length = vent.length || (2 * width);
                    return (width * length * (vent.count || 0));
                },
                
                calculateActualFeedVentVelocity() {
                    const area = this.calculateTotalFeedVentArea();
                    if (area === 0) return 0;
                    return this.calculateAirflowPerSecond() / area;
                },
                
                calculateFeedVentStatus() {
                    const velocity = this.calculateActualFeedVentVelocity();
                    if (velocity === 0) return {text: 'تعریف نشده', class: 'text-secondary'};
                    if (velocity <= 2.5) return {text: 'مناسب', class: 'text-success'};
                    if (velocity <= 4) return {text: 'قابل قبول', class: 'text-warning'};
                    return {text: 'نیاز به بازنگری', class: 'text-danger'};
                },
                
                calculateTotalReturnVentArea() {
                    const vent = this.getCurrentProject().vents.return;
                    let width = vent.width;
                    if (vent.type === 'narrow') width = 0.05;
                    if (vent.type === 'wide') width = 0.5;
                    return (width || 0) * (vent.length || 0) * (vent.count || 0);
                },
                
                calculateActualReturnVentVelocity() {
                    const area = this.calculateTotalReturnVentArea();
                    if (area === 0) return 0;
                    return this.calculateAirflowPerSecond() * 0.8 / area; // 80% return air
                },
                
                calculateReturnToFeedVentRatio() {
                    const feedArea = this.calculateTotalFeedVentArea();
                    if (feedArea === 0) return '0';
                    const ratio = this.calculateTotalReturnVentArea() / feedArea;
                    return ratio.toFixed(2);
                },
                
                calculateTotalVentRatio() {
                    const feedArea = this.calculateTotalFeedVentArea();
                    const returnArea = this.calculateTotalReturnVentArea();
                    if (feedArea === 0) return '0';
                    const ratio = (feedArea + returnArea) / feedArea;
                    return ratio.toFixed(2);
                },
                
                updateReturnVentType() {
                    const vent = this.getCurrentProject().vents.return;
                    if (vent.type === 'narrow') {
                        vent.width = 0.05;
                    } else if (vent.type === 'wide') {
                        vent.width = 0.5;
                    }
                },
                
                getVentDesignStatus() {
                    const feedVelocity = this.calculateActualFeedVentVelocity();
                    const returnVelocity = this.calculateActualReturnVentVelocity();
                    
                    if (feedVelocity === 0 || returnVelocity === 0) {
                        return {
                            class: 'alert-warning',
                            icon: 'fa-exclamation-triangle',
                            message: 'لطفا مشخصات دریچه‌ها را تکمیل کنید.'
                        };
                    }
                    
                    if (feedVelocity > 4 || returnVelocity > 4) {
                        return {
                            class: 'alert-danger',
                            icon: 'fa-times-circle',
                            message: 'سرعت هوا در دریچه‌ها بیش از حد مجاز است.'
                        };
                    }
                    
                    if (feedVelocity >= 2 && feedVelocity <= 2.5 && returnVelocity >= 2.5 && returnVelocity <= 3.5) {
                        return {
                            class: 'alert-success',
                            icon: 'fa-check-circle',
                            message: 'طراحی دریچه‌ها مناسب است.'
                        };
                    }
                    
                    return {
                        class: 'alert-info',
                        icon: 'fa-info-circle',
                        message: 'طراحی دریچه‌ها نیاز به بررسی بیشتر دارد.'
                    };
                },
                
                optimizeVents() {
                    const project = this.getCurrentProject();
                    const airflow = this.calculateAirflowPerSecond();
                    
                    // Optimize feed vents for 2.2 m/s velocity
                    const optimalFeedArea = airflow / 2.2;
                    const ventDiameter = 0.3;
                    const ventWidth = 0.7 * ventDiameter;
                    const ventLength = 2 * ventWidth;
                    const ventArea = ventWidth * ventLength;
                    
                    project.vents.feed.count = Math.max(1, Math.round(optimalFeedArea / ventArea));
                    project.vents.feed.diameter = ventDiameter;
                    project.vents.feed.width = ventWidth;
                    project.vents.feed.length = ventLength;
                    project.vents.feed.airVelocity = 2.2;
                    
                    // Optimize return vents for 3.0 m/s velocity
                    const returnAirflow = airflow * 0.8;
                    const optimalReturnArea = returnAirflow / 3.0;
                    project.vents.return.type = 'narrow';
                    project.vents.return.width = 0.05;
                    project.vents.return.length = 0.5;
                    const returnVentArea = 0.05 * 0.5;
                    
                    project.vents.return.count = Math.max(1, Math.round(optimalReturnArea / returnVentArea));
                    project.vents.return.airVelocity = 3.0;
                    
                    alert('دریچه‌ها بهینه‌سازی شدند.');
                },
                
                // Calculation Methods for ARF Section
                getEffectiveDiameter() {
                    const arf = this.getCurrentProject().arf;
                    if (arf.diameter === 'custom') return arf.customDiameter || 2.5;
                    return parseFloat(arf.diameter) || 2.5;
                },
                
                getEffectiveLength() {
                    const arf = this.getCurrentProject().arf;
                    if (arf.length === 'custom') return arf.customLength || 5.2;
                    return parseFloat(arf.length) || 5.2;
                },
                
                calculateFilterSurfaceArea() {
                    const diameter = this.getEffectiveDiameter();
                    const length = this.getEffectiveLength();
                    return Math.PI * diameter * length;
                },
                
                calculateTotalFilterArea() {
                    const arf = this.getCurrentProject().arf;
                    return this.calculateFilterSurfaceArea() * (arf.count || 1);
                },
                
                calculateActualARFVelocity() {
                    const area = this.calculateTotalFilterArea();
                    if (area === 0) return 0;
                    return this.calculateAirflowPerSecond() / area;
                },
                
                getARFVelocityStatus() {
                    const velocity = this.calculateActualARFVelocity();
                    if (velocity === 0) return {text: 'تعریف نشده', class: 'text-secondary'};
                    if (velocity <= 1.22) return {text: 'مناسب', class: 'text-success'};
                    if (velocity <= 1.5) return {text: 'قابل قبول', class: 'text-warning'};
                    return {text: 'بیش از حد مجاز', class: 'text-danger'};
                },
                
                calculateARFCapacity() {
                    const area = this.calculateTotalFilterArea();
                    return area * 1.0 * 3600; // 1.0 m/s velocity
                },
                
                calculateARFCapacityRatio() {
                    const capacity = this.calculateARFCapacity();
                    const need = this.calculateTotalAirflow();
                    if (need === 0) return '0';
                    const ratio = capacity / need;
                    return ratio.toFixed(2);
                },
                
                calculateBrushingHeaders() {
                    const arf = this.getCurrentProject().arf;
                    const length = this.getEffectiveLength();
                    return Math.ceil(length / 1.7) * (arf.count || 1);
                },
                
                calculateDustCollectorPackageCost() {
                    const arf = this.getCurrentProject().arf;
                    const count = arf.count || 1;
                    return count * 8500; // $8500 per filter package
                },
                
                getARFDesignStatus() {
                    const velocity = this.calculateActualARFVelocity();
                    const capacityRatio = parseFloat(this.calculateARFCapacityRatio());
                    
                    if (velocity === 0) {
                        return {
                            class: 'alert-warning',
                            icon: 'fa-exclamation-triangle',
                            message: 'لطفا مشخصات فیلتر را تکمیل کنید.'
                        };
                    }
                    
                    if (velocity > 1.22) {
                        return {
                            class: 'alert-danger',
                            icon: 'fa-times-circle',
                            message: 'سرعت هوا در فیلتر بیش از حد مجاز است.'
                        };
                    }
                    
                    if (capacityRatio < 1) {
                        return {
                            class: 'alert-warning',
                            icon: 'fa-exclamation-triangle',
                            message: 'ظرفیت فیلتر کمتر از نیاز است.'
                        };
                    }
                    
                    if (velocity >= 0.9 && velocity <= 1.1 && capacityRatio >= 1 && capacityRatio <= 1.3) {
                        return {
                            class: 'alert-success',
                            icon: 'fa-check-circle',
                            message: 'طراحی فیلتر مناسب است.'
                        };
                    }
                    
                    return {
                        class: 'alert-info',
                        icon: 'fa-info-circle',
                        message: 'طراحی فیلتر نیاز به بررسی بیشتر دارد.'
                    };
                },
                
                autoDesignARF() {
                    const project = this.getCurrentProject();
                    const airflow = this.calculateTotalAirflow() / 3600; // m³/s
                    
                    // Design for 1.0 m/s velocity
                    const requiredArea = airflow / 1.0;
                    
                    // Use standard 2.5m diameter, 5.2m length filter
                    const filterArea = Math.PI * 2.5 * 5.2;
                    
                    project.arf.count = Math.max(1, Math.ceil(requiredArea / filterArea));
                    project.arf.diameter = '2.5';
                    project.arf.length = '5.2';
                    project.arf.airVelocity = 1.0;
                    
                    alert('فیلتر دوار به صورت خودکار طراحی شد.');
                },
                
                // Calculation Methods for Damper Section
                calculateFreshDamperArea() {
                    const damper = this.getCurrentProject().dampers.fresh;
                    const efficiency = this.getCurrentProject().dampers.efficiency || 0.92;
                    return (damper.height || 0) * (damper.width || 0) * (damper.count || 0) * efficiency;
                },
                
                calculateActualFreshDamperVelocity() {
                    const area = this.calculateFreshDamperArea();
                    if (area === 0) return 0;
                    return this.calculateAirflowPerSecond() * 0.2 / area; // 20% fresh air
                },
                
                getFreshDamperStatus() {
                    const velocity = this.calculateActualFreshDamperVelocity();
                    if (velocity === 0) return {text: 'تعریف نشده', class: 'text-secondary'};
                    if (velocity <= 6.6) return {text: 'مناسب', class: 'text-success'};
                    if (velocity <= 8) return {text: 'قابل قبول', class: 'text-warning'};
                    return {text: 'بیش از حد مجاز', class: 'text-danger'};
                },
                
                calculateExhaustDamperArea() {
                    const damper = this.getCurrentProject().dampers.exhaust;
                    const efficiency = this.getCurrentProject().dampers.efficiency || 0.92;
                    return (damper.height || 0) * (damper.width || 0) * (damper.count || 0) * efficiency;
                },
                
                calculateActualExhaustDamperVelocity() {
                    const area = this.calculateExhaustDamperArea();
                    if (area === 0) return 0;
                    return this.calculateAirflowPerSecond() * 0.2 / area; // 20% exhaust air
                },
                
                getExhaustDamperStatus() {
                    const velocity = this.calculateActualExhaustDamperVelocity();
                    if (velocity === 0) return {text: 'تعریف نشده', class: 'text-secondary'};
                    if (velocity <= 6.6) return {text: 'مناسب', class: 'text-success'};
                    if (velocity <= 8) return {text: 'قابل قبول', class: 'text-warning'};
                    return {text: 'بیش از حد مجاز', class: 'text-danger'};
                },
                
                calculateReturnDamperArea() {
                    const damper = this.getCurrentProject().dampers.return;
                    const efficiency = this.getCurrentProject().dampers.efficiency || 0.92;
                    return (damper.height || 0) * (damper.width || 0) * (damper.count || 0) * efficiency;
                },
                
                calculateActualReturnDamperVelocity() {
                    const area = this.calculateReturnDamperArea();
                    if (area === 0) return 0;
                    return this.calculateAirflowPerSecond() * 0.8 / area; // 80% return air
                },
                
                getReturnDamperStatus() {
                    const velocity = this.calculateActualReturnDamperVelocity();
                    if (velocity === 0) return {text: 'تعریف نشده', class: 'text-secondary'};
                    if (velocity <= 5.8) return {text: 'مناسب', class: 'text-success'};
                    if (velocity <= 7) return {text: 'قابل قبول', class: 'text-warning'};
                    return {text: 'بیش از حد مجاز', class: 'text-danger'};
                },
                
                calculateTotalDamperArea() {
                    return this.calculateFreshDamperArea() + 
                           this.calculateExhaustDamperArea() + 
                           this.calculateReturnDamperArea();
                },
                
                getDamperDesignStatus() {
                    const freshVelocity = this.calculateActualFreshDamperVelocity();
                    const exhaustVelocity = this.calculateActualExhaustDamperVelocity();
                    const returnVelocity = this.calculateActualReturnDamperVelocity();
                    
                    if (freshVelocity === 0 || exhaustVelocity === 0 || returnVelocity === 0) {
                        return {
                            class: 'alert-warning',
                            icon: 'fa-exclamation-triangle',
                            message: 'لطفا مشخصات دمپرها را تکمیل کنید.'
                        };
                    }
                    
                    if (freshVelocity > 6.6 || exhaustVelocity > 6.6 || returnVelocity > 5.8) {
                        return {
                            class: 'alert-danger',
                            icon: 'fa-times-circle',
                            message: 'سرعت هوا در برخی دمپرها بیش از حد مجاز است.'
                        };
                    }
                    
                    if (freshVelocity >= 5 && freshVelocity <= 6 && 
                        exhaustVelocity >= 5 && exhaustVelocity <= 6 && 
                        returnVelocity >= 4.5 && returnVelocity <= 5.5) {
                        return {
                            class: 'alert-success',
                            icon: 'fa-check-circle',
                            message: 'طراحی دمپرها مناسب است.'
                        };
                    }
                    
                    return {
                        class: 'alert-info',
                        icon: 'fa-info-circle',
                        message: 'طراحی دمپرها نیاز به بررسی بیشتر دارد.'
                    };
                },
                
                autoDesignDampers() {
                    const project = this.getCurrentProject();
                    const airflow = this.calculateAirflowPerSecond();
                    
                    // Design fresh damper for 20% fresh air at 5.8 m/s
                    const freshAirflow = airflow * 0.2;
                    const freshArea = freshAirflow / 5.8;
                    const damperArea = 2.82 * 1.52 * 0.92; // Standard damper area with efficiency
                    
                    project.dampers.fresh.count = Math.max(1, Math.ceil(freshArea / damperArea));
                    project.dampers.fresh.height = 2.82;
                    project.dampers.fresh.width = 1.52;
                    project.dampers.fresh.airVelocity = 5.8;
                    
                    // Design exhaust damper same as fresh
                    project.dampers.exhaust.count = project.dampers.fresh.count;
                    project.dampers.exhaust.height = 2.82;
                    project.dampers.exhaust.width = 1.52;
                    project.dampers.exhaust.airVelocity = 5.8;
                    
                    // Design return damper for 80% return air at 5.0 m/s
                    const returnAirflow = airflow * 0.8;
                    const returnArea = returnAirflow / 5.0;
                    project.dampers.return.count = Math.max(1, Math.ceil(returnArea / damperArea));
                    project.dampers.return.height = 2.82;
                    project.dampers.return.width = 1.52;
                    project.dampers.return.airVelocity = 5.0;
                    
                    alert('دمپرها به صورت خودکار طراحی شدند.');
                },
                
                // Calculation Methods for Air Washer Section
                calculateAirWasherCrossSection() {
                    const aw = this.getCurrentProject().airwasher;
                    return (aw.height || 0) * (aw.width || 0) * (aw.cellCount || 1);
                },
                
                calculateActualAirWasherVelocity() {
                    const area = this.calculateAirWasherCrossSection();
                    if (area === 0) return 0;
                    return this.calculateAirflowPerSecond() / area;
                },
                
                getAirWasherVelocityStatus() {
                    const velocity = this.calculateActualAirWasherVelocity();
                    if (velocity === 0) return {text: 'تعریف نشده', class: 'text-secondary'};
                    if (velocity <= 3.77) return {text: 'مناسب', class: 'text-success'};
                    if (velocity <= 4) return {text: 'قابل قبول', class: 'text-warning'};
                    return {text: 'بیش از حد مجاز', class: 'text-danger'};
                },
                
                calculateRisersCount() {
                    const aw = this.getCurrentProject().airwasher;
                    return Math.ceil(2 * (aw.width || 0) / 0.304);
                },
                
                calculateNozzlesCount() {
                    const aw = this.getCurrentProject().airwasher;
                    const risers = this.calculateRisersCount();
                    return risers * Math.ceil(((aw.height || 0) - 0.11) / 0.076);
                },
                
                calculateTotalWaterFlow() {
                    const aw = this.getCurrentProject().airwasher;
                    const nozzles = this.calculateNozzlesCount();
                    return (nozzles * (aw.nozzleFlowRate || 2.5) * 60) / 1000;
                },
                
                calculateRequiredPumpHead() {
                    // Simplified calculation
                    return 35; // Standard head for textile air washer
                },
                
                calculatePumpMotorPower() {
                    const flow = this.calculateTotalWaterFlow();
                    const head = this.calculateRequiredPumpHead();
                    // Power (kW) = (Flow * Head * 9.81) / (3600 * Efficiency)
                    // Assuming 70% efficiency
                    return Math.round((flow * head * 9.81) / (3600 * 0.7) * 10) / 10;
                },
                
                getAirWasherDesignStatus() {
                    const velocity = this.calculateActualAirWasherVelocity();
                    
                    if (velocity === 0) {
                        return {
                            class: 'alert-warning',
                            icon: 'fa-exclamation-triangle',
                            message: 'لطفا مشخصات هوا شوی را تکمیل کنید.'
                        };
                    }
                    
                    if (velocity > 3.77) {
                        return {
                            class: 'alert-danger',
                            icon: 'fa-times-circle',
                            message: 'سرعت هوا در هوا شوی بیش از حد مجاز است.'
                        };
                    }
                    
                    if (velocity >= 3 && velocity <= 3.5) {
                        return {
                            class: 'alert-success',
                            icon: 'fa-check-circle',
                            message: 'طراحی هوا شوی مناسب است.'
                        };
                    }
                    
                    return {
                        class: 'alert-info',
                        icon: 'fa-info-circle',
                        message: 'طراحی هوا شوی نیاز به بررسی بیشتر دارد.'
                    };
                },
                
                autoDesignAirWasher() {
                    const project = this.getCurrentProject();
                    const airflow = this.calculateTotalAirflow() / 3600; // m³/s
                    
                    // Design for 3.5 m/s velocity
                    const requiredArea = airflow / 3.5;
                    
                    // Use standard 3.2m height, 5.0m width air washer
                    const cellArea = 3.2 * 5.0;
                    
                    project.airwasher.cellCount = Math.max(1, Math.ceil(requiredArea / cellArea));
                    project.airwasher.height = 3.2;
                    project.airwasher.width = 5.0;
                    project.airwasher.airVelocity = 3.5;
                    
                    // Set standard components
                    project.airwasher.airBaffles = {count: 100, height: 0.4, width: 0.3, weight: 13.5, material: 'ABS'};
                    project.airwasher.eliminators = {count: 212, height: 1.5, width: 0.15, weight: 1.3, material: 'ABS'};
                    
                    alert('هوا شوی به صورت خودکار طراحی شد.');
                },
                
                // Dashboard Calculations
                get projectProgress() {
                    const project = this.getCurrentProject();
                    return project.progress || 0;
                },
                
                get totalSections() {
                    return 10; // Total number of sections in the application
                },
                
                get completedSections() {
                    const project = this.getCurrentProject();
                    let completed = 0;
                    
                    if (project.problem && project.problem.name) completed++;
                    if (project.condition && project.condition.coldTemp !== undefined) completed++;
                    if (project.stations && project.stations.length > 0) completed++;
                    if (project.ducts && project.ducts.feed && project.ducts.feed.main.diameter) completed++;
                    if (project.vents && project.vents.feed && project.vents.feed.diameter) completed++;
                    if (project.arf && project.arf.diameter) completed++;
                    if (project.dampers && project.dampers.fresh && project.dampers.fresh.height) completed++;
                    if (project.airwasher && project.airwasher.height) completed++;
                    
                    return completed;
                },
                
                get inProgressSections() {
                    // Sections that have some data but aren't complete
                    return 2; // Simplified
                },
                
                get pendingSections() {
                    return this.totalSections - this.completedSections - this.inProgressSections;
                },
                
                get problemProgress() {
                    const problem = this.getCurrentProject().problem;
                    let progress = 0;
                    if (problem.name) progress += 20;
                    if (problem.location) progress += 20;
                    if (problem.author) progress += 20;
                    if (problem.description) progress += 20;
                    if (problem.industryType) progress += 20;
                    return progress;
                },
                
                get totalCost() {
                    const project = this.getCurrentProject();
                    return project.estimatedCost || 0;
                },
                
                get recentProjects() {
                    return [...this.projects].sort((a, b) => b.id - a.id).slice(0, 5);
                },
                
                exportProject() {
                    const project = this.getCurrentProject();
                    const dataStr = JSON.stringify(project, null, 2);
                    const dataUri = 'data:application/json;charset=utf-8,'+ encodeURIComponent(dataStr);
                    
                    const exportFileDefaultName = `textile-ventilation-project-${project.id}.json`;
                    
                    const linkElement = document.createElement('a');
                    linkElement.setAttribute('href', dataUri);
                    linkElement.setAttribute('download', exportFileDefaultName);
                    linkElement.click();
                    
                    alert('پروژه با موفقیت صادر شد.');
                },
                
                exportProblemData() {
                    const problem = this.getCurrentProject().problem;
                    const dataStr = JSON.stringify(problem, null, 2);
                    const dataUri = 'data:application/json;charset=utf-8,'+ encodeURIComponent(dataStr);
                    
                    const exportFileDefaultName = `project-problem-${this.getCurrentProject().id}.json`;
                    
                    const linkElement = document.createElement('a');
                    linkElement.setAttribute('href', dataUri);
                    linkElement.setAttribute('download', exportFileDefaultName);
                    linkElement.click();
                }
            }
        }
    </script>
    
    <!-- Bootstrap JS Bundle -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>