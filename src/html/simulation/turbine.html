<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Smart Power Plant Simulator with Auto-Sync</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-annotation@2.0.1/dist/chartjs-plugin-annotation.min.js"></script>
    <style>
        :root {
            --control-room-dark: #0a1929;
            --control-room-blue: #1a365d;
            --hmi-green: #00ff88;
            --hmi-yellow: #ffcc00;
            --hmi-red: #ff3333;
            --hmi-orange: #ff8800;
            --hmi-blue: #00aaff;
            --hmi-purple: #aa00ff;
            --panel-gray: #2d3748;
            --panel-light: #4a5568;
            --text-primary: #e2e8f0;
            --text-secondary: #a0aec0;
            --alarm-critical: #ff4444;
            --alarm-major: #ff8800;
            --alarm-minor: #ffcc00;
            --alarm-info: #00aaff;
            --grid-stable: #00cc66;
            --grid-unstable: #ff3333;
            --auto-mode: #00ccff;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
            user-select: none;
            touch-action: manipulation;
            font-family: 'Segoe UI', 'Roboto', 'Helvetica Neue', Arial, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #0a1929 0%, #1a365d 100%);
            color: var(--text-primary);
            min-height: 100vh;
            overflow-x: hidden;
            font-size: 14px;
            line-height: 1.5;
        }
        
        /* Mobile-first responsive container */
        .mobile-container {
            width: 100%;
            max-width: 100vw;
            min-height: 100vh;
            overflow-x: hidden;
        }
        
        /* Responsive SCADA Header */
        .responsive-header {
            background: linear-gradient(180deg, #0a1929 0%, #122543 100%);
            border-bottom: 2px solid var(--hmi-blue);
            padding: 12px 15px;
            display: flex;
            flex-wrap: wrap;
            align-items: center;
            justify-content: space-between;
            gap: 10px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
            position: sticky;
            top: 0;
            z-index: 100;
        }
        
        .header-left {
            display: flex;
            align-items: center;
            gap: 10px;
            min-width: 0;
            flex: 1;
        }
        
        .mobile-logo {
            width: 40px;
            height: 40px;
            background: linear-gradient(135deg, var(--hmi-blue) 0%, #0066cc 100%);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            flex-shrink: 0;
        }
        
        .header-title {
            flex: 1;
            min-width: 0;
        }
        
        .header-title h1 {
            font-size: 16px;
            font-weight: 700;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        
        .header-title .subtitle {
            font-size: 11px;
            color: var(--hmi-green);
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        
        .header-right {
            display: flex;
            align-items: center;
            gap: 8px;
            flex-shrink: 0;
        }
        
        .mobile-status {
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 12px;
            background: rgba(0, 0, 0, 0.3);
            padding: 6px 10px;
            border-radius: 6px;
        }
        
        .status-dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
        }
        
        .status-dot.online { background: var(--hmi-green); animation: pulse-green 2s infinite; }
        .status-dot.offline { background: var(--text-secondary); }
        .status-dot.auto { background: var(--auto-mode); animation: pulse-blue 2s infinite; }
        .status-dot.alarm { background: var(--hmi-red); animation: blink 1s infinite; }
        
        @keyframes pulse-green {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        
        @keyframes pulse-blue {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        
        /* Mobile Navigation */
        .mobile-nav {
            display: flex;
            background: rgba(0, 0, 0, 0.2);
            border-bottom: 1px solid var(--panel-light);
            overflow-x: auto;
            -webkit-overflow-scrolling: touch;
        }
        
        .nav-item {
            padding: 12px 16px;
            white-space: nowrap;
            border-bottom: 3px solid transparent;
            font-size: 13px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            flex-shrink: 0;
        }
        
        .nav-item.active {
            border-bottom-color: var(--hmi-blue);
            background: rgba(0, 170, 255, 0.1);
        }
        
        /* Main Content - Mobile First */
        .mobile-content {
            padding: 15px;
            padding-bottom: 80px;
        }
        
        .content-section {
            display: none;
        }
        
        .content-section.active {
            display: block;
            animation: fadeIn 0.3s ease;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        /* Mobile Card Design */
        .mobile-card {
            background: var(--panel-gray);
            border-radius: 12px;
            padding: 18px;
            margin-bottom: 15px;
            border: 1px solid var(--panel-light);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
        }
        
        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid var(--panel-light);
        }
        
        .card-title {
            font-size: 15px;
            font-weight: 700;
            color: var(--hmi-blue);
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .card-actions {
            display: flex;
            gap: 8px;
        }
        
        /* Mobile Turbine Grid */
        .turbine-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
            margin-bottom: 20px;
        }
        
        @media (max-width: 480px) {
            .turbine-grid {
                grid-template-columns: 1fr;
            }
        }
        
        .turbine-card {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 10px;
            padding: 15px;
            border: 2px solid var(--panel-light);
            transition: all 0.3s;
            position: relative;
            overflow: hidden;
        }
        
        .turbine-card.active {
            border-color: var(--hmi-blue);
            box-shadow: 0 0 15px rgba(0, 170, 255, 0.3);
        }
        
        .turbine-card.auto {
            border-color: var(--auto-mode);
            box-shadow: 0 0 15px rgba(0, 204, 255, 0.3);
        }
        
        .turbine-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }
        
        .turbine-name {
            font-weight: 700;
            font-size: 14px;
            color: var(--hmi-blue);
        }
        
        .turbine-status {
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 600;
        }
        
        .status-offline { background: rgba(160, 174, 192, 0.2); color: var(--text-secondary); }
        .status-starting { background: rgba(255, 136, 0, 0.2); color: var(--hmi-orange); }
        .status-running { background: rgba(0, 170, 255, 0.2); color: var(--hmi-blue); }
        .status-syncing { background: rgba(255, 204, 0, 0.2); color: var(--hmi-yellow); }
        .status-online { background: rgba(0, 255, 136, 0.2); color: var(--hmi-green); }
        .status-tripped { background: rgba(255, 68, 68, 0.2); color: var(--hmi-red); }
        
        .turbine-metrics {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            margin-bottom: 15px;
        }
        
        .metric {
            text-align: center;
        }
        
        .metric-label {
            font-size: 11px;
            color: var(--text-secondary);
            margin-bottom: 4px;
        }
        
        .metric-value {
            font-size: 14px;
            font-weight: 700;
            font-family: 'Courier New', monospace;
        }
        
        .turbine-controls {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 6px;
        }
        
        /* Mobile Buttons */
        .mobile-btn {
            height: 44px;
            border: none;
            border-radius: 8px;
            font-size: 13px;
            font-weight: 600;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 4px;
            cursor: pointer;
            transition: all 0.2s;
            padding: 8px;
        }
        
        .mobile-btn:active {
            transform: scale(0.96);
        }
        
        .mobile-btn.primary {
            background: linear-gradient(135deg, var(--hmi-blue) 0%, #0066cc 100%);
            color: white;
        }
        
        .mobile-btn.success {
            background: linear-gradient(135deg, var(--hmi-green) 0%, #00cc66 100%);
            color: white;
        }
        
        .mobile-btn.warning {
            background: linear-gradient(135deg, var(--hmi-yellow) 0%, #cc9900 100%);
            color: #333;
        }
        
        .mobile-btn.danger {
            background: linear-gradient(135deg, var(--hmi-red) 0%, #cc0000 100%);
            color: white;
        }
        
        .mobile-btn.auto {
            background: linear-gradient(135deg, var(--auto-mode) 0%, #0099cc 100%);
            color: white;
        }
        
        .mobile-btn:disabled {
            background: #4a5568;
            color: #718096;
            cursor: not-allowed;
        }
        
        /* Visualization for Mobile */
        .visualization-container {
            width: 100%;
            height: 250px;
            background: #0d1b2a;
            border-radius: 10px;
            overflow: hidden;
            margin-bottom: 15px;
            position: relative;
            border: 1px solid var(--panel-light);
        }
        
        #mobile-visualization {
            width: 100%;
            height: 100%;
        }
        
        /* Automation Panel */
        .automation-panel {
            background: linear-gradient(135deg, rgba(0, 204, 255, 0.1) 0%, rgba(0, 102, 204, 0.2) 100%);
            border: 2px solid var(--auto-mode);
        }
        
        .auto-controls {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            margin-top: 15px;
        }
        
        .auto-status {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            padding: 10px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 8px;
            margin-bottom: 15px;
        }
        
        /* Charts for Mobile */
        .chart-container {
            height: 180px;
            width: 100%;
            margin-top: 10px;
        }
        
        /* Load Control Slider */
        .slider-container {
            margin: 20px 0;
        }
        
        .slider-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
        }
        
        .slider-value {
            font-size: 20px;
            font-weight: 700;
            color: var(--hmi-blue);
            font-family: 'Courier New', monospace;
        }
        
        .mobile-slider {
            width: 100%;
            height: 12px;
            -webkit-appearance: none;
            appearance: none;
            background: linear-gradient(to right, #00cc66 0%, #ffcc00 50%, #ff4444 100%);
            border-radius: 6px;
            outline: none;
        }
        
        .mobile-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 28px;
            height: 28px;
            border-radius: 50%;
            background: var(--hmi-blue);
            cursor: pointer;
            box-shadow: 0 4px 15px rgba(0, 170, 255, 0.5);
            border: 3px solid white;
        }
        
        .slider-labels {
            display: flex;
            justify-content: space-between;
            margin-top: 8px;
            font-size: 11px;
            color: var(--text-secondary);
        }
        
        /* Alarm Panel */
        .alarm-panel {
            background: rgba(255, 68, 68, 0.1);
            border: 1px solid var(--hmi-red);
            max-height: 200px;
            overflow-y: auto;
        }
        
        .alarm-item {
            padding: 10px;
            margin-bottom: 8px;
            background: rgba(255, 68, 68, 0.2);
            border-radius: 6px;
            border-left: 4px solid var(--hmi-red);
            font-size: 12px;
        }
        
        .alarm-time {
            font-size: 10px;
            color: var(--text-secondary);
            margin-top: 4px;
        }
        
        /* Mobile Bottom Bar */
        .mobile-bottom-bar {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: rgba(0, 0, 0, 0.9);
            backdrop-filter: blur(10px);
            border-top: 2px solid var(--panel-light);
            display: flex;
            justify-content: space-around;
            padding: 12px 0;
            z-index: 100;
        }
        
        .bottom-btn {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 4px;
            padding: 8px 12px;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
            min-width: 70px;
        }
        
        .bottom-btn.active {
            background: rgba(0, 170, 255, 0.2);
        }
        
        .bottom-btn:active {
            background: rgba(255, 255, 255, 0.1);
        }
        
        .bottom-icon {
            font-size: 20px;
        }
        
        .bottom-label {
            font-size: 11px;
            font-weight: 600;
        }
        
        /* Quick Actions Panel */
        .quick-actions {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            margin-top: 15px;
        }
        
        .quick-btn {
            height: 60px;
            border-radius: 10px;
            border: none;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 6px;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .quick-btn:active {
            transform: scale(0.98);
        }
        
        /* Modal Overlay for Mobile */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(5px);
            z-index: 1000;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s;
        }
        
        .modal-overlay.active {
            opacity: 1;
            visibility: visible;
        }
        
        .modal-content {
            background: var(--panel-gray);
            border-radius: 15px;
            padding: 25px;
            width: 100%;
            max-width: 400px;
            max-height: 80vh;
            overflow-y: auto;
            transform: translateY(20px);
            transition: transform 0.3s;
        }
        
        .modal-overlay.active .modal-content {
            transform: translateY(0);
        }
        
        /* Touch-friendly controls */
        .touch-area {
            padding: 15px;
            margin: -15px;
        }
        
        /* Responsive grid for larger screens */
        @media (min-width: 768px) {
            .mobile-container {
                max-width: 768px;
                margin: 0 auto;
                padding: 20px;
            }
            
            .turbine-grid {
                grid-template-columns: repeat(4, 1fr);
            }
            
            .quick-actions {
                grid-template-columns: repeat(4, 1fr);
            }
            
            .auto-controls {
                grid-template-columns: repeat(4, 1fr);
            }
        }
        
        /* Loading Screen */
        .loading-screen {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: var(--control-room-dark);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 2000;
        }
        
        .loading-text {
            margin-top: 20px;
            color: var(--hmi-blue);
            font-size: 16px;
            font-weight: 600;
        }
        
        /* Swipe hint for mobile */
        .swipe-hint {
            text-align: center;
            color: var(--text-secondary);
            font-size: 12px;
            margin-top: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }
        
        /* Auto-sync indicator */
        .auto-sync-indicator {
            position: absolute;
            top: 8px;
            right: 8px;
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: var(--auto-mode);
            animation: pulse-blue 1s infinite;
        }
    </style>
</head>
<body>
    <!-- Loading Screen -->
    <div class="loading-screen" id="loading-screen">
        <div class="mobile-logo" style="width: 60px; height: 60px; font-size: 28px;">
            <i class="fas fa-bolt"></i>
        </div>
        <div class="loading-text">Initializing Smart Grid System...</div>
    </div>

    <!-- Mobile Container -->
    <div class="mobile-container">
        <!-- Responsive Header -->
        <header class="responsive-header">
            <div class="header-left">
                <div class="mobile-logo">
                    <i class="fas fa-industry"></i>
                </div>
                <div class="header-title">
                    <h1>SMART PLANT CONTROL</h1>
                    <div class="subtitle">Auto-Sync • 1000MW • Mobile SCADA</div>
                </div>
            </div>
            
            <div class="header-right">
                <div class="mobile-status">
                    <div class="status-dot offline" id="system-status"></div>
                    <span id="system-status-text">OFFLINE</span>
                </div>
            </div>
        </header>

        <!-- Mobile Navigation -->
        <nav class="mobile-nav">
            <div class="nav-item active" data-section="dashboard">
                <i class="fas fa-tachometer-alt"></i> Dashboard
            </div>
            <div class="nav-item" data-section="turbines">
                <i class="fas fa-cogs"></i> Turbines
            </div>
            <div class="nav-item" data-section="automation">
                <i class="fas fa-robot"></i> Automation
            </div>
            <div class="nav-item" data-section="monitoring">
                <i class="fas fa-chart-line"></i> Monitoring
            </div>
            <div class="nav-item" data-section="alarms">
                <i class="fas fa-exclamation-triangle"></i> Alarms
            </div>
        </nav>

        <!-- Main Content -->
        <main class="mobile-content">
            <!-- Dashboard Section -->
            <section class="content-section active" id="dashboard-section">
                <div class="mobile-card">
                    <div class="card-header">
                        <div class="card-title">
                            <i class="fas fa-industry"></i>
                            Plant Overview
                        </div>
                        <div class="card-actions">
                            <button class="mobile-btn success" id="quick-start">
                                <i class="fas fa-play"></i>
                                <span>Quick Start</span>
                            </button>
                        </div>
                    </div>
                    
                    <div class="visualization-container">
                        <canvas id="mobile-visualization"></canvas>
                    </div>
                    
                    <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px; margin-top: 15px;">
                        <div style="text-align: center;">
                            <div style="font-size: 12px; color: var(--text-secondary);">TOTAL OUTPUT</div>
                            <div style="font-size: 24px; font-weight: 700; color: var(--hmi-green);" id="total-output">0 MW</div>
                        </div>
                        <div style="text-align: center;">
                            <div style="font-size: 12px; color: var(--text-secondary);">GRID FREQUENCY</div>
                            <div style="font-size: 24px; font-weight: 700; color: var(--hmi-blue);" id="grid-frequency">50.00 Hz</div>
                        </div>
                    </div>
                </div>
                
                <div class="mobile-card">
                    <div class="card-header">
                        <div class="card-title">
                            <i class="fas fa-bolt"></i>
                            Quick Actions
                        </div>
                    </div>
                    
                    <div class="quick-actions">
                        <button class="quick-btn mobile-btn primary" id="auto-start-all">
                            <i class="fas fa-play-circle"></i>
                            <span>Start All</span>
                        </button>
                        <button class="quick-btn mobile-btn auto" id="auto-sync-all">
                            <i class="fas fa-sync-alt"></i>
                            <span>Auto Sync</span>
                        </button>
                        <button class="quick-btn mobile-btn success" id="connect-grid">
                            <i class="fas fa-plug"></i>
                            <span>Connect Grid</span>
                        </button>
                        <button class="quick-btn mobile-btn danger" id="emergency-stop">
                            <i class="fas fa-stop-circle"></i>
                            <span>E-Stop</span>
                        </button>
                    </div>
                </div>
                
                <div class="mobile-card">
                    <div class="card-header">
                        <div class="card-title">
                            <i class="fas fa-sliders-h"></i>
                            Load Control
                        </div>
                    </div>
                    
                    <div class="slider-container">
                        <div class="slider-header">
                            <div>Load Demand</div>
                            <div class="slider-value" id="load-value">0 MW</div>
                        </div>
                        <input type="range" class="mobile-slider" id="load-slider" min="0" max="1000" value="0" step="10">
                        <div class="slider-labels">
                            <div>0 MW</div>
                            <div>500 MW</div>
                            <div>1000 MW</div>
                        </div>
                    </div>
                    
                    <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 8px; margin-top: 15px;">
                        <button class="mobile-btn primary" data-load="250">250MW</button>
                        <button class="mobile-btn primary" data-load="500">500MW</button>
                        <button class="mobile-btn warning" data-load="750">750MW</button>
                        <button class="mobile-btn danger" data-load="1000">1000MW</button>
                    </div>
                </div>
            </section>

            <!-- Turbines Section -->
            <section class="content-section" id="turbines-section">
                <div class="mobile-card">
                    <div class="card-header">
                        <div class="card-title">
                            <i class="fas fa-turbine"></i>
                            Gas Turbines Control
                        </div>
                        <div class="card-actions">
                            <button class="mobile-btn auto" id="enable-auto-turbines">
                                <i class="fas fa-robot"></i>
                                <span>Auto</span>
                            </button>
                        </div>
                    </div>
                    
                    <div class="turbine-grid" id="turbine-grid">
                        <!-- Turbine cards will be generated here -->
                    </div>
                    
                    <div class="swipe-hint">
                        <i class="fas fa-arrow-left"></i>
                        Scroll to see all turbines
                        <i class="fas fa-arrow-right"></i>
                    </div>
                </div>
            </section>

            <!-- Automation Section -->
            <section class="content-section" id="automation-section">
                <div class="mobile-card automation-panel">
                    <div class="card-header">
                        <div class="card-title">
                            <i class="fas fa-robot"></i>
                            Smart Automation System
                        </div>
                        <div class="card-actions">
                            <div class="status-dot auto" id="auto-status"></div>
                        </div>
                    </div>
                    
                    <div class="auto-status">
                        <span id="auto-status-text">Automation: OFF</span>
                    </div>
                    
                    <div class="auto-controls">
                        <button class="mobile-btn auto" id="auto-sequence">
                            <i class="fas fa-play-circle"></i>
                            <span>Auto Sequence</span>
                        </button>
                        <button class="mobile-btn auto" id="auto-sync">
                            <i class="fas fa-sync-alt"></i>
                            <span>Smart Sync</span>
                        </button>
                        <button class="mobile-btn auto" id="auto-load">
                            <i class="fas fa-chart-line"></i>
                            <span>Auto Load</span>
                        </button>
                        <button class="mobile-btn auto" id="auto-protection">
                            <i class="fas fa-shield-alt"></i>
                            <span>Smart Protect</span>
                        </button>
                    </div>
                    
                    <div style="margin-top: 20px;">
                        <div style="font-size: 13px; color: var(--text-secondary); margin-bottom: 10px;">
                            Automation Settings
                        </div>
                        
                        <div style="display: grid; gap: 12px;">
                            <div style="display: flex; justify-content: space-between; align-items: center;">
                                <span>Auto-sync sensitivity</span>
                                <span style="font-weight: 700; color: var(--auto-mode);" id="sync-sensitivity">High</span>
                            </div>
                            <input type="range" class="mobile-slider" min="1" max="3" value="2" step="1" id="sensitivity-slider">
                            
                            <div style="display: flex; justify-content: space-between; align-items: center;">
                                <span>Load response speed</span>
                                <span style="font-weight: 700; color: var(--auto-mode);" id="response-speed">Medium</span>
                            </div>
                            <input type="range" class="mobile-slider" min="1" max="3" value="2" step="1" id="response-slider">
                        </div>
                    </div>
                </div>
                
                <div class="mobile-card">
                    <div class="card-header">
                        <div class="card-title">
                            <i class="fas fa-brain"></i>
                            AI Predictions
                        </div>
                    </div>
                    
                    <div style="margin-top: 15px;">
                        <div style="font-size: 13px; color: var(--text-secondary); margin-bottom: 10px;">
                            System Predictions
                        </div>
                        
                        <div style="display: grid; gap: 10px;">
                            <div style="display: flex; justify-content: space-between;">
                                <span>Next maintenance:</span>
                                <span style="color: var(--hmi-yellow); font-weight: 600;">T1: 245h</span>
                            </div>
                            <div style="display: flex; justify-content: space-between;">
                                <span>Optimal load range:</span>
                                <span style="color: var(--hmi-green); font-weight: 600;">60-85%</span>
                            </div>
                            <div style="display: flex; justify-content: space-between;">
                                <span>Grid stability:</span>
                                <span style="color: var(--hmi-green); font-weight: 600;">High</span>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Monitoring Section -->
            <section class="content-section" id="monitoring-section">
                <div class="mobile-card">
                    <div class="card-header">
                        <div class="card-title">
                            <i class="fas fa-chart-line"></i>
                            Performance Monitoring
                        </div>
                    </div>
                    
                    <div class="chart-container">
                        <canvas id="performance-chart"></canvas>
                    </div>
                </div>
                
                <div class="mobile-card">
                    <div class="card-header">
                        <div class="card-title">
                            <i class="fas fa-wave-square"></i>
                            Frequency Stability
                        </div>
                    </div>
                    
                    <div class="chart-container">
                        <canvas id="frequency-chart"></canvas>
                    </div>
                    
                    <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; margin-top: 15px;">
                        <div style="text-align: center;">
                            <div style="font-size: 11px; color: var(--text-secondary);">STABILITY</div>
                            <div style="font-size: 16px; font-weight: 700; color: var(--hmi-green);" id="stability-value">100%</div>
                        </div>
                        <div style="text-align: center;">
                            <div style="font-size: 11px; color: var(--text-secondary);">DEVIATION</div>
                            <div style="font-size: 16px; font-weight: 700; color: var(--hmi-blue);" id="deviation-value">0.00 Hz</div>
                        </div>
                        <div style="text-align: center;">
                            <div style="font-size: 11px; color: var(--text-secondary);">RESERVE</div>
                            <div style="font-size: 16px; font-weight: 700; color: var(--hmi-yellow);" id="reserve-value">1000 MW</div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Alarms Section -->
            <section class="content-section" id="alarms-section">
                <div class="mobile-card alarm-panel">
                    <div class="card-header">
                        <div class="card-title" style="color: var(--hmi-red);">
                            <i class="fas fa-exclamation-triangle"></i>
                            Active Alarms
                        </div>
                        <div class="card-actions">
                            <button class="mobile-btn primary" id="acknowledge-all">
                                <i class="fas fa-check-circle"></i>
                                <span>Ack All</span>
                            </button>
                        </div>
                    </div>
                    
                    <div id="alarm-list">
                        <div class="alarm-item">
                            <div>System in offline mode</div>
                            <div class="alarm-time">--:--:--</div>
                        </div>
                    </div>
                </div>
                
                <div class="mobile-card">
                    <div class="card-header">
                        <div class="card-title">
                            <i class="fas fa-history"></i>
                            System Log
                        </div>
                    </div>
                    
                    <div style="max-height: 200px; overflow-y: auto;" id="system-log">
                        <!-- System logs will appear here -->
                    </div>
                </div>
            </section>
        </main>

        <!-- Mobile Bottom Bar -->
        <div class="mobile-bottom-bar">
            <div class="bottom-btn active" data-action="home">
                <div class="bottom-icon"><i class="fas fa-home"></i></div>
                <div class="bottom-label">Home</div>
            </div>
            <div class="bottom-btn" data-action="control">
                <div class="bottom-icon"><i class="fas fa-gamepad"></i></div>
                <div class="bottom-label">Control</div>
            </div>
            <div class="bottom-btn" data-action="auto">
                <div class="bottom-icon"><i class="fas fa-robot"></i></div>
                <div class="bottom-label">Auto</div>
            </div>
            <div class="bottom-btn" data-action="monitor">
                <div class="bottom-icon"><i class="fas fa-eye"></i></div>
                <div class="bottom-label">Monitor</div>
            </div>
            <div class="bottom-btn" data-action="alarms">
                <div class="bottom-icon"><i class="fas fa-bell"></i></div>
                <div class="bottom-label">Alarms</div>
            </div>
        </div>
    </div>

    <script>
        // Advanced Smart Plant Simulator with Auto-Sync
        class SmartPlantSimulator {
            constructor() {
                // Configuration
                this.config = {
                    nominalCapacity: 1000,
                    turbineCount: 4,
                    turbineCapacity: 250,
                    gridFrequency: 50.0,
                    gridVoltage: 400,
                    
                    // Auto-sync settings
                    autoSyncEnabled: true,
                    syncTolerance: {
                        high: 0.05,   // ±0.05 Hz
                        medium: 0.1,  // ±0.1 Hz
                        low: 0.2      // ±0.2 Hz
                    },
                    autoSyncSpeed: {
                        high: 0.2,    // 0.2 Hz/sec
                        medium: 0.1,  // 0.1 Hz/sec
                        low: 0.05     // 0.05 Hz/sec
                    },
                    
                    // Automation settings
                    autoLoadBalancing: true,
                    autoProtection: true,
                    predictiveMaintenance: true,
                    aiOptimization: true
                };
                
                // Plant State
                this.state = {
                    plantStatus: 'OFFLINE',
                    gridConnected: false,
                    totalOutput: 0,
                    loadDemand: 0,
                    gridFrequency: 50.0,
                    systemVoltage: 0,
                    
                    // Turbines with auto-sync capability
                    turbines: [],
                    
                    // Automation State
                    automation: {
                        enabled: false,
                        mode: 'MANUAL', // MANUAL, SEMI_AUTO, FULL_AUTO
                        autoSyncActive: false,
                        autoLoadActive: false,
                        autoProtectionActive: false,
                        sequenceActive: false,
                        currentSequence: null
                    },
                    
                    // Smart Grid Features
                    smartGrid: {
                        frequencyStability: 100,
                        reserveMargin: 1000,
                        loadForecast: 0,
                        gridHealth: 'EXCELLENT',
                        aiPredictions: {
                            maintenance: [],
                            optimalLoad: { min: 60, max: 85 },
                            efficiencyPeak: 75
                        }
                    },
                    
                    // Monitoring Data
                    monitoring: {
                        frequencyData: Array(30).fill(50.0),
                        outputData: Array(30).fill(0),
                        efficiencyData: Array(30).fill(0),
                        stabilityData: Array(30).fill(100)
                    },
                    
                    // Alarms & Logs
                    alarms: [],
                    systemLog: [],
                    
                    // Timing
                    lastUpdate: Date.now(),
                    autoSyncInterval: null,
                    monitoringInterval: null
                };
                
                // DOM Elements
                this.elements = {};
                
                // Charts
                this.charts = {};
                
                // Initialize
                this.initialize();
            }
            
            initialize() {
                // Create turbines
                this.createTurbines();
                
                // Cache DOM elements
                this.cacheElements();
                
                // Initialize UI
                this.initUI();
                
                // Initialize charts
                this.initCharts();
                
                // Setup event listeners
                this.setupEventListeners();
                
                // Start simulation
                this.startSimulation();
                
                // Hide loading screen
                setTimeout(() => {
                    document.getElementById('loading-screen').style.display = 'none';
                    this.logSystem('Smart Grid System initialized successfully');
                    this.logSystem('Automation system ready - Auto-sync enabled');
                }, 1500);
            }
            
            createTurbines() {
                for (let i = 1; i <= 4; i++) {
                    this.state.turbines.push({
                        id: i,
                        name: `GT-0${i}`,
                        status: 'OFFLINE',
                        output: 0,
                        speed: 0,
                        temperature: 25,
                        vibration: 0.1,
                        frequency: 0,
                        voltage: 0,
                        syncStatus: 'NOT_SYNCED',
                        autoSync: false,
                        efficiency: 0,
                        runHours: 0,
                        maintenanceRequired: false,
                        nextMaintenance: 8000 - (i * 200), // Staggered maintenance
                        protection: {
                            autoTrip: true,
                            temperatureLimit: 650,
                            vibrationLimit: 7.1,
                            overspeedLimit: 3300
                        },
                        aiMetrics: {
                            healthScore: 100,
                            efficiencyTrend: 'STABLE',
                            predictedFailure: null
                        }
                    });
                }
            }
            
            cacheElements() {
                // Status elements
                this.elements.systemStatus = document.getElementById('system-status');
                this.elements.systemStatusText = document.getElementById('system-status-text');
                this.elements.totalOutput = document.getElementById('total-output');
                this.elements.gridFrequency = document.getElementById('grid-frequency');
                this.elements.loadValue = document.getElementById('load-value');
                
                // Control elements
                this.elements.loadSlider = document.getElementById('load-slider');
                this.elements.connectGrid = document.getElementById('connect-grid');
                this.elements.emergencyStop = document.getElementById('emergency-stop');
                this.elements.quickStart = document.getElementById('quick-start');
                this.elements.autoStartAll = document.getElementById('auto-start-all');
                this.elements.autoSyncAll = document.getElementById('auto-sync-all');
                
                // Automation elements
                this.elements.autoStatus = document.getElementById('auto-status');
                this.elements.autoStatusText = document.getElementById('auto-status-text');
                this.elements.autoSequence = document.getElementById('auto-sequence');
                this.elements.autoSync = document.getElementById('auto-sync');
                this.elements.autoLoad = document.getElementById('auto-load');
                this.elements.autoProtection = document.getElementById('auto-protection');
                this.elements.enableAutoTurbines = document.getElementById('enable-auto-turbines');
                
                // Monitoring elements
                this.elements.stabilityValue = document.getElementById('stability-value');
                this.elements.deviationValue = document.getElementById('deviation-value');
                this.elements.reserveValue = document.getElementById('reserve-value');
                
                // Slider elements
                this.elements.sensitivitySlider = document.getElementById('sensitivity-slider');
                this.elements.responseSlider = document.getElementById('response-slider');
                this.elements.syncSensitivity = document.getElementById('sync-sensitivity');
                this.elements.responseSpeed = document.getElementById('response-speed');
                
                // Alarm elements
                this.elements.alarmList = document.getElementById('alarm-list');
                this.elements.systemLog = document.getElementById('system-log');
                this.elements.acknowledgeAll = document.getElementById('acknowledge-all');
            }
            
            initUI() {
                // Generate turbine cards
                this.generateTurbineCards();
                
                // Update initial UI
                this.updateUI();
                
                // Initialize navigation
                this.initNavigation();
            }
            
            initCharts() {
                // Performance Chart
                const perfCtx = document.getElementById('performance-chart').getContext('2d');
                this.charts.performance = new Chart(perfCtx, {
                    type: 'line',
                    data: {
                        labels: Array(30).fill(''),
                        datasets: [
                            {
                                label: 'Output (MW)',
                                data: Array(30).fill(0),
                                borderColor: '#00ff88',
                                backgroundColor: 'rgba(0, 255, 136, 0.1)',
                                borderWidth: 2,
                                fill: true,
                                tension: 0.4
                            },
                            {
                                label: 'Demand (MW)',
                                data: Array(30).fill(0),
                                borderColor: '#00aaff',
                                backgroundColor: 'rgba(0, 170, 255, 0.1)',
                                borderWidth: 2,
                                fill: true,
                                tension: 0.4
                            }
                        ]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: { display: false }
                        },
                        scales: {
                            x: { display: false },
                            y: {
                                grid: { color: 'rgba(255, 255, 255, 0.1)' },
                                ticks: { 
                                    color: '#a0aec0',
                                    callback: function(value) {
                                        return value + ' MW';
                                    }
                                },
                                min: 0,
                                max: 1000
                            }
                        }
                    }
                });
                
                // Frequency Chart
                const freqCtx = document.getElementById('frequency-chart').getContext('2d');
                this.charts.frequency = new Chart(freqCtx, {
                    type: 'line',
                    data: {
                        labels: Array(30).fill(''),
                        datasets: [
                            {
                                label: 'Frequency (Hz)',
                                data: Array(30).fill(50.0),
                                borderColor: '#aa00ff',
                                backgroundColor: 'rgba(170, 0, 255, 0.1)',
                                borderWidth: 2,
                                fill: true,
                                tension: 0.4
                            }
                        ]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            annotation: {
                                annotations: {
                                    line1: {
                                        type: 'line',
                                        yMin: 50,
                                        yMax: 50,
                                        borderColor: 'rgba(255, 255, 255, 0.3)',
                                        borderWidth: 1,
                                        borderDash: [5, 5]
                                    },
                                    line2: {
                                        type: 'line',
                                        yMin: 49.8,
                                        yMax: 49.8,
                                        borderColor: 'rgba(255, 204, 0, 0.3)',
                                        borderWidth: 1,
                                        borderDash: [5, 5]
                                    },
                                    line3: {
                                        type: 'line',
                                        yMin: 50.2,
                                        yMax: 50.2,
                                        borderColor: 'rgba(255, 204, 0, 0.3)',
                                        borderWidth: 1,
                                        borderDash: [5, 5]
                                    }
                                }
                            }
                        },
                        scales: {
                            x: { display: false },
                            y: {
                                grid: { color: 'rgba(255, 255, 255, 0.1)' },
                                ticks: { 
                                    color: '#a0aec0',
                                    callback: function(value) {
                                        return value.toFixed(1) + ' Hz';
                                    }
                                },
                                min: 49.5,
                                max: 50.5
                            }
                        }
                    }
                });
            }
            
            initNavigation() {
                // Tab navigation
                document.querySelectorAll('.nav-item').forEach(item => {
                    item.addEventListener('click', () => {
                        // Remove active class from all
                        document.querySelectorAll('.nav-item').forEach(i => i.classList.remove('active'));
                        document.querySelectorAll('.content-section').forEach(s => s.classList.remove('active'));
                        
                        // Add active class to clicked
                        item.classList.add('active');
                        const section = item.dataset.section;
                        document.getElementById(`${section}-section`).classList.add('active');
                    });
                });
                
                // Bottom bar navigation
                document.querySelectorAll('.bottom-btn').forEach(btn => {
                    btn.addEventListener('click', () => {
                        const action = btn.dataset.action;
                        
                        // Remove active class from all
                        document.querySelectorAll('.bottom-btn').forEach(b => b.classList.remove('active'));
                        
                        // Add active class to clicked
                        btn.classList.add('active');
                        
                        // Handle actions
                        switch(action) {
                            case 'home':
                                this.showSection('dashboard');
                                break;
                            case 'control':
                                this.showSection('turbines');
                                break;
                            case 'auto':
                                this.showSection('automation');
                                break;
                            case 'monitor':
                                this.showSection('monitoring');
                                break;
                            case 'alarms':
                                this.showSection('alarms');
                                break;
                        }
                    });
                });
            }
            
            showSection(section) {
                // Update navigation
                document.querySelectorAll('.nav-item').forEach(i => i.classList.remove('active'));
                document.querySelectorAll('.content-section').forEach(s => s.classList.remove('active'));
                
                const navItem = document.querySelector(`[data-section="${section}"]`);
                if (navItem) navItem.classList.add('active');
                
                document.getElementById(`${section}-section`).classList.add('active');
            }
            
            setupEventListeners() {
                // Quick Actions
                this.elements.quickStart.addEventListener('click', () => this.startQuickSequence());
                this.elements.autoStartAll.addEventListener('click', () => this.autoStartAllTurbines());
                this.elements.autoSyncAll.addEventListener('click', () => this.enableAutoSyncAll());
                this.elements.connectGrid.addEventListener('click', () => this.connectToGrid());
                this.elements.emergencyStop.addEventListener('click', () => this.emergencyStop());
                
                // Load Control
                this.elements.loadSlider.addEventListener('input', (e) => {
                    const load = parseInt(e.target.value);
                    this.setLoadDemand(load);
                });
                
                document.querySelectorAll('[data-load]').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        const load = parseInt(btn.dataset.load);
                        this.setLoadDemand(load);
                    });
                });
                
                // Automation Controls
                this.elements.autoSequence.addEventListener('click', () => this.startAutoSequence());
                this.elements.autoSync.addEventListener('click', () => this.toggleAutoSync());
                this.elements.autoLoad.addEventListener('click', () => this.toggleAutoLoad());
                this.elements.autoProtection.addEventListener('click', () => this.toggleAutoProtection());
                this.elements.enableAutoTurbines.addEventListener('click', () => this.toggleTurbineAutomation());
                
                // Settings Sliders
                this.elements.sensitivitySlider.addEventListener('input', (e) => {
                    const value = parseInt(e.target.value);
                    const sensitivity = ['Low', 'Medium', 'High'][value - 1];
                    this.elements.syncSensitivity.textContent = sensitivity;
                    this.updateSyncSettings();
                });
                
                this.elements.responseSlider.addEventListener('input', (e) => {
                    const value = parseInt(e.target.value);
                    const speed = ['Slow', 'Medium', 'Fast'][value - 1];
                    this.elements.responseSpeed.textContent = speed;
                });
                
                // Alarm Management
                this.elements.acknowledgeAll.addEventListener('click', () => this.acknowledgeAllAlarms());
                
                // Touch event delegation for turbine controls
                document.getElementById('turbine-grid').addEventListener('click', (e) => {
                    const btn = e.target.closest('.mobile-btn');
                    if (!btn) return;
                    
                    const turbineId = btn.dataset.turbine;
                    const action = btn.dataset.action;
                    
                    if (turbineId && action) {
                        this.handleTurbineAction(parseInt(turbineId), action);
                    }
                });
            }
            
            generateTurbineCards() {
                const grid = document.getElementById('turbine-grid');
                grid.innerHTML = '';
                
                this.state.turbines.forEach(turbine => {
                    const card = document.createElement('div');
                    card.className = `turbine-card ${turbine.autoSync ? 'auto' : ''}`;
                    
                    card.innerHTML = `
                        ${turbine.autoSync ? '<div class="auto-sync-indicator"></div>' : ''}
                        <div class="turbine-header">
                            <div class="turbine-name">${turbine.name}</div>
                            <div class="turbine-status status-${turbine.status.toLowerCase()}">${turbine.status}</div>
                        </div>
                        
                        <div class="turbine-metrics">
                            <div class="metric">
                                <div class="metric-label">OUTPUT</div>
                                <div class="metric-value">${Math.round(turbine.output)} MW</div>
                            </div>
                            <div class="metric">
                                <div class="metric-label">SPEED</div>
                                <div class="metric-value">${Math.round(turbine.speed)} RPM</div>
                            </div>
                            <div class="metric">
                                <div class="metric-label">TEMP</div>
                                <div class="metric-value">${Math.round(turbine.temperature)}°C</div>
                            </div>
                            <div class="metric">
                                <div class="metric-label">FREQ</div>
                                <div class="metric-value">${turbine.frequency.toFixed(2)} Hz</div>
                            </div>
                        </div>
                        
                        <div class="turbine-controls">
                            <button class="mobile-btn primary" data-turbine="${turbine.id}" data-action="start" 
                                    ${!['OFFLINE', 'TRIPPED'].includes(turbine.status) ? 'disabled' : ''}>
                                <i class="fas fa-play"></i>
                                <span>START</span>
                            </button>
                            <button class="mobile-btn warning" data-turbine="${turbine.id}" data-action="sync"
                                    ${turbine.status !== 'RUNNING' ? 'disabled' : ''}>
                                <i class="fas fa-sync-alt"></i>
                                <span>SYNC</span>
                            </button>
                            <button class="mobile-btn ${turbine.autoSync ? 'auto' : 'danger'}" data-turbine="${turbine.id}" data-action="auto-toggle">
                                <i class="fas ${turbine.autoSync ? 'fa-robot' : 'fa-user'}"></i>
                                <span>${turbine.autoSync ? 'AUTO' : 'MAN'}</span>
                            </button>
                        </div>
                    `;
                    
                    grid.appendChild(card);
                });
            }
            
            startSimulation() {
                // Main simulation loop
                setInterval(() => {
                    this.updateSimulation();
                }, 100);
                
                // Auto-sync loop
                setInterval(() => {
                    if (this.state.automation.autoSyncActive) {
                        this.performAutoSync();
                    }
                }, 1000);
                
                // Monitoring update
                setInterval(() => {
                    this.updateMonitoring();
                    this.updateCharts();
                }, 2000);
                
                // AI predictions update
                setInterval(() => {
                    this.updateAIPredictions();
                }, 5000);
            }
            
            updateSimulation() {
                const now = Date.now();
                const deltaTime = (now - this.state.lastUpdate) / 1000;
                this.state.lastUpdate = now;
                
                // Update each turbine
                this.state.turbines.forEach(turbine => {
                    this.updateTurbine(turbine, deltaTime);
                });
                
                // Update grid frequency based on power balance
                this.updateGridFrequency();
                
                // Update plant status
                this.updatePlantStatus();
                
                // Update UI
                this.updateUI();
                
                // Check for alarms
                this.checkAlarms();
                
                // Process automation
                if (this.state.automation.enabled) {
                    this.processAutomation();
                }
            }
            
            updateTurbine(turbine, deltaTime) {
                switch (turbine.status) {
                    case 'OFFLINE':
                        turbine.speed = Math.max(0, turbine.speed - 100 * deltaTime);
                        turbine.temperature = Math.max(25, turbine.temperature - 10 * deltaTime);
                        turbine.output = Math.max(0, turbine.output - 50 * deltaTime);
                        break;
                        
                    case 'STARTING':
                        this.updateTurbineStartup(turbine, deltaTime);
                        break;
                        
                    case 'RUNNING':
                        this.updateTurbineRunning(turbine, deltaTime);
                        break;
                        
                    case 'SYNCHRONIZING':
                        this.updateTurbineSynchronizing(turbine, deltaTime);
                        break;
                        
                    case 'ONLINE':
                        this.updateTurbineOnline(turbine, deltaTime);
                        break;
                        
                    case 'TRIPPED':
                        this.updateTurbineTripped(turbine, deltaTime);
                        break;
                }
                
                // Update run hours
                if (['RUNNING', 'ONLINE', 'SYNCHRONIZING'].includes(turbine.status)) {
                    turbine.runHours += deltaTime / 3600;
                }
                
                // Check protection limits
                this.checkTurbineProtection(turbine);
            }
            
            updateTurbineStartup(turbine, deltaTime) {
                // Simulate startup sequence
                turbine.speed = Math.min(3000, turbine.speed + 100 * deltaTime);
                turbine.temperature = Math.min(500, turbine.temperature + 50 * deltaTime);
                
                // When at full speed, switch to running
                if (turbine.speed >= 3000) {
                    turbine.status = 'RUNNING';
                    turbine.voltage = 400;
                    this.logSystem(`${turbine.name} startup complete - ready for synchronization`);
                    
                    // Enable auto-sync if configured
                    if (turbine.autoSync) {
                        setTimeout(() => {
                            this.startAutoSync(turbine.id);
                        }, 2000);
                    }
                }
            }
            
            updateTurbineRunning(turbine, deltaTime) {
                // Maintain running parameters
                turbine.speed = 3000 + (Math.random() - 0.5) * 10;
                turbine.temperature = 500 + (Math.random() - 0.5) * 20;
                turbine.vibration = 3 + Math.random() * 0.5;
                
                // Build voltage if not already at grid level
                if (turbine.voltage < 400) {
                    turbine.voltage = Math.min(400, turbine.voltage + 10 * deltaTime);
                }
                
                // Initialize frequency near grid frequency
                if (turbine.frequency === 0) {
                    turbine.frequency = 49.5 + Math.random() * 1.0;
                }
            }
            
            updateTurbineSynchronizing(turbine, deltaTime) {
                // Manual or auto synchronization
                if (turbine.autoSync) {
                    // Auto-sync mode - automatically match grid parameters
                    const sensitivity = this.getSyncSensitivity();
                    const speed = this.getSyncSpeed();
                    
                    // Match frequency
                    const freqDiff = this.state.gridFrequency - turbine.frequency;
                    if (Math.abs(freqDiff) > sensitivity) {
                        turbine.frequency += Math.sign(freqDiff) * speed * deltaTime;
                    }
                    
                    // Match voltage
                    const voltDiff = 400 - turbine.voltage;
                    if (Math.abs(voltDiff) > 1) {
                        turbine.voltage += Math.sign(voltDiff) * 5 * deltaTime;
                    }
                    
                    // Check if synchronized
                    if (Math.abs(freqDiff) < 0.05 && Math.abs(voltDiff) < 5) {
                        turbine.status = 'ONLINE';
                        turbine.syncStatus = 'SYNCED';
                        this.logSystem(`${turbine.name} auto-synchronized with grid`);
                    }
                } else {
                    // Manual sync - slower convergence
                    turbine.frequency = this.approachValue(turbine.frequency, this.state.gridFrequency, 0.05 * deltaTime);
                    turbine.voltage = this.approachValue(turbine.voltage, 400, 2 * deltaTime);
                    
                    const freqDiff = Math.abs(turbine.frequency - this.state.gridFrequency);
                    const voltDiff = Math.abs(turbine.voltage - 400);
                    
                    if (freqDiff < 0.1 && voltDiff < 5) {
                        turbine.status = 'ONLINE';
                        turbine.syncStatus = 'SYNCED';
                        this.logSystem(`${turbine.name} synchronized with grid`);
                    }
                }
            }
            
            updateTurbineOnline(turbine, deltaTime) {
                // Follow load demand
                const targetOutput = this.calculateTargetOutput(turbine.id);
                const responseSpeed = this.getResponseSpeed();
                turbine.output = this.approachValue(turbine.output, targetOutput, responseSpeed * deltaTime);
                
                // Update parameters based on load
                const loadFactor = turbine.output / this.config.turbineCapacity;
                turbine.temperature = 500 + (loadFactor * 100) + (Math.random() - 0.5) * 10;
                turbine.vibration = 3 + (loadFactor * 2) + Math.random() * 0.3;
                turbine.frequency = this.state.gridFrequency + (Math.random() - 0.5) * 0.05;
                
                // Update efficiency
                turbine.efficiency = 35 + (loadFactor * 0.5);
                
                // AI health monitoring
                this.updateTurbineHealth(turbine);
            }
            
            updateTurbineHealth(turbine) {
                // Calculate health score based on various parameters
                let healthScore = 100;
                
                // Deduct for high temperature
                if (turbine.temperature > 600) {
                    healthScore -= 20;
                } else if (turbine.temperature > 550) {
                    healthScore -= 10;
                }
                
                // Deduct for high vibration
                if (turbine.vibration > 5) {
                    healthScore -= 15;
                } else if (turbine.vibration > 4) {
                    healthScore -= 5;
                }
                
                // Update efficiency trend
                const efficiencyChange = turbine.efficiency - (turbine.aiMetrics.lastEfficiency || turbine.efficiency);
                turbine.aiMetrics.lastEfficiency = turbine.efficiency;
                
                if (efficiencyChange < -2) {
                    turbine.aiMetrics.efficiencyTrend = 'DECLINING';
                    healthScore -= 10;
                } else if (efficiencyChange < -0.5) {
                    turbine.aiMetrics.efficiencyTrend = 'SLOW_DECLINE';
                    healthScore -= 5;
                } else if (efficiencyChange > 0.5) {
                    turbine.aiMetrics.efficiencyTrend = 'IMPROVING';
                } else {
                    turbine.aiMetrics.efficiencyTrend = 'STABLE';
                }
                
                turbine.aiMetrics.healthScore = Math.max(0, Math.min(100, healthScore));
                
                // Predict maintenance needs
                if (turbine.runHours > turbine.nextMaintenance * 0.9) {
                    turbine.maintenanceRequired = true;
                    if (!turbine.aiMetrics.predictedFailure) {
                        turbine.aiMetrics.predictedFailure = 'MAINTENANCE_DUE';
                    }
                }
            }
            
            updateGridFrequency() {
                // Calculate power balance
                const totalOutput = this.state.turbines.reduce((sum, t) => sum + t.output, 0);
                const powerDifference = totalOutput - this.state.loadDemand;
                
                // Update frequency based on power balance (droop characteristic)
                if (this.state.gridConnected && totalOutput > 0) {
                    const frequencyChange = (powerDifference / this.config.nominalCapacity) * 0.5;
                    this.state.gridFrequency = 50.0 - frequencyChange;
                    
                    // Add realistic grid fluctuations
                    this.state.gridFrequency += (Math.random() - 0.5) * 0.05;
                    
                    // Limit frequency range
                    this.state.gridFrequency = Math.max(49.5, Math.min(50.5, this.state.gridFrequency));
                    
                    // Calculate frequency stability
                    const freqDeviation = Math.abs(50.0 - this.state.gridFrequency);
                    this.state.smartGrid.frequencyStability = Math.max(0, 100 - (freqDeviation * 100));
                }
                
                // Update reserve margin
                const availableCapacity = this.getAvailableCapacity();
                this.state.smartGrid.reserveMargin = availableCapacity - this.state.loadDemand;
            }
            
            updatePlantStatus() {
                // Calculate total output
                this.state.totalOutput = this.state.turbines.reduce((sum, t) => sum + t.output, 0);
                
                // Update plant status
                const onlineTurbines = this.state.turbines.filter(t => t.status === 'ONLINE').length;
                
                if (onlineTurbines === 0) {
                    this.state.plantStatus = 'OFFLINE';
                } else if (this.state.automation.enabled && this.state.automation.mode === 'FULL_AUTO') {
                    this.state.plantStatus = 'AUTO_OPERATION';
                } else if (this.state.gridConnected) {
                    this.state.plantStatus = 'ONLINE';
                } else {
                    this.state.plantStatus = 'STARTING';
                }
            }
            
            updateUI() {
                // Update status indicators
                this.updateStatusIndicators();
                
                // Update overview values
                this.elements.totalOutput.textContent = `${Math.round(this.state.totalOutput)} MW`;
                this.elements.gridFrequency.textContent = `${this.state.gridFrequency.toFixed(2)} Hz`;
                this.elements.loadValue.textContent = `${this.state.loadDemand} MW`;
                
                // Update monitoring values
                this.elements.stabilityValue.textContent = `${Math.round(this.state.smartGrid.frequencyStability)}%`;
                this.elements.deviationValue.textContent = `${Math.abs(50.0 - this.state.gridFrequency).toFixed(2)} Hz`;
                this.elements.reserveValue.textContent = `${Math.round(this.state.smartGrid.reserveMargin)} MW`;
                
                // Update automation status
                this.updateAutomationStatus();
                
                // Update turbine cards
                this.updateTurbineCards();
                
                // Update grid connection button
                const syncedTurbines = this.state.turbines.filter(t => t.status === 'ONLINE').length;
                this.elements.connectGrid.disabled = syncedTurbines < 2 || this.state.gridConnected;
                
                if (syncedTurbines >= 2 && !this.state.gridConnected) {
                    this.elements.connectGrid.innerHTML = '<i class="fas fa-plug"></i><span>Connect Grid</span>';
                } else if (this.state.gridConnected) {
                    this.elements.connectGrid.innerHTML = '<i class="fas fa-plug"></i><span>Connected</span>';
                    this.elements.connectGrid.disabled = true;
                }
            }
            
            updateStatusIndicators() {
                const statusDot = this.elements.systemStatus;
                const statusText = this.elements.systemStatusText;
                
                switch (this.state.plantStatus) {
                    case 'AUTO_OPERATION':
                        statusDot.className = 'status-dot auto';
                        statusText.textContent = 'AUTO MODE';
                        break;
                    case 'ONLINE':
                        statusDot.className = 'status-dot online';
                        statusText.textContent = 'ONLINE';
                        break;
                    case 'STARTING':
                        statusDot.className = 'status-dot alarm';
                        statusText.textContent = 'STARTING';
                        break;
                    default:
                        statusDot.className = 'status-dot offline';
                        statusText.textContent = 'OFFLINE';
                }
            }
            
            updateAutomationStatus() {
                const statusDot = this.elements.autoStatus;
                const statusText = this.elements.autoStatusText;
                
                if (this.state.automation.enabled) {
                    statusDot.className = 'status-dot auto';
                    statusText.textContent = `Automation: ${this.state.automation.mode}`;
                } else {
                    statusDot.className = 'status-dot offline';
                    statusText.textContent = 'Automation: OFF';
                }
            }
            
            updateTurbineCards() {
                this.state.turbines.forEach(turbine => {
                    const card = document.querySelector(`.turbine-card:nth-child(${turbine.id})`);
                    if (!card) return;
                    
                    // Update status
                    const statusEl = card.querySelector('.turbine-status');
                    if (statusEl) {
                        statusEl.textContent = turbine.status;
                        statusEl.className = `turbine-status status-${turbine.status.toLowerCase()}`;
                    }
                    
                    // Update metrics
                    const outputEl = card.querySelector('.metric:nth-child(1) .metric-value');
                    const speedEl = card.querySelector('.metric:nth-child(2) .metric-value');
                    const tempEl = card.querySelector('.metric:nth-child(3) .metric-value');
                    const freqEl = card.querySelector('.metric:nth-child(4) .metric-value');
                    
                    if (outputEl) outputEl.textContent = `${Math.round(turbine.output)} MW`;
                    if (speedEl) speedEl.textContent = `${Math.round(turbine.speed)} RPM`;
                    if (tempEl) tempEl.textContent = `${Math.round(turbine.temperature)}°C`;
                    if (freqEl) freqEl.textContent = `${turbine.frequency.toFixed(2)} Hz`;
                    
                    // Update auto-sync indicator
                    if (turbine.autoSync) {
                        card.classList.add('auto');
                        if (!card.querySelector('.auto-sync-indicator')) {
                            const indicator = document.createElement('div');
                            indicator.className = 'auto-sync-indicator';
                            card.prepend(indicator);
                        }
                    } else {
                        card.classList.remove('auto');
                        const indicator = card.querySelector('.auto-sync-indicator');
                        if (indicator) indicator.remove();
                    }
                    
                    // Update control buttons
                    const startBtn = card.querySelector('[data-action="start"]');
                    const syncBtn = card.querySelector('[data-action="sync"]');
                    const autoBtn = card.querySelector('[data-action="auto-toggle"]');
                    
                    if (startBtn) {
                        startBtn.disabled = !['OFFLINE', 'TRIPPED'].includes(turbine.status);
                    }
                    
                    if (syncBtn) {
                        syncBtn.disabled = turbine.status !== 'RUNNING';
                    }
                    
                    if (autoBtn) {
                        autoBtn.innerHTML = `<i class="fas ${turbine.autoSync ? 'fa-robot' : 'fa-user'}"></i><span>${turbine.autoSync ? 'AUTO' : 'MAN'}</span>`;
                        autoBtn.className = `mobile-btn ${turbine.autoSync ? 'auto' : 'danger'}`;
                    }
                });
            }
            
            updateMonitoring() {
                // Add new data points
                this.state.monitoring.frequencyData.push(this.state.gridFrequency);
                this.state.monitoring.frequencyData.shift();
                
                this.state.monitoring.outputData.push(this.state.totalOutput);
                this.state.monitoring.outputData.shift();
                
                const avgEfficiency = this.state.turbines.reduce((sum, t) => sum + t.efficiency, 0) / 
                                     Math.max(1, this.state.turbines.filter(t => t.output > 0).length);
                this.state.monitoring.efficiencyData.push(avgEfficiency || 0);
                this.state.monitoring.efficiencyData.shift();
                
                this.state.monitoring.stabilityData.push(this.state.smartGrid.frequencyStability);
                this.state.monitoring.stabilityData.shift();
            }
            
            updateCharts() {
                // Performance chart
                this.charts.performance.data.datasets[0].data = [...this.state.monitoring.outputData];
                this.charts.performance.data.datasets[1].data = Array(30).fill(this.state.loadDemand);
                this.charts.performance.update('none');
                
                // Frequency chart
                this.charts.frequency.data.datasets[0].data = [...this.state.monitoring.frequencyData];
                this.charts.frequency.update('none');
            }
            
            updateAIPredictions() {
                // Update maintenance predictions
                this.state.turbines.forEach(turbine => {
                    const remainingHours = turbine.nextMaintenance - turbine.runHours;
                    if (remainingHours < 100) {
                        this.addAlarm(`Maintenance due soon for ${turbine.name}`, 'MINOR', 
                                    `${Math.round(remainingHours)} hours remaining`);
                    }
                });
                
                // Update optimal load prediction based on grid conditions
                const currentLoadFactor = (this.state.totalOutput / this.config.nominalCapacity) * 100;
                if (currentLoadFactor > 85) {
                    this.state.smartGrid.aiPredictions.optimalLoad.max = 90;
                } else if (currentLoadFactor < 60) {
                    this.state.smartGrid.aiPredictions.optimalLoad.min = 55;
                }
            }
            
            // Automation Functions
            
            startQuickSequence() {
                this.logSystem('Quick start sequence initiated');
                
                // Start all turbines
                this.state.turbines.forEach((turbine, index) => {
                    setTimeout(() => {
                        this.startTurbine(turbine.id);
                    }, index * 30000); // Staggered start
                });
                
                // Enable auto-sync for all turbines
                setTimeout(() => {
                    this.enableAutoSyncAll();
                }, 120000);
                
                // Auto-connect to grid when ready
                setTimeout(() => {
                    this.connectToGrid();
                }, 180000);
                
                this.addAlarm('Quick start sequence active', 'INFO', 'Automated plant startup in progress');
            }
            
            autoStartAllTurbines() {
                this.logSystem('Auto-starting all turbines');
                
                this.state.turbines.forEach(turbine => {
                    if (turbine.status === 'OFFLINE') {
                        this.startTurbine(turbine.id);
                        // Enable auto-sync for each turbine
                        turbine.autoSync = true;
                    }
                });
                
                this.addAlarm('All turbines auto-start initiated', 'INFO');
            }
            
            enableAutoSyncAll() {
                this.logSystem('Enabling auto-sync for all turbines');
                
                this.state.turbines.forEach(turbine => {
                    turbine.autoSync = true;
                    if (turbine.status === 'RUNNING') {
                        this.startAutoSync(turbine.id);
                    }
                });
                
                this.state.automation.autoSyncActive = true;
                this.addAlarm('Auto-sync enabled for all turbines', 'INFO');
            }
            
            startAutoSync(turbineId) {
                const turbine = this.state.turbines.find(t => t.id === turbineId);
                if (!turbine || turbine.status !== 'RUNNING') return;
                
                turbine.status = 'SYNCHRONIZING';
                this.logSystem(`Auto-sync started for ${turbine.name}`);
            }
            
            toggleAutoSync() {
                this.state.automation.autoSyncActive = !this.state.automation.autoSyncActive;
                
                if (this.state.automation.autoSyncActive) {
                    this.logSystem('Smart synchronization system activated');
                    this.addAlarm('Auto-sync system enabled', 'INFO');
                    
                    // Enable auto-sync for all running turbines
                    this.state.turbines.forEach(turbine => {
                        if (turbine.status === 'RUNNING') {
                            turbine.autoSync = true;
                            this.startAutoSync(turbine.id);
                        }
                    });
                } else {
                    this.logSystem('Smart synchronization system deactivated');
                    this.addAlarm('Auto-sync system disabled', 'INFO');
                }
            }
            
            toggleAutoLoad() {
                this.state.automation.autoLoadActive = !this.state.automation.autoLoadActive;
                
                if (this.state.automation.autoLoadActive) {
                    this.logSystem('Auto load balancing activated');
                    this.addAlarm('Auto load balancing enabled', 'INFO');
                } else {
                    this.logSystem('Auto load balancing deactivated');
                }
            }
            
            toggleAutoProtection() {
                this.state.automation.autoProtectionActive = !this.state.automation.autoProtectionActive;
                
                if (this.state.automation.autoProtectionActive) {
                    this.logSystem('Smart protection system activated');
                    this.addAlarm('Auto protection system enabled', 'INFO');
                    
                    // Enable auto-protection for all turbines
                    this.state.turbines.forEach(turbine => {
                        turbine.protection.autoTrip = true;
                    });
                } else {
                    this.logSystem('Smart protection system deactivated');
                }
            }
            
            toggleTurbineAutomation() {
                const allAuto = this.state.turbines.every(t => t.autoSync);
                
                this.state.turbines.forEach(turbine => {
                    turbine.autoSync = !allAuto;
                });
                
                this.state.automation.enabled = !allAuto;
                this.state.automation.mode = !allAuto ? 'FULL_AUTO' : 'MANUAL';
                
                if (!allAuto) {
                    this.logSystem('Full turbine automation enabled');
                    this.addAlarm('Full automation mode activated', 'INFO');
                } else {
                    this.logSystem('Turbine automation disabled');
                }
            }
            
            startAutoSequence() {
                if (this.state.automation.sequenceActive) return;
                
                this.state.automation.sequenceActive = true;
                this.state.automation.currentSequence = [
                    { action: 'CHECK_SYSTEM', delay: 0 },
                    { action: 'START_TURBINES', delay: 5000 },
                    { action: 'ENABLE_AUTO_SYNC', delay: 60000 },
                    { action: 'CONNECT_GRID', delay: 180000 },
                    { action: 'APPLY_BASE_LOAD', delay: 200000 },
                    { action: 'ENABLE_AUTO_LOAD', delay: 220000 }
                ];
                
                this.logSystem('Auto sequence started');
                this.addAlarm('Automated plant startup sequence initiated', 'INFO');
                
                this.processAutoSequence();
            }
            
            processAutoSequence() {
                if (!this.state.automation.sequenceActive || !this.state.automation.currentSequence.length) {
                    this.state.automation.sequenceActive = false;
                    this.logSystem('Auto sequence completed');
                    return;
                }
                
                const step = this.state.automation.currentSequence[0];
                setTimeout(() => {
                    switch (step.action) {
                        case 'CHECK_SYSTEM':
                            this.logSystem('Auto sequence: System check passed');
                            break;
                        case 'START_TURBINES':
                            this.autoStartAllTurbines();
                            break;
                        case 'ENABLE_AUTO_SYNC':
                            this.enableAutoSyncAll();
                            break;
                        case 'CONNECT_GRID':
                            this.connectToGrid();
                            break;
                        case 'APPLY_BASE_LOAD':
                            this.setLoadDemand(250);
                            break;
                        case 'ENABLE_AUTO_LOAD':
                            this.toggleAutoLoad();
                            break;
                    }
                    
                    this.state.automation.currentSequence.shift();
                    this.processAutoSequence();
                }, step.delay);
            }
            
            performAutoSync() {
                // Auto-sync all turbines that need it
                this.state.turbines.forEach(turbine => {
                    if (turbine.autoSync && turbine.status === 'RUNNING') {
                        // Check if close enough to start auto-sync
                        const freqDiff = Math.abs(turbine.frequency - this.state.gridFrequency);
                        if (freqDiff < 0.5 && turbine.voltage > 380) {
                            if (turbine.status !== 'SYNCHRONIZING') {
                                this.startAutoSync(turbine.id);
                            }
                        }
                    }
                });
            }
            
            processAutomation() {
                // Auto load balancing
                if (this.state.automation.autoLoadActive && this.state.gridConnected) {
                    this.performAutoLoadBalancing();
                }
                
                // Auto protection
                if (this.state.automation.autoProtectionActive) {
                    this.performAutoProtection();
                }
            }
            
            performAutoLoadBalancing() {
                // Calculate optimal load distribution
                const onlineTurbines = this.state.turbines.filter(t => t.status === 'ONLINE');
                if (onlineTurbines.length === 0) return;
                
                // Distribute load evenly with efficiency consideration
                const totalEfficiency = onlineTurbines.reduce((sum, t) => sum + t.efficiency, 0);
                const avgEfficiency = totalEfficiency / onlineTurbines.length;
                
                onlineTurbines.forEach(turbine => {
                    // Give more load to more efficient turbines
                    const efficiencyFactor = turbine.efficiency / avgEfficiency;
                    const targetLoad = (this.state.loadDemand / onlineTurbines.length) * efficiencyFactor;
                    
                    const responseSpeed = this.getResponseSpeed();
                    turbine.output = this.approachValue(turbine.output, targetLoad, responseSpeed * 0.1);
                });
            }
            
            performAutoProtection() {
                this.state.turbines.forEach(turbine => {
                    if (turbine.protection.autoTrip) {
                        // Check temperature
                        if (turbine.temperature > turbine.protection.temperatureLimit) {
                            this.tripTurbine(turbine.id, 'Auto-protection: Over temperature');
                        }
                        
                        // Check vibration
                        if (turbine.vibration > turbine.protection.vibrationLimit) {
                            this.tripTurbine(turbine.id, 'Auto-protection: High vibration');
                        }
                        
                        // Check overspeed
                        if (turbine.speed > turbine.protection.overspeedLimit) {
                            this.tripTurbine(turbine.id, 'Auto-protection: Over speed');
                        }
                    }
                });
            }
            
            // Helper Functions
            
            getSyncSensitivity() {
                const value = parseInt(this.elements.sensitivitySlider.value);
                return this.config.syncTolerance[['low', 'medium', 'high'][value - 1]];
            }
            
            getSyncSpeed() {
                const value = parseInt(this.elements.sensitivitySlider.value);
                return this.config.autoSyncSpeed[['low', 'medium', 'high'][value - 1]];
            }
            
            getResponseSpeed() {
                const value = parseInt(this.elements.responseSlider.value);
                return [5, 10, 20][value - 1]; // MW/sec response rate
            }
            
            updateSyncSettings() {
                // Update auto-sync behavior based on settings
                this.logSystem(`Sync sensitivity updated to ${this.elements.syncSensitivity.textContent}`);
            }
            
            approachValue(current, target, step) {
                if (current < target) {
                    return Math.min(current + step, target);
                } else if (current > target) {
                    return Math.max(current - step, target);
                }
                return current;
            }
            
            calculateTargetOutput(turbineId) {
                if (!this.state.gridConnected || this.state.loadDemand === 0) return 0;
                
                const onlineTurbines = this.state.turbines.filter(t => t.status === 'ONLINE');
                if (onlineTurbines.length === 0) return 0;
                
                // Simple load sharing (can be enhanced with AI)
                return Math.min(
                    this.config.turbineCapacity,
                    this.state.loadDemand / onlineTurbines.length
                );
            }
            
            getAvailableCapacity() {
                const onlineTurbines = this.state.turbines.filter(t => t.status === 'ONLINE');
                return onlineTurbines.length * this.config.turbineCapacity;
            }
            
            // Control Functions
            
            handleTurbineAction(turbineId, action) {
                const turbine = this.state.turbines.find(t => t.id === turbineId);
                if (!turbine) return;
                
                switch (action) {
                    case 'start':
                        this.startTurbine(turbineId);
                        break;
                    case 'sync':
                        this.synchronizeTurbine(turbineId);
                        break;
                    case 'auto-toggle':
                        this.toggleTurbineAutoSync(turbineId);
                        break;
                }
            }
            
            startTurbine(turbineId) {
                const turbine = this.state.turbines.find(t => t.id === turbineId);
                if (!turbine || !['OFFLINE', 'TRIPPED'].includes(turbine.status)) return;
                
                turbine.status = 'STARTING';
                this.logSystem(`${turbine.name} startup initiated`);
            }
            
            synchronizeTurbine(turbineId) {
                const turbine = this.state.turbines.find(t => t.id === turbineId);
                if (!turbine || turbine.status !== 'RUNNING') return;
                
                turbine.status = 'SYNCHRONIZING';
                this.logSystem(`${turbine.name} synchronization started`);
            }
            
            toggleTurbineAutoSync(turbineId) {
                const turbine = this.state.turbines.find(t => t.id === turbineId);
                if (!turbine) return;
                
                turbine.autoSync = !turbine.autoSync;
                
                if (turbine.autoSync) {
                    this.logSystem(`${turbine.name} auto-sync enabled`);
                    if (turbine.status === 'RUNNING') {
                        this.startAutoSync(turbineId);
                    }
                } else {
                    this.logSystem(`${turbine.name} auto-sync disabled`);
                }
            }
            
            setLoadDemand(load) {
                const newLoad = Math.min(this.config.nominalCapacity, Math.max(0, load));
                this.state.loadDemand = newLoad;
                this.elements.loadSlider.value = newLoad;
                
                // Check for overload
                const availableCapacity = this.getAvailableCapacity();
                if (newLoad > availableCapacity) {
                    this.addAlarm('Load demand exceeds available capacity', 'MAJOR', 
                                 `Demand: ${newLoad}MW, Available: ${availableCapacity}MW`);
                    
                    // Auto-load shedding if enabled
                    if (this.state.automation.autoProtectionActive && newLoad > availableCapacity * 1.1) {
                        setTimeout(() => {
                            this.performAutoLoadShedding();
                        }, 3000);
                    }
                }
                
                this.logSystem(`Load demand set to ${newLoad} MW`);
            }
            
            connectToGrid() {
                if (this.state.gridConnected) return;
                
                const syncedTurbines = this.state.turbines.filter(t => t.status === 'ONLINE');
                if (syncedTurbines.length < 2) {
                    this.addAlarm('Grid connection failed', 'MAJOR', 'Minimum 2 synchronized turbines required');
                    return;
                }
                
                this.state.gridConnected = true;
                this.logSystem('Grid connection established');
                this.addAlarm('Grid connected', 'INFO', 'Plant supplying power to grid');
                
                // Enable load control
                this.elements.loadSlider.disabled = false;
            }
            
            emergencyStop() {
                // Trip all turbines
                this.state.turbines.forEach(turbine => {
                    if (turbine.status !== 'OFFLINE' && turbine.status !== 'TRIPPED') {
                        this.tripTurbine(turbine.id, 'Emergency stop');
                    }
                });
                
                // Disconnect from grid
                this.state.gridConnected = false;
                
                // Reset load demand
                this.state.loadDemand = 0;
                this.elements.loadSlider.value = 0;
                
                // Disable automation
                this.state.automation.enabled = false;
                this.state.automation.autoSyncActive = false;
                this.state.automation.autoLoadActive = false;
                
                this.addAlarm('EMERGENCY STOP ACTIVATED', 'CRITICAL', 'Full plant shutdown');
                this.logSystem('Emergency stop executed - Full plant shutdown');
            }
            
            tripTurbine(turbineId, reason) {
                const turbine = this.state.turbines.find(t => t.id === turbineId);
                if (!turbine) return;
                
                turbine.status = 'TRIPPED';
                this.logSystem(`${turbine.name} tripped: ${reason}`);
                this.addAlarm(`${turbine.name} TRIPPED`, 'CRITICAL', reason);
                
                // If grid was connected and this causes issues
                if (this.state.gridConnected) {
                    const onlineTurbines = this.state.turbines.filter(t => t.status === 'ONLINE');
                    if (onlineTurbines.length < 2) {
                        this.state.gridConnected = false;
                        this.addAlarm('Grid disconnected', 'MAJOR', 'Insufficient online turbines');
                    }
                }
            }
            
            performAutoLoadShedding() {
                // Reduce load to match available capacity
                const availableCapacity = this.getAvailableCapacity();
                const newLoad = availableCapacity * 0.9;
                this.setLoadDemand(newLoad);
                
                this.addAlarm('Auto load shedding performed', 'CRITICAL', 
                             'Load demand reduced to match available capacity');
            }
            
            checkTurbineProtection(turbine) {
                // Basic protection checks
                if (turbine.temperature > 650) {
                    this.tripTurbine(turbine.id, 'Over temperature protection');
                }
                
                if (turbine.vibration > 7.1) {
                    this.tripTurbine(turbine.id, 'High vibration protection');
                }
                
                if (turbine.speed > 3300) {
                    this.tripTurbine(turbine.id, 'Over speed protection');
                }
            }
            
            checkAlarms() {
                // Check frequency deviations
                if (this.state.gridConnected) {
                    if (Math.abs(this.state.gridFrequency - 50.0) > 0.5) {
                        this.addAlarm('Grid frequency deviation', 'CRITICAL', 
                                     `Frequency: ${this.state.gridFrequency.toFixed(2)} Hz`);
                    }
                }
            }
            
            addAlarm(title, severity, description = '') {
                const alarm = {
                    id: Date.now(),
                    timestamp: new Date().toLocaleTimeString(),
                    title,
                    severity,
                    description,
                    acknowledged: false
                };
                
                this.state.alarms.unshift(alarm);
                
                // Update alarm display
                this.updateAlarmDisplay();
                
                // Add to system log
                this.logSystem(`ALARM: ${title} - ${description}`);
            }
            
            updateAlarmDisplay() {
                const unacknowledged = this.state.alarms.filter(a => !a.acknowledged);
                
                // Update alarm list
                this.elements.alarmList.innerHTML = '';
                
                unacknowledged.slice(0, 5).forEach(alarm => {
                    const alarmDiv = document.createElement('div');
                    alarmDiv.className = 'alarm-item';
                    
                    let severityColor = '';
                    switch (alarm.severity) {
                        case 'CRITICAL': severityColor = '#ff4444'; break;
                        case 'MAJOR': severityColor = '#ff8800'; break;
                        case 'MINOR': severityColor = '#ffcc00'; break;
                        case 'INFO': severityColor = '#00aaff'; break;
                    }
                    
                    alarmDiv.style.borderLeftColor = severityColor;
                    alarmDiv.innerHTML = `
                        <div>${alarm.title}</div>
                        ${alarm.description ? `<div style="font-size: 11px; margin-top: 4px;">${alarm.description}</div>` : ''}
                        <div class="alarm-time">${alarm.timestamp}</div>
                    `;
                    
                    this.elements.alarmList.appendChild(alarmDiv);
                });
                
                // Update system log
                this.updateSystemLog();
            }
            
            updateSystemLog() {
                this.elements.systemLog.innerHTML = '';
                
                this.state.systemLog.slice(0, 10).forEach(log => {
                    const logDiv = document.createElement('div');
                    logDiv.style.padding = '8px';
                    logDiv.style.borderBottom = '1px solid var(--panel-light)';
                    logDiv.style.fontSize = '12px';
                    logDiv.innerHTML = `
                        <span style="color: var(--hmi-green);">${log.timestamp}</span>
                        <span style="margin-left: 10px;">${log.message}</span>
                    `;
                    
                    this.elements.systemLog.appendChild(logDiv);
                });
            }
            
            acknowledgeAllAlarms() {
                this.state.alarms.forEach(alarm => alarm.acknowledged = true);
                this.updateAlarmDisplay();
                this.logSystem('All alarms acknowledged');
            }
            
            logSystem(message) {
                const logEntry = {
                    timestamp: new Date().toLocaleTimeString(),
                    message
                };
                
                this.state.systemLog.unshift(logEntry);
                
                // Keep only last 100 log entries
                if (this.state.systemLog.length > 100) {
                    this.state.systemLog.pop();
                }
            }
        }
        
        // Initialize simulator
        window.addEventListener('DOMContentLoaded', () => {
            window.smartPlant = new SmartPlantSimulator();
        });
    </script>
</body>
</html>