<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>شبیه‌ساز پیشرفته نیروگاه گازی ۱۰۰۰ مگاواتی</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-annotation@2.0.1/dist/chartjs-plugin-annotation.min.js"></script>
    <style>
        :root {
            --primary: #3498db;
            --primary-dark: #2980b9;
            --secondary: #2c3e50;
            --success: #27ae60;
            --warning: #f39c12;
            --danger: #e74c3c;
            --danger-dark: #c0392b;
            --dark: #1a1a2e;
            --light: #ecf0f1;
            --surface: rgba(44, 62, 80, 0.95);
            --grid-color: #2ecc71;
            --turbine-color: #3498db;
            --generator-color: #9b59b6;
            --transformer-color: #e67e22;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
            -webkit-user-select: none;
            user-select: none;
            touch-action: manipulation;
            font-family: 'Vazir', 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        @font-face {
            font-family: 'Vazir';
            src: url('https://cdn.jsdelivr.net/gh/rastikerdar/vazir-font@v30.1.0/dist/Vazir.woff2') format('woff2');
        }
        
        body {
            background: linear-gradient(135deg, #0c2461 0%, #1a1a2e 100%);
            color: var(--light);
            min-height: 100vh;
            overflow-x: hidden;
            line-height: 1.8;
            font-family: 'Vazir', sans-serif;
        }
        
        /* کانتینر اصلی */
        .persian-container {
            width: 100%;
            max-width: 100vw;
            min-height: 100vh;
            padding: 0;
            position: relative;
            overflow-x: hidden;
        }
        
        /* هدر فارسی */
        .persian-header {
            background: linear-gradient(135deg, rgba(0, 0, 0, 0.9) 0%, rgba(44, 62, 80, 0.95) 100%);
            backdrop-filter: blur(20px);
            padding: 15px 20px;
            position: sticky;
            top: 0;
            z-index: 1000;
            border-bottom: 2px solid rgba(52, 152, 219, 0.3);
            box-shadow: 0 5px 25px rgba(0, 0, 0, 0.4);
        }
        
        .header-content {
            display: grid;
            grid-template-columns: auto 1fr auto;
            gap: 15px;
            align-items: center;
        }
        
        .logo-section {
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .logo-icon {
            width: 48px;
            height: 48px;
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            box-shadow: 0 4px 12px rgba(52, 152, 219, 0.3);
        }
        
        .logo-text {
            display: flex;
            flex-direction: column;
        }
        
        .plant-name {
            font-size: 1.4rem;
            font-weight: 900;
            color: var(--light);
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
        }
        
        .plant-spec {
            font-size: 0.9rem;
            color: var(--primary);
            opacity: 0.9;
        }
        
        .header-center {
            text-align: center;
        }
        
        .time-display {
            font-size: 1.1rem;
            font-weight: 700;
            color: var(--light);
            margin-bottom: 5px;
            direction: ltr;
            display: inline-block;
            background: rgba(0, 0, 0, 0.3);
            padding: 5px 15px;
            border-radius: 20px;
        }
        
        .date-display {
            font-size: 0.9rem;
            opacity: 0.8;
        }
        
        .header-actions {
            display: flex;
            gap: 10px;
            direction: ltr;
        }
        
        .header-btn {
            width: 44px;
            height: 44px;
            border-radius: 12px;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s;
            position: relative;
        }
        
        .header-btn:active {
            transform: scale(0.95);
            background: rgba(255, 255, 255, 0.2);
        }
        
        .badge {
            position: absolute;
            top: -5px;
            left: -5px;
            background: var(--danger);
            color: white;
            font-size: 0.7rem;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        /* داشبورد اصلی */
        .persian-dashboard {
            padding: 15px;
            padding-bottom: 100px;
        }
        
        /* بخش وضعیت */
        .status-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
            margin-bottom: 20px;
        }
        
        .status-card {
            background: var(--surface);
            border-radius: 15px;
            padding: 20px;
            border: 2px solid rgba(255, 255, 255, 0.05);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.2);
            position: relative;
            overflow: hidden;
            transition: all 0.3s;
        }
        
        .status-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 12px 30px rgba(0, 0, 0, 0.3);
        }
        
        .status-card::before {
            content: '';
            position: absolute;
            top: 0;
            right: 0;
            width: 4px;
            height: 100%;
            background: linear-gradient(to bottom, var(--primary) 0%, var(--success) 100%);
        }
        
        .status-card.critical::before {
            background: linear-gradient(to bottom, var(--danger) 0%, var(--warning) 100%);
        }
        
        .status-label {
            font-size: 0.85rem;
            opacity: 0.7;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .status-label i {
            color: var(--primary);
        }
        
        .status-value {
            font-size: 1.6rem;
            font-weight: 900;
            margin-bottom: 8px;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
        }
        
        .status-trend {
            font-size: 0.85rem;
            display: flex;
            align-items: center;
            gap: 6px;
            opacity: 0.9;
        }
        
        .trend-up { color: var(--success); }
        .trend-down { color: var(--danger); }
        .trend-stable { color: var(--warning); }
        
        /* بخش توربین‌ها */
        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid rgba(52, 152, 219, 0.3);
        }
        
        .section-title {
            font-size: 1.2rem;
            font-weight: 700;
            color: var(--primary);
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .section-actions {
            display: flex;
            gap: 10px;
        }
        
        /* شبکه توربین‌ها */
        .turbine-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin-bottom: 25px;
        }
        
        @media (min-width: 768px) {
            .turbine-grid {
                grid-template-columns: repeat(4, 1fr);
            }
        }
        
        .turbine-card {
            background: linear-gradient(135deg, rgba(0, 0, 0, 0.4) 0%, rgba(52, 152, 219, 0.1) 100%);
            border-radius: 15px;
            padding: 20px;
            border: 2px solid rgba(52, 152, 219, 0.3);
            position: relative;
            transition: all 0.3s;
        }
        
        .turbine-card.active {
            border-color: var(--turbine-color);
            box-shadow: 0 0 25px rgba(52, 152, 219, 0.4);
            animation: pulse-glow 2s infinite;
        }
        
        @keyframes pulse-glow {
            0%, 100% { box-shadow: 0 0 25px rgba(52, 152, 219, 0.4); }
            50% { box-shadow: 0 0 35px rgba(52, 152, 219, 0.6); }
        }
        
        .turbine-card.tripped {
            border-color: var(--danger);
            box-shadow: 0 0 25px rgba(231, 76, 60, 0.4);
            animation: pulse-alarm 1.5s infinite;
        }
        
        @keyframes pulse-alarm {
            0%, 100% { 
                opacity: 1;
                box-shadow: 0 0 25px rgba(231, 76, 60, 0.4);
            }
            50% { 
                opacity: 0.9;
                box-shadow: 0 0 35px rgba(231, 76, 60, 0.6);
            }
        }
        
        .turbine-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .turbine-name {
            font-weight: 900;
            font-size: 1.1rem;
            color: var(--light);
        }
        
        .turbine-id {
            background: rgba(0, 0, 0, 0.3);
            padding: 4px 10px;
            border-radius: 20px;
            font-size: 0.9rem;
            color: var(--turbine-color);
        }
        
        .turbine-status {
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 700;
            display: inline-block;
        }
        
        .status-online { background: rgba(39, 174, 96, 0.2); color: var(--success); border: 1px solid rgba(39, 174, 96, 0.3); }
        .status-starting { background: rgba(243, 156, 18, 0.2); color: var(--warning); border: 1px solid rgba(243, 156, 18, 0.3); }
        .status-syncing { background: rgba(155, 89, 182, 0.2); color: var(--generator-color); border: 1px solid rgba(155, 89, 182, 0.3); }
        .status-offline { background: rgba(149, 165, 166, 0.2); color: #95a5a6; border: 1px solid rgba(149, 165, 166, 0.3); }
        .status-tripped { background: rgba(231, 76, 60, 0.2); color: var(--danger); border: 1px solid rgba(231, 76, 60, 0.3); }
        .status-maintenance { background: rgba(230, 126, 34, 0.2); color: var(--transformer-color); border: 1px solid rgba(230, 126, 34, 0.3); }
        
        .turbine-visual {
            height: 120px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 10px;
            margin-bottom: 15px;
            position: relative;
            overflow: hidden;
            border: 1px solid rgba(255, 255, 255, 0.05);
        }
        
        .turbine-canvas {
            width: 100%;
            height: 100%;
        }
        
        .turbine-metrics {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
            margin-bottom: 15px;
        }
        
        .metric {
            text-align: center;
            background: rgba(0, 0, 0, 0.2);
            padding: 10px;
            border-radius: 10px;
            border: 1px solid rgba(255, 255, 255, 0.05);
        }
        
        .metric-label {
            font-size: 0.75rem;
            opacity: 0.7;
            margin-bottom: 5px;
            white-space: nowrap;
        }
        
        .metric-value {
            font-size: 1.1rem;
            font-weight: 700;
            direction: ltr;
        }
        
        .turbine-controls {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 8px;
            margin-top: 15px;
        }
        
        /* دکمه‌های کنترلی */
        .control-btn {
            height: 44px;
            border-radius: 10px;
            border: none;
            font-size: 0.9rem;
            font-weight: 700;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 4px;
            cursor: pointer;
            transition: all 0.2s;
            position: relative;
            overflow: hidden;
        }
        
        .control-btn:active {
            transform: scale(0.97);
        }
        
        .control-btn.primary {
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            color: white;
        }
        
        .control-btn.success {
            background: linear-gradient(135deg, var(--success) 0%, #229954 100%);
            color: white;
        }
        
        .control-btn.warning {
            background: linear-gradient(135deg, var(--warning) 0%, #d68910 100%);
            color: white;
        }
        
        .control-btn.danger {
            background: linear-gradient(135deg, var(--danger) 0%, var(--danger-dark) 100%);
            color: white;
        }
        
        .control-btn:disabled {
            background: #555;
            opacity: 0.5;
            cursor: not-    allowed;
        }
        
        /* بخش سنکرونسازی */
        .sync-section {
            background: linear-gradient(135deg, rgba(0, 0, 0, 0.4) 0%, rgba(155, 89, 182, 0.1) 100%);
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 25px;
            border: 2px solid rgba(155, 89, 182, 0.3);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.2);
        }
        
        .sync-visual {
            height: 180px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 10px;
            margin: 20px 0;
            position: relative;
            overflow: hidden;
            border: 1px solid rgba(255, 255, 255, 0.05);
        }
        
        .sync-metrics {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
        }
        
        /* کنترل بار */
        .load-section {
            background: linear-gradient(135deg, rgba(0, 0, 0, 0.4) 0%, rgba(46, 204, 113, 0.1) 100%);
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 25px;
            border: 2px solid rgba(46, 204, 113, 0.3);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.2);
        }
        
        .load-visual {
            height: 140px;
            position: relative;
            margin: 20px 0;
        }
        
        .load-bar {
            position: absolute;
            bottom: 0;
            width: 100%;
            height: 50px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            overflow: hidden;
            border: 2px solid rgba(255, 255, 255, 0.1);
        }
        
        .load-fill {
            position: absolute;
            bottom: 0;
            right: 0;
            width: 0%;
            height: 100%;
            background: linear-gradient(to left, var(--success) 0%, var(--warning) 70%, var(--danger) 100%);
            border-radius: 10px;
            transition: width 0.5s cubic-bezier(0.34, 1.56, 0.64, 1);
        }
        
        .load-marks {
            display: flex;
            justify-content: space-between;
            margin-top: 60px;
            font-size: 0.9rem;
            opacity: 0.8;
        }
        
        .load-mark {
            text-align: center;
            flex: 1;
        }
        
        .load-mark.active {
            color: var(--primary);
            font-weight: 700;
        }
        
        /* اسلایدر لمسی */
        .touch-slider-container {
            margin: 25px 0;
        }
        
        .slider-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 15px;
        }
        
        .slider-value {
            font-size: 1.8rem;
            font-weight: 900;
            color: var(--primary);
            direction: ltr;
        }
        
        .range-slider {
            width: 100%;
            height: 12px;
            -webkit-appearance: none;
            appearance: none;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 6px;
            outline: none;
        }
        
        .range-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background: var(--primary);
            cursor: pointer;
            box-shadow: 0 4px 15px rgba(52, 152, 219, 0.5);
            border: 3px solid white;
            transition: all 0.2s;
        }
        
        .range-slider::-webkit-slider-thumb:active {
            transform: scale(1.2);
            box-shadow: 0 6px 20px rgba(52, 152, 219, 0.7);
        }
        
        .slider-labels {
            display: flex;
            justify-content: space-between;
            margin-top: 8px;
            font-size: 0.85rem;
            opacity: 0.7;
        }
        
        /* شبکه دکمه‌های کنترلی */
        .control-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
            margin-top: 20px;
        }
        
        @media (min-width: 768px) {
            .control-grid {
                grid-template-columns: repeat(4, 1fr);
            }
        }
        
        .grid-btn {
            height: 70px;
            border-radius: 12px;
            border: none;
            font-size: 0.95rem;
            font-weight: 700;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 6px;
            cursor: pointer;
            transition: all 0.3s;
            position: relative;
            overflow: hidden;
        }
        
        .grid-btn:active {
            transform: scale(0.97);
        }
        
        .grid-btn i {
            font-size: 1.3rem;
        }
        
        .grid-btn.primary {
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            color: white;
        }
        
        .grid-btn.success {
            background: linear-gradient(135deg, var(--success) 0%, #229954 100%);
            color: white;
        }
        
        .grid-btn.warning {
            background: linear-gradient(135deg, var(--warning) 0%, #d68910 100%);
            color: white;
        }
        
        .grid-btn.danger {
            background: linear-gradient(135deg, var(--danger) 0%, var(--danger-dark) 100%);
            color: white;
        }
        
        .grid-btn.purple {
            background: linear-gradient(135deg, var(--generator-color) 0%, #8e44ad 100%);
            color: white;
        }
        
        .grid-btn.orange {
            background: linear-gradient(135deg, var(--transformer-color) 0%, #d35400 100%);
            color: white;
        }
        
        /* بخش نمودارها */
        .charts-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 20px;
            margin-bottom: 25px;
        }
        
        @media (min-width: 768px) {
            .charts-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }
        
        .chart-card {
            background: var(--surface);
            border-radius: 15px;
            padding: 20px;
            height: 320px;
            border: 2px solid rgba(255, 255, 255, 0.05);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.2);
        }
        
        /* پنل هشدار */
        .alarm-panel {
            background: linear-gradient(135deg, rgba(231, 76, 60, 0.1) 0%, rgba(192, 57, 43, 0.2) 100%);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 25px;
            border: 2px solid rgba(231, 76, 60, 0.3);
            animation: pulse-alarm 2s infinite;
        }
        
        .alarm-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 15px;
            color: var(--danger);
        }
        
        .alarm-list {
            max-height: 200px;
            overflow-y: auto;
            direction: ltr;
        }
        
        .alarm-item {
            padding: 12px;
            margin-bottom: 10px;
            background: rgba(231, 76, 60, 0.2);
            border-radius: 10px;
            border-right: 4px solid var(--danger);
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: all 0.3s;
        }
        
        .alarm-item:hover {
            background: rgba(231, 76, 60, 0.3);
            transform: translateX(-5px);
        }
        
        .alarm-content {
            flex: 1;
        }
        
        .alarm-title {
            font-weight: 700;
            margin-bottom: 5px;
        }
        
        .alarm-desc {
            font-size: 0.9rem;
            opacity: 0.9;
        }
        
        .alarm-time {
            font-size: 0.8rem;
            opacity: 0.8;
            margin-right: 15px;
        }
        
        /* نویگیشن پایین */
        .persian-nav {
            position: fixed;
            bottom: 0;
            right: 0;
            left: 0;
            background: rgba(0, 0, 0, 0.95);
            backdrop-filter: blur(20px);
            border-top: 2px solid rgba(52, 152, 219, 0.3);
            display: flex;
            justify-content: space-around;
            padding: 12px 0;
            z-index: 1000;
        }
        
        .nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 6px;
            padding: 10px 15px;
            border-radius: 15px;
            cursor: pointer;
            transition: all 0.3s;
            min-width: 70px;
        }
        
        .nav-item.active {
            background: rgba(52, 152, 219, 0.2);
            transform: translateY(-5px);
        }
        
        .nav-item:active {
            background: rgba(255, 255, 255, 0.1);
        }
        
        .nav-icon {
            font-size: 1.3rem;
        }
        
        .nav-label {
            font-size: 0.85rem;
            font-weight: 700;
        }
        
        /* تابلوی آموزش */
        .tutorial-panel {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: var(--surface);
            border-radius: 20px;
            padding: 30px;
            max-width: 500px;
            width: 90%;
            z-index: 2000;
            box-shadow: 0 20px 50px rgba(0, 0, 0, 0.5);
            display: none;
        }
        
        .tutorial-panel.active {
            display: block;
            animation: slideIn 0.5s cubic-bezier(0.34, 1.56, 0.64, 1);
        }
        
        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translate(-50%, -60%);
            }
            to {
                opacity: 1;
                transform: translate(-50%, -50%);
            }
        }
        
        .tutorial-content {
            text-align: center;
        }
        
        .tutorial-icon {
            font-size: 4rem;
            color: var(--primary);
            margin-bottom: 20px;
        }
        
        .tutorial-text {
            font-size: 1.1rem;
            margin-bottom: 25px;
            line-height: 1.8;
        }
        
        .tutorial-step {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 15px;
            text-align: right;
        }
        
        .step-number {
            width: 30px;
            height: 30px;
            background: var(--primary);
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 900;
        }
        
        /* انیمیشن‌های ویژه */
        @keyframes rotate {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
        
        @keyframes float {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }
        
        .rotating {
            animation: rotate 2s linear infinite;
        }
        
        .floating {
            animation: float 3s ease-in-out infinite;
        }
        
        /* رسپانسیو */
        @media (max-width: 480px) {
            .header-content {
                grid-template-columns: 1fr;
                text-align: center;
            }
            
            .logo-section, .header-center, .header-actions {
                justify-content: center;
            }
            
            .status-grid {
                grid-template-columns: 1fr;
            }
            
            .sync-metrics {
                grid-template-columns: repeat(2, 1fr);
            }
        }
        
        /* اسکرول بار سفارشی */
        ::-webkit-scrollbar {
            width: 8px;
        }
        
        ::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 4px;
        }
        
        ::-webkit-scrollbar-thumb {
            background: var(--primary);
            border-radius: 4px;
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: var(--primary-dark);
        }
    </style>
</head>
<body>
    <div class="persian-container">
        <!-- هدر فارسی -->
        <header class="persian-header">
            <div class="header-content">
                <div class="logo-section">
                    <div class="logo-icon">
                        <i class="fas fa-bolt"></i>
                    </div>
                    <div class="logo-text">
                        <div class="plant-name">نیروگاه گازی ۱۰۰۰ مگاواتی</div>
                        <div class="plant-spec">شبیه‌ساز پیشرفته عملیاتی</div>
                    </div>
                </div>
                
                <div class="header-center">
                    <div class="time-display" id="current-time">۱۲:۰۰:۰۰</div>
                    <div class="date-display" id="current-date">۱۴۰۳/۰۱/۰۱</div>
                </div>
                
                <div class="header-actions">
                    <div class="header-btn" id="alarm-btn">
                        <i class="fas fa-exclamation-triangle"></i>
                        <span class="badge" id="alarm-count">۰</span>
                    </div>
                    <div class="header-btn" id="tutorial-btn">
                        <i class="fas fa-graduation-cap"></i>
                    </div>
                    <div class="header-btn" id="settings-btn">
                        <i class="fas fa-cog"></i>
                    </div>
                </div>
            </div>
        </header>
        
        <!-- داشبورد فارسی -->
        <main class="persian-dashboard">
            <!-- بخش وضعیت -->
            <section class="status-grid">
                <div class="status-card">
                    <div class="status-label">
                        <i class="fas fa-industry"></i>
                        وضعیت نیروگاه
                    </div>
                    <div class="status-value" id="plant-status">آفلاین</div>
                    <div class="status-trend">
                        <i class="fas fa-circle trend-stable"></i>
                        <span>آماده راه‌اندازی</span>
                    </div>
                </div>
                
                <div class="status-card">
                    <div class="status-label">
                        <i class="fas fa-bolt"></i>
                        خروجی کل
                    </div>
                    <div class="status-value" id="total-output">۰ مگاوات</div>
                    <div class="status-trend">
                        <i class="fas fa-arrow-left"></i>
                        <span>هدف: <span id="target-output">۰ مگاوات</span></span>
                    </div>
                </div>
                
                <div class="status-card">
                    <div class="status-label">
                        <i class="fas fa-wave-square"></i>
                        فرکانس شبکه
                    </div>
                    <div class="status-value" id="grid-frequency">۵۰.۰۰ هرتز</div>
                    <div class="status-trend">
                        <i class="fas fa-shield-alt"></i>
                        <span>پایداری: <span id="frequency-stability">۱۰۰٪</span></span>
                    </div>
                </div>
                
                <div class="status-card">
                    <div class="status-label">
                        <i class="fas fa-plug"></i>
                        ولتاژ سیستم
                    </div>
                    <div class="status-value" id="system-voltage">۰ کیلوولت</div>
                    <div class="status-trend">
                        <i class="fas fa-chart-pie"></i>
                        <span>بار: <span id="system-load">۰٪</span></span>
                    </div>
                </div>
            </section>
            
            <!-- بخش توربین‌های گازی -->
            <section class="turbine-section">
                <div class="section-header">
                    <div class="section-title">
                        <i class="fas fa-tachometer-alt rotating"></i>
                        <span>توربین‌های گازی (۴ واحد ۲۵۰ مگاواتی)</span>
                    </div>
                    <div class="section-actions">
                        <button class="control-btn primary" id="start-all-turbines">
                            <i class="fas fa-play-circle"></i>
                            <span>راه‌اندازی همه</span>
                        </button>
                        <button class="control-btn danger" id="stop-all-turbines">
                            <i class="fas fa-stop-circle"></i>
                            <span>توقف همه</span>
                        </button>
                    </div>
                </div>
                
                <div class="turbine-grid" id="turbine-grid">
                    <!-- کارت‌های توربین اینجا ساخته می‌شوند -->
                </div>
            </section>
            
            <!-- بخش سنکرونسازی ژنراتورها -->
            <section class="sync-section">
                <div class="section-header">
                    <div class="section-title">
                        <i class="fas fa-cogs floating"></i>
                        <span>سنکرونسازی ژنراتورها</span>
                    </div>
                    <div class="section-actions">
                        <button class="control-btn warning" id="sync-all-generators">
                            <i class="fas fa-sync-alt"></i>
                            <span>سنکرون همه</span>
                        </button>
                    </div>
                </div>
                
                <div class="sync-visual" id="sync-visual">
                    <!-- ویژوالیزیشن سنکرونسازی -->
                    <canvas id="sync-canvas"></canvas>
                </div>
                
                <div class="sync-metrics">
                    <div class="metric">
                        <div class="metric-label">وضعیت سنکرون</div>
                        <div class="metric-value" id="sync-status">غیرسنکرون</div>
                    </div>
                    <div class="metric">
                        <div class="metric-label">زاویه فاز</div>
                        <div class="metric-value" id="phase-angle">۰°</div>
                    </div>
                    <div class="metric">
                        <div class="metric-label">سرعت سنکرون</div>
                        <div class="metric-value" id="sync-speed">۰ دور بر دقیقه</div>
                    </div>
                    <div class="metric">
                        <div class="metric-label">ولتاژ تحریک</div>
                        <div class="metric-value" id="excitation-voltage">۰ ولت</div>
                    </div>
                    <div class="metric">
                        <div class="metric-label">جریان میدان</div>
                        <div class="metric-value" id="field-current">۰ آمپر</div>
                    </div>
                    <div class="metric">
                        <div class="metric-label">ضریب توان</div>
                        <div class="metric-value" id="power-factor">۰.۰۰</div>
                    </div>
                </div>
            </section>
            
            <!-- بخش کنترل بار و اتصال به شبکه -->
            <section class="load-section">
                <div class="section-header">
                    <div class="section-title">
                        <i class="fas fa-balance-scale-left"></i>
                        <span>کنترل بار و اتصال به شبکه</span>
                    </div>
                    <div class="section-actions">
                        <button class="control-btn success" id="connect-to-grid">
                            <i class="fas fa-plug"></i>
                            <span>اتصال به شبکه</span>
                        </button>
                    </div>
                </div>
                
                <div class="load-visual">
                    <div class="load-bar">
                        <div class="load-fill" id="load-fill"></div>
                    </div>
                    <div class="load-marks">
                        <div class="load-mark">۰٪ (خاموش)</div>
                        <div class="load-mark">۲۵٪ (۲۵۰ مگاوات)</div>
                        <div class="load-mark">۵۰٪ (۵۰۰ مگاوات)</div>
                        <div class="load-mark">۷۵٪ (۷۵۰ مگاوات)</div>
                        <div class="load-mark">۱۰۰٪ (۱۰۰۰ مگاوات)</div>
                    </div>
                </div>
                
                <div class="touch-slider-container">
                    <div class="slider-header">
                        <div>کنترل توزیع بار</div>
                        <div class="slider-value" id="load-value">۰ مگاوات</div>
                    </div>
                    <input type="range" class="range-slider" id="load-slider" min="0" max="1000" value="0" step="10">
                    <div class="slider-labels">
                        <div>حداقل بار</div>
                        <div>محدوده بهینه</div>
                        <div>حداکثر ظرفیت</div>
                    </div>
                </div>
                
                <div class="control-grid">
                    <button class="grid-btn primary" id="load-250">
                        <i class="fas fa-chart-line"></i>
                        <span>۲۵۰ مگاوات</span>
                    </button>
                    <button class="grid-btn primary" id="load-500">
                        <i class="fas fa-chart-line"></i>
                        <span>۵۰۰ مگاوات</span>
                    </button>
                    <button class="grid-btn warning" id="load-750">
                        <i class="fas fa-chart-line"></i>
                        <span>۷۵۰ مگاوات</span>
                    </button>
                    <button class="grid-btn danger" id="load-1000">
                        <i class="fas fa-chart-line"></i>
                        <span>۱۰۰۰ مگاوات</span>
                    </button>
                    <button class="grid-btn success" id="auto-balance">
                        <i class="fas fa-robot"></i>
                        <span>تعادل خودکار</span>
                    </button>
                    <button class="grid-btn purple" id="manual-control">
                        <i class="fas fa-hand-paper"></i>
                        <span>کنترل دستی</span>
                    </button>
                    <button class="grid-btn danger" id="emergency-trip">
                        <i class="fas fa-skull-crossbones"></i>
                        <span>تریپ اضطراری</span>
                    </button>
                    <button class="grid-btn orange" id="reset-faults">
                        <i class="fas fa-redo"></i>
                        <span>بازنشانی خطاها</span>
                    </button>
                </div>
            </section>
            
            <!-- بخش کنترل‌های پیشرفته -->
            <section class="advanced-controls">
                <div class="section-header">
                    <div class="section-title">
                        <i class="fas fa-sliders-h"></i>
                        <span>کنترل‌های پیشرفته سیستم</span>
                    </div>
                </div>
                
                <div class="control-group">
                    <div class="group-title">
                        <i class="fas fa-fire"></i>
                        <span>کنترل احتراق</span>
                    </div>
                    <div class="touch-slider-container">
                        <div class="slider-header">
                            <div>نرخ جریان سوخت</div>
                            <div class="slider-value" id="fuel-flow">۰٪</div>
                        </div>
                        <input type="range" class="range-slider" id="fuel-slider" min="0" max="100" value="0" step="1">
                    </div>
                    
                    <div class="touch-slider-container">
                        <div class="slider-header">
                            <div>نسبت هوا به سوخت</div>
                            <div class="slider-value" id="air-fuel-ratio">۱۵:۱</div>
                        </div>
                        <input type="range" class="range-slider" id="ratio-slider" min="10" max="20" value="15" step="0.1">
                    </div>
                </div>
                
                <div class="control-group">
                    <div class="group-title">
                        <i class="fas fa-fan"></i>
                        <span>سیستم خنک‌کننده</span>
                    </div>
                    <div class="touch-slider-container">
                        <div class="slider-header">
                            <div>جریان خنک‌کننده</div>
                            <div class="slider-value" id="coolant-flow">۰٪</div>
                        </div>
                        <input type="range" class="range-slider" id="coolant-slider" min="0" max="100" value="0" step="1">
                    </div>
                </div>
                
                <div class="control-group">
                    <div class="group-title">
                        <i class="fas fa-oil-can"></i>
                        <span>سیستم روغن‌کاری</span>
                    </div>
                    <div class="touch-slider-container">
                        <div class="slider-header">
                            <div>فشار روغن</div>
                            <div class="slider-value" id="oil-pressure">۰ بار</div>
                        </div>
                        <input type="range" class="range-slider" id="oil-slider" min="0" max="10" value="0" step="0.1">
                    </div>
                </div>
            </section>
            
            <!-- بخش نمودارها -->
            <section class="charts-section">
                <div class="section-header">
                    <div class="section-title">
                        <i class="fas fa-chart-bar"></i>
                        <span>مانیتورینگ عملکرد</span>
                    </div>
                </div>
                
                <div class="charts-grid">
                    <div class="chart-card">
                        <canvas id="performance-chart"></canvas>
                    </div>
                    <div class="chart-card">
                        <canvas id="efficiency-chart"></canvas>
                    </div>
                    <div class="chart-card">
                        <canvas id="temperature-chart"></canvas>
                    </div>
                    <div class="chart-card">
                        <canvas id="vibration-chart"></canvas>
                    </div>
                </div>
            </section>
            
            <!-- پنل هشدارها -->
            <section class="alarm-panel" id="alarm-panel" style="display: none;">
                <div class="alarm-header">
                    <i class="fas fa-exclamation-triangle rotating"></i>
                    <h3>هشدارهای فعال</h3>
                </div>
                <div class="alarm-list" id="alarm-list">
                    <!-- هشدارها اینجا نمایش داده می‌شوند -->
                </div>
            </section>
        </main>
        
        <!-- نویگیشن پایین -->
        <nav class="persian-nav">
            <div class="nav-item active" data-screen="dashboard">
                <div class="nav-icon"><i class="fas fa-tachometer-alt"></i></div>
                <div class="nav-label">داشبورد</div>
            </div>
            <div class="nav-item" data-screen="control">
                <div class="nav-icon"><i class="fas fa-gamepad"></i></div>
                <div class="nav-label">کنترل</div>
            </div>
            <div class="nav-item" data-screen="monitor">
                <div class="nav-icon"><i class="fas fa-chart-line"></i></div>
                <div class="nav-label">مانیتور</div>
            </div>
            <div class="nav-item" data-screen="alarms">
                <div class="nav-icon"><i class="fas fa-exclamation-circle"></i></div>
                <div class="nav-label">هشدارها</div>
            </div>
            <div class="nav-item" data-screen="reports">
                <div class="nav-icon"><i class="fas fa-clipboard-list"></i></div>
                <div class="nav-label">گزارشات</div>
            </div>
        </nav>
        
        <!-- تابلوی آموزش -->
        <div class="tutorial-panel" id="tutorial-panel">
            <div class="tutorial-content">
                <div class="tutorial-icon">
                    <i class="fas fa-graduation-cap"></i>
                </div>
                <h2>آموزش راه‌اندازی نیروگاه</h2>
                <div class="tutorial-text">
                    برای راه‌اندازی نیروگاه، این مراحل را دنبال کنید:
                </div>
                
                <div class="tutorial-step">
                    <div class="step-number">۱</div>
                    <div>توربین‌های گازی را راه‌اندازی کنید</div>
                </div>
                
                <div class="tutorial-step">
                    <div class="step-number">۲</div>
                    <div>ژنراتورها را با شبکه سنکرون کنید</div>
                </div>
                
                <div class="tutorial-step">
                    <div class="step-number">۳</div>
                    <div>به شبکه برق متصل شوید</div>
                </div>
                
                <div class="tutorial-step">
                    <div class="step-number">۴</div>
                    <div>بار را به تدریج افزایش دهید</div>
                </div>
                
                <button class="grid-btn primary" id="close-tutorial" style="margin-top: 20px; width: 100%;">
                    <i class="fas fa-check-circle"></i>
                    <span>شروع شبیه‌سازی</span>
                </button>
            </div>
        </div>
    </div>

    <script>
        // شبیه‌ساز پیشرفته نیروگاه گازی
        class نیروگاهشبیه‌ساز {
            constructor() {
                this.وضعیت = {
                    وضعیت_نیروگاه: "آفلاین",
                    خروجی_کل: 0,
                    فرکانس_شبکه: 50.00,
                    ولتاژ_سیستم: 0,
                    بار_موردنیاز: 0,
                    هدف_خروجی: 0,
                    متصل_به_شبکه: false,
                    وضعیت_سنکرون: "غیرسنکرون",
                    زاویه_فاز: 0,
                    سرعت_سنکرون: 0,
                    ولتاژ_تحریک: 0,
                    جریان_میدان: 0,
                    ضریب_توان: 0,
                    جریان_سوخت: 0,
                    نسبت_هوا_سوخت: 15.0,
                    جریان_خنک‌کننده: 0,
                    فشار_روغن: 0,
                    راندمان: 0,
                    
                    توربین‌ها: [],
                    هشدارها: [],
                    خطاها: [],
                    گزارشات: [],
                    
                    تعادل_خودکار: false,
                    کنترل_دستی: true,
                    مرحله_آموزش: 0
                };
                
                // نمودارها
                this.نمودار_عملکرد = null;
                this.نمودار_راندمان = null;
                this.نمودار_دما = null;
                this.نمودار_لرزش = null;
                
                // المان‌های DOM
                this.المان‌ها = {};
                
                // اینتروال‌های شبیه‌سازی
                this.اینتروال‌ها = [];
                
                // تاریخ و زمان فارسی
                this.تقویم_شمسی = new Intl.DateTimeFormat('fa-IR', {
                    year: 'numeric',
                    month: '2-digit',
                    day: '2-digit'
                });
                
                // مقداردهی اولیه
                this.مقداردهی_اولیه();
            }
            
            مقداردهی_اولیه() {
                this.ایجاد_توربین‌ها();
                this.کش_المان‌ها();
                this.ایجاد_نمودارها();
                this.تنظیم_رویدادها();
                this.نمایش_توربین‌ها();
                this.شروع_شبیه‌سازی();
                this.به‌روزرسانی_زمان();
                
                // نمایش آموزش در ابتدا
                setTimeout(() => {
                    this.نمایش_آموزش();
                }, 1000);
            }
            
            ایجاد_توربین‌ها() {
                const نام‌های_توربین = ["پر قدرت", "تندباد", "گردباد", "آتشفشان"];
                
                for (let i = 0; i < 4; i++) {
                    this.وضعیت.توربین‌ها.push({
                        شناسه: i + 1,
                        نام: `توربین ${نام‌های_توربین[i]}`,
                        وضعیت: "آفلاین",
                        خروجی: 0,
                        حداکثر_خروجی: 250,
                        سرعت: 0,
                        حداکثر_سرعت: 3000,
                        دما: 25,
                        حداکثر_دما: 650,
                        ولتاژ: 0,
                        فرکانس: 0,
                        مصرف_سوخت: 0,
                        راندمان: 0,
                        سنکرون_شده: false,
                        تریپ_شده: false,
                        دلیل_تریپ: "",
                        لرزش: 0,
                        دمای_یاتاقان: 25,
                        دمای_خروجی: 25,
                        زمان_راه‌اندازی: 0,
                        متریک‌ها: {
                            دسترس‌پذیری: 100,
                            قابلیت_اطمینان: 100,
                            نیاز_تعمیراتی: false,
                            ساعت_کارکرد: 0
                        }
                    });
                }
            }
            
            کش_المان‌ها() {
                // المان‌های وضعیت
                this.المان‌ها.وضعیت_نیروگاه = document.getElementById('plant-status');
                this.المان‌ها.خروجی_کل = document.getElementById('total-output');
                this.المان‌ها.فرکانس_شبکه = document.getElementById('grid-frequency');
                this.المان‌ها.ولتاژ_سیستم = document.getElementById('system-voltage');
                this.المان‌ها.هدف_خروجی = document.getElementById('target-output');
                this.المان‌ها.پایداری_فرکانس = document.getElementById('frequency-stability');
                this.المان‌ها.بار_سیستم = document.getElementById('system-load');
                
                // شبکه توربین‌ها
                this.المان‌ها.شبکه_توربین = document.getElementById('turbine-grid');
                
                // المان‌های سنکرون
                this.المان‌ها.وضعیت_سنکرون = document.getElementById('sync-status');
                this.المان‌ها.زاویه_فاز = document.getElementById('phase-angle');
                this.المان‌ها.سرعت_سنکرون = document.getElementById('sync-speed');
                this.المان‌ها.ولتاژ_تحریک = document.getElementById('excitation-voltage');
                this.المان‌ها.جریان_میدان = document.getElementById('field-current');
                this.المان‌ها.ضریب_توان = document.getElementById('power-factor');
                
                // کنترل بار
                this.المان‌ها.مقدار_بار = document.getElementById('load-value');
                this.المان‌ها.اسلایدر_بار = document.getElementById('load-slider');
                this.المان‌ها.پرکردن_بار = document.getElementById('load-fill');
                
                // المان‌های کنترل
                this.المان‌ها.جریان_سوخت = document.getElementById('fuel-flow');
                this.المان‌ها.اسلایدر_سوخت = document.getElementById('fuel-slider');
                this.المان‌ها.نسبت_هوا_سوخت = document.getElementById('air-fuel-ratio');
                this.المان‌ها.اسلایدر_نسبت = document.getElementById('ratio-slider');
                this.المان‌ها.جریان_خنک‌کننده = document.getElementById('coolant-flow');
                this.المان‌ها.اسلایدر_خنک‌کننده = document.getElementById('coolant-slider');
                this.المان‌ها.فشار_روغن = document.getElementById('oil-pressure');
                this.المان‌ها.اسلایدر_روغن = document.getElementById('oil-slider');
                
                // المان‌های هشدار
                this.المان‌ها.شمارنده_هشدار = document.getElementById('alarm-count');
                this.المان‌ها.پنل_هشدار = document.getElementById('alarm-panel');
                this.المان‌ها.لیست_هشدار = document.getElementById('alarm-list');
                
                // دکمه‌ها
                this.کش_دکمه‌ها();
                
                // زمان
                this.المان‌ها.زمان_جاری = document.getElementById('current-time');
                this.المان‌ها.تاریخ_جاری = document.getElementById('current-date');
                
                // آموزش
                this.المان‌ها.پنل_آموزش = document.getElementById('tutorial-panel');
            }
            
            کش_دکمه‌ها() {
                const دکمه‌ها = [
                    'start-all-turbines', 'stop-all-turbines', 'sync-all-generators',
                    'connect-to-grid', 'load-250', 'load-500', 'load-750', 'load-1000',
                    'auto-balance', 'manual-control', 'emergency-trip', 'reset-faults',
                    'alarm-btn', 'tutorial-btn', 'settings-btn', 'close-tutorial'
                ];
                
                دکمه‌ها.forEach(شناسه => {
                    this.المان‌ها[شناسه] = document.getElementById(شناسه);
                });
            }
            
            ایجاد_نمودارها() {
                // نمودار عملکرد
                const زمینه_عملکرد = document.getElementById('performance-chart').getContext('2d');
                this.نمودار_عملکرد = new Chart(زمینه_عملکرد, {
                    type: 'line',
                    data: {
                        labels: Array(20).fill(''),
                        datasets: [
                            {
                                label: 'خروجی (مگاوات)',
                                data: Array(20).fill(0),
                                borderColor: '#27ae60',
                                backgroundColor: 'rgba(39, 174, 96, 0.1)',
                                fill: true,
                                tension: 0.4,
                                borderWidth: 2
                            },
                            {
                                label: 'تقاضا (مگاوات)',
                                data: Array(20).fill(0),
                                borderColor: '#3498db',
                                backgroundColor: 'rgba(52, 152, 219, 0.1)',
                                fill: true,
                                tension: 0.4,
                                borderWidth: 2
                            }
                        ]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                labels: { color: '#fff', font: { family: 'Vazir' } }
                            }
                        },
                        scales: {
                            x: {
                                grid: { color: 'rgba(255, 255, 255, 0.05)' },
                                ticks: { color: '#aaa', font: { family: 'Vazir' } }
                            },
                            y: {
                                grid: { color: 'rgba(255, 255, 255, 0.05)' },
                                ticks: { color: '#aaa', font: { family: 'Vazir' } },
                                title: {
                                    display: true,
                                    text: 'توان (مگاوات)',
                                    color: '#aaa',
                                    font: { family: 'Vazir' }
                                },
                                min: 0,
                                max: 1000
                            }
                        }
                    }
                });
                
                // نمودار راندمان
                const زمینه_راندمان = document.getElementById('efficiency-chart').getContext('2d');
                this.نمودار_راندمان = new Chart(زمینه_راندمان, {
                    type: 'bar',
                    data: {
                        labels: ['توربین ۱', 'توربین ۲', 'توربین ۳', 'توربین ۴'],
                        datasets: [
                            {
                                label: 'راندمان (%)',
                                data: [0, 0, 0, 0],
                                backgroundColor: [
                                    'rgba(52, 152, 219, 0.7)',
                                    'rgba(155, 89, 182, 0.7)',
                                    'rgba(46, 204, 113, 0.7)',
                                    'rgba(241, 196, 15, 0.7)'
                                ],
                                borderColor: [
                                    'rgb(52, 152, 219)',
                                    'rgb(155, 89, 182)',
                                    'rgb(46, 204, 113)',
                                    'rgb(241, 196, 15)'
                                ],
                                borderWidth: 1
                            }
                        ]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                labels: { color: '#fff', font: { family: 'Vazir' } }
                            }
                        },
                        scales: {
                            x: {
                                grid: { color: 'rgba(255, 255, 255, 0.05)' },
                                ticks: { color: '#aaa', font: { family: 'Vazir' } }
                            },
                            y: {
                                grid: { color: 'rgba(255, 255, 255, 0.05)' },
                                ticks: { 
                                    color: '#aaa', 
                                    font: { family: 'Vazir' },
                                    callback: function(value) {
                                        return value + '%';
                                    }
                                },
                                title: {
                                    display: true,
                                    text: 'راندمان (%)',
                                    color: '#aaa',
                                    font: { family: 'Vazir' }
                                },
                                min: 0,
                                max: 100
                            }
                        }
                    }
                });
                
                // نمودار دما
                const زمینه_دما = document.getElementById('temperature-chart').getContext('2d');
                this.نمودار_دما = new Chart(زمینه_دما, {
                    type: 'line',
                    data: {
                        labels: Array(15).fill(''),
                        datasets: [
                            {
                                label: 'دمای توربین ۱',
                                data: Array(15).fill(25),
                                borderColor: '#3498db',
                                backgroundColor: 'rgba(52, 152, 219, 0.1)',
                                fill: true,
                                tension: 0.4,
                                borderWidth: 2
                            },
                            {
                                label: 'دمای توربین ۲',
                                data: Array(15).fill(25),
                                borderColor: '#9b59b6',
                                backgroundColor: 'rgba(155, 89, 182, 0.1)',
                                fill: true,
                                tension: 0.4,
                                borderWidth: 2
                            },
                            {
                                label: 'حداکثر مجاز',
                                data: Array(15).fill(650),
                                borderColor: '#e74c3c',
                                borderDash: [5, 5],
                                backgroundColor: 'transparent',
                                fill: false,
                                borderWidth: 1
                            }
                        ]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                labels: { color: '#fff', font: { family: 'Vazir' } }
                            }
                        },
                        scales: {
                            x: {
                                grid: { color: 'rgba(255, 255, 255, 0.05)' },
                                ticks: { color: '#aaa', font: { family: 'Vazir' } }
                            },
                            y: {
                                grid: { color: 'rgba(255, 255, 255, 0.05)' },
                                ticks: { 
                                    color: '#aaa', 
                                    font: { family: 'Vazir' },
                                    callback: function(value) {
                                        return value + '°C';
                                    }
                                },
                                title: {
                                    display: true,
                                    text: 'دما (°C)',
                                    color: '#aaa',
                                    font: { family: 'Vazir' }
                                },
                                min: 0,
                                max: 700
                            }
                        }
                    }
                });
                
                // نمودار لرزش
                const زمینه_لرزش = document.getElementById('vibration-chart').getContext('2d');
                this.نمودار_لرزش = new Chart(زمینه_لرزش, {
                    type: 'line',
                    data: {
                        labels: Array(15).fill(''),
                        datasets: [
                            {
                                label: 'لرزش توربین ۱',
                                data: Array(15).fill(0),
                                borderColor: '#e74c3c',
                                backgroundColor: 'rgba(231, 76, 60, 0.1)',
                                fill: true,
                                tension: 0.4,
                                borderWidth: 2
                            },
                            {
                                label: 'حداکثر مجاز',
                                data: Array(15).fill(5),
                                borderColor: '#f39c12',
                                borderDash: [5, 5],
                                backgroundColor: 'transparent',
                                fill: false,
                                borderWidth: 1
                            }
                        ]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                labels: { color: '#fff', font: { family: 'Vazir' } }
                            }
                        },
                        scales: {
                            x: {
                                grid: { color: 'rgba(255, 255, 255, 0.05)' },
                                ticks: { color: '#aaa', font: { family: 'Vazir' } }
                            },
                            y: {
                                grid: { color: 'rgba(255, 255, 255, 0.05)' },
                                ticks: { 
                                    color: '#aaa', 
                                    font: { family: 'Vazir' },
                                    callback: function(value) {
                                        return value + ' mm/s';
                                    }
                                },
                                title: {
                                    display: true,
                                    text: 'لرزش (mm/s)',
                                    color: '#aaa',
                                    font: { family: 'Vazir' }
                                },
                                min: 0,
                                max: 10
                            }
                        }
                    }
                });
            }
            
            تنظیم_رویدادها() {
                // دکمه‌های کنترل
                this.المان‌ها['start-all-turbines'].addEventListener('click', () => this.راه‌اندازی_همه_توربین‌ها());
                this.المان‌ها['stop-all-turbines'].addEventListener('click', () => this.توقف_همه_توربین‌ها());
                this.المان‌ها['sync-all-generators'].addEventListener('click', () => this.سنکرون_همه());
                this.المان‌ها['connect-to-grid'].addEventListener('click', () => this.اتصال_به_شبکه());
                
                // دکمه‌های بار
                this.المان‌ها['load-250'].addEventListener('click', () => this.تنظیم_بار(250));
                this.المان‌ها['load-500'].addEventListener('click', () => this.تنظیم_بار(500));
                this.المان‌ها['load-750'].addEventListener('click', () => this.تنظیم_بار(750));
                this.المان‌ها['load-1000'].addEventListener('click', () => this.تنظیم_بار(1000));
                
                // دکمه‌های حالت کنترل
                this.المان‌ها['auto-balance'].addEventListener('click', () => this.تغییر_تعادل_خودکار());
                this.المان‌ها['manual-control'].addEventListener('click', () => this.تغییر_کنترل_دستی());
                this.المان‌ها['emergency-trip'].addEventListener('click', () => this.تریپ_اضطراری());
                this.المان‌ها['reset-faults'].addEventListener('click', () => this.بازنشانی_خطاها());
                this.المان‌ها['close-tutorial'].addEventListener('click', () => this.بستن_آموزش());
                
                // اسلایدرها
                this.المان‌ها.اسلایدر_بار.addEventListener('input', (e) => {
                    const مقدار = parseInt(e.target.value);
                    this.تنظیم_بار(مقدار);
                });
                
                this.المان‌ها.اسلایدر_سوخت.addEventListener('input', (e) => {
                    this.وضعیت.جریان_سوخت = parseInt(e.target.value);
                    this.المان‌ها.جریان_سوخت.textContent = `${this.وضعیت.جریان_سوخت}٪`;
                    this.به‌روزرسانی_عملکرد_توربین‌ها();
                });
                
                this.المان‌ها.اسلایدر_نسبت.addEventListener('input', (e) => {
                    this.وضعیت.نسبت_هوا_سوخت = parseFloat(e.target.value);
                    this.المان‌ها.نسبت_هوا_سوخت.textContent = `${this.وضعیت.نسبت_هوا_سوخت.toFixed(1)}:۱`;
                    this.به‌روزرسانی_راندمان_احتراق();
                });
                
                this.المان‌ها.اسلایدر_خنک‌کننده.addEventListener('input', (e) => {
                    this.وضعیت.جریان_خنک‌کننده = parseInt(e.target.value);
                    this.المان‌ها.جریان_خنک‌کننده.textContent = `${this.وضعیت.جریان_خنک‌کننده}٪`;
                    this.به‌روزرسانی_سیستم_خنک‌کننده();
                });
                
                this.المان‌ها.اسلایدر_روغن.addEventListener('input', (e) => {
                    this.وضعیت.فشار_روغن = parseFloat(e.target.value);
                    this.المان‌ها.فشار_روغن.textContent = `${this.وضعیت.فشار_روغن.toFixed(1)} بار`;
                    this.به‌روزرسانی_سیستم_روغن‌کاری();
                });
                
                // دکمه هشدار
                this.المان‌ها['alarm-btn'].addEventListener('click', () => this.نمایش_هشدارها());
                
                // دکمه آموزش
                this.المان‌ها['tutorial-btn'].addEventListener('click', () => this.نمایش_آموزش());
                
                // نویگیشن
                document.querySelectorAll('.nav-item').forEach(آیتم => {
                    آیتم.addEventListener('click', (e) => {
                        document.querySelectorAll('.nav-item').forEach(i => i.classList.remove('active'));
                        آیتم.classList.add('active');
                        this.تغییر_صفحه(آیتم.getAttribute('data-screen'));
                    });
                });
                
                // رویدادهای لمسی برای کارت توربین‌ها
                document.addEventListener('click', (e) => {
                    if (e.target.closest('.turbine-controls')) {
                        const دکمه = e.target.closest('button');
                        if (دکمه) {
                            const شناسه_توربین = parseInt(دکمه.dataset.turbine);
                            const عمل = دکمه.dataset.action;
                            this.پردازش_عمل_توربین(شناسه_توربین, عمل);
                        }
                    }
                });
            }
            
            نمایش_توربین‌ها() {
                this.المان‌ها.شبکه_توربین.innerHTML = '';
                
                this.وضعیت.توربین‌ها.forEach(توربین => {
                    const کارت = document.createElement('div');
                    const کلاس_وضعیت = `status-${توربین.وضعیت.toLowerCase().replace(' ', '-')}`;
                    
                    کارت.className = `turbine-card ${توربین.وضعیت !== 'آفلاین' ? 'active' : ''} ${توربین.تریپ_شده ? 'tripped' : ''}`;
                    
                    کارت.innerHTML = `
                        <div class="turbine-header">
                            <div>
                                <div class="turbine-name">${توربین.نام}</div>
                                <div class="turbine-id">واحد ${توربین.شناسه}</div>
                            </div>
                            <div class="turbine-status ${کلاس_وضعیت}">${توربین.وضعیت}</div>
                        </div>
                        
                        <div class="turbine-visual">
                            <canvas class="turbine-canvas" id="turbine-canvas-${توربین.شناسه}"></canvas>
                        </div>
                        
                        <div class="turbine-metrics">
                            <div class="metric">
                                <div class="metric-label">خروجی</div>
                                <div class="metric-value">${Math.round(توربین.خروجی)} MW</div>
                            </div>
                            <div class="metric">
                                <div class="metric-label">سرعت</div>
                                <div class="metric-value">${Math.round(توربین.سرعت)} RPM</div>
                            </div>
                            <div class="metric">
                                <div class="metric-label">دما</div>
                                <div class="metric-value">${Math.round(توربین.دما)}°C</div>
                            </div>
                            <div class="metric">
                                <div class="metric-label">راندمان</div>
                                <div class="metric-value">${Math.round(توربین.راندمان)}%</div>
                            </div>
                        </div>
                        
                        <div class="turbine-controls">
                            <button class="control-btn primary" data-turbine="${توربین.شناسه}" data-action="start" 
                                    ${توربین.وضعیت !== 'آفلاین' ? 'disabled' : ''}>
                                <i class="fas fa-play"></i>
                                <span>راه‌اندازی</span>
                            </button>
                            <button class="control-btn warning" data-turbine="${توربین.شناسه}" data-action="sync"
                                    ${!['در حال کار', 'آنلاین'].includes(توربین.وضعیت) ? 'disabled' : ''}>
                                <i class="fas fa-sync-alt"></i>
                                <span>سنکرون</span>
                            </button>
                            <button class="control-btn danger" data-turbine="${توربین.شناسه}" data-action="trip"
                                    ${توربین.وضعیت === 'آفلاین' ? 'disabled' : ''}>
                                <i class="fas fa-power-off"></i>
                                <span>تریپ</span>
                            </button>
                        </div>
                    `;
                    
                    this.المان‌ها.شبکه_توربین.appendChild(کارت);
                });
                
                // مقداردهی ویژوالیزیشن توربین‌ها
                this.مقداردهی_ویژوال_توربین‌ها();
            }
            
            مقداردهی_ویژوال_توربین‌ها() {
                this.وضعیت.توربین‌ها.forEach(توربین => {
                    const بوم = document.getElementById(`turbine-canvas-${توربین.شناسه}`);
                    if (بوم) {
                        this.رندر_توربین(بوم, توربین);
                    }
                });
            }
            
            رندر_توربین(بوم, توربین) {
                const زمینه = بوم.getContext('2d');
                const عرض = بوم.width || 200;
                const ارتفاع = بوم.height || 120;
                
                // پاک‌سازی بوم
                زمینه.clearRect(0, 0, عرض, ارتفاع);
                
                // رسم توربین بر اساس وضعیت
                this.رسم_توربین(زمینه, عرض, ارتفاع, توربین);
                
                // فریم بعدی
                درخواست_انیمیشن(() => this.رندر_توربین(بوم, توربین));
            }
            
            رسم_توربین(زمینه, عرض, ارتفاع, توربین) {
                const مرکز_x = عرض / 2;
                const مرکز_y = ارتفاع / 2;
                
                // رنگ بر اساس وضعیت
                let رنگ_بدنه;
                if (توربین.تریپ_شده) {
                    رنگ_بدنه = '#e74c3c';
                } else {
                    switch(توربین.وضعیت) {
                        case 'آنلاین': رنگ_بدنه = '#27ae60'; break;
                        case 'در حال کار': رنگ_بدنه = '#3498db'; break;
                        case 'در حال راه‌اندازی': رنگ_بدنه = '#f39c12'; break;
                        case 'در حال سنکرون': رنگ_بدنه = '#9b59b6'; break;
                        default: رنگ_بدنه = '#7f8c8d';
                    }
                }
                
                // رسم بدنه توربین
                زمینه.fillStyle = رنگ_بدنه;
                زمینه.fillRect(مرکز_x - 40, مرکز_y - 20, 80, 40);
                
                // رسم پره‌های چرخان اگر در حال کار باشد
                if (['در حال کار', 'آنلاین', 'در حال راه‌اندازی'].includes(توربین.وضعیت)) {
                    زمینه.save();
                    زمینه.translate(مرکز_x, مرکز_y);
                    
                    // محاسبه چرخش بر اساس سرعت
                    const چرخش = (Date.now() / 1000) * (توربین.سرعت / 3000);
                    زمینه.rotate(چرخش);
                    
                    // رسم سه پره
                    for (let i = 0; i < 3; i++) {
                        زمینه.rotate((Math.PI * 2) / 3);
                        زمینه.fillStyle = '#2c3e50';
                        زمینه.fillRect(-4, -25, 8, 25);
                    }
                    
                    زمینه.restore();
                }
                
                // رسم خروجی دود بر اساس دما
                if (توربین.دما > 100) {
                    const شدت_گرما = Math.min(1, توربین.دما / 650);
                    const گرادیانت = زمینه.createLinearGradient(مرکز_x + 40, مرکز_y, مرکز_x + 80, مرکز_y);
                    گرادیانت.addColorStop(0, `rgba(255, ${100 + (155 * (1 - شدت_گرما))}, 0, 0.8)`);
                    گرادیانت.addColorStop(1, 'rgba(255, 100, 0, 0)');
                    
                    زمینه.fillStyle = گرادیانت;
                    زمینه.beginPath();
                    زمینه.ellipse(مرکز_x + 60, مرکز_y, 20, 8, 0, 0, Math.PI * 2);
                    زمینه.fill();
                }
                
                // نمایشگر وضعیت
                زمینه.fillStyle = توربین.تریپ_شده ? '#e74c3c' : 
                               توربین.وضعیت === 'آنلاین' ? '#27ae60' :
                               توربین.وضعیت === 'در حال کار' ? '#3498db' :
                               توربین.وضعیت === 'در حال راه‌اندازی' ? '#f39c12' : '#95a5a6';
                
                زمینه.beginPath();
                زمینه.arc(مرکز_x, مرکز_y - 30, 6, 0, Math.PI * 2);
                زمینه.fill();
            }
            
            راه‌اندازی_همه_توربین‌ها() {
                let تأخیر = 0;
                this.وضعیت.توربین‌ها.forEach(توربین => {
                    if (توربین.وضعیت === 'آفلاین' && !توربین.تریپ_شده) {
                        setTimeout(() => {
                            this.راه‌اندازی_توربین(توربین.شناسه);
                        }, تأخیر);
                        تأخیر += 2000; // راه‌اندازی پلکانی
                    }
                });
                
                this.افزودن_گزارش('راه‌اندازی همه توربین‌ها به صورت پلکانی');
            }
            
            راه‌اندازی_توربین(شناسه) {
                const توربین = this.وضعیت.توربین‌ها.find(t => t.شناسه === شناسه);
                if (!توربین || توربین.وضعیت !== 'آفلاین') return;
                
                توربین.وضعیت = 'در حال راه‌اندازی';
                توربین.زمان_راه‌اندازی = Date.now();
                
                // شانس ۵٪ برای خطای راه‌اندازی
                if (Math.random() < 0.05) {
                    setTimeout(() => {
                        this.تریپ_توربین(شناسه, 'خطای راه‌اندازی - مشکل احتراق');
                    }, 3000);
                } else {
                    setTimeout(() => {
                        توربین.وضعیت = 'در حال کار';
                        توربین.سرعت = 3000;
                        توربین.دما = 300;
                        this.افزودن_گزارش(`${توربین.نام} با موفقیت راه‌اندازی شد`);
                    }, 5000);
                }
                
                this.به‌روزرسانی_وضعیت_نیروگاه();
                this.نمایش_توربین‌ها();
            }
            
            توقف_همه_توربین‌ها() {
                this.وضعیت.توربین‌ها.forEach(توربین => {
                    if (توربین.وضعیت !== 'آفلاین') {
                        this.توقف_توربین(توربین.شناسه);
                    }
                });
                
                this.افزودن_گزارش('توقف همه توربین‌ها');
            }
            
            توقف_توربین(شناسه) {
                const توربین = this.وضعیت.توربین‌ها.find(t => t.شناسه === شناسه);
                if (!توربین) return;
                
                توربین.وضعیت = 'آفلاین';
                توربین.خروجی = 0;
                توربین.سرعت = 0;
                توربین.دما = 25;
                توربین.سنکرون_شده = false;
                
                this.به‌روزرسانی_وضعیت_نیروگاه();
                this.نمایش_توربین‌ها();
            }
            
            سنکرون_همه() {
                this.وضعیت.توربین‌ها.forEach(توربین => {
                    if (توربین.وضعیت === 'در حال کار' && !توربین.سنکرون_شده) {
                        this.سنکرون_توربین(توربین.شناسه);
                    }
                });
            }
            
            سنکرون_توربین(شناسه) {
                const توربین = this.وضعیت.توربین‌ها.find(t => t.شناسه === شناسه);
                if (!توربین || توربین.وضعیت !== 'در حال کار') return;
                
                توربین.وضعیت = 'در حال سنکرون';
                
                // شبیه‌سازی فرآیند سنکرون
                setTimeout(() => {
                    if (!توربین.تریپ_شده) {
                        توربین.سنکرون_شده = true;
                        توربین.وضعیت = 'آنلاین';
                        توربین.ولتاژ = 400;
                        توربین.فرکانس = 50.0;
                        this.افزودن_گزارش(`${توربین.نام} با شبکه سنکرون شد`);
                    }
                }, 3000);
                
                this.به‌روزرسانی_وضعیت_سنکرون();
                this.نمایش_توربین‌ها();
            }
            
            اتصال_به_شبکه() {
                const توربین‌های_سنکرون = this.وضعیت.توربین‌ها.filter(t => t.سنکرون_شده);
                
                if (توربین‌های_سنکرون.length >= 2) {
                    this.وضعیت.متصل_به_شبکه = true;
                    this.وضعیت.وضعیت_نیروگاه = 'آنلاین';
                    this.المان‌ها['connect-to-grid'].disabled = true;
                    this.افزودن_گزارش('اتصال به شبکه برق برقرار شد');
                    
                    // مقداردهی اولیه توزیع بار
                    this.توزیع_بار();
                } else {
                    this.افزودن_هشدار('خطای اتصال به شبکه', 'حداقل ۲ توربین سنکرون شده مورد نیاز است', 'warning');
                }
                
                this.به‌روزرسانی_وضعیت_نیروگاه();
            }
            
            تنظیم_بار(مقدار) {
                this.وضعیت.بار_موردنیاز = Math.min(1000, Math.max(0, مقدار));
                this.وضعیت.هدف_خروجی = this.وضعیت.بار_موردنیاز;
                
                this.المان‌ها.مقدار_بار.textContent = `${this.وضعیت.بار_موردنیاز} مگاوات`;
                this.المان‌ها.اسلایدر_بار.value = this.وضعیت.بار_موردنیاز;
                
                const درصد_پرکردن = (this.وضعیت.بار_موردنیاز / 1000) * 100;
                this.المان‌ها.پرکردن_بار.style.width = `${درصد_پرکردن}%`;
                
                if (this.وضعیت.متصل_به_شبکه) {
                    this.توزیع_بار();
                }
                
                // بررسی اضافه بار
                if (this.وضعیت.بار_موردنیاز > this.ظرفیت_در_دسترس()) {
                    this.افزودن_هشدار('هشدار اضافه بار', `تقاضا (${this.وضعیت.بار_موردنیاز}MW) از ظرفیت در دسترس بیشتر است`, 'danger');
                    
                    // شانس تریپ اضافه بار
                    if (this.وضعیت.بار_موردنیاز > this.ظرفیت_در_دسترس() * 1.1) {
                        setTimeout(() => {
                            this.تریپ_اضافه_بار();
                        }, 5000);
                    }
                }
                
                this.به‌روزرسانی_وضعیت_نیروگاه();
            }
            
            توزیع_بار() {
                if (!this.وضعیت.متصل_به_شبکه) return;
                
                const توربین‌های_آنلاین = this.وضعیت.توربین‌ها.filter(t => t.وضعیت === 'آنلاین');
                if (توربین‌های_آنلاین.length === 0) return;
                
                const بار_هر_توربین = this.وضعیت.بار_موردنیاز / توربین‌های_آنلاین.length;
                
                توربین‌های_آنلاین.forEach(توربین => {
                    // تنظیم تدریجی بار
                    const هدف_خروجی = Math.min(توربین.حداکثر_خروجی, بار_هر_توربین);
                    توربین.خروجی = this.نزدیک_کردن_مقدار(توربین.خروجی, هدف_خروجی, 5);
                    
                    // به‌روزرسانی متریک‌های توربین بر اساس بار
                    this.به‌روزرسانی_متریک‌های_توربین(توربین);
                });
                
                this.به‌روزرسانی_خروجی_کل();
            }
            
            به‌روزرسانی_متریک‌های_توربین(توربین) {
                // محاسبه راندمان بر اساس بار
                const درصد_بار = (توربین.خروجی / توربین.حداکثر_خروجی) * 100;
                توربین.راندمان = Math.min(95, 60 + (درصد_بار * 0.35));
                
                // به‌روزرسانی دما بر اساس بار
                const دمای_پایه = 300;
                const ضریب_بار = توربین.خروجی / توربین.حداکثر_خروجی;
                توربین.دما = دمای_پایه + (ضریب_بار * 350);
                
                // به‌روزرسانی لرزش
                توربین.لرزش = 1 + (ضریب_بار * 4) + Math.random() * 2;
                
                // بررسی هشدار دمای بالا
                if (توربین.دما > 600) {
                    this.افزودن_هشدار(`${توربین.نام} دمای بالا`, 
                                    `دما در ${Math.round(توربین.دما)}°C`, 'warning');
                    
                    // تریپ اگر دمای بحرانی
                    if (توربین.دما > 650) {
                        this.تریپ_توربین(توربین.شناسه, 'تریپ دمای بالا');
                    }
                }
                
                // بررسی لرزش بالا
                if (توربین.لرزش > 5) {
                    this.افزودن_هشدار(`${توربین.نام} لرزش بالا`, 
                                    `لرزش در ${توربین.لرزش.toFixed(1)} mm/s`, 'warning');
                }
                
                // افزایش ساعت کارکرد
                if (توربین.وضعیت === 'آنلاین') {
                    توربین.متریک‌ها.ساعت_کارکرد += 0.1;
                }
            }
            
            تریپ_توربین(شناسه, دلیل) {
                const توربین = this.وضعیت.توربین‌ها.find(t => t.شناسه === شناسه);
                if (!توربین) return;
                
                توربین.وضعیت = 'تریپ شده';
                توربین.تریپ_شده = true;
                توربین.دلیل_تریپ = دلیل;
                توربین.خروجی = 0;
                توربین.سنکرون_شده = false;
                
                this.افزودن_هشدار(`${توربین.نام} تریپ شد`, دلیل, 'danger');
                this.افزودن_گزارش(`${توربین.نام} تریپ شد: ${دلیل}`);
                
                // به‌روزرسانی وضعیت نیروگاه
                const توربین‌های_آنلاین = this.وضعیت.توربین‌ها.filter(t => t.وضعیت === 'آنلاین');
                if (توربین‌های_آنلاین.length === 0 && this.وضعیت.متصل_به_شبکه) {
                    this.وضعیت.متصل_به_شبکه = false;
                    this.وضعیت.وضعیت_نیروگاه = 'تریپ شده';
                    this.افزودن_هشدار('قطع اتصال شبکه', 'همه توربین‌ها تریپ شدند', 'danger');
                }
                
                this.به‌روزرسانی_وضعیت_نیروگاه();
                this.نمایش_توربین‌ها();
            }
            
            تریپ_اضافه_بار() {
                const توربین‌های_آنلاین = this.وضعیت.توربین‌ها.filter(t => t.وضعیت === 'آنلاین');
                if (توربین‌های_آنلاین.length === 0) return;
                
                // تریپ ۱ یا ۲ توربین به صورت تصادفی
                const تعداد_تریپ = Math.min(2, Math.floor(Math.random() * توربین‌های_آنلاین.length) + 1);
                
                for (let i = 0; i < تعداد_تریپ; i++) {
                    const توربین = توربین‌های_آنلاین[Math.floor(Math.random() * توربین‌های_آنلاین.length)];
                    this.تریپ_توربین(توربین.شناسه, 'تریپ حفاظت اضافه بار');
                }
                
                this.افزودن_هشدار('حفاظت اضافه بار', 'سیستم به دلیل اضافه بار تریپ شد', 'danger');
            }
            
            تغییر_تعادل_خودکار() {
                this.وضعیت.تعادل_خودکار = !this.وضعیت.تعادل_خودکار;
                this.وضعیت.کنترل_دستی = !this.وضعیت.تعادل_خودکار;
                
                const دکمه = this.المان‌ها['auto-balance'];
                if (this.وضعیت.تعادل_خودکار) {
                    دکمه.classList.add('active');
                    دکمه.innerHTML = '<i class="fas fa-robot"></i><span>تعادل خودکار فعال</span>';
                    this.افزودن_گزارش('تعادل خودکار بار فعال شد');
                } else {
                    دکمه.classList.remove('active');
                    دکمه.innerHTML = '<i class="fas fa-robot"></i><span>تعادل خودکار</span>';
                }
                
                this.المان‌ها['manual-control'].classList.toggle('active', this.وضعیت.کنترل_دستی);
            }
            
            تغییر_کنترل_دستی() {
                this.وضعیت.کنترل_دستی = !this.وضعیت.کنترل_دستی;
                this.وضعیت.تعادل_خودکار = !this.وضعیت.کنترل_دستی;
                
                const دکمه = this.المان‌ها['manual-control'];
                if (this.وضعیت.کنترل_دستی) {
                    دکمه.classList.add('active');
                    دکمه.innerHTML = '<i class="fas fa-hand-paper"></i><span>کنترل دستی فعال</span>';
                } else {
                    دکمه.classList.remove('active');
                    دکمه.innerHTML = '<i class="fas fa-hand-paper"></i><span>کنترل دستی</span>';
                }
                
                this.المان‌ها['auto-balance'].classList.toggle('active', this.وضعیت.تعادل_خودکار);
            }
            
            تریپ_اضطراری() {
                this.افزودن_هشدار('تریپ اضطراری', 'تریپ اضطراری دستی فعال شد', 'danger');
                
                // تریپ همه توربین‌ها
                this.وضعیت.توربین‌ها.forEach(توربین => {
                    if (توربین.وضعیت !== 'آفلاین') {
                        this.تریپ_توربین(توربین.شناسه, 'تریپ اضطراری دستی');
                    }
                });
                
                this.وضعیت.متصل_به_شبکه = false;
                this.وضعیت.وضعیت_نیروگاه = 'تریپ شده';
                
                setTimeout(() => {
                    this.افزودن_گزارش('عملیات تریپ اضطراری تکمیل شد');
                }, 1000);
            }
            
            بازنشانی_خطاها() {
                this.وضعیت.توربین‌ها.forEach(توربین => {
                    if (توربین.تریپ_شده) {
                        توربین.تریپ_شده = false;
                        توربین.دلیل_تریپ = '';
                        توربین.وضعیت = 'آفلاین';
                    }
                });
                
                this.وضعیت.هشدارها = [];
                this.به‌روزرسانی_نمایش_هشدارها();
                
                this.افزودن_گزارش('همه خطاها بازنشانی شدند');
                this.نمایش_توربین‌ها();
            }
            
            ظرفیت_در_دسترس() {
                const توربین‌های_آنلاین = this.وضعیت.توربین‌ها.filter(t => t.وضعیت === 'آنلاین');
                return توربین‌های_آنلاین.reduce((مجموع, توربین) => مجموع + توربین.حداکثر_خروجی, 0);
            }
            
            نزدیک_کردن_مقدار(جاری, هدف, گام) {
                if (جاری < هدف) {
                    return Math.min(جاری + گام, هدف);
                } else if (جاری > هدف) {
                    return Math.max(جاری - گام, هدف);
                }
                return جاری;
            }
            
            پردازش_عمل_توربین(شناسه_توربین, عمل) {
                switch (عمل) {
                    case 'start':
                        this.راه‌اندازی_توربین(شناسه_توربین);
                        break;
                    case 'sync':
                        this.سنکرون_توربین(شناسه_توربین);
                        break;
                    case 'trip':
                        this.تریپ_توربین(شناسه_توربین, 'تریپ دستی');
                        break;
                }
            }
            
            شروع_شبیه‌سازی() {
                // حلقه اصلی شبیه‌سازی
                const حلقه_شبیه‌سازی = () => {
                    // به‌روزرسانی وضعیت توربین‌ها
                    this.وضعیت.توربین‌ها.forEach(توربین => {
                        if (توربین.وضعیت === 'در حال راه‌اندازی') {
                            توربین.سرعت = this.نزدیک_کردن_مقدار(توربین.سرعت, 3000, 100);
                            توربین.دما = this.نزدیک_کردن_مقدار(توربین.دما, 300, 10);
                        } else if (توربین.وضعیت === 'در حال کار') {
                            // حفظ وضعیت کاری
                            توربین.سرعت = 3000 + (Math.random() * 20 - 10);
                        } else if (توربین.وضعیت === 'در حال سنکرون') {
                            // نزدیک شدن به پارامترهای شبکه
                            توربین.فرکانس = this.نزدیک_کردن_مقدار(توربین.فرکانس, 50.0, 0.5);
                            توربین.ولتاژ = this.نزدیک_کردن_مقدار(توربین.ولتاژ, 400, 20);
                        } else if (توربین.وضعیت === 'آنلاین') {
                            // تغییرات جزئی
                            توربین.فرکانس = 50.0 + (Math.random() * 0.2 - 0.1);
                        }
                    });
                    
                    // تعادل خودکار اگر فعال باشد
                    if (this.وضعیت.تعادل_خودکار && this.وضعیت.متصل_به_شبکه) {
                        this.توزیع_بار();
                    }
                    
                    // تولید خطای تصادفی (۱٪ شانس در ثانیه)
                    if (Math.random() < 0.01) {
                        this.تولید_خطای_تصادفی();
                    }
                    
                    this.به‌روزرسانی_خروجی_کل();
                    this.به‌روزرسانی_وضعیت_سنکرون();
                    this.نمایش_توربین‌ها();
                    this.به‌روزرسانی_نمودارها();
                };
                
                // اجرای شبیه‌سازی با فرکانس ۱ هرتز
                this.اینتروال‌ها.push(setInterval(حلقه_شبیه‌سازی, 1000));
            }
            
            تولید_خطای_تصادفی() {
                const توربین‌های_فعال = this.وضعیت.توربین‌ها.filter(t => 
                    ['در حال کار', 'آنلاین', 'در حال سنکرون'].includes(t.وضعیت)
                );
                
                if (توربین‌های_فعال.length === 0) return;
                
                const انواع_خطا = [
                    { نوع: 'لرزش', آستانه: 6, پیام: 'لرزش بالا تشخیص داده شد' },
                    { نوع: 'دما', آستانه: 620, پیام: 'دمای بالا تشخیص داده شد' },
                    { نوع: 'یاتاقان', آستانه: 80, پیام: 'دمای یاتاقان بالا' },
                    { نوع: 'سوخت', آستانه: 0.1, پیام: 'مشکل تامین سوخت' }
                ];
                
                const خطا = انواع_خطا[Math.floor(Math.random() * انواع_خطا.length)];
                const توربین = توربین‌های_فعال[Math.floor(Math.random() * توربین‌های_فعال.length)];
                
                // بررسی شرایط خطا
                let شرط_برقرار = false;
                switch (خطا.نوع) {
                    case 'لرزش':
                        شرط_برقرار = توربین.لرزش > خطا.آستانه;
                        break;
                    case 'دما':
                        شرط_برقرار = توربین.دما > خطا.آستانه;
                        break;
                    case 'یاتاقان':
                        شرط_برقرار = توربین.دمای_یاتاقان > خطا.آستانه;
                        break;
                    case 'سوخت':
                        شرط_برقرار = Math.random() < خطا.آستانه;
                        break;
                }
                
                if (شرط_برقرار) {
                    this.افزودن_هشدار(`${توربین.نام} خطای ${خطا.نوع}`, خطا.پیام, 'warning');
                    
                    // ۳۰٪ شانس تریپ
                    if (Math.random() < 0.3) {
                        this.تریپ_توربین(توربین.شناسه, `خطای ${خطا.نوع}`);
                    }
                }
            }
            
            به‌روزرسانی_وضعیت_نیروگاه() {
                // به‌روزرسانی نمایش وضعیت
                this.المان‌ها.وضعیت_نیروگاه.textContent = this.وضعیت.وضعیت_نیروگاه;
                this.المان‌ها.خروجی_کل.textContent = `${Math.round(this.وضعیت.خروجی_کل)} مگاوات`;
                this.المان‌ها.هدف_خروجی.textContent = `${this.وضعیت.هدف_خروجی} مگاوات`;
                this.المان‌ها.فرکانس_شبکه.textContent = `${this.وضعیت.فرکانس_شبکه.toFixed(2)} هرتز`;
                this.المان‌ها.ولتاژ_سیستم.textContent = `${this.وضعیت.ولتاژ_سیستم} کیلوولت`;
                
                // به‌روزرسانی پایداری فرکانس
                const انحراف_فرکانس = Math.abs(50.0 - this.وضعیت.فرکانس_شبکه);
                const پایداری = Math.max(0, 100 - (انحراف_فرکانس * 100));
                this.المان‌ها.پایداری_فرکانس.textContent = `${Math.round(پایداری)}٪`;
                
                // به‌روزرسانی بار سیستم
                const درصد_بار = (this.وضعیت.خروجی_کل / 1000) * 100;
                this.المان‌ها.بار_سیستم.textContent = `${Math.round(درصد_بار)}٪`;
            }
            
            به‌روزرسانی_خروجی_کل() {
                this.وضعیت.خروجی_کل = this.وضعیت.توربین‌ها.reduce((مجموع, توربین) => مجموع + توربین.خروجی, 0);
                
                // به‌روزرسانی فرکانس شبکه بر اساس تعادل بار
                if (this.وضعیت.متصل_به_شبکه) {
                    const تفاوت_بار = this.وضعیت.خروجی_کل - this.وضعیت.بار_موردنیاز;
                    this.وضعیت.فرکانس_شبکه = 50.0 - (تفاوت_بار / 1000) * 0.5;
                    this.وضعیت.فرکانس_شبکه += (Math.random() * 0.1 - 0.05); // نویز
                    this.وضعیت.فرکانس_شبکه = Math.max(49.5, Math.min(50.5, this.وضعیت.فرکانس_شبکه));
                }
                
                // به‌روزرسانی ولتاژ سیستم
                const تعداد_آنلاین = this.وضعیت.توربین‌ها.filter(t => t.وضعیت === 'آنلاین').length;
                this.وضعیت.ولتاژ_سیستم = تعداد_آنلاین > 0 ? 400 : 0;
                
                this.به‌روزرسانی_وضعیت_نیروگاه();
            }
            
            به‌روزرسانی_وضعیت_سنکرون() {
                const توربین‌های_سنکرون = this.وضعیت.توربین‌ها.filter(t => t.سنکرون_شده);
                
                if (توربین‌های_سنکرون.length === 0) {
                    this.وضعیت.وضعیت_سنکرون = "غیرسنکرون";
                } else if (توربین‌های_سنکرون.length === this.وضعیت.توربین‌ها.length) {
                    this.وضعیت.وضعیت_سنکرون = "کاملا سنکرون";
                } else {
                    this.وضعیت.وضعیت_سنکرون = "نیمه سنکرون";
                }
                
                this.المان‌ها.وضعیت_سنکرون.textContent = this.وضعیت.وضعیت_سنکرون;
                
                // به‌روزرسانی متریک‌های سنکرون
                this.وضعیت.زاویه_فاز = توربین‌های_سنکرون.length * 15;
                this.وضعیت.سرعت_سنکرون = توربین‌های_سنکرون.length * 750;
                this.وضعیت.ولتاژ_تحریک = توربین‌های_سنکرون.length * 100;
                this.وضعیت.جریان_میدان = توربین‌های_سنکرون.length * 500;
                this.وضعیت.ضریب_توان = توربین‌های_سنکرون.length > 0 ? 0.95 : 0;
                
                this.المان‌ها.زاویه_فاز.textContent = `${this.وضعیت.زاویه_فاز}°`;
                this.المان‌ها.سرعت_سنکرون.textContent = `${this.وضعیت.سرعت_سنکرون} دور بر دقیقه`;
                this.المان‌ها.ولتاژ_تحریک.textContent = `${this.وضعیت.ولتاژ_تحریک} ولت`;
                this.المان‌ها.جریان_میدان.textContent = `${this.وضعیت.جریان_میدان} آمپر`;
                this.المان‌ها.ضریب_توان.textContent = this.وضعیت.ضریب_توان.toFixed(2);
            }
            
            به‌روزرسانی_نمودارها() {
                // افزودن نقطه داده جدید
                const اکنون = new Date().toLocaleTimeString('fa-IR', {hour: '2-digit', minute:'2-digit'});
                
                // نمودار عملکرد
                this.نمودار_عملکرد.data.labels.push(اکنون);
                this.نمودار_عملکرد.data.labels.shift();
                
                this.نمودار_عملکرد.data.datasets[0].data.push(this.وضعیت.خروجی_کل);
                this.نمودار_عملکرد.data.datasets[0].data.shift();
                
                this.نمودار_عملکرد.data.datasets[1].data.push(this.وضعیت.بار_موردنیاز);
                this.نمودار_عملکرد.data.datasets[1].data.shift();
                
                this.نمودار_عملکرد.update('none');
                
                // نمودار راندمان
                const راندمان‌ها = this.وضعیت.توربین‌ها.map(t => Math.round(t.راندمان));
                this.نمودار_راندمان.data.datasets[0].data = راندمان‌ها;
                this.نمودار_راندمان.update('none');
                
                // نمودار دما
                this.نمودار_دما.data.labels.push(اکنون);
                this.نمودار_دما.data.labels.shift();
                
                this.نمودار_دما.data.datasets[0].data.push(this.وضعیت.توربین‌ها[0]?.دما || 25);
                this.نمودار_دما.data.datasets[0].data.shift();
                
                this.نمودار_دما.data.datasets[1].data.push(this.وضعیت.توربین‌ها[1]?.دما || 25);
                this.نمودار_دما.data.datasets[1].data.shift();
                
                this.نمودار_دما.update('none');
                
                // نمودار لرزش
                this.نمودار_لرزش.data.labels.push(اکنون);
                this.نمودار_لرزش.data.labels.shift();
                
                this.نمودار_لرزش.data.datasets[0].data.push(this.وضعیت.توربین‌ها[0]?.لرزش || 0);
                this.نمودار_لرزش.data.datasets[0].data.shift();
                
                this.نمودار_لرزش.update('none');
            }
            
            افزودن_هشدار(عنوان, پیام, نوع = 'warning') {
                const هشدار = {
                    شناسه: Date.now(),
                    عنوان,
                    پیام,
                    نوع,
                    زمان: new Date().toLocaleTimeString('fa-IR'),
                    تأیید_شده: false
                };
                
                this.وضعیت.هشدارها.unshift(هشدار);
                
                // فقط ۲۰ هشدار آخر نگه داشته شود
                if (this.وضعیت.هشدارها.length > 20) {
                    this.وضعیت.هشدارها.pop();
                }
                
                this.به‌روزرسانی_نمایش_هشدارها();
                
                // نمایش پنل هشدار اگر وجود دارد
                if (this.وضعیت.هشدارها.length > 0) {
                    this.المان‌ها.پنل_هشدار.style.display = 'block';
                }
            }
            
            افزودن_گزارش(پیام) {
                const گزارش = {
                    زمان: new Date().toLocaleTimeString('fa-IR'),
                    پیام
                };
                
                this.وضعیت.گزارشات.unshift(گزارش);
                
                // فقط ۱۰۰ گزارش آخر نگه داشته شود
                if (this.وضعیت.گزارشات.length > 100) {
                    this.وضعیت.گزارشات.pop();
                }
            }
            
            به‌روزرسانی_نمایش_هشدارها() {
                // به‌روزرسانی شمارنده هشدار
                const تعداد_تأیید_نشده = this.وضعیت.هشدارها.filter(h => !h.تأیید_شده).length;
                this.المان‌ها.شمارنده_هشدار.textContent = تعداد_تأیید_نشده;
                
                // به‌روزرسانی لیست هشدار
                this.المان‌ها.لیست_هشدار.innerHTML = '';
                
                this.وضعیت.هشدارها.slice(0, 5).forEach(هشدار => {
                    const المان_هشدار = document.createElement('div');
                    المان_هشدار.className = 'alarm-item';
                    المان_هشدار.innerHTML = `
                        <div class="alarm-content">
                            <div class="alarm-title">${هشدار.عنوان}</div>
                            <div class="alarm-desc">${هشدار.پیام}</div>
                        </div>
                        <div class="alarm-time">${هشدار.زمان}</div>
                    `;
                    
                    this.المان‌ها.لیست_هشدار.appendChild(المان_هشدار);
                });
            }
            
            نمایش_هشدارها() {
                // تأیید همه هشدارها
                this.وضعیت.هشدارها.forEach(هشدار => هشدار.تأیید_شده = true);
                this.به‌روزرسانی_نمایش_هشدارها();
                
                // مخفی کردن پنل هشدار اگر هشدار فعالی وجود ندارد
                if (this.وضعیت.هشدارها.filter(h => !h.تأیید_شده).length === 0) {
                    this.المان‌ها.پنل_هشدار.style.display = 'none';
                }
            }
            
            نمایش_آموزش() {
                this.المان‌ها.پنل_آموزش.classList.add('active');
            }
            
            بستن_آموزش() {
                this.المان‌ها.پنل_آموزش.classList.remove('active');
                this.افزودن_گزارش('شبیه‌سازی آموزشی شروع شد');
            }
            
            تغییر_صفحه(صفحه) {
                // در یک برنامه کامل، این تابع صفحات را تغییر می‌دهد
                console.log(`تغییر به صفحه: ${صفحه}`);
            }
            
            به‌روزرسانی_زمان() {
                const اکنون = new Date();
                
                // زمان فارسی
                const زمان_فارسی = اکنون.toLocaleTimeString('fa-IR');
                this.المان‌ها.زمان_جاری.textContent = زمان_فارسی;
                
                // تاریخ شمسی
                const تاریخ_فارسی = this.تقویم_شمسی.format(اکنون);
                this.المان‌ها.تاریخ_جاری.textContent = تاریخ_فارسی;
                
                // به‌روزرسانی هر ثانیه
                setTimeout(() => this.به‌روزرسانی_زمان(), 1000);
            }
        }
        
        // شروع شبیه‌سازی هنگام بارگذاری صفحه
        window.addEventListener('DOMContentLoaded', () => {
            window.نیروگاه = new نیروگاهشبیه‌ساز();
        });
        
        // تابع کمکی برای درخواست انیمیشن فریم
        function درخواست_انیمیشن(تابع) {
            if (typeof requestAnimationFrame !== 'undefined') {
                requestAnimationFrame(تابع);
            } else {
                setTimeout(تابع, 16);
            }
        }
    </script>
</body>
</html>