<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Enhanced Waveform Modulation Simulator</title>
    <style>
        :root {
            --primary: #4361ee;
            --secondary: #3f37c9;
            --accent: #4cc9f0;
            --light: #f8f9fa;
            --dark: #0f172a;
            --success: #4ade80;
            --danger: #f87171;
            --warning: #facc15;
            --purple: #a78bfa;
            --pink: #f472b6;
            --teal: #2dd4bf;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #0f172a, #1e293b);
            color: var(--light);
            min-height: 100vh;
            padding: 20px;
            overflow-x: hidden;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
        }
        
        header {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px;
            position: relative;
        }
        
        h1 {
            font-size: 2.8rem;
            margin-bottom: 10px;
            background: linear-gradient(90deg, var(--accent), var(--purple));
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            letter-spacing: 1px;
            text-shadow: 0 2px 8px rgba(76, 201, 240, 0.2);
        }
        
        .subtitle {
            font-size: 1.2rem;
            color: #94a3b8;
            max-width: 800px;
            margin: 0 auto;
            line-height: 1.6;
        }
        
        .app-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 25px;
            margin-bottom: 40px;
        }
        
        @media (max-width: 1100px) {
            .app-container {
                grid-template-columns: 1fr;
            }
        }
        
        .control-panel {
            background: rgba(30, 41, 59, 0.7);
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.3);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .panel-title {
            font-size: 1.5rem;
            margin-bottom: 25px;
            color: var(--accent);
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .panel-title svg {
            width: 24px;
            height: 24px;
        }
        
        .control-group {
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .control-group:last-child {
            border-bottom: none;
            margin-bottom: 0;
        }
        
        .control-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 15px;
        }
        
        .control-label {
            font-weight: 600;
            font-size: 1.1rem;
            color: #e2e8f0;
        }
        
        .value-display {
            background: rgba(15, 23, 42, 0.7);
            padding: 5px 12px;
            border-radius: 20px;
            font-weight: 600;
            color: var(--accent);
            min-width: 80px;
            text-align: center;
        }
        
        .slider-container {
            margin-bottom: 10px;
            position: relative;
        }
        
        input[type="range"] {
            width: 100%;
            height: 8px;
            -webkit-appearance: none;
            background: linear-gradient(to right, var(--primary), var(--accent));
            border-radius: 10px;
            outline: none;
        }
        
        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 22px;
            height: 22px;
            border-radius: 50%;
            background: var(--light);
            cursor: pointer;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.5);
            transition: all 0.2s ease;
        }
        
        input[type="range"]::-webkit-slider-thumb:hover {
            transform: scale(1.2);
            box-shadow: 0 0 15px var(--accent);
        }
        
        .wave-selectors {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
        }
        
        .wave-option {
            background: rgba(15, 23, 42, 0.7);
            border: 2px solid transparent;
            border-radius: 12px;
            padding: 15px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        
        .wave-option:hover {
            transform: translateY(-3px);
            background: rgba(56, 70, 106, 0.7);
        }
        
        .wave-option.active {
            border-color: var(--accent);
            background: rgba(56, 70, 106, 0.9);
            box-shadow: 0 0 15px rgba(76, 201, 240, 0.3);
        }
        
        .wave-option .wave-icon {
            font-size: 2rem;
            margin-bottom: 10px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .action-buttons {
            display: flex;
            gap: 15px;
            margin-top: 20px;
        }
        
        .btn {
            flex: 1;
            padding: 15px;
            border: none;
            border-radius: 12px;
            font-weight: 600;
            font-size: 1.1rem;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }
        
        .btn-primary {
            background: var(--primary);
            color: white;
            box-shadow: 0 4px 10px rgba(67, 97, 238, 0.3);
        }
        
        .btn-primary:hover {
            background: var(--secondary);
            transform: translateY(-3px);
            box-shadow: 0 7px 20px rgba(67, 97, 238, 0.4);
        }
        
        .btn-secondary {
            background: rgba(255, 255, 255, 0.1);
            color: white;
        }
        
        .btn-secondary:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: translateY(-3px);
        }
        
        .visualization-panel {
            display: flex;
            flex-direction: column;
            gap: 25px;
        }
        
        .wave-display {
            background: rgba(30, 41, 59, 0.7);
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.3);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            flex: 1;
        }
        
        .display-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 20px;
        }
        
        .display-title {
            font-size: 1.3rem;
            font-weight: 600;
            color: var(--accent);
        }
        
        .canvas-container {
            position: relative;
            height: 200px;
            background: rgba(15, 23, 42, 0.4);
            border-radius: 10px;
            overflow: hidden;
        }
        
        canvas {
            width: 100%;
            height: 100%;
        }
        
        .wave-info {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin-top: 20px;
        }
        
        .info-card {
            background: rgba(15, 23, 42, 0.4);
            border-radius: 10px;
            padding: 15px;
            transition: all 0.3s ease;
        }
        
        .info-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(15, 23, 42, 0.5);
        }
        
        .info-card h4 {
            color: var(--accent);
            margin-bottom: 10px;
            font-size: 1.1rem;
        }
        
        .info-value {
            font-size: 1.3rem;
            font-weight: 600;
        }
        
        .modulation-result {
            background: rgba(30, 41, 59, 0.7);
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.3);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            min-height: 300px;
        }
        
        .result-title {
            font-size: 1.4rem;
            margin-bottom: 20px;
            color: var(--accent);
        }
        
        .result-description {
            line-height: 1.6;
            margin-bottom: 25px;
            color: #cbd5e1;
        }
        
        .result-description strong {
            color: var(--accent);
        }
        
        .result-wave {
            height: 200px;
            background: rgba(15, 23, 42, 0.4);
            border-radius: 10px;
            margin-top: 20px;
            position: relative;
        }
        
        footer {
            text-align: center;
            margin-top: 40px;
            padding: 20px;
            color: #94a3b8;
            font-size: 0.9rem;
        }
        
        .audio-controls {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-top: 20px;
        }
        
        .volume-container {
            flex: 1;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .volume-icon {
            font-size: 1.5rem;
            color: var(--accent);
        }
        
        .wave-legend {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 15px;
            flex-wrap: wrap;
        }
        
        .legend-item {
            display: flex;
            align-items: center;
            gap: 5px;
            font-size: 0.9rem;
            padding: 5px 10px;
            border-radius: 20px;
            background: rgba(15, 23, 42, 0.4);
        }
        
        .legend-color {
            width: 15px;
            height: 4px;
            border-radius: 2px;
        }
        
        .animation-indicator {
            position: absolute;
            top: 10px;
            right: 10px;
            display: flex;
            align-items: center;
            gap: 5px;
            font-size: 0.8rem;
            color: var(--accent);
        }
        
        .pulse {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background: var(--accent);
            animation: pulse 1.5s infinite;
        }
        
        @keyframes pulse {
            0% { transform: scale(0.8); opacity: 0.7; }
            50% { transform: scale(1.2); opacity: 1; }
            100% { transform: scale(0.8); opacity: 0.7; }
        }
        
        .waveform-title {
            position: absolute;
            top: 10px;
            left: 15px;
            font-size: 0.8rem;
            color: var(--accent);
            z-index: 10;
        }
        
        .status-indicator {
            position: absolute;
            top: 10px;
            right: 10px;
            background: var(--success);
            color: white;
            padding: 3px 8px;
            border-radius: 10px;
            font-size: 0.7rem;
            display: none;
        }
        
        .playing .status-indicator {
            display: block;
        }
        
        .wave-grid {
            position: absolute;
            width: 100%;
            height: 100%;
            background-image: 
                linear-gradient(rgba(255,255,255,0.05) 1px, transparent 1px),
                linear-gradient(90deg, rgba(255,255,255,0.05) 1px, transparent 1px);
            background-size: 20px 20px;
        }
        
        .frequency-label {
            position: absolute;
            bottom: 5px;
            right: 10px;
            font-size: 0.7rem;
            color: rgba(255, 255, 255, 0.5);
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>Enhanced Waveform Modulation Simulator</h1>
            <p class="subtitle">Explore amplitude modulation (AM) and frequency modulation (FM) with customizable parameters. Visualize waveforms, see calculated values, and listen to the resulting sounds.</p>
        </header>
        
        <div class="app-container">
            <div class="control-panel">
                <h2 class="panel-title">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z" />
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
                    </svg>
                    Modulation Controls
                </h2>
                
                <div class="control-group">
                    <div class="control-header">
                        <span class="control-label">Carrier Frequency</span>
                        <span class="value-display" id="mainFreqValue">10.0 kHz</span>
                    </div>
                    <div class="slider-container">
                        <input type="range" id="mainFreq" min="1" max="24" step="0.1" value="10">
                    </div>
                    <div class="control-header">
                        <span class="control-label">Modulation Frequency</span>
                        <span class="value-display" id="modFreqValue">1.0 kHz</span>
                    </div>
                    <div class="slider-container">
                        <input type="range" id="modFreq" min="0.1" max="11" step="0.1" value="1">
                    </div>
                </div>
                
                <div class="control-group">
                    <div class="control-header">
                        <span class="control-label">Modulation Depth</span>
                        <span class="value-display" id="modDepthValue">50%</span>
                    </div>
                    <div class="slider-container">
                        <input type="range" id="modDepth" min="0" max="100" value="50">
                    </div>
                </div>
                
                <div class="control-group">
                    <div class="control-header">
                        <span class="control-label">Modulation Technique</span>
                    </div>
                    <div class="wave-selectors">
                        <div class="wave-option active" data-type="AM">
                            <div class="wave-icon">üìª</div>
                            <div>AM (Amplitude Modulation)</div>
                        </div>
                        <div class="wave-option" data-type="FM">
                            <div class="wave-icon">üéµ</div>
                            <div>FM (Frequency Modulation)</div>
                        </div>
                    </div>
                </div>
                
                <div class="control-group">
                    <div class="control-header">
                        <span class="control-label">Carrier Wave Type</span>
                    </div>
                    <div class="wave-selectors">
                        <div class="wave-option active" data-wave="sine">
                            <div class="wave-icon">„Ä∞Ô∏è</div>
                            <div>Sine</div>
                        </div>
                        <div class="wave-option" data-wave="square">
                            <div class="wave-icon">‚éç‚éç‚éç‚éç</div>
                            <div>Square</div>
                        </div>
                        <div class="wave-option" data-wave="triangle">
                            <div class="wave-icon">‚ñ≥‚ñ≥‚ñ≥‚ñ≥</div>
                            <div>Triangular</div>
                        </div>
                        <div class="wave-option" data-wave="sawtooth">
                            <div class="wave-icon">‚á≤‚á≤‚á≤‚á≤</div>
                            <div>Sawtooth</div>
                        </div>
                    </div>
                </div>
                
                <div class="control-group">
                    <div class="control-header">
                        <span class="control-label">Modulation Wave Type</span>
                    </div>
                    <div class="wave-selectors">
                        <div class="wave-option active" data-wave="sine">
                            <div class="wave-icon">„Ä∞Ô∏è</div>
                            <div>Sine</div>
                        </div>
                        <div class="wave-option" data-wave="square">
                            <div class="wave-icon">‚éç‚éç‚éç‚éç</div>
                            <div>Square</div>
                        </div>
                        <div class="wave-option" data-wave="triangle">
                            <div class="wave-icon">‚ñ≥‚ñ≥‚ñ≥‚ñ≥</div>
                            <div>Triangular</div>
                        </div>
                        <div class="wave-option" data-wave="sawtooth">
                            <div class="wave-icon">‚á≤‚á≤‚á≤‚á≤</div>
                            <div>Sawtooth</div>
                        </div>
                    </div>
                </div>
                
                <div class="action-buttons">
                    <button class="btn btn-primary" id="playBtn">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" viewBox="0 0 16 16">
                            <path d="M11.596 8.697l-6.363 3.692c-.54.313-1.233-.066-1.233-.697V4.308c0-.63.692-1.01 1.233-.696l6.363 3.692a.802.802 0 0 1 0 1.393z"/>
                        </svg>
                        Play Sound
                    </button>
                    <button class="btn btn-secondary" id="resetBtn">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" viewBox="0 0 16 16">
                            <path d="M8 3a5 5 0 1 0 4.546 2.914.5.5 0 0 1 .908-.417A6 6 0 1 1 8 2v1z"/>
                            <path d="M8 4.466V.534a.25.25 0 0 1 .41-.192l2.36 1.966c.12.1.12.284 0 .384L8.41 4.658A.25.25 0 0 1 8 4.466z"/>
                        </svg>
                        Reset
                    </button>
                </div>
            </div>
            
            <div class="visualization-panel">
                <div class="wave-display">
                    <div class="display-header">
                        <div class="display-title">Waveform Visualization</div>
                        <div class="animation-indicator">
                            <div class="pulse"></div>
                            <span>Live</span>
                        </div>
                    </div>
                    
                    <div class="canvas-container">
                        <canvas id="carrierCanvas"></canvas>
                        <div class="wave-grid"></div>
                        <div class="waveform-title">Carrier + Modulation + Result</div>
                        <div class="frequency-label">Time Domain</div>
                    </div>
                    <div class="wave-legend">
                        <div class="legend-item">
                            <div class="legend-color" style="background-color: #4cc9f0;"></div>
                            <span>Carrier Wave</span>
                        </div>
                        <div class="legend-item">
                            <div class="legend-color" style="background-color: #a78bfa;"></div>
                            <span>Modulation Wave</span>
                        </div>
                        <div class="legend-item">
                            <div class="legend-color" style="background-color: #f87171;"></div>
                            <span>Modulated Wave</span>
                        </div>
                    </div>
                    
                    <div class="wave-info">
                        <div class="info-card">
                            <h4>Carrier Frequency</h4>
                            <div class="info-value" id="carrierFreq">10,000 Hz</div>
                        </div>
                        <div class="info-card">
                            <h4>Modulation Frequency</h4>
                            <div class="info-value" id="modulationFreq">1,000 Hz</div>
                        </div>
                        <div class="info-card">
                            <h4>Modulation Depth</h4>
                            <div class="info-value" id="modulationDepth">50%</div>
                        </div>
                        <div class="info-card">
                            <h4>Waveform Type</h4>
                            <div class="info-value" id="waveType">Sine / Sine</div>
                        </div>
                    </div>
                </div>
                
                <div class="modulation-result">
                    <h3 class="result-title">Modulation Analysis</h3>
                    <div class="result-description">
                        <p>Your current settings show a <strong id="modTypeDesc">Amplitude Modulation (AM)</strong> waveform. The carrier wave at <strong id="carrierFreqDesc">10,000 Hz</strong> is being modulated by a <strong id="modFreqDesc">1,000 Hz</strong> <strong id="modWaveDesc">sine</strong> wave.</p>
                        <p>With a modulation depth of <strong id="modDepthDesc">50%</strong>, <span id="modEffectDesc">the amplitude varies between <strong>50% and 150%</strong> of its original value. This creates sidebands at <strong>9,000 Hz</strong> and <strong>11,000 Hz</strong>.</span></p>
                    </div>
                    
                    <div class="audio-controls">
                        <div class="volume-container">
                            <div class="volume-icon">üîä</div>
                            <input type="range" id="volume" min="0" max="100" value="80" class="volume-slider">
                        </div>
                        <div class="value-display" id="volumeValue">80%</div>
                    </div>
                    
                    <div class="result-wave">
                        <canvas id="resultCanvas"></canvas>
                        <div class="wave-grid"></div>
                        <div class="waveform-title">Modulated Result</div>
                        <div class="status-indicator">Playing</div>
                        <div class="frequency-label">Time Domain</div>
                    </div>
                </div>
            </div>
        </div>
        
        <footer>
            <p>Enhanced Waveform Modulation Simulator | Created with Web Audio API | All calculations performed in real-time</p>
        </footer>
    </div>

    <script>
        // DOM Elements
        const mainFreqSlider = document.getElementById('mainFreq');
        const modFreqSlider = document.getElementById('modFreq');
        const modDepthSlider = document.getElementById('modDepth');
        const volumeSlider = document.getElementById('volume');
        const mainFreqValue = document.getElementById('mainFreqValue');
        const modFreqValue = document.getElementById('modFreqValue');
        const modDepthValue = document.getElementById('modDepthValue');
        const volumeValue = document.getElementById('volumeValue');
        const carrierFreq = document.getElementById('carrierFreq');
        const modulationFreq = document.getElementById('modulationFreq');
        const modulationDepth = document.getElementById('modulationDepth');
        const waveType = document.getElementById('waveType');
        const playBtn = document.getElementById('playBtn');
        const resetBtn = document.getElementById('resetBtn');
        const carrierCanvas = document.getElementById('carrierCanvas');
        const resultCanvas = document.getElementById('resultCanvas');
        const modTypeDesc = document.getElementById('modTypeDesc');
        const carrierFreqDesc = document.getElementById('carrierFreqDesc');
        const modFreqDesc = document.getElementById('modFreqDesc');
        const modDepthDesc = document.getElementById('modDepthDesc');
        const modWaveDesc = document.getElementById('modWaveDesc');
        const modEffectDesc = document.getElementById('modEffectDesc');
        
        // Waveform state
        let modulationType = 'AM';
        let mainWaveType = 'sine';
        let modWaveType = 'sine';
        let audioContext = null;
        let isPlaying = false;
        let animationId = null;
        let currentTime = 0;
        let lastUpdate = 0;
        const animationSpeed = 0.02;
        
        // Initialize
        function init() {
            updateSliders();
            setupEventListeners();
            updateDescription();
            startAnimation();
        }
        
        // Update slider value displays
        function updateSliders() {
            mainFreqValue.textContent = `${parseFloat(mainFreqSlider.value).toFixed(1)} kHz`;
            modFreqValue.textContent = `${parseFloat(modFreqSlider.value).toFixed(1)} kHz`;
            modDepthValue.textContent = `${modDepthSlider.value}%`;
            volumeValue.textContent = `${volumeSlider.value}%`;
            
            // Update info cards
            const carrierFreqVal = (parseFloat(mainFreqSlider.value)*1000).toLocaleString();
            const modFreqVal = (parseFloat(modFreqSlider.value)*1000).toLocaleString();
            
            carrierFreq.textContent = `${carrierFreqVal} Hz`;
            modulationFreq.textContent = `${modFreqVal} Hz`;
            modulationDepth.textContent = `${modDepthSlider.value}%`;
            waveType.textContent = `${mainWaveType.charAt(0).toUpperCase() + mainWaveType.slice(1)} / ${modWaveType.charAt(0).toUpperCase() + modWaveType.slice(1)}`;
            
            // Update description
            carrierFreqDesc.textContent = `${carrierFreqVal} Hz`;
            modFreqDesc.textContent = `${modFreqVal} Hz`;
            modDepthDesc.textContent = `${modDepthSlider.value}%`;
            modWaveDesc.textContent = modWaveType;
        }
        
        // Update description text
        function updateDescription() {
            if (modulationType === 'AM') {
                modTypeDesc.textContent = 'Amplitude Modulation (AM)';
                const minAmp = (100 - parseInt(modDepthSlider.value));
                const maxAmp = (100 + parseInt(modDepthSlider.value));
                modEffectDesc.innerHTML = `the amplitude varies between <strong>${minAmp}% and ${maxAmp}%</strong> of its original value. This creates sidebands at <strong>${(parseFloat(mainFreqSlider.value)-parseFloat(modFreqSlider.value)).toFixed(1)} kHz</strong> and <strong>${(parseFloat(mainFreqSlider.value)+parseFloat(modFreqSlider.value)).toFixed(1)} kHz</strong>.`;
            } else {
                modTypeDesc.textContent = 'Frequency Modulation (FM)';
                const maxDev = parseInt(modDepthSlider.value) * parseFloat(mainFreqSlider.value) / 100;
                modEffectDesc.innerHTML = `the frequency varies by ¬±<strong>${maxDev.toFixed(1)} kHz</strong> around the carrier frequency. The modulation index is <strong>${(maxDev / parseFloat(modFreqSlider.value)).toFixed(2)}</strong>.`;
            }
        }
        
        // Set up event listeners
        function setupEventListeners() {
            // Slider inputs
            mainFreqSlider.addEventListener('input', () => {
                updateSliders();
                updateDescription();
            });
            
            modFreqSlider.addEventListener('input', () => {
                updateSliders();
                updateDescription();
            });
            
            modDepthSlider.addEventListener('input', () => {
                updateSliders();
                updateDescription();
            });
            
            volumeSlider.addEventListener('input', updateSliders);
            
            // Modulation type selection
            document.querySelectorAll('.wave-option[data-type]').forEach(option => {
                option.addEventListener('click', () => {
                    document.querySelectorAll('.wave-option[data-type]').forEach(opt => {
                        opt.classList.remove('active');
                    });
                    option.classList.add('active');
                    modulationType = option.dataset.type;
                    updateDescription();
                });
            });
            
            // Wave type selection
            document.querySelectorAll('.wave-option[data-wave]').forEach(option => {
                option.addEventListener('click', function() {
                    const group = this.closest('.control-group');
                    const isMainWave = group.querySelector('.control-label').textContent.includes('Carrier');
                    
                    // Remove active class from all in group
                    group.querySelectorAll('.wave-option').forEach(opt => {
                        opt.classList.remove('active');
                    });
                    
                    // Add active to clicked
                    this.classList.add('active');
                    
                    // Update state
                    if (isMainWave) {
                        mainWaveType = this.dataset.wave;
                    } else {
                        modWaveType = this.dataset.wave;
                    }
                    
                    updateSliders();
                });
            });
            
            // Play button
            playBtn.addEventListener('click', togglePlayback);
            
            // Reset button
            resetBtn.addEventListener('click', resetControls);
        }
        
        // Start animation loop
        function startAnimation() {
            if (animationId) {
                cancelAnimationFrame(animationId);
            }
            
            function animate(timestamp) {
                if (!lastUpdate) lastUpdate = timestamp;
                const deltaTime = (timestamp - lastUpdate) / 1000;
                lastUpdate = timestamp;
                
                currentTime += deltaTime * animationSpeed;
                if (currentTime > 100) currentTime = 0;
                
                drawWaveforms();
                animationId = requestAnimationFrame(animate);
            }
            
            animationId = requestAnimationFrame(animate);
        }
        
        // Draw waveforms on canvas
        function drawWaveforms() {
            const carrierCtx = carrierCanvas.getContext('2d');
            const resultCtx = resultCanvas.getContext('2d');
            
            const width = carrierCanvas.width = carrierCanvas.parentElement.clientWidth;
            const height = carrierCanvas.height = carrierCanvas.parentElement.clientHeight;
            resultCanvas.width = resultCanvas.parentElement.clientWidth;
            resultCanvas.height = resultCanvas.parentElement.clientHeight;
            
            // Clear canvases
            carrierCtx.clearRect(0, 0, width, height);
            resultCtx.clearRect(0, 0, resultCanvas.width, resultCanvas.height);
            
            // Draw grid
            drawGrid(carrierCtx, width, height);
            drawGrid(resultCtx, resultCanvas.width, resultCanvas.height);
            
            // Get values
            const carrierFreq = parseFloat(mainFreqSlider.value) * 1000; // Convert kHz to Hz
            const modFreq = parseFloat(modFreqSlider.value) * 1000; // Convert kHz to Hz
            const modDepth = parseInt(modDepthSlider.value) / 100;
            
            // Draw carrier wave
            drawWave(carrierCtx, width, height, carrierFreq, 1, '#4cc9f0', mainWaveType);
            
            // Draw modulation wave
            drawWave(carrierCtx, width, height, modFreq, 0.5, '#a78bfa', modWaveType, 30);
            
            // Draw modulated wave
            drawModulatedWave(carrierCtx, width, height, carrierFreq, modFreq, modDepth, '#f87171');
            
            // Draw result waveform
            drawModulatedWave(resultCtx, resultCanvas.width, resultCanvas.height, 
                              carrierFreq, modFreq, modDepth, '#4cc9f0');
        }
        
        // Draw grid on canvas
        function drawGrid(ctx, width, height) {
            ctx.strokeStyle = 'rgba(255, 255, 255, 0.05)';
            ctx.lineWidth = 1;
            
            // Vertical lines
            for (let x = 0; x < width; x += 20) {
                ctx.beginPath();
                ctx.moveTo(x, 0);
                ctx.lineTo(x, height);
                ctx.stroke();
            }
            
            // Horizontal lines
            for (let y = 0; y < height; y += 20) {
                ctx.beginPath();
                ctx.moveTo(0, y);
                ctx.lineTo(width, y);
                ctx.stroke();
            }
            
            // Center line
            ctx.strokeStyle = 'rgba(255, 255, 255, 0.1)';
            ctx.beginPath();
            ctx.moveTo(0, height / 2);
            ctx.lineTo(width, height / 2);
            ctx.stroke();
        }
        
        // Draw a single wave
        function drawWave(ctx, width, height, freq, amplitude, color, waveType, yOffset = 0) {
            ctx.beginPath();
            ctx.strokeStyle = color;
            ctx.lineWidth = 2;
            
            const centerY = height / 2 + yOffset;
            const samples = width;
            const timeScale = 0.0005;
            const tOffset = currentTime * 10;
            
            for (let x = 0; x < width; x++) {
                const t = (x / width + tOffset) * 2 * Math.PI * freq * timeScale;
                let y;
                
                switch(waveType) {
                    case 'sine':
                        y = Math.sin(t);
                        break;
                    case 'square':
                        y = Math.sin(t) > 0 ? 1 : -1;
                        break;
                    case 'triangle':
                        y = 1 - 2 * Math.abs(Math.round(t/(2*Math.PI)) - t/(2*Math.PI));
                        break;
                    case 'sawtooth':
                        y = 2 * (t/(2*Math.PI) - Math.floor(0.5 + t/(2*Math.PI)));
                        break;
                    default:
                        y = Math.sin(t);
                }
                
                const pixelY = centerY - y * amplitude * (height/3);
                
                if (x === 0) {
                    ctx.moveTo(x, pixelY);
                } else {
                    ctx.lineTo(x, pixelY);
                }
            }
            
            ctx.stroke();
        }
        
        // Draw modulated wave
        function drawModulatedWave(ctx, width, height, carrierFreq, modFreq, modDepth, color) {
            ctx.beginPath();
            ctx.strokeStyle = color;
            ctx.lineWidth = 2;
            
            const centerY = height / 2;
            const samples = width;
            const timeScale = 0.0005;
            const tOffset = currentTime * 10;
            
            for (let x = 0; x < width; x++) {
                const t = (x / width + tOffset) * 2 * Math.PI * carrierFreq * timeScale;
                const modT = (x / width + tOffset) * 2 * Math.PI * modFreq * timeScale;
                
                let modSignal;
                switch(modWaveType) {
                    case 'sine':
                        modSignal = Math.sin(modT);
                        break;
                    case 'square':
                        modSignal = Math.sin(modT) > 0 ? 1 : -1;
                        break;
                    case 'triangle':
                        modSignal = 1 - 2 * Math.abs(Math.round(modT/(2*Math.PI)) - modT/(2*Math.PI));
                        break;
                    case 'sawtooth':
                        modSignal = 2 * (modT/(2*Math.PI) - Math.floor(0.5 + modT/(2*Math.PI)));
                        break;
                    default:
                        modSignal = Math.sin(modT);
                }
                
                let carrierSignal;
                switch(mainWaveType) {
                    case 'sine':
                        carrierSignal = Math.sin(t);
                        break;
                    case 'square':
                        carrierSignal = Math.sin(t) > 0 ? 1 : -1;
                        break;
                    case 'triangle':
                        carrierSignal = 1 - 2 * Math.abs(Math.round(t/(2*Math.PI)) - t/(2*Math.PI));
                        break;
                    case 'sawtooth':
                        carrierSignal = 2 * (t/(2*Math.PI) - Math.floor(0.5 + t/(2*Math.PI)));
                        break;
                    default:
                        carrierSignal = Math.sin(t);
                }
                
                let y;
                if (modulationType === 'AM') {
                    // Amplitude Modulation: A * (1 + m*modSignal) * carrierSignal
                    y = carrierSignal * (1 + modDepth * modSignal);
                } else {
                    // Frequency Modulation: A * sin(œâ_c t + m * ‚à´ modSignal dt)
                    // Approximate integral as sum
                    const integral = modSignal * modT;
                    y = Math.sin(t + modDepth * integral);
                }
                
                const pixelY = centerY - y * (height/3);
                
                if (x === 0) {
                    ctx.moveTo(x, pixelY);
                } else {
                    ctx.lineTo(x, pixelY);
                }
            }
            
            ctx.stroke();
        }
        
        // Toggle sound playback
        function togglePlayback() {
            const resultWave = document.querySelector('.result-wave');
            
            if (isPlaying) {
                stopPlayback();
                playBtn.innerHTML = `
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" viewBox="0 0 16 16">
                        <path d="M11.596 8.697l-6.363 3.692c-.54.313-1.233-.066-1.233-.697V4.308c0-.63.692-1.01 1.233-.696l6.363 3.692a.802.802 0 0 1 0 1.393z"/>
                    </svg>
                    Play Sound
                `;
                isPlaying = false;
                resultWave.classList.remove('playing');
            } else {
                startPlayback();
                playBtn.innerHTML = `
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" viewBox="0 0 16 16">
                        <path d="M5.5 3.5A1.5 1.5 0 0 1 7 5v6a1.5 1.5 0 0 1-3 0V5a1.5 1.5 0 0 1 1.5-1.5zm5 0A1.5 1.5 0 0 1 12 5v6a1.5 1.5 0 0 1-3 0V5a1.5 1.5 0 0 1 1.5-1.5z"/>
                    </svg>
                    Stop Sound
                `;
                isPlaying = true;
                resultWave.classList.add('playing');
            }
        }
        
        // Start audio playback
        function startPlayback() {
            // Create audio context if not already created
            if (!audioContext) {
                audioContext = new (window.AudioContext || window.webkitAudioContext)();
            }
            
            // Get values
            const carrierFreq = parseFloat(mainFreqSlider.value) * 1000; // Convert kHz to Hz
            const modFreq = parseFloat(modFreqSlider.value) * 1000; // Convert kHz to Hz
            const modDepth = parseInt(modDepthSlider.value) / 100;
            const volume = parseInt(volumeSlider.value) / 100;
            
            // Create oscillator and gain node
            const oscillator = audioContext.createOscillator();
            const gainNode = audioContext.createGain();
            
            // Set oscillator type based on main wave type
            switch(mainWaveType) {
                case 'sine':
                    oscillator.type = 'sine';
                    break;
                case 'square':
                    oscillator.type = 'square';
                    break;
                case 'triangle':
                    oscillator.type = 'triangle';
                    break;
                case 'sawtooth':
                    oscillator.type = 'sawtooth';
                    break;
                default:
                    oscillator.type = 'sine';
            }
            
            // Apply modulation
            if (modulationType === 'AM') {
                // Create modulator for AM
                const modulator = audioContext.createOscillator();
                const modulationGain = audioContext.createGain();
                
                // Set modulator type
                switch(modWaveType) {
                    case 'sine':
                        modulator.type = 'sine';
                        break;
                    case 'square':
                        modulator.type = 'square';
                        break;
                    case 'triangle':
                        modulator.type = 'triangle';
                        break;
                    case 'sawtooth':
                        modulator.type = 'sawtooth';
                        break;
                    default:
                        modulator.type = 'sine';
                }
                
                modulator.frequency.value = modFreq;
                modulationGain.gain.value = modDepth;
                
                // Connect modulator to gain of carrier
                modulator.connect(modulationGain);
                modulationGain.connect(gainNode.gain);
                
                // Start modulator
                modulator.start();
            } else {
                // FM modulation
                const modulator = audioContext.createOscillator();
                const modulationGain = audioContext.createGain();
                
                // Set modulator type
                switch(modWaveType) {
                    case 'sine':
                        modulator.type = 'sine';
                        break;
                    case 'square':
                        modulator.type = 'square';
                        break;
                    case 'triangle':
                        modulator.type = 'triangle';
                        break;
                    case 'sawtooth':
                        modulator.type = 'sawtooth';
                        break;
                    default:
                        modulator.type = 'sine';
                }
                
                modulator.frequency.value = modFreq;
                modulationGain.gain.value = carrierFreq * modDepth;
                
                // Connect modulator to frequency of carrier
                modulator.connect(modulationGain);
                modulationGain.connect(oscillator.frequency);
                
                // Start modulator
                modulator.start();
            }
            
            // Set carrier frequency and volume
            oscillator.frequency.value = carrierFreq;
            gainNode.gain.value = volume * 0.5; // Reduce volume to avoid clipping
            
            // Connect and start
            oscillator.connect(gainNode);
            gainNode.connect(audioContext.destination);
            oscillator.start();
            
            // Store nodes for later cleanup
            oscillator.onended = () => {
                isPlaying = false;
                playBtn.innerHTML = `
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" viewBox="0 0 16 16">
                        <path d="M11.596 8.697l-6.363 3.692c-.54.313-1.233-.066-1.233-.697V4.308c0-.63.692-1.01 1.233-.696l6.363 3.692a.802.802 0 0 1 0 1.393z"/>
                    </svg>
                    Play Sound
                `;
                document.querySelector('.result-wave').classList.remove('playing');
            };
            
            // Stop after 4 seconds
            setTimeout(() => {
                if (isPlaying) {
                    oscillator.stop();
                    isPlaying = false;
                    playBtn.innerHTML = `
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" viewBox="0 0 16 16">
                            <path d="M11.596 8.697l-6.363 3.692c-.54.313-1.233-.066-1.233-.697V4.308c0-.63.692-1.01 1.233-.696l6.363 3.692a.802.802 0 0 1 0 1.393z"/>
                        </svg>
                        Play Sound
                    `;
                    document.querySelector('.result-wave').classList.remove('playing');
                }
            }, 4000);
        }
        
        // Stop audio playback
        function stopPlayback() {
            if (audioContext) {
                audioContext.close();
                audioContext = null;
            }
            isPlaying = false;
        }
        
        // Reset controls to default
        function resetControls() {
            mainFreqSlider.value = 10;
            modFreqSlider.value = 1;
            modDepthSlider.value = 50;
            volumeSlider.value = 80;
            
            // Reset wave types
            document.querySelectorAll('.wave-option[data-type]').forEach(opt => {
                opt.classList.remove('active');
                if (opt.dataset.type === 'AM') {
                    opt.classList.add('active');
                }
            });
            
            document.querySelectorAll('.wave-option[data-wave]').forEach(opt => {
                opt.classList.remove('active');
                if (opt.dataset.wave === 'sine') {
                    opt.classList.add('active');
                }
            });
            
            modulationType = 'AM';
            mainWaveType = 'sine';
            modWaveType = 'sine';
            
            updateSliders();
            updateDescription();
        }
        
        // Initialize on load
        window.addEventListener('load', init);
    </script>
</body>
</html>